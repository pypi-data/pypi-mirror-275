[tox]
isolated_build = True
envlist = py38,py39,py310,py311,py312

[testenv]
deps =
    black
    coverage
    flake8
    mccabe
    mypy
    pylint
    pytest
    testcontainers-core
    # Pin version to fix docker version: https://github.com/Red5d/docker-autocompose/issues/73
    requests<2.29
commands =
    coverage erase
    coverage run
    coverage combine
    coverage report -m
    coverage xml
    black keyraser_client --line-length 88 --skip-string-normalization
    flake8 keyraser_client
    pylint keyraser_client --rcfile=tox.ini
;     mypy keyraser_client --config-file tox.ini
pass_env =
    KR_BINARIES
    DOCKER_HOST

[testenv:docs]
description = Build the documentation for dev without committing
basepython = python3.12
deps =
    mkdocs
    mkdocs-material
    mkdocstrings[python]
    mkdocs-git-revision-date-plugin
commands =
    mkdocs build
;     mkdocs serve # Uncomment to check the built documentation locally

[testenv:docs-release]
description = Build the documentation for a release
basepython = python3.12
deps =
    mkdocs
    mkdocs-material
    mkdocstrings[python]
    mkdocs-git-revision-date-plugin
    mike
commands =
    mike deploy --deploy-prefix build -b docs-deployment --update-aliases {env:VERSION_TAG:dev} {env:VERSION_ALIAS:latest}
    mike set-default --deploy-prefix build -b docs-deployment latest
passenv =
    HOME
    VERSION_TAG
    VERSION_ALIAS

[coverage:run]
branch = True
command_line = -m pytest
parallel = True
source =
    keyraser_client/

[coverage:report]
exclude_lines =
    if __name__ == .__main__.:

[flake8]
extend-ignore = E203
exclude = .git,__pycache__,docs/source/conf.py,old,build,dist,test_*.py
max-complexity = 10
max-line-length = 88
per-file-ignores =
    keyraser_client/__init__.py:F401

[pylint]
ignore-paths=^keyraser_client/test_.*$
; R0903: too-few-public-methods
; R0913: too-many-arguments
; R1704: redefined-argument-from-local
; W0621: redefined-outer-name
; W0622: redefined-builtin
disable=R0903,R0913,R1704,W0621,W0622

[mypy]

[SIMILARITIES]
# Minimum lines number of a similarity.
min-similarity-lines=4
# Ignore comments when computing similarities.
ignore-comments=yes
# Ignore docstrings when computing similarities.    requests<2.2.29
ignore-docstrings=yes
# Ignore imports when computing similarities.coverage
ignore-imports=yes
