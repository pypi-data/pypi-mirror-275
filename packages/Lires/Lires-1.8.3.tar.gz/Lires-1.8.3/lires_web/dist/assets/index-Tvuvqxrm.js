var Lt=Object.defineProperty;var qt=(o,t,e)=>t in o?Lt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var ne=(o,t,e)=>(qt(o,typeof t!="symbol"?t+"":t,e),e);import{d as B,f as U,B as p,C as g,D as fe,E as ae,o as he,G as vt,H as n,c as k,I,w as oe,a as y,F as H,J as te,z as S,K as Q,L as A,M,N as Ge,O as q,P as Et,Q as Ft,R as se,S as ie,U as Je,V as gt,W as me,X as V,Y as zt,Z as X,_ as Qe,$ as je,a0 as Be,a1 as Le,a2 as Ot,a3 as ut,a4 as Ht,n as _t,r as Nt,y as Wt,a5 as Ze,a6 as Oe,a7 as jt}from"./@vue-D_lT-ze_.js";import{d as Ne,c as Vt}from"./pinia-BHWH00Pk.js";import{u as ye,a as yt,c as Kt,b as Zt}from"./vue-router-DNoSD41y.js";import{M as Gt}from"./async-mutex-CSJywVGb.js";import{f as Jt}from"./fast-xml-parser-CJG3bOwu.js";import{P as Ve}from"./plotly.js-dist-FakLekxN.js";import{E as Qt,M as Yt}from"./md-editor-v3-CPol1xJ_.js";import{m as Xt}from"./gray-matter-D4hcLa5V.js";import"./vite-plugin-node-polyfills-Cgl3E5jI.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-B1uT6SkR.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-DtLj4T47.js";import"./@codemirror-4Zn9bE8B.js";import"./@lezer-tqr6QOpM.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-bWEtUbjf.js";import"./markdown-it-DI8MEbma.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-task-lists-BNI9E7ji.js";import"./markdown-it-xss-DEpVfk-m.js";import"./xss-DnjGkJ2-.js";import"./cssfilter-BjxKUPhv.js";import"./node-stdlib-browser-d7cmxmpa.js";import"./section-matter-DWrNKXO4.js";import"./kind-of-l3izQsJJ.js";import"./extend-shallow-DA8A8LGH.js";import"./is-extendable-CiA4f1iz.js";import"./js-yaml-B7yGoGZD.js";import"./strip-bom-string-BxrG9K6S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const en=B({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(o){const t=o,e=U(()=>{switch(t.styleType){case"alert":case"error":return{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"};case"warning":return{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"};case"info":return{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"};case"success":return{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"};default:return{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}}}),a=U(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(s,i)=>(p(),g("div",{id:"popup",style:ae({...e.value,...a.value})},[fe(s.$slots,"default",{},void 0)],4))}}),E=(o,t)=>{const e=o.__vccOpts||o;for(const[a,s]of t)e[a]=s;return e},ct=E(en,[["__scopeId","data-v-7a7b12ca"]]),pe="->";class N extends Set{static removeSpaces(t){const e=t.split(pe);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(pe),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>N.removeSpaces(a)),super(e)}copy(){return new N(this)}add(t){return super.add(N.removeSpaces(t))}has(t){return super.has(N.removeSpaces(t))}union(t){const e=new N(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new N(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return De.isSubset(this,t)}withParents(){const t=new N(this);return this.forEach(e=>t.union_(De.allParentsOf(e))),t}withChildsFrom(t){const e=new N(this);return this.forEach(a=>e.union_(De.allChildsOf(a,t))),e}allParents(){const t=new N;return this.forEach(e=>t.union_(De.allParentsOf(e))),t}toArray(){return Array.from(this)}}class De{static allParentsOf(t){const e=t.split(pe);if(e.length===1)return new N([]);const a=[],s=[];for(let i=0;i<e.length-1;i++)a.push(e[i]),s.push(a.join(pe));return new N(s)}static allChildsOf(t,e){const a=new N;for(const s of e)s.startsWith(t)&&s.length>t.length+pe.length&&s.substring(t.length,t.length+pe.length)===`${pe}`&&a.add(s);return a}static tagHierarchy(t){const e=pe;function a(r,l){const c=r.split(l);return c.length===1?[r]:[c[0],c.slice(1).join(l)]}function s(r,l=e){const c={},_=r.map(d=>a(d,l));for(const d of _)d[0]in c||(c[d[0]]=[]),d.length===2&&c[d[0]].push(d[1]);const u={};for(const d in c)u[d]=s(c[d],l);return u}function i(r,l=e){for(const c in r){const _=r[c];for(const u in _){const d=[c,u].join(e);_[d]=_[u],delete _[u]}i(_,l)}return r}return i(s(Array.from(t)))}static isSubset(t,e){let a=!0;for(const s of t)if(!e.has(s)){a=!1;break}return a}}class Re{constructor(t,e){ne(this,"summary");ne(this,"supp");ne(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get dtype(){return this.summary.doc_type}get tags(){return new N(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.reqDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.updateDatapointAbstract(this.summary.uuid,t).then(s=>{this.supp.abstract=t,e(s)}).catch(s=>{a(s)})})}fetchNote(){return new Promise((t,e)=>{this.conn.reqDatapointNote(this.summary.uuid).then(a=>{this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):new Promise((e,a)=>{this.conn.updateDatapointNote(this.summary.uuid,t).then(s=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(i=>i.trim()==""?0:1).reduce((i,r)=>i+r,0),e(s)}).catch(s=>{a(s)})})}deleteMiscFile(t){return this.conn.deleteMiscFile(this.summary.uuid,t)}renameMiscFile(t,e){return this.conn.renameMiscFile(this.summary.uuid,t,e)}listMiscFiles(){const t=this.conn.reqMiscFileList(this.summary.uuid),e=`${this.backendUrl}/misc/${this.summary.uuid}`;return t.then(a=>a.map(s=>{const i=new URLSearchParams;return i.append("fname",s),i.append("_u",G().user.id.toString()),{fname:s,rpath:`./misc/${s}`,url:`${e.toString()}?${i.toString()}`}}))}uploadMisc(t){return new Promise((e,a)=>{this.conn.uploadMiscFiles(this.summary.uuid,t).then(s=>{e(s.map(i=>`./misc/${i}`))},s=>{a(s)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.deleteDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.reqDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=He}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===He.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}?_u=${G().user.id}`:!this.summary.has_file&&this.url?this.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const a=`${this.backendUrl}/pdfjs/web/viewer.html`;function s(l,c=a){const _=new URLSearchParams;c===a&&_.append("key",W().encKey),_.append("file",`${l}`);for(const u in t)_.append(u,t[u]);return`${c}?${_.toString()}`}function i(l){return e?(new URL(l).hash&&(l=l.slice(0,l.indexOf("#"))),`${l}#${e}`):l}let r="about:blank";if(this.isDummy()&&(r="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const l=this.getRawDocURL();r=s(i(l))}if(this.summary.has_file&&this.summary.file_type==".html"){const l=this.getRawDocURL();r=i(l)}return!this.summary.has_file&&this.summary.url&&(r=i(this.summary.url)),console.log("Open doc url: ",r),r}fileType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const He={doc_type:"",has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class tn{constructor(t){ne(this,"cache");ne(this,"tags");ne(this,"uids");ne(this,"dataInfoAcquireMutex",new Gt);ne(this,"conn");ne(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new N,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){await this.updateKeyCache(),await this.updateTagCache(),this._initliazed=!0,console.log("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.reqAllKeys()}async updateTagCache(){this.tags=new N(await this.conn.reqAllTags())}async update(t,e=!0){let a;return t.uuid in this.cache?(this.cache[t.uuid].update(t),a=this.cache[t.uuid].tags):(this.cache[t.uuid]=new Re(this.conn,t),a=new N),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),e&&(i=>{const r=new N;for(const l in this.cache)r.union_(this.cache[l].tags);return this.tags.union_(r),!i.issubset(r)})(a)&&await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new N([]),this._initliazed=!1}async delete(t,e=!0){let a;t in this.cache?(a=this.cache[t].tags,delete this.cache[t]):a=null,this.uids.includes(t)&&(this.uids=this.uids.filter(i=>i!==t)),e&&(i=>{if(i===null)return!0;const r=new N;for(const l in this.cache)r.union_(this.cache[l].tags);return!i.issubset(r)})(a)&&await this.updateTagCache()}hasCache(t){return t in this.cache}getDummy(){return new Re(this.conn,He)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.reqDatapointSummary(t);this.cache[t]=new Re(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new Re(this.conn,He)}return this.cache[t]}async agetMany(t,e=!0,a=!0){const s=async()=>{this.dataInfoAcquireMutex.acquire();try{const l=Object.keys(this.cache),c=t.filter(d=>!l.includes(d));if(c.length===0)return t.map(d=>this.cache[d]);const _=await this.conn.reqDatapointSummaries(c);console.log("DEBUG: get data points of size: ",_.length),_.map(d=>new Re(this.conn,d)).forEach(d=>{this.cache[d.uid]=d})}catch(l){throw l}finally{this.dataInfoAcquireMutex.release()}return t.map(l=>this.cache[l])},i=async()=>await Promise.all(t.map(l=>this.aget(l)));if(e)try{return await s()}catch(r){if(a)return console.warn("Caught error in agetMany: ",r),await i();throw r}return await i()}async agetByAuthor(t){const e=await this.conn.query({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new N(t);const e=[];for(const a in this.cache){const s=this.cache[a],i=new N(s.summary.tags);t.issubset(i.withParents())&&e.push(s)}return e}}class dt{constructor(t,e){ne(this,"conn");ne(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let a;return e===null?a="":e<0?a=`&t=${Date.now()}`:a=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${a}`}}class nn{constructor(t){ne(this,"conn");this.conn=t}async list(){return(await this.conn.reqUserList()).map(e=>new dt(this.conn,e))}async get(t){let e=await this.conn.reqUserInfo(t);return new dt(this.conn,e)}}var ve=function o(t){function e(le,F){return le>>>F|le<<32-F}for(var a=Math.pow,s=a(2,32),i="length",r,l,c="",_=[],u=t[i]*8,d=o.h=o.h||[],f=o.k=o.k||[],v=f[i],h={},x=2;v<64;x++)if(!h[x]){for(r=0;r<313;r+=x)h[r]=x;d[v]=a(x,.5)*s|0,f[v++]=a(x,1/3)*s|0}for(t+="";t[i]%64-56;)t+="\0";for(r=0;r<t[i];r++){if(l=t.charCodeAt(r),l>>8)throw new Error("ASCII check failed");_[r>>2]|=l<<(3-r)%4*8}for(_[_[i]]=u/s|0,_[_[i]]=u,l=0;l<_[i];){var D=_.slice(l,l+=16),C=d;for(d=d.slice(0,8),r=0;r<64;r++){var m=D[r-15],$=D[r-2],P=d[0],w=d[4],b=d[7]+(e(w,6)^e(w,11)^e(w,25))+(w&d[5]^~w&d[6])+f[r]+(D[r]=r<16?D[r]:D[r-16]+(e(m,7)^e(m,18)^m>>>3)+D[r-7]+(e($,17)^e($,19)^$>>>10)|0),T=(e(P,2)^e(P,13)^e(P,22))+(P&d[1]^P&d[2]^d[1]&d[2]);d=[b+T|0].concat(d),d[4]=d[4]+b|0}for(r=0;r<8;r++)d[r]=d[r]+C[r]|0}for(r=0;r<8;r++)for(l=3;l+1;l--){var Y=d[r]>>l*8&255;c+=(Y<16?0:"")+Y.toString(16)}return c};class an{constructor({baseUrlGetter:t=()=>"",tokenGetter:e=()=>"",sessionIDGetter:a=()=>""}){this._baseUrlGetter=t,this._tokenGetter=e,this._sessionIDGetter=a}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}get sessionID(){return this._sessionIDGetter()}async get(t,e={}){const a=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(s=>a.searchParams.append(s,e[s])),await this._fetch(a.toString(),{method:"GET"})}async post(t,e={}){const a=new FormData;for(const s in e){let i=e[s];i instanceof Array&&(i=JSON.stringify(i)),a.append(s,i)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:a})}async put(t,e){const a=new FormData;return a.append("key",this._tokenGetter()),a.append("session_id",this._sessionIDGetter()),a.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:a})}async delete(t,e={}){const a=new FormData;for(const s in e){let i=e[s];i instanceof Array&&(i=JSON.stringify(i)),a.append(s,i)}return a.append("key",this._tokenGetter()),a.append("session_id",this._sessionIDGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:a})}async _fetch(t,e){if(e===void 0&&(e={}),e.headers===void 0?e.headers=new Headers:typeof e.headers=="string"?e.headers=new Headers(e.headers):e.headers=new Headers(e.headers),e.headers.append("Authorization",`Bearer ${this._tokenGetter()}`),(e==null?void 0:e.method)==="GET"){const s=new URL(t);s.searchParams.append("session_id",this._sessionIDGetter()),t=s.toString()}else if((e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(typeof e.body=="string")e.body=JSON.stringify({session_id:this._sessionIDGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("session_id")||e.body.append("session_id",this._sessionIDGetter());else throw new Error("Not implemented body type");const a=await fetch(t,e);if(!a.ok)throw new Error(`Request failed with status ${a.status}`);return a}}class on{constructor(t,e=()=>""){ne(this,"docDry",(t,e)=>this.doc(t,e).replace("/doc/","/doc-dry/"));ne(this,"docText",(t,e)=>this.doc(t,e).replace("/doc/","/doc-text/"));this.baseURLGetter=t,this.tokenGetter=e}get baseURL(){return this.baseURLGetter()}get token(){return this.tokenGetter()}doc(t,e){return`${this.baseURL}/doc/${t}?_u=${e}`}databaseDownload(t=!1){return`${this.baseURL}/api/database/download?data=${t}&key=${this.token}`}miscFile(t,e){const a=encodeURIComponent(e);return`${this.baseURL}/misc/${t}?fname=${a}`}userAvatar(t,e={size:128,t:-1}){let a;return e.t===null?a="":e.t<0?a=`&t=${Date.now()}`:a=`&t=${e.t}`,`${this.baseURL}/user-avatar/${t}?size=${e.size}${a}`}}class sn{constructor(t,e,a=null){if(a===null){const s=Math.random().toString(36).substring(2);a=()=>s}this.fetcher=new an({baseUrlGetter:t,tokenGetter:e,sessionIDGetter:a}),this.resolve=new on(t,e)}get baseURL(){return this.fetcher.baseUrl}async authorize(){return await this.fetcher.post("/api/auth").then(t=>t.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async reqAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:a.toString()}).then(s=>s.json())}async reqDatabaseUsage(){return await this.fetcher.get("/api/database/usage").then(t=>t.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async reqDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async deleteDatapoint(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async updateDatapoint(t,{bibtex:e=null,tags:a=null,url:s=null}){if(!t&&(e===null||a===null||s===null))throw new Error("uid is null, other fields should be complete");const i={};return t!==null&&(i.uuid=t),e!==null&&(i.bibtex=e),a!==null&&(i.tags=JSON.stringify(a)),s!==null&&(i.url=s),await this.fetcher.post("/api/dataman/update",i).then(r=>r.json())}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async updateDatapointAbstract(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(a=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async updateDatapointNote(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(a=>!0)}async query({tags:t=[],searchBy:e="title",searchContent:a="",maxResults:s=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:a,top_k:s}).then(i=>i.json())}async featurizeText(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(a=>a.json())}reqAISummary(t,e,a=()=>{},s=!0,i="DEFAULT"){this.fetcher.post("/api/summary",{force:s,uuid:t,model:i}).then(r=>{if(!r.ok)throw e("(Error: "+r.status+")"),new Error("HTTP error "+r.status);const l=r.body.getReader(),c=({value:_,done:u})=>{if(u){a();return}let d=new TextDecoder().decode(_);return e(d),l.read().then(c)};return l.read().then(c)})}async reqMiscFileList(t){return await this.fetcher.get(`/api/misc-list/${t}`).then(e=>e.json())}async deleteMiscFile(t,e){return await this.fetcher.delete(`/misc/${t}`,{fname:e}).then(()=>!0)}async renameMiscFile(t,e,a){return await this.fetcher.post(`/misc/${t}`,{fname:e,dst_fname:a}).then(()=>!0)}async uploadMiscFiles(t,e){return(await Promise.all(e.map(s=>new Promise((i,r)=>{this.fetcher.put(`/misc/${t}`,s).then(l=>l.json()).then(i).catch(r)})))).map(s=>s.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(a=>a.json())}async deleteDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async updateTagAll(t,e){return await this.fetcher.post("/api/database/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTagAll(t){return await this.fetcher.post("/api/database/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:ve(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(a=>a.json())}async updateUserAccess(t,e,a,s){const i={};return i.username=t,e!==null&&(i.is_admin=e.toString()),a!==null&&(i.mandatory_tags=JSON.stringify(a)),s!==null&&(i.max_storage=s),await this.fetcher.post("/api/userman/modify",i).then(r=>r.json())}async registerUser(t,e,a,s){return await this.fetcher.post("/api/userman/register",{invitation_code:t,username:e,password:ve(a),name:s}).then(i=>i.json())}async createUser(t,e,a,s,i,r){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:ve(a),is_admin:s.toString(),mandatory_tags:JSON.stringify(i),max_storage:r}).then(l=>l.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async reqFeedList({maxResults:t=10,category:e="",timeBefore:a=-1,timeAfter:s=-1}){return console.log("reqFeedList",t,e,a,s),await this.fetcher.post("/api/feed/query",{max_results:t,category:e,time_before:a,time_after:s}).then(i=>i.json())}async reqFeedCategories(){return await this.fetcher.get("/api/feed/categories").then(t=>t.json())}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const ge={};window.g_eventHooks=ge;function de(o,t){if(Array.isArray(o)){for(const e of o)de(e,t);return}ge[o]===void 0&&(ge[o]=[]),ge[o].includes(t)||ge[o].push(t)}function wt(o,t){if(Array.isArray(o)){for(const e of o)wt(e,t);return}ge[o]!==void 0&&(ge[o]=ge[o].filter(e=>e!==t))}function rn(o,t){he(()=>{de(o,t),console.log(`registered event callback [${o}]`,t.name)}),vt(()=>{wt(o,t),console.log(`unregistered event callback [${o}]`,t.name)})}class ln{constructor(t,e){ne(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});ne(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});ne(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);ne(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=ve(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:a=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=i=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:s=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s};const i=new URLSearchParams(window.location.search);i.append("key",this.__tokenGetter()),i.append("session_id",this.sessionID);const r=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+i.toString();return console.log("connecting to server websocket at: ",r),this.ws=new WebSocket(r),this.ws.onmessage=l=>{console.log(l);const c=JSON.parse(l.data);if(c.type==="event"){const _=c.content;if(console.log(_),Object.keys(ge).includes(_.type))for(const u of ge[_.type])u(_)}e(l)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(l=>setTimeout(l,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s})})):s()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}resetReconnect(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.__remainingRetries=0,this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}async function Ye(o){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(o),!0;{const t=document.createElement("textarea");t.value=o,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function un(o){window.open(o,"_blank")}function bt(o,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{o(...a),e=null},t)}}function kt(o){let t,e,a;function s(l){var c;return((c=o.match(new RegExp(`^\\s*${l}\\s*=\\s*({.*}|"[^"]*"),?\\s*$`,"m")))==null?void 0:c[1])||""}function i(l){return l.replace(/"/g,"").replace(/{/g,"").replace(/}/g,"").trim()}t=s("volume"),e=s("number"),e||(e=s("issue")),a=s("pages"),a=a.replace("--","-"),t=i(t),e=i(e),a=i(a);let r="";return t&&(r+=`${t}`),e&&(r+=`(${e})`),a&&(r?r+=`: ${a}`:r+=`${a}`),r}function ht(o,t,e=null){let a="";if(e){let s=new Date;s.setTime(s.getTime()+e*24*60*60*1e3),a=`expires=${s.toUTCString()}; `}document.cookie=`${o}=${t}; ${a} path=/; sameSite=Lax`}function cn(o){return decodeURIComponent(document.cookie).split("; ").forEach(a=>{if(a.startsWith(`${o}=`)&&a.includes("expires"))return!0}),!1}function dn(o){const e=decodeURIComponent(document.cookie).split("; ");let a="";return e.forEach(s=>{s.indexOf(o)===0&&(a=s.substring(`${o}=`.length))}),a}const z=Ne("uiStatus",{state:()=>({tagStatus:{checked:new N,all:new N,unfolded:new N},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"title",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,showMiscPanel:!1,showNotePreview:null,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal},focusedDataUID(){return this.unfoldedDataUIDs.length===0?null:this.unfoldedDataUIDs[0]}},actions:{updateShownData(){const o=G();this.tagStatus.all=o.allTags,console.log("DEBUG: updateShownData() is called."),ee().conn.query({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(o){this.recentlyReadDataUIDs.includes(o)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(o),1),this.recentlyReadDataUIDs.unshift(o),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},showPopup(o,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:o,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(){G().reload(()=>{this.databaseLoadingStatus.nCurrent=0,G().database.clear(),this.updateShownData()},()=>{z().databaseLoadingStatus.nTotal=-1,z().tagStatus.all=G().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${ee().conn.baseURL}`,"alert"),z().databaseLoadingStatus.nTotal=-1})}}}),ee=Ne("connection",{state:()=>{const o=new ln(W().backend,()=>W().encKey);return{conn:new sn(W().backend,()=>W().encKey,()=>o.sessionID),wsConn:o}}}),G=Ne("data",{state:()=>({database:new tn(ee().conn),userPool:new nn(ee().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}},reload(o=()=>{this.database.clear()},t=()=>{},e=()=>{}){o();function a(s){s.database.init().then(i=>{t()},i=>{e(i)})}a(this)}}}),W=Ne("settings",{state:()=>({__encKey:(()=>{const o=localStorage.getItem("encKey");return o?(localStorage.removeItem("encKey"),ht("encKey",o,1),o):dn("encKey")})(),__showTagPanel:(localStorage.getItem("showTagPanel")||String(window.innerWidth>768))==="true",__showHomeInfoPanel:(localStorage.getItem("showHomeInfoPanel")||"false")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||hn(),__backendPort:sessionStorage.getItem("backendPort")||pn(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},showHomeInfoPanel(){return this.__showHomeInfoPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(o,t=void 0){t===void 0&&(t=cn("encKey")),this.__encKey=o,ht("encKey",o,t?7:null)},setBackendHost(o){this.__backendHost=o,sessionStorage.setItem("backendUrl",o)},setBackendPort(o){this.__backendPort=o,sessionStorage.setItem("backendPort",o)},setShowTagPanel(o){this.__showTagPanel=o,localStorage.setItem("showTagPanel",o.toString())},setShowHomeInfoPanel(o){this.__showHomeInfoPanel=o,localStorage.setItem("showHomeInfoPanel",o.toString())},setShow3DScatterPlot(o){this.__show3DScatterPlot=o,localStorage.setItem("show3DScatterPlot",o.toString())},setReaderLayoutType(o){this.__readerLayoutType=o.toString(),localStorage.setItem("readerLayoutType",o.toString())},setNumItemsPerPage(o){this.__numItemsPerPage=o.toString(),localStorage.setItem("numItemsPerPage",o.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function hn(){let o=window.location.protocol,t=window.location.hostname;return`${o}//${t}`}function pn(){const o=window.location.port;return o==="1420"?"8080":o}function Xe(o,t,e){W().setEncKey(o,e),t!==null?G().user=t:G().clearUserInfo(),t?W().loggedIn=!0:W().loggedIn=!1}function fn(){Xe("",null,!0)}async function mn(){const o=ee().conn,t=W().encKey;try{const e=await o.authorize();return Xe(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function vn(o,t){return ve(o+ve(t))}const gn={class:"loading-widget"},_n=B({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(o){const t=o,e=U(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,s)=>(p(),g("div",gn,[n("div",{class:"loading-widget__spinner",style:ae(e.value)},null,4)]))}}),We=E(_n,[["__scopeId","data-v-1d6933bb"]]),yn={class:"loading-popout"},wn=B({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(o){const t=o;return(e,a)=>(p(),g("div",yn,[k(We,{size:"25px"}),n("label",null,I(t.text),1)]))}}),$t=E(wn,[["__scopeId","data-v-95a13423"]]),Ae=[];class J{static registerThemeChangeCallback(t){Ae.indexOf(t)===-1&&Ae.push(t)}static unregisterThemeChangeCallback(t){const e=Ae.indexOf(t);e!==-1&&Ae.splice(e,1)}static toggleDarkMode(){document.documentElement.classList.contains("light")?J.setDarkMode(!0):document.documentElement.classList.contains("dark")?J.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,J.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?J.setDarkMode(!0):t=="light"?J.setDarkMode(!1):J.isDefaultDarkMode()&&!J.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let a of Ae)a(t);if(e){const a=t?"dark":"light";localStorage.getItem("themeMode")!==a&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function pt(o,t){let e=o.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Me(o){if(o===null||typeof o!="object")return o;let t=Array.isArray(o)?[]:{};for(let e in o)t[e]=Me(o[e]);return t}function St(o,t,e=!1){if(o.length!==t.length)throw new Error("arr.length !== scores.length");const a=new Array;for(let l=0;l<o.length;l++)a.push([o[l],t[l]]);let s;e?s=a.sort((l,c)=>l[1]-c[1]):s=a.sort((l,c)=>c[1]-l[1]);const i=new Array,r=new Array;for(const l of s)i.push(l[0]),r.push(l[1]);return[i,r]}const bn=o=>(se("data-v-934929d5"),o=o(),ie(),o),kn={id:"popups"},$n=bn(()=>n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),Sn={id:"app"},xn=B({__name:"App",setup(o){const t=ye(),e=z(),a=W();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&W().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&W().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&W().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const h=()=>{a.loggedIn?a.loggedIn=!1:s()};mn().then(x=>{x||h()},()=>{h()})}});function s(){G().$reset(),z().$reset(),i.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}oe(()=>a.loggedIn,(h,x)=>{h?f():s()});const i=ee().wsConn,r=y(!1),l=y(!1),c=y(window.location.hash.split("?")[0]==="#/login");t.afterEach((h,x)=>{c.value=h.path==="/login"});const _=U(()=>!r.value&&!c.value&&!l.value),u=U(()=>l.value&&!c.value);function d(){i.connect({onopenCallback:()=>{r.value=!0,l.value=!1},oncloseCallback:()=>r.value=!1,onfailedToConnectCallback:()=>l.value=!0})}setInterval(()=>{!i.isOpen()&&r.value&&!c.value&&!l.value?(console.log("DEBUG: Connection lost, try to reconnect"),r.value=!1,d()):c.value&&i.willTryReconnect()&&(console.log("DEBUG: In login page, close connection."),i.close())},5e3);function f(){d(),e.reloadDatabase()}de("add_entry",h=>{const x=G(),D=h.datapoint_summary;x.database.update(D).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),de(["update_entry","update_note"],h=>{const x=G(),D=h.datapoint_summary;x.database.update(D).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),de("delete_entry",h=>{const x=G(),D=h.uuid;x.database.delete(D).then(()=>{console.log("DEBUG: delete entry update UI"),e.updateShownData()})}),de(["delete_tag","update_tag"],h=>{const x=new N([h.src_tag]),D=G();(async function(){await D.database.updateTagCache();const m=D.database.getCacheByTags(x);await Promise.all(m.map($=>$.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),de("update_user",h=>{if(h.username===G().user.username){if(h.user_info===null)throw new Error("assertion failed: User info is null");for(const x of Object.keys(G().user))x!=="enc_key"&&(G().user[x]=h.user_info[x])}});const v=()=>{window.location.reload()};return he(()=>{J.setDefaultDarkMode()}),(h,x)=>{const D=Ge("router-view");return p(),g(H,null,[n("div",kn,[(p(!0),g(H,null,te(Object.keys(S(e).popupValues),(C,m)=>(p(),Q(ct,{key:m,styleType:S(e).popupValues[C].styleType,style:ae({transform:`translate(-50%, ${-50+110*m}%) scale(0.9)`})},{default:M(()=>[q(I(S(e).popupValues[C].content),1)]),_:2},1032,["styleType","style"]))),128))]),_.value?(p(),Q($t,{key:0,text:"connecting..."})):A("",!0),u.value?(p(),Q(ct,{key:1,styleType:"info",position:"center"},{default:M(()=>[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[$n,n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[q(" Please check if the server is running, make sure your network is working properly, and try to "),n("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:v},"reload the page"),q(". ")])])]),_:1})):A("",!0),n("div",Sn,[k(D,null,{default:M(({Component:C})=>[(p(),Q(Ft,{exclude:"Reader"},[(p(),Q(Et(C)))],1024))]),_:1})])],64)}}}),Cn=E(xn,[["__scopeId","data-v-934929d5"]]),Dn={for:"chk"},Pn={id:"checkCircle"},In={key:0,id:"checkStatus"},Tn=B({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(o,{emit:t}){const e=t,a=o;function s(i){e("onCheck",a.identifier)}return(i,r)=>(p(),g("div",{class:"toggle",onClick:s},[n("label",Dn,[fe(i.$slots,"default",{},void 0)]),n("div",Pn,[i.checked?(p(),g("div",In)):A("",!0)])]))}}),Se=E(Tn,[["__scopeId","data-v-582ee950"]]),Un={class:"toggleText"},Rn={class:"children slideInDown"},An=B({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,a=t,s=U({get:()=>e.tagStatus,set:h=>a("update:tagStatus",h)}),i=U(()=>{let h="collapseButton";return Object.keys(e.children).length!==0&&(h+=" collapsible"),h}),r=y(null),l=U(()=>!e.tagStatus.unfolded.has(e.identifier)),c=U(()=>l.value?"triangle-right":"triangle-down rotate90in");function _(h){let x=s.value.unfolded;x.has(e.identifier)?x.delete(e.identifier):x.add(e.identifier)}const u=U(()=>e.tagStatus.checked.has(e.identifier));function d(h){if(h===void 0)return;let x=s.value.checked;x.has(h)?x.delete(h):x.add(h)}const f=y(null),v=h=>{h.button===2&&(_(),h.preventDefault())};return Je(()=>{var h;(h=f.value)==null||h.addEventListener("contextmenu",v)}),gt(()=>{var h;(h=f.value)==null||h.removeEventListener("contextmenu",v)}),(h,x)=>(p(),g(H,null,[n("div",{class:"row",ref_key:"rowDiv",ref:f},[n("div",{id:"button",class:me(i.value),ref_key:"button",ref:r,onClick:_},[Object.keys(e.children).length!==0?(p(),g("div",{key:0,class:me(c.value)},null,2)):A("",!0)],2),n("div",Un,[k(Se,{checked:u.value,identifier:e.identifier,onOnCheck:d},{default:M(()=>[fe(h.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),V(n("div",Rn,[(p(!0),g(H,null,te(h.children,(D,C)=>(p(),Q(xt,{identifier:String(C),children:D,"tag-status":s.value,"onUpdate:tagStatus":x[0]||(x[0]=m=>s.value=m)},{default:M(()=>[q(I(String(C).split(S(pe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[zt,!l.value]])],64))}}),xt=E(An,[["__scopeId","data-v-3c7d3255"]]),Mn={id:"tagSelector-main",class:"hover-scrollable"},Bn=B({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,a=t,s=U(()=>De.tagHierarchy(e.tagStatus.all)),i=U(()=>Object.keys(s.value).sort()),r=U({get:()=>e.tagStatus,set:l=>a("update:tagStatus",l)});return(l,c)=>(p(),g("div",Mn,[(p(!0),g(H,null,te(i.value,_=>(p(),Q(xt,{identifier:String(_),children:s.value[_],tagStatus:r.value,"onUpdate:tagStatus":c[0]||(c[0]=u=>r.value=u)},{default:M(()=>[q(I(String(_).split(S(pe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),Ct=E(Bn,[["__scopeId","data-v-f90dfe41"]]),Ln={key:0,class:"prefix"},qn=B({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(o,{emit:t}){const e=o,a=t,s=U(()=>{const i=e.tag.split(pe);return i.length==1?["",i[0]]:[i.slice(0,i.length-1).join("·"),i[i.length-1]]});return(i,r)=>(p(),g("div",{class:me(`bubble${i.tStyle?" "+i.tStyle:""}`),onClick:r[0]||(r[0]=()=>a("click"))},[s.value[0]?(p(),g("div",Ln,I(s.value[0]),1)):A("",!0),q(" "+I(s.value[1]),1)],2))}}),En=E(qn,[["__scopeId","data-v-f454bc70"]]),Fn=B({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(o,{emit:t}){const e=o,a=t,s=U(()=>{const i={};for(const r of e.tags)e.highlightTags&&e.highlightTags.has(r)?i[r]="highlight":e.mutedTags&&e.mutedTags.has(r)?i[r]="muted":i[r]="";return i});return(i,r)=>(p(),g("div",{id:"bubbleContainer",style:ae({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(p(!0),g(H,null,te(e.tags,l=>(p(),Q(En,{onClick:()=>a("clickOnBubble",l),tag:l,"t-style":s.value[l]},null,8,["onClick","tag","t-style"]))),256))],4))}}),et=E(Fn,[["__scopeId","data-v-62e107cd"]]),tt=o=>(se("data-v-9523b989"),o=o(),ie(),o),zn=tt(()=>n("h3",{class:"green"},"Tags",-1)),On=tt(()=>n("hr",null,null,-1)),Hn=tt(()=>n("hr",null,null,-1)),Nn=B({__name:"FileTags",emits:["onCheck"],setup(o,{emit:t}){const e=t,a=z(),s=G(),i=y(null),r=y(null);oe(()=>a.unfoldedDataUIDs,()=>{a.unfoldedDataUIDs.length==0?r.value=null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])&&s.database.aget(a.unfoldedDataUIDs[0]).then(f=>{r.value=f})});const l=U(()=>r.value==null?null:a.tagStatus.checked.withChildsFrom(r.value.tags)),c=U(()=>{const f=a.tagStatus.checked.copy();return r.value!==null&&f.pop_ifcontains_(r.value.tags),f});function _(){a.tagStatus.checked=new N,a.updateShownData()}oe(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function u(){const f=prompt("Old tag");if(f&&s.database.allTags().has(f)){const v=prompt("New tag");v&&ee().conn.updateTagAll(f,v).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function d(){const f=prompt("Tag to delete");if(f&&s.database.allTags().has(f)){if(!confirm(`Are you sure to delete tag "${f}"?`))return;ee().conn.deleteTagAll(f).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(f,v)=>(p(),g("div",{id:"file-tags-main",ref_key:"ftPanel",ref:i},[n("div",{class:"title"},[n("div",{id:"title-title"},[zn,n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:u},"rename"),n("div",{class:"button",onClick:d},"delete")])]),On]),k(Ct,{onOnCheck:v[0]||(v[0]=h=>e("onCheck",h)),tagStatus:S(a).tagStatus,"onUpdate:tagStatus":v[1]||(v[1]=h=>S(a).tagStatus=h)},null,8,["tagStatus"]),Hn,k(et,{onClickOnBubble:v[2]||(v[2]=h=>{S(a).tagStatus.checked.has(h)?S(a).tagStatus.checked.delete(h):S(a).tagStatus.checked.add(h),S(a).updateShownData()}),tags:r.value?r.value.tags:S(a).tagStatus.checked,"highlight-tags":l.value,"muted-tags":c.value,"max-width":i.value?i.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:_},"CLEAR SELECTION")])],512))}}),Wn=E(Nn,[["__scopeId","data-v-9523b989"]]),jn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",nt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",Vn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",Kn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",Zn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",Gn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Jn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Qn=o=>(se("data-v-c6dbcdc2"),o=o(),ie(),o),Yn={key:0,id:"window"},Xn={class:"header"},ea=Qn(()=>n("span",{class:"close-icon"},"✕",-1)),ta=[ea],na=B({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(o,{emit:t}){const e=o,a=t,s=U({get:()=>e.show,set:l=>{a("update:show",l)}});function i(){s.value=!1,a("onClose"),a("close")}function r(l){l.target===l.currentTarget&&i()}return window.addEventListener("keydown",l=>{l.key===e.closeKey&&(i(),l.preventDefault())}),(l,c)=>s.value?(p(),g("div",Yn,[n("div",{id:"blocker",onClick:r,style:ae({"z-index":l.zIndex-1})},[n("div",{class:"floating-window",style:ae({"z-index":l.zIndex})},[n("div",Xn,[n("label",null,I(e.title),1),n("button",{class:"close-button",onClick:i},ta)]),n("div",{class:"window-content scrollable",style:ae({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[fe(l.$slots,"default",{},void 0)],4)],4)],4)])):A("",!0)}}),ke=E(na,[["__scopeId","data-v-c6dbcdc2"]]),aa={id:"query-dialog-main"},oa={class:"content"},sa={id:"buttons"},ia=B({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(o,{emit:t}){const e=o,a=t,s=U({get:()=>e.show,set:i=>{a("update:show",i)}});return(i,r)=>(p(),Q(ke,{show:s.value,"onUpdate:show":r[2]||(r[2]=l=>s.value=l),title:i.title,compact:!0,"z-index":i.zIndex,onOnClose:r[3]||(r[3]=()=>a("onClose"))},{default:M(()=>[n("div",aa,[n("div",oa,[fe(i.$slots,"default",{},void 0,!0)]),n("div",sa,[n("div",{class:"button ok-button",onClick:r[0]||(r[0]=()=>a("onAccept"))},"OK"),i.showCancel?(p(),g("div",{key:0,class:"button cancel-button last-button",onClick:r[1]||(r[1]=()=>a("onCancel"))},"Cancel")):A("",!0)])])]),_:3},8,["show","title","z-index"]))}}),xe=E(ia,[["__scopeId","data-v-81948a9f"]]),ra=o=>(se("data-v-990ad4c4"),o=o(),ie(),o),la={id:"tag-selector-with-entry-main"},ua={style:{textAlign:"left"}},ca=ra(()=>n("label",{for:"tagSelector"},"Tags",-1)),da={id:"tagSelector",class:"scrollable"},ha={class:"entry"},pa=B({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(o,{emit:t}){const e=o,a=t,s=U({get:()=>e.tagStatus,set:c=>a("update:tagStatus",c)}),i=y(e.tagInputValue);oe(()=>e.tagInputValue,c=>{i.value=c});const r=U({get:()=>i.value,set:c=>{a("update:tagInputValue",c),i.value=c}}),l=()=>{const c=r.value.trim();c!==""&&(s.value.all.add(c),s.value.checked.add(c),s.value.unfolded.union_(De.allParentsOf(c)),r.value="")};return(c,_)=>(p(),g("div",la,[n("div",ua,[ca,n("div",da,[k(Ct,{tagStatus:s.value,"onUpdate:tagStatus":_[0]||(_[0]=u=>s.value=u)},null,8,["tagStatus"])])]),n("div",ha,[V(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":_[1]||(_[1]=u=>r.value=u),onKeyup:Qe(l,["enter"])},null,544),[[X,r.value]]),n("button",{class:me(`green${r.value?" to-be-confirmed":""}`),onClick:l},"ADD",2)])]))}}),fa=E(pa,[["__scopeId","data-v-990ad4c4"]]);async function ma(o){const t=`https://export.arxiv.org/api/query?id_list=${o}`,a=await(await fetch(t,{method:"GET"})).text();let r=new Jt.XMLParser().parse(a).feed.entry;function l(c){return Array.isArray(c.author)?c.author.map(_=>_.name):c.author?[c.author.name]:[]}if(r){const c=r.id.split("/").pop().split("v")[0],_=r.id,u=r.title,d=r.summary,f=l(r),v=r.updated,h=r.published;return{id:c,link:_,title:u,abstract:d,authors:f,updatedTime:v,publishedTime:h}}else throw new Error("Failed to fetch paper from arxiv")}function va(o){return`@article{${o.id},
  author = {${o.authors.join(" and ")}},
  title = {${o.title}},
  journal = {arXiv preprint arXiv:${o.id}},
  year = {${o.publishedTime.split("-")[0]}},
  abstract = {${o.abstract}}
  }`.replace(/  /g,"")}const ft=(o,{entry:t="",title:e="",authors:a=[""],year:s=new Date().getFullYear()}={})=>(t||(t=`${s}_${Math.random().toString(36).substring(7)}`),o=="article"?`@article{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${s}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):o=="inproceedings"?`@inproceedings{${t},
        author = {${a.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${s}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):o=="webpage"?`@misc{${t},
        title = "{${e}}",
        author = "{${a.join(" and ")}}",
        year = {${s}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):o=="misc"?`@misc{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        year = {${s}},
        url = {},
        }`.replace(/  /g,""):"");class Ke{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await ma(e);return{bibtex:va(a),url:a.link}}static async fromWebpage(t){var c;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),r=(c=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:c.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${r}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ga={key:0,id:"arrow"},_a=["onKeydown","onClick"],ya=B({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(o,{emit:t}){const e=o,a=t,s=U({get:()=>e.show,set:r=>{a("update:show",r)}});function i(){s.value=!1}return(r,l)=>(p(),g(H,null,[r.blocker?(p(),g("div",{key:0,id:"blocker",onClick:i,style:ae({zIndex:e.zIndex-1})},null,4)):A("",!0),n("div",{id:"floatingMenu",style:ae({left:e.position.x+"px",top:e.position.y+"px",visibility:s.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(p(),g("div",ga)):A("",!0),(p(!0),g(H,null,te(e.menuItems,(c,_)=>(p(),g("div",{class:me(`non-selectable floatingMenuItem${_!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Qe(u=>{c.action(),i()},["enter"]),onClick:u=>{c.action(),i()}},I(c.name),43,_a))),256))],4)],64))}}),wa=E(ya,[["__scopeId","data-v-c6b659c7"]]),Ue=B({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(o,t){const e=y(null),a=i=>{const r=i.target;if(r.files&&r.files.length>0){const l=r.files[0];o.action(l)}};function s(){e.value.click()}return t.expose({click:s}),()=>k(H,null,[k("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),o.asLink?k("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:o.style},[o.text]):k("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:o.style},[o.text])])}}),at=B({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(o,t){const e=y(null),a=f=>{e.value.innerText=f},s=f=>{e.value.contentEditable=f.toString()},i=f=>e.value.contains(f),r=function(){return document.activeElement===e.value},l=U({get(){return e.value.innerText},set(f){e.value.innerText=f}});t.expose({setText:a,setEditable:s,contains:i,innerText:l,hasFocus:r});const c=()=>{t.emit("change",e.value.innerText)},_=()=>{t.emit("finish",e.value.innerText)},u=f=>{if(f.key==="Enter")if(f.ctrlKey||f.metaKey){f.preventDefault();const v=window.getSelection(),h=v==null?void 0:v.getRangeAt(0);if(h){const x=document.createElement("br");h.insertNode(x),h.setStartAfter(x),h.setEndAfter(x),v==null||v.removeAllRanges(),v==null||v.addRange(h)}}else e.value.blur()},d=f=>{var h;f.preventDefault();const v=(h=f.clipboardData)==null?void 0:h.getData("text/plain");document.execCommand("insertText",!1,v)};return()=>k("p",{class:"editable-paragraph",contenteditable:o.contentEditable,ref:e,onInput:c,onBlur:_,onKeydown:u,style:o.style,onPaste:d},[t.slots.default&&t.slots.default()])}}),Dt=B({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(o,t){const e=y(!1),a=y(null),s=y({x:0,y:0});return oe(e,i=>{if(i){const r=a.value.getBoundingClientRect();s.value={x:r.left+r.width/2,y:r.bottom+5}}else s.value={x:0,y:0}}),()=>k("div",null,[k("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:i=>{i.key==="Enter"&&(i.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),k(wa,{show:e.value,"onUpdate:show":i=>e.value=i,menuItems:o.menuItems,position:s.value,middleTop:!0,arrow:!0},null)])}}),ba=B({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(o,t){const e={width:`${o.size}`,height:`${o.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>k("img",{src:o.href,alt:o.alt,style:e,onClick:()=>t.emit("click")},null)}});function mt(o){function t(u,d){var v;const f=(v=u.split(".").pop())==null?void 0:v.toLowerCase();for(const h of d)if(f===h)return!0;return!1}function e(u){return!!(u.type.startsWith("image/")||t(u.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function a(u){return!!(u.type==="application/pdf"||t(u.name,["pdf"]))}function s(u){return!!(u.type==="text/html"||t(u.name,["html"]))}function i(u){return!!(u.type==="text/plain"||t(u.name,["txt","bib","bibtex","nbib","enw","ris"]))}function r(u){return!!(a(u)||s(u)||e(u))}const l=[],c=[],_=[];for(let u=0;u<o.length;u++)i(o[u])?l.push(o[u]):r(o[u])?c.push(o[u]):_.push(o[u]);return{citation:l,document:c,unknown:_}}const we=o=>(se("data-v-e295a40e"),o=o(),ie(),o),ka={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},$a={style:{margin:"10px"}},Sa={style:{display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"}},xa=we(()=>n("legend",null,"Source",-1)),Ca={class:"bibsource-container"},Da=we(()=>n("legend",{for:"bibsource-arxiv"},"arxiv",-1)),Pa={class:"bibsource-container"},Ia=we(()=>n("legend",{for:"bibsource-doi"},"doi",-1)),Ta={class:"bibsource-container"},Ua=we(()=>n("legend",{for:"bibsource-webpage"},"webpage",-1)),Ra=["placeholder"],Aa={key:0},Ma={id:"inputDiv"},Ba={id:"inputLeft"},La={id:"bibtexArea"},qa={class:"horizontal"},Ea=we(()=>n("label",{for:"bibtex"},"Bibtex",-1)),Fa={id:"bibtexSource",class:"horizontal"},za={id:"urlArea"},Oa=we(()=>n("label",{for:"url"},"URL: ",-1)),Ha={id:"inputRight"},Na={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},Wa=we(()=>n("div",{class:"hr"},null,-1)),ja={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},Va=we(()=>n("div",{class:"hr"},null,-1)),Ka={key:1},Za=we(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),Ga=[Za],Ja=B({__name:"DataEditor",setup(o,{expose:t}){const e=z(),a=ee().conn,s=y(!1),i=y(null),r=y(""),l=y(""),c=y(null),_=y({all:new N,checked:new N,unfolded:new N});function u(){const O={uuid:i.value?i.value.summary.uuid:null,bibtex:r.value,tags:Array.from(_.value.checked),url:l.value,file:c.value};v(),e.showPopup("Saving entry...","info"),a.updateDatapoint(O.uuid,{bibtex:O.bibtex,tags:O.tags,url:O.url}).then(R=>{O.file?(e.showPopup("Uploading document...","info"),a.uploadDocument(R.uuid,O.file).then(L=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const d=y("");function f({datapoint:O=null,bibtex:R=null,url:L=null,tags:ue=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,O!==null&&(i.value=O,r.value=O.summary.bibtex,l.value=O.summary.url,ue===null&&(ue=new N(O.summary.tags))),R!==null&&(r.value=R),L!==null&&(l.value=L),ue!==null?(Array.isArray(ue)&&(ue=new N(ue)),_.value={all:new N(e.tagStatus.all).union(ue),checked:ue,unfolded:ue.allParents()}):_.value={all:new N(e.tagStatus.all),checked:new N(e.tagStatus.checked),unfolded:new N(e.tagStatus.unfolded)},s.value=!0)}function v(){s.value=!1,i.value=null,r.value="",l.value="",_.value={all:new N(e.tagStatus.all),checked:new N(e.tagStatus.checked),unfolded:new N(e.tagStatus.unfolded)},c.value=null,d.value="",F.value=!1,e.dataEditorOpened=!1}function h(){return s.value}function x(O){if(i.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!mt([O]).document)return e.showPopup("Unsupported file","error"),!1;if(c.value=O,console.log("file selected"),r.value.trim().length===0){console.log("try to extract bibtex from file");const R=O.name,L=O.lastModified,ue=ft(m.value,{title:R,year:new Date(L).getFullYear()});r.value=ue}return!0}function D(O){let R=!1;if(!O||O.length===0)return R;const L=mt(O);if((L.citation.length>1||L.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),L.citation.length==0&&L.document.length==0&&(console.log("[Error] Got files: ",O),e.showPopup("Unsupported file type","error")),L.citation.length>0){const ue=L.citation[0];if(ue.size<64*1024){const rt=new FileReader;rt.onload=Mt=>{var lt;const Bt=(lt=Mt.target)==null?void 0:lt.result;r.value=Bt},rt.readAsText(ue),R=!0}else e.showPopup("Text file too large","error")}return L.document.length>0&&(R=x(L.document[0])),R}t({show:f,close:v,isShown:h,loadFiles:D});const C=y(!1),m=y("article"),$=U(()=>ft(m.value)),P=y(!1),w=y("arxiv"),b={arxiv:O=>Ke.fromArxiv(O),doi:O=>Ke.fromDoi(O),webpage:O=>Ke.fromWebpage(O)},T={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},Y=y("");function le(O){e.showPopup("Fetching from BibTeX source...","info"),P.value=!1,Y.value="",b[w.value](O).then(R=>{e.showPopup("Obtained bibtex from source","success"),r.value=R.bibtex,l.value=R.url},()=>{e.showPopup("Failed to fetch from source","error")})}const F=y(!1),j=y(null),K=O=>{O.preventDefault(),F.value=!0},Z=O=>{O.preventDefault(),F.value=!1},_e=O=>{var L;O.preventDefault();const R=(L=O.dataTransfer)==null?void 0:L.files;R&&D(R),F.value=!1};return(O,R)=>(p(),g(H,null,[k(xe,{show:C.value,"onUpdate:show":R[4]||(R[4]=L=>C.value=L),onOnAccept:R[5]||(R[5]=()=>{r.value=$.value,C.value=!1}),onOnCancel:R[6]||(R[6]=L=>C.value=!1),"z-index":102,title:"Select template"},{default:M(()=>[n("div",ka,[k(Se,{onOnCheck:R[0]||(R[0]=L=>m.value="article"),checked:m.value=="article"},{default:M(()=>[q("Article")]),_:1},8,["checked"]),k(Se,{onOnCheck:R[1]||(R[1]=L=>m.value="inproceedings"),checked:m.value=="inproceedings"},{default:M(()=>[q("Inproceedings")]),_:1},8,["checked"]),k(Se,{onOnCheck:R[2]||(R[2]=L=>m.value="webpage"),checked:m.value=="webpage"},{default:M(()=>[q("Webpage")]),_:1},8,["checked"]),k(Se,{onOnCheck:R[3]||(R[3]=L=>m.value="misc"),checked:m.value=="misc"},{default:M(()=>[q("Misc")]),_:1},8,["checked"])])]),_:1},8,["show"]),k(xe,{show:P.value,"onUpdate:show":R[11]||(R[11]=L=>P.value=L),onOnCancel:R[12]||(R[12]=L=>P.value=!1),onOnAccept:R[13]||(R[13]=()=>{le(Y.value)}),"z-index":102,title:"Source input"},{default:M(()=>[n("div",$a,[n("fieldset",Sa,[xa,n("div",Ca,[V(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":R[7]||(R[7]=L=>w.value=L)},null,512),[[je,w.value]]),Da]),n("div",Pa,[V(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":R[8]||(R[8]=L=>w.value=L)},null,512),[[je,w.value]]),Ia]),n("div",Ta,[V(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":R[9]||(R[9]=L=>w.value=L)},null,512),[[je,w.value]]),Ua])]),V(n("input",{type:"text","onUpdate:modelValue":R[10]||(R[10]=L=>Y.value=L),placeholder:T[w.value],style:{width:"100%",marginTop:"10px"}},null,8,Ra),[[X,Y.value]])])]),_:1},8,["show"]),k(xe,{show:s.value,"onUpdate:show":R[21]||(R[21]=L=>s.value=L),title:i.value?i.value.authorAbbr():"new","show-cancel":!1,onOnAccept:u,onOnCance:v,onOnClose:v},{default:M(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:j,onDragover:K,onDrop:_e,onDragend:Z},[F.value?(p(),g("div",Ka,Ga)):(p(),g("div",Aa,[n("div",Ma,[n("div",Ba,[n("div",La,[n("div",qa,[Ea,n("div",Fa,[n("div",{class:"button",onClick:R[14]||(R[14]=L=>C.value=!0)},"template"),n("div",{class:"button",onClick:R[15]||(R[15]=L=>P.value=!0)},"from-source")])]),V(n("textarea",{id:"bibtex","onUpdate:modelValue":R[16]||(R[16]=L=>r.value=L),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[X,r.value]])]),n("div",za,[Oa,V(n("input",{id:"url","onUpdate:modelValue":R[17]||(R[17]=L=>l.value=L),placeholder:"url",type:"text"},null,512),[[X,l.value]])])]),n("div",Ha,[k(fa,{"tag-status":_.value,"onUpdate:tagStatus":R[18]||(R[18]=L=>_.value=L),"tag-input-value":d.value,"onUpdate:tagInputValue":R[19]||(R[19]=L=>d.value=L)},null,8,["tag-status","tag-input-value"])])]),i.value===null?(p(),g("div",Na,[Wa,n("div",ja,[q(I(c.value?c.value.name:"")+" ",1),c.value?(p(),g("a",{key:1,onClick:R[20]||(R[20]=L=>c.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(p(),Q(S(Ue),{key:0,text:"Select document",action:x,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),Va])):A("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),ot=E(Ja,[["__scopeId","data-v-e295a40e"]]),Ce=o=>(se("data-v-9b2c5a9d"),o=o(),ie(),o),Qa={class:"layout"},Ya={id:"info"},Xa=Ce(()=>n("td",null,[n("b",null,"Authors")],-1)),eo={id:"authorTD"},to=["onClick"],no={key:0,id:"otherPubTR"},ao={colspan:"2"},oo={id:"authorPapers"},so=Ce(()=>n("td",null,[n("b",null,"Publication")],-1)),io=Ce(()=>n("td",null,[n("b",null,"Year")],-1)),ro=Ce(()=>n("td",null,[n("b",null,"Tags")],-1)),lo=Ce(()=>n("td",null,[n("b",null,"Type")],-1)),uo={id:"shortSummary"},co={id:"shortSummaryTitle"},ho=Ce(()=>n("b",null,"AI Summary",-1)),po=Ce(()=>n("summary",null,[n("b",null,"Related Articles")],-1)),fo=B({__name:"DataSummary",props:{datapoint:{}},setup(o){const t=o,e=G(),a=y([]),s=y([]),i=U(()=>Object.fromEntries(a.value.map((m,$)=>[m.summary.uuid,s.value[$].toPrecision(3)]))),r=ee().conn,l=y(null),c=y("");function _(m=!1){c.value="Loading...";let $="";u(),r.reqAISummary(t.datapoint.summary.uuid,P=>{P.replace(/\\n/g,"<br>"),$+=P,c.value=$},()=>{u(),console.log("finished")},m)}async function u(){let m=null;if(t.datapoint.supp.abstract?m=t.datapoint.supp.abstract:m=await t.datapoint.fetchAbstract(),m||(c.value&&!c.value.startsWith("Error")&&!c.value.startsWith("Loading")?m=c.value:m=t.datapoint.title),m=="")return;const $=await r.query({searchBy:"feature",searchContent:m,maxResults:9}),P=await e.database.agetMany($.uids,!1),w=new Array;for(const b of P){const T=$.uids.indexOf(b.summary.uuid);if(T>=0)w.push($.scores[T]);else throw new Error("Related article not found in search result, IMPOSSIBLE")}[a.value,s.value]=St(P,w,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),s.value.shift())}const d=y(""),f=y([]),v=y({});async function h(){const m=t.datapoint.authors,$=await Promise.all(m.map(P=>e.database.agetByAuthor(P)));v.value={};for(let P=0;P<m.length;P++)v.value[m[P]]=$[P]}const x=U(()=>{const m={};for(const $ in v.value)v.value[$]&&v.value[$].length>1?m[$]=v.value[$].length-1:m[$]=null;return m});function D(m){f.value=v.value[m],f.value||(f.value=[]),f.value=f.value.filter($=>$.summary.uuid!=t.datapoint.summary.uuid),d.value===m?d.value="":d.value=m}he(()=>{h(),_(!1)});const C=U(()=>{const b=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,T=(Math.sin(b)+1)*.5*1200,Y=Math.round(T);return`${window.innerWidth-Y}px`});return(m,$)=>(p(),g("div",{id:"main",style:ae({width:C.value})},[n("h2",null,I(m.datapoint.summary.title),1),n("div",Qa,[n("div",Ya,[n("table",null,[n("tr",null,[Xa,n("td",eo,[(p(!0),g(H,null,te(m.datapoint.summary.authors,P=>(p(),g("div",null,[n("span",null,I(P),1),x.value[P]!==null?(p(),g("a",{key:0,onClick:()=>D(P)}," ("+I(x.value[P])+") ",9,to)):A("",!0)]))),256))])]),k(Be,{name:"slideDown"},{default:M(()=>[d.value?(p(),g("tr",no,[n("td",ao,[n("b",null,I(`Other publications from ${d.value.toUpperCase()}:`),1),n("div",oo,[k(Ie,{uids:f.value.map(P=>P.summary.uuid)},null,8,["uids"])])])])):A("",!0)]),_:1}),n("tr",null,[so,n("td",null,I(m.datapoint.summary.publication),1)]),n("tr",null,[io,n("td",null,I(m.datapoint.summary.year),1)]),n("tr",null,[ro,n("td",null,I(m.datapoint.summary.tags.toString()),1)]),n("tr",null,[lo,n("td",null,I(m.datapoint.fileType()+`${m.datapoint.summary.has_file?" ("+m.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),n("div",uo,[n("div",co,[ho,n("div",{class:"button",onClick:$[0]||($[0]=P=>_(!0))},"↻")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:l},I(c.value),513)]),n("details",null,[po,k(Ie,{uids:a.value.map(P=>P.summary.uuid),scores:i.value},null,8,["uids","scores"])])])],4))}}),mo=E(fo,[["__scopeId","data-v-9b2c5a9d"]]),vo=o=>(se("data-v-564cf261"),o=o(),ie(),o),go={id:"citations",style:{textAlign:"left"}},_o=["onClick"],yo={class:"citation-type",style:{marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"}},wo={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},bo={key:0},ko={key:0,id:"moreMain"},$o={class:"row",id:"buttons"},So=["href"],xo={key:0,class:"row",id:"actions"},Co={id:"abstract"},Do=vo(()=>n("summary",null,"Abstract",-1)),Po=B({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(o,{expose:t}){const e=o,a=z(),s=y(null),i=async m=>{m.target instanceof HTMLDetailsElement&&!m.target.open||(s.value.setEditable(!1),s.value.innerText="Loading...",e.datapoint.fetchAbstract().then($=>{s.value.innerText=$,s.value.setEditable(!0)},()=>{s.value.innerText="Failed to load abstract."}))},r=async m=>{m&&(await e.datapoint.uploadAbstract(m),await e.datapoint.update())},l=y(!1);function c(m,$){return[m,`${$.length>80?$.slice(0,80)+"...":$}`,$]}function _(m){Ye(m).then($=>{$?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const u=y(!1);function d(m){a.showPopup("uploading..."),e.datapoint.uploadDocument(m).then($=>{e.datapoint.update($),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function f(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(m=>{e.datapoint.update(m),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function v(){const m=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&ee().conn.deleteDatapoint(m).then($=>{a.showPopup("Deleted")})}const h=y(null);function x(){h.value.show({datapoint:e.datapoint})}const D=U(()=>s.value===null?!h.value.isShown():!h.value.isShown()&&!s.value.hasFocus());t({editThisDatapoint:x,deleteThisDatapoint:v,shouldEnableEditDatapoint:D});const C=y(!1);return(m,$)=>{const P=Ge("router-link");return p(),g(H,null,[k(ke,{show:C.value,"onUpdate:show":$[0]||($[0]=w=>C.value=w),title:"Summary"},{default:M(()=>[k(mo,{datapoint:m.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),k(ke,{show:l.value,"onUpdate:show":$[1]||($[1]=w=>l.value=w),title:"Citations"},{default:M(()=>[(p(!0),g(H,null,te([c("Title",`${m.datapoint.summary.title}`),c("Author-year",`${m.datapoint.authorAbbr()} (${m.datapoint.summary.year})`),c("APA",`${m.datapoint.authorAbbr()} (${m.datapoint.summary.year}). ${m.datapoint.summary.title}. ${m.datapoint.summary.publication}.`),c("Bibtex",m.datapoint.summary.bibtex),c("DocURL",m.datapoint.getRawDocURL()),c("Markdown",`[${m.datapoint.authorAbbr()} (${m.datapoint.summary.year})](${m.datapoint.getRawDocURL()})`),c("UUID",`${m.datapoint.summary.uuid}`)],(w,b)=>(p(),g("div",go,[n("div",{onClick:()=>{_(w[2]),l.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",yo,I(w[0]),1),n("p",wo,I(w[1]),1)],8,_o),b!==6?(p(),g("hr",bo)):A("",!0)]))),256))]),_:1},8,["show"]),k(ot,{ref_key:"dataEditor",ref:h},null,512),k(Be,{name:"expand-transition"},{default:M(()=>[m.show?(p(),g("div",ko,[n("div",$o,[k(P,{to:`/reader/${e.datapoint.summary.uuid}`},{default:M(()=>[q("Reader")]),_:1},8,["to"]),m.datapoint.url?(p(),g("a",{key:0,href:m.datapoint.url,target:"_blank"},"Link",8,So)):A("",!0),n("a",{rel:"noopener noreferrer",onClick:$[2]||($[2]=()=>C.value=!C.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:$[3]||($[3]=()=>l.value=!l.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:$[4]||($[4]=()=>u.value=!u.value)},"Actions")]),k(Be,{name:"actions"},{default:M(()=>[u.value?(p(),g("div",xo,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:x},"Edit"),m.datapoint.summary.has_file?(p(),g("a",{key:1,rel:"noopener noreferrer",onClick:f,class:"danger btn"},"Free document")):(p(),Q(S(Ue),{key:0,action:w=>d(w),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:v,class:"danger btn"},"Delete")])):A("",!0)]),_:1}),n("div",Co,[n("details",{onToggle:i},[Do,k(S(at),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:s,style:{minHeight:"20px"},onFinish:$[5]||($[5]=w=>r(w))},null,512)],32)])])):A("",!0)]),_:1})],64)}}}),Io=E(Po,[["__scopeId","data-v-564cf261"]]),To="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",Uo="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",Ro={class:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",flexWrap:"nowrap",gap:"0.25rem"}},Ao={id:"marks"},Mo=["src"],Bo=["src"],Lo={class:"row text"},qo={style:{borderRadius:"10px",marginLeft:"5px",display:"flex",flexDirection:"column"}},Eo={id:"title",style:{display:"flex",fontSize:"1rem"}},Fo={style:{"margin-right":"0.1rem","margin-top":"0.25rem","font-size":"0.75rem",opacity:"0.8",display:"inline-block",filter:"drop-shadow(1px 1px 0.5px var(--color-border))"}},zo={style:{marginTop:"0px",padding:"0px",color:"var(--color-text-soft)",fontSize:"0.75rem"}},Oo={class:"right row"},Ho={id:"status-container"},No={class:"status"},Wo={key:0,src:jn,alt:"",class:"icon"},jo={key:1,src:nt,alt:"",class:"icon placeholder"},Vo={class:"status"},Ko={key:0,src:Vn,alt:"",class:"icon"},Zo={key:1,src:Kn,alt:"",class:"icon"},Go={key:2,src:Zn,alt:"",class:"icon"},Jo={key:3,src:nt,alt:"",class:"icon placeholder"},Qo={class:"status"},Yo={key:0,src:Gn,alt:"",class:"icon"},Xo={key:1,src:Jn,alt:"",class:"icon"},es={key:2,src:nt,alt:"",class:"icon placeholder"},ts=12,ns=1,as=B({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0}},emits:["update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,a=t,s=U({get:()=>e.unfoldedIds,set:w=>a("update:unfoldedIds",w)}),i=U({get:()=>e.hoveredIds,set:w=>a("update:hoveredIds",w)}),r=U(()=>s.value.includes(e.datapoint.summary.uuid)),l=y(null),c=y(null),_=y(null),u=y(null);let d=!1;function f(w){if(pt(w.target,l.value)){if(w.target.id=="authorYear"){const b=e.datapoint.getOpenDocURL();b!==""&&un(b),d=!0}if(!pt(w.target,_.value)){if(d){d=!1;return}r.value?s.value=s.value.filter(b=>b!==e.datapoint.summary.uuid):s.value=[e.datapoint.summary.uuid]}}}const v=U(()=>{switch(e.datapoint.dtype){case"article":return"📄";case"book":return"📚";case"incollection":return"📖";case"inbook":return"📖";case"manual":return"📖";case"inproceedings":return"📜";case"conference":return"📜";case"misc":return"📎";case"thesis":return"🎓";case"phdthesis":return"🎓";case"mastersthesis":return"🎓";case"techreport":return"📑";case"unpublished":return"📝";case"webpage":return"🌐";case"online":return"🌐";default:return"❔"}}),h=U(()=>e.datapoint.yearAuthor("-")),x=y(!1);oe(x,w=>{w?i.value.push(e.datapoint.summary.uuid):i.value=i.value.filter(b=>b!==e.datapoint.summary.uuid)});const D=U(()=>x.value?"var(--color-background-theme-highlight)":s.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)"),C=U(()=>kt(e.datapoint.summary.bibtex));function m(w){const b=e.datapoint.summary.tags.slice();w?b.push("* Bookmark"):b.splice(b.indexOf("* Bookmark"),1);const T=e.datapoint.summary.uuid;ee().conn.updateDatapoint(T,{tags:b}).then(Y=>{e.datapoint.update(Y),z().updateShownData()},()=>z().showPopup("Failed to save","error")),d=!0}function $(){var w;return s.value.includes(e.datapoint.summary.uuid)&&x.value&&document.activeElement===document.body&&((w=u.value)==null?void 0:w.shouldEnableEditDatapoint)}function P(w){var b,T;w.code==="Space"&&$()&&((b=u.value)==null||b.editThisDatapoint(),w.preventDefault()),(w.code==="Delete"||w.code==="Backspace")&&$()&&((T=u.value)==null||T.deleteThisDatapoint(),w.preventDefault())}return oe(()=>s.value,w=>{w.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",P):window.removeEventListener("keydown",P)}),(w,b)=>(p(),g("div",{id:"fileRow",class:me(`${r.value?" unfolded":""}`),onClick:f,onMouseover:b[2]||(b[2]=T=>x.value=!0),onMouseleave:b[3]||(b[3]=T=>x.value=!1),ref_key:"dataCard",ref:l,style:ae({backgroundColor:D.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:c},[n("div",Ro,[n("div",Ao,[w.datapoint.summary.tags.includes("* Bookmark")?(p(),g("img",{key:0,src:S(Uo),alt:"",class:"icon redIcon",onClick:b[0]||(b[0]=()=>m(!1)),style:{height:"1rem"}},null,8,Mo)):(p(),g("img",{key:1,src:S(To),alt:"",class:"icon",onClick:b[1]||(b[1]=()=>m(!0)),style:{height:"1rem"}},null,8,Bo))]),n("div",Lo,[n("div",qo,[n("div",Eo,[n("p",null,[n("span",Fo,I(v.value),1),q(" "+I(w.datapoint.summary.title),1)])]),n("div",zo,I(h.value+", "+w.datapoint.publication+(C.value?". "+C.value:"")),1)]),fe(w.$slots,"default",{},void 0)])]),n("div",Oo,[n("div",Ho,[n("div",No,[w.datapoint.summary.has_abstract?(p(),g("img",Wo)):(p(),g("img",jo))]),n("div",Vo,[w.datapoint.fileType()=="pdf"?(p(),g("img",Ko)):w.datapoint.fileType()=="html"?(p(),g("img",Zo)):w.datapoint.fileType()=="url"?(p(),g("img",Go)):(p(),g("img",Jo))]),n("div",Qo,[w.datapoint.summary.note_linecount>ts?(p(),g("img",Yo)):w.datapoint.summary.note_linecount>ns?(p(),g("img",Xo)):(p(),g("img",es))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:_},[k(Io,{datapoint:w.datapoint,show:r.value,ref_key:"moreComponent",ref:u},null,8,["datapoint","show"])],512)],38))}}),os=E(as,[["__scopeId","data-v-f2b3f69e"]]),ss={id:"datacard-container-main"},is={key:0,class:"relatedArticleScore"},rs={key:1,id:"datacard-container-footer"},ls=["disabled"],us={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},cs=["disabled"],ds=B({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,a=t,s=y([]),i=U({get:()=>e.unfoldedIds==null?s.value:e.unfoldedIds,set:m=>{e.unfoldedIds==null?s.value=m:a("update:unfoldedIds",m)}}),r=y([]),l=U({get:()=>e.hoveredIds==null?r.value:e.hoveredIds,set:m=>{e.hoveredIds==null?r.value=m:a("update:hoveredIds",m)}}),c=y(null),_=y(null),u=y(0),d=W(),f=y([]),v=y(!1);function h(){const m=u.value*d.numItemsPerPage,$=Math.min(m+d.numItemsPerPage,e.uids.length),P=e.uids.slice(m,$),w=G().database;let b=!0;(async()=>(await new Promise(T=>setTimeout(T,500)),b&&(v.value=!1)))(),w.agetMany(P).then(T=>{f.value=T,b=!1,v.value=!0})}oe([()=>e.uids,()=>u.value,()=>d.numItemsPerPage],()=>{e.uids.length<u.value*d.numItemsPerPage&&(u.value=0),h()}),h();const x=()=>{var m;u.value>=Math.ceil(e.uids.length/d.numItemsPerPage)-1||(u.value++,_.value.setText(""+(u.value+1)),(m=c.value)==null||m.scrollTo({top:0,behavior:"auto"}))},D=()=>{var m;u.value!=0&&(u.value--,_.value.setText(""+(u.value+1)),(m=c.value)==null||m.scrollTo({top:0,behavior:"auto"}))},C=m=>{const $=m.target;$.scrollTop==0||$.scrollTop+$.clientHeight>=$.scrollHeight};return(m,$)=>(p(),g("div",ss,[n("div",{id:"datacard-container",style:ae({gap:m.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:c,onScroll:C,class:"scrollable"},[(p(!0),g(H,null,te(f.value,(P,w)=>(p(),Q(os,{datapoint:P,"unfolded-ids":i.value,"onUpdate:unfoldedIds":$[0]||($[0]=b=>i.value=b),"hovered-ids":l.value,"onUpdate:hoveredIds":$[1]||($[1]=b=>l.value=b),line_number:w,compact:m.compact},{default:M(()=>[e.scores!=null&&e.scores[P.summary.uuid]!=null?(p(),g("label",is,I(e.scores[P.summary.uuid]),1)):A("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),v.value?A("",!0):(p(),Q(Be,{key:0,name:"fade"},{default:M(()=>[k($t,{text:"Loading data..."})]),_:1})),m.uids.length>S(d).numItemsPerPage?(p(),g("div",rs,[n("button",{onClick:D,disabled:u.value==0},"Prev",8,ls),n("span",us,[k(S(at),{ref_key:"pageIndicatorEditableParagrah",ref:_,onFinish:$[2]||($[2]=P=>{parseInt(P)>0&&parseInt(P)<=Math.ceil(m.uids.length/S(d).numItemsPerPage)&&(u.value=parseInt(P)-1)})},{default:M(()=>[q(I(u.value+1),1)]),_:1},512),q(" / "),n("p",null,I(Math.ceil(m.uids.length/S(d).numItemsPerPage)),1)]),n("button",{onClick:x,disabled:u.value>=Math.ceil(m.uids.length/S(d).numItemsPerPage)-1},"Next",8,cs)])):A("",!0)]))}}),Ie=E(ds,[["__scopeId","data-v-006a79ab"]]),hs=["title"],ps=["src","alt"],fs={for:"icon",class:"iconLabel non-selectable"},ms=B({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(o,{expose:t,emit:e}){const a=o,s=U(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),i=e,r=y(null);t({getBoundingClientRect:()=>{var d;return(d=r.value)==null?void 0:d.getBoundingClientRect()}});function c(){i("onClick"),i("click")}function _(d){if(d===null)return null;const f=d.toLowerCase().split("+");return v=>{f.includes("ctrl")&&!v.ctrlKey||f.includes("alt")&&!v.altKey||f.includes("shift")&&!v.shiftKey||f.includes("meta")&&!v.metaKey||f.includes(v.key.toLowerCase())&&(console.log("shortcut triggered: "+d+" | "+a.labelText),c(),v.preventDefault())}}const u=_(a.shortcut);return Je(()=>{u!==null&&window.addEventListener("keydown",u)}),gt(()=>{u!==null&&window.removeEventListener("keydown",u)}),(d,f)=>(p(),g("span",{class:"hoverMaxout105 button non-selecable",onClick:c,onKeydown:Qe(c,["enter"]),tabindex:0,title:`${s.value}`,ref_key:"button",ref:r},[n("img",{id:"icon",class:"icon",src:d.iconSrc,alt:d.labelText.toUpperCase()+"_ICON"},null,8,ps),n("label",fs,I(d.labelText),1)],40,hs))}}),be=E(ms,[["__scopeId","data-v-f0fccbdf"]]);let vs=window.location.protocol,Pt;Pt=`${vs}//${window.location.hostname}:${window.location.port}`;const gs=`${Pt}/documentation/`;console.log("production mode");function qe(){const o=W().backendPort,t=W().backendHost;return o?`${t}:${o}`:t}const _s={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Pe=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],ys="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",ws={data(){return{usedSpace:0,totalSpace:1,unit:"MB"}},computed:{fillPercentage(){return`${Math.min(this.usedSpace/this.totalSpace,1)*100}%`}},mounted(){this.usedSpace=0,this.totalSpace=1,this.unit="MB",this.fetchDiskUsage()},methods:{fetchDiskUsage(){ee().conn.reqDatabaseUsage().then(o=>{const t=(o.disk_usage/1024/1024).toFixed(1),e=(o.disk_limit/1024/1024).toFixed(1);e>1024?(this.unit="GB",this.usedSpace=(t/1024).toFixed(1),this.totalSpace=(e/1024).toFixed(1)):(this.unit="MB",this.usedSpace=t,this.totalSpace=e)},()=>{console.log("failed to fetch disk usage")})}}},bs={id:"disk-usage-main"},ks={class:"disk-usage-bar"},$s={class:"disk-usage-text"};function Ss(o,t,e,a,s,i){return p(),g("div",bs,[n("div",ks,[n("div",{class:"disk-usage-fill",style:ae({width:i.fillPercentage})},null,4)]),n("div",$s," Space: "+I(s.usedSpace)+" / "+I(s.totalSpace)+" "+I(s.unit),1)])}const xs=E(ws,[["render",Ss],["__scopeId","data-v-35d9044c"]]),st=o=>(se("data-v-02517de9"),o=o(),ie(),o),Cs={id:"usercard-main"},Ds={id:"user-settings"},Ps=st(()=>n("hr",null,null,-1)),Is=st(()=>n("summary",null,"Change password",-1)),Ts={id:"password-container"},Us={id:"info"},Rs={id:"user-desc"},As={id:"name-edit"},Ms={id:"name"},Bs=["src"],Ls={key:0,class:"admin_hint"},qs=st(()=>n("div",{style:{height:"0.2rem"}},null,-1)),Es=B({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(o,{emit:t}){const e=o,a=ee().conn,s=t,i=U(()=>G().user.id===e.userInfo.id),r=y(null),l=y(c());function c(){return`${qe()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function _(D){if(!D.type.startsWith("image/")){z().showPopup("Please select an image file","error");return}z().showPopup("Uploading avatar..."),a.uploadUserAvatar(e.userInfo.username,D).then(C=>{l.value=c(),s("update:userInfo",C)},C=>{z().showPopup(C,"error")})}const u=y(!1),d=y(""),f=y(""),v=y(""),h=y("");function x(){if(d.value===""||d.value===e.userInfo.name||d.value!==e.userInfo.name&&a.updateUserNickname(d.value).then(D=>{s("update:userInfo",D),u.value=!1},D=>{z().showPopup(D,"error")}),v.value!==""||h.value!==""){if(v.value===""){z().showPopup("Please enter the new password","error");return}if(v.value!==h.value){z().showPopup("The new passwords do not match","error");return}if(W().encKey!==ve(e.userInfo.username+ve(f.value))){z().showPopup("The old password is incorrect","error");return}a.updateUserPassword(v.value).then(D=>{const C=ve(e.userInfo.username+ve(v.value));W().setEncKey(C),f.value="",v.value="",h.value="",u.value=!1},D=>{z().showPopup(D,"error")})}}return(D,C)=>(p(),g("div",Cs,[k(xe,{show:u.value,"onUpdate:show":C[4]||(C[4]=m=>u.value=m),title:"User settings",onOnCancel:C[5]||(C[5]=m=>u.value=!1),onOnAccept:x},{default:M(()=>[n("div",Ds,[n("b",null,I(e.userInfo.username),1),V(n("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=m=>d.value=m),placeholder:"Nickname",class:"input"},null,512),[[X,d.value]]),Ps,n("details",null,[Is,n("div",Ts,[V(n("input",{type:"password","onUpdate:modelValue":C[1]||(C[1]=m=>f.value=m),placeholder:"Old password",class:"input"},null,512),[[X,f.value]]),V(n("input",{type:"password","onUpdate:modelValue":C[2]||(C[2]=m=>v.value=m),placeholder:"New password",class:"input"},null,512),[[X,v.value]]),V(n("input",{type:"password","onUpdate:modelValue":C[3]||(C[3]=m=>h.value=m),placeholder:"Confirm new password",class:"input"},null,512),[[X,h.value]])])])])]),_:1},8,["show"]),n("div",Us,[n("div",{id:"avatar",style:ae(i.value?{cursor:"pointer",borderRadius:"50%"}:{})},[k(S(ba),{href:l.value,size:D.avatarSize,onClick:C[6]||(C[6]=m=>{var $;return i.value?($=r.value)==null?void 0:$.click():()=>{}})},null,8,["href","size"]),k(S(Ue),{text:"Change avatar",action:_,ref_key:"avatarUploadBtn",ref:r,style:{display:"none"}},null,512)],4),n("div",Rs,[n("div",As,[n("h1",Ms,I(e.userInfo.name),1),i.value?(p(),g("img",{key:0,src:S(ys),alt:"",class:"icon",id:"edit-settings-icon",onClick:C[7]||(C[7]=m=>u.value=!0)},null,8,Bs)):A("",!0)]),n("p",{onClick:C[8]||(C[8]=m=>u.value=!0),style:{cursor:"pointer"}},[q(I(e.userInfo.username)+" ",1),e.userInfo.is_admin?(p(),g("label",Ls,"admin")):A("",!0)]),k(xs),qs])]),n("p",{id:"credential",onClick:C[9]||(C[9]=()=>{S(Ye)(S(W)().encKey).then(()=>{S(z)().showPopup("Secret copied to clipboard","info")})})},"-- Credential:"+I(S(W)().encKey.substring(0,12))+" --",1)]))}}),Fs=E(Es,[["__scopeId","data-v-02517de9"]]),zs={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},Os={class:"settings-container"},Hs={class:"settings-header"},Ns={class:"widget"};function Ws(o,t,e,a,s,i){return p(),g("div",Os,[n("div",Hs,[n("label",null,I(e.title),1),n("p",null,I(e.description),1)]),n("div",Ns,[fe(o.$slots,"default",{},void 0)])])}const Ee=E(zs,[["render",Ws],["__scopeId","data-v-f00f1fc8"]]),js=n("option",{value:"auto"},"Auto",-1),Vs=n("option",{value:"light"},"Light",-1),Ks=n("option",{value:"dark"},"Dark",-1),Zs=[js,Vs,Ks],Gs=B({__name:"ConfigTheme",setup(o){const t=y("auto");function e(){t.value=J.getThemeMode()}function a(s){s==="auto"?(J.clear(),J.setDefaultDarkMode()):s==="light"?J.setDarkMode(!1):s==="dark"&&J.setDarkMode(!0),e()}return e(),(s,i)=>(p(),Q(Ee,{title:"Theme",description:"Change the theme of the app"},{default:M(()=>[V(n("select",{"onUpdate:modelValue":i[0]||(i[0]=r=>t.value=r),onChange:i[1]||(i[1]=r=>a(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},Zs,544),[[Le,t.value]])]),_:1}))}}),Js={class:"switch-toggle"},Qs=B({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(o,{emit:t}){const a=y(o.checked),s=t,i=y(null);return(r,l)=>(p(),g("div",Js,[V(n("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":l[0]||(l[0]=c=>a.value=c),onChange:l[1]||(l[1]=()=>{s("update:checked",a.value)}),ref_key:"checkerRef",ref:i},null,544),[[Ot,a.value]]),n("label",{class:"switch",onClick:l[2]||(l[2]=c=>{var _;return(_=i.value)==null?void 0:_.click()})})]))}}),Te=E(Qs,[["__scopeId","data-v-58ea3d44"]]),Ys=B({__name:"ConfigShowTags",setup(o){const t=W(),e=U({get:()=>t.showTagPanel,set:a=>t.setShowTagPanel(a)});return(a,s)=>(p(),Q(Ee,{title:"Tag Panel",description:"Show tag panel at home page"},{default:M(()=>[k(Te,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),Xs=B({__name:"ConfigShowHomeInfoPanel",setup(o){const t=W(),e=U({get:()=>t.showHomeInfoPanel,set:a=>t.setShowHomeInfoPanel(a)});return(a,s)=>(p(),Q(Ee,{title:"Info Panel",description:"Show info panel at home page"},{default:M(()=>[k(Te,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),ei=B({__name:"ConfigShowScatterPlot",setup(o){const t=W(),e=U({get:()=>t.show3DScatterPlot,set:a=>t.setShow3DScatterPlot(a)});return(a,s)=>(p(),Q(Ee,{title:"Scatter Plot",description:"Show scatter plot at home page"},{default:M(()=>[k(Te,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),ti=["value"],ni=B({__name:"ConfigPageCapacity",setup(o){const t=U({get:()=>W().numItemsPerPage,set:a=>W().setNumItemsPerPage(a)}),e=[10,20,50,100,200,500];return(a,s)=>(p(),Q(Ee,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:M(()=>[V(n("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.value=i),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(p(),g(H,null,te(e,i=>n("option",{value:i,key:i},I(i),9,ti)),64))],512),[[Le,t.value]])]),_:1}))}}),ai={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},oi={style:{display:"flex",justifyContent:"center",alignItems:"center"}},si=n("hr",null,null,-1),ii=B({__name:"SettingsWindow",setup(o){const t=G().user;return(e,a)=>(p(),g("div",ai,[n("div",oi,[k(Fs,{"user-info":S(t),"avatar-size":"120px"},null,8,["user-info"])]),si,k(Gs),k(ni),k(Ys),k(Xs),k(ei)]))}}),ri="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",li="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",ui="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",ci="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",di={class:"button"},hi={key:0,id:"navigator"},pi={class:"nav-toggle"},fi=B({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0},compact:{type:Boolean,default:!0},showNavigator:{type:Boolean,default:!0}},setup(o){const t=o,e=ye();function a(){fn()}const s=y(null);let i=0;window.addEventListener("scroll",function(){const _=window.scrollY||document.documentElement.scrollTop;_<=i||i<10?s.value&&s.value.classList.contains("hidden")&&s.value.classList.remove("hidden"):s.value&&!s.value.classList.contains("hidden")&&s.value.classList.add("hidden"),i=_});const r=y(!1),l=yt(),c=U(()=>l.path.split("/")[1]);return(_,u)=>(p(),g(H,null,[k(ke,{show:r.value,"onUpdate:show":u[0]||(u[0]=d=>r.value=d),title:"Settings"},{default:M(()=>[k(ii)]),_:1},8,["show"]),n("div",{class:me(`main-toolbar ${t.compact?"compact-layout":"normal-layout shadow"}`),ref_key:"mainDiv",ref:s},[n("div",di,[t.returnHome?(p(),Q(be,{key:0,iconSrc:S(ui),labelText:"Home",shortcut:"ctrl+h",onOnClick:u[1]||(u[1]=()=>{S(e).push("/")}),title:"home"},null,8,["iconSrc"])):(p(),Q(be,{key:1,iconSrc:S(ri),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),k(be,{iconSrc:S(ci),labelText:"Settings",shortcut:"ctrl+,",onOnClick:u[2]||(u[2]=()=>{r.value=!0}),title:"Open settings"},null,8,["iconSrc"]),_.showNavigator?A("",!0):(p(),Q(S(Dt),{key:2,menuItems:[{name:"Home",action:()=>{S(e).push("/")}},{name:"Feed",action:()=>{S(e).push("/feed")}},{name:"About",action:()=>{S(e).push("/about")}}]},{default:M(()=>[k(be,{iconSrc:S(li),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]))]),_.showNavigator?(p(),g("div",hi,[n("div",pi,[n("div",{class:me(`button ${c.value==="home"||!c.value?"active-nav":""}`),onClick:u[3]||(u[3]=()=>{S(e).push("/")})},"Home",2),n("div",{class:me(`button ${c.value==="feed"?"active-nav":""}`),onClick:u[4]||(u[4]=()=>{S(e).push("/feed")})},"Feed",2),n("div",{class:me(`button ${c.value==="about"?"active-nav":""}`),onClick:u[5]||(u[5]=()=>{S(e).push("/about")})},"About",2)])])):A("",!0),fe(_.$slots,"default",{},void 0)],2)],64))}}),Fe=E(fi,[["__scopeId","data-v-0d6cb588"]]),mi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",It="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",vi=B({__name:"Splitter",props:ut({direction:{},movable:{type:Boolean,default:!0},minSplitRatio:{default:0},maxSplitRatio:{default:1},mode:{default:"ab"},splitterWidth:{default:"3px"},overflow:{default:"auto"}},{splitRatio:{default:.5},splitRatioModifiers:{}}),emits:ut(["moveStart","moveStop"],["update:splitRatio"]),setup(o,{emit:t}){const e=o,a=Ht(o,"splitRatio"),s=t,i=y(null),r=y(null),l=y(null),c=y(null),_=y(!1);function u(){e.mode=="ab"&&r.value&&l.value&&(e.direction==="vertical"?(r.value.style.width=`calc(${a.value*100}%)`,l.value.style.width=`calc(${(1-a.value)*100}%)`):(r.value.style.height=`calc(${a.value*100}%)`,l.value.style.height=`calc(${(1-a.value)*100}%)`)),e.mode=="a"&&r.value&&(e.direction==="vertical"?r.value.style.width="100%":r.value.style.height="100%"),e.mode=="b"&&l.value&&(e.direction==="vertical"?l.value.style.width="100%":l.value.style.height="100%")}function d(h){c.value&&c.value.contains(h.target)&&(_.value=!0),s("moveStart",h)}function f(){_.value=!1,s("moveStop")}function v(h){if(_.value&&r.value&&l.value&&c.value){const x="touches"in h?h.touches[0].clientX:h.clientX,D="touches"in h?h.touches[0].clientY:h.clientY,C=r.value.getBoundingClientRect(),m=i.value.getBoundingClientRect(),$=e.direction==="vertical"?(x-C.left)/m.width:(D-C.top)/m.height;a.value=Math.max(e.minSplitRatio,Math.min(e.maxSplitRatio,$)),h.preventDefault()}}return window.addEventListener("mousedown",d),window.addEventListener("touchstart",d),window.addEventListener("mouseup",f),window.addEventListener("touchend",f),window.addEventListener("mousemove",v),window.addEventListener("touchmove",v),oe(()=>[e.direction,e.mode,a.value],()=>{_t(u)}),he(()=>{u()}),(h,x)=>(p(),g("div",{id:"sp-container",ref_key:"container",ref:i,style:ae(e.direction==="vertical"?{flexDirection:"row"}:{flexDirection:"column"})},[e.mode=="ab"||e.mode=="a"?(p(),g("div",{key:0,ref_key:"aPane",ref:r,class:"splitter-pane panel",style:ae({overflow:e.overflow})},[fe(h.$slots,"a",{},void 0)],4)):A("",!0),e.mode=="ab"&&e.movable?(p(),g("div",{key:1,ref_key:"splitter",ref:c,class:"splitter",style:ae(e.direction==="vertical"?{cursor:"col-resize",height:"100%",width:h.splitterWidth}:{cursor:"row-resize",width:"100%",height:h.splitterWidth})},null,4)):A("",!0),e.mode=="ab"||e.mode=="b"?(p(),g("div",{key:2,ref_key:"bPane",ref:l,class:"splitter-pane panel",style:ae({overflow:e.overflow})},[fe(h.$slots,"b",{},void 0)],4)):A("",!0)],4))}}),it=E(vi,[["__scopeId","data-v-d141d9f5"]]),gi=B({__name:"Plot3d",props:{data:{}},setup(o,{expose:t}){const e=y(null),a=o,s=U(()=>a.data.map(h=>({x:h.x,y:h.y,z:h.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:h.text,marker:{size:3.5,opacity:h.opacity,color:h.color}}))),i={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},r={...i,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},l=y(J.isDarkMode()?"dark":"light");J.registerThemeChangeCallback(()=>{l.value=J.isDarkMode()?"dark":"light",d()});const c=U(()=>l.value==="dark"?r:i),_={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let u=null;function d(){if(!e.value)return;Ve.react(e.value,s.value,c.value,_),e.value.layout.scene&&u&&Ve.relayout(e.value,"scene.camera",u)}return t({update:d}),he(()=>{Ve.newPlot(e.value,s.value,c.value,_).then(()=>{e.value.on("plotly_relayout",f=>{if(console.log("plotly_relayout",f),!f["scene.camera"])return;const v=f["scene.camera"];u=Me(v)})}),e.value.on("plotly_click",function(f){f.points||console.log("Not clicking on any data.");const v=f.points[0].x,h=f.points[0].y,x=f.points[0].z,D=f.points[0].pointNumber;console.log(`You clicked on ${v}, ${h}, ${x} (point ${D})}`)}),oe(s,()=>{d()})}),(f,v)=>(p(),g("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),_i=E(gi,[["__scopeId","data-v-db3ba83e"]]),yi={id:"main-filtervis"},wi={key:0,id:"plot3dDiv"},bi={key:0,id:"loadingDiv",class:"full"},ki={key:1,class:"status"},$i=B({__name:"FilterVis",setup(o){const t=G(),e=y(null),a=z(),s=W(),i=y(null),r=U(()=>{if(i.value===null)return{};const f=t.database.allKeys(),v={};for(const h of f)i.value[h]&&(v[h]=i.value[h]);return v});async function l(f,v="rgb(100, 100, 200)"){const h=r.value;if(!h)f=[];else for(let b=f.length-1;b>=0;b--)h[f[b]]===void 0&&f.splice(b,1);const x=f.length,D=await t.database.agetMany(f),C=new Float32Array(x),m=new Float32Array(x),$=new Float32Array(x),P=new Array(x);for(const[b,T]of f.entries()){let Y=h[T];if(Y==null)throw new Error("uid not found in feats: "+T);C[b]=Y[0],m[b]=Y[1],$[b]=Y[2];const le=D[b];P[b]=`${le.authorYear()}<br>${le.summary.title}`}let w;if(typeof v=="string")w=v;else if(v instanceof Array)if(typeof v[0]=="string")w=v;else{const b=v,T=Math.max(...b),Y=Math.min(...b),le={0:J.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};w=b.map(j=>{const K=(j-Y)/(T-Y),Z=Array(3);for(let _e=0;_e<3;_e++)Z[_e]=Math.round(le[0][_e]*(1-K)+le[1][_e]*K);return`rgb(${Z[0]}, ${Z[1]}, ${Z[2]})`})}else throw new Error("Invalid color type");return{x:C,y:m,z:$,opacity:.75,color:w,text:P}}const c=y(null);async function _(){const f=a.shownDataScores;let v;f?v=await l(Me(a.shownDataUIDs),f):v=await l(Me(a.shownDataUIDs));const x=t.database.allKeys().filter(m=>a.shownDataUIDs.indexOf(m)==-1),D=await l(x,J.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),C=await l(Me(a.unfoldedDataUIDs),"rgb(255, 0, 0)");c.value=[v,D,C]}const u=U(()=>Object.keys(r.value).length>0);async function d(){i.value=null;const f=ee().conn,v=(await f.status()).n_data;let h;v<50?h=-1:v<100?h=5:v<300?h=8:v<500?h=12:h=15,console.log("dataset size: ",v,"perp: ",h),i.value=await f.reqDatabaseFeatureTSNE("doc_feature",3,h)}return oe(()=>[a.shownDataUIDs,a.unfoldedDataUIDs],()=>{_()}),oe(()=>s.show3DScatterPlot,f=>{f&&d().then(()=>{_()})}),he(()=>{s.show3DScatterPlot&&d().then(()=>{_()})}),(f,v)=>(p(),g("div",yi,[S(s).show3DScatterPlot?(p(),g("div",wi,[k(_i,{data:c.value?c.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!u.value||!r.value?(p(),g("div",bi,[i.value===null?(p(),Q(We,{key:0})):(p(),g("p",ki,"Data not ready"))])):A("",!0)])):A("",!0)]))}}),Si=E($i,[["__scopeId","data-v-97428746"]]),xi={id:"searchbar"},Ci={id:"searchbar-container"},Di=["value"],Pi=B({__name:"Searchbar",setup(o){const t=z(),e=["title","author","year","note","publication","feature","uuid"],a=y(""),s=y(null);function i(){const c={searchBy:s.value.value,content:a.value};t.searchState=c,console.log(c),t.updateShownData()}const r=bt(i,300);function l(c){return c.charAt(0).toUpperCase()+c.slice(1)}return(c,_)=>(p(),g("div",xi,[n("div",Ci,[n("select",{ref_key:"searchSelector",ref:s,name:"search_type",id:"searchType",onChange:i},[(p(),g(H,null,te(e,u=>n("option",{value:u},I(l(u)),9,Di)),64))],544),V(n("input",{type:"text",id:"searchbar-input",placeholder:"Search","onUpdate:modelValue":_[0]||(_[0]=u=>a.value=u),onInput:_[1]||(_[1]=(...u)=>S(r)&&S(r)(...u))},null,544),[[X,a.value]])])]))}}),Ii=E(Pi,[["__scopeId","data-v-ab0dfe65"]]);class Ti{constructor(t){ne(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const a in e)t[a]=e[a];return t}setURLParam(t,e){const a=this.getURLParams();a[t]=e,this.router.push({query:a})}updateURLWithParam(t,e){const a=this.getURLParams();return a[t]=e,this.router.resolve({query:a}).href}}function Ui(o,{router:t=null,datapoint:e=null}){const a=t?new Ti(t):null;if(o=o.replace(/^---[\s\S]*?---/,""),e){const s=G().user;o=o.replace(new RegExp("./misc/","g"),`${qe()}/misc/${e.summary.uuid}?_u=${s.id}&&fname=`),a&&(window.location.href.includes("/reader/")?o=o.replace(new RegExp("\\$\\{doc\\}#","g"),a.updateURLWithParam("docHashMark","")):o=o.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))}return o}const Ri=o=>(se("data-v-d773806f"),o=o(),ie(),o),Ai={id:"noteEditor"},Mi={key:2,id:"save-hint"},Bi={style:{"padding-inline":"5px","padding-block":"0.5rem"}},Li={key:0,style:{display:"flex",gap:"5px"}},qi=Ri(()=>n("label",{class:"frontmatter-label"},"LINKS",-1)),Ei=["href"],Fi={key:1,style:{display:"flex"}},zi={id:"btn-container"},Oi=["id"],Hi={key:0,id:"misc-container",class:"hover-scrollable"},Ni={key:0,style:{"font-weight":"bold",color:"var(--color-text-soft)",top:"0.5rem"}},Wi=["href"],ji={key:0,style:{color:"var(--color-text-soft)"}},Vi={class:"misc-file-op-container"},Ki=["onClick"],Zi=["onClick"],Gi=["onClick"],Ji=B({__name:"NoteEditor",props:{datapoint:{}},setup(o,{expose:t}){const e=o,a=ye(),s=y(""),i=y({}),r=U(()=>{var F;return!e.datapoint||((F=e.datapoint)==null?void 0:F.isDummy())}),l=y(J.isDarkMode()?"dark":"light"),c=()=>l.value=J.isDarkMode()?"dark":"light";he(()=>J.registerThemeChangeCallback(c)),vt(()=>J.unregisterThemeChangeCallback(c)),oe(()=>s.value,F=>{try{const j=Xt(F);if(typeof j.data!="object"||j.data===i.value)return;i.value=j.data,console.log("DEBUG: front matter",i.value)}catch{}});const _=U(()=>Ui(s.value,{router:a,datapoint:e.datapoint})),u=y(null),d=z(),f=y([]),v=y(""),h=U(()=>{function F(Z){return Z.replace(/\n/g,"").replace(/\r/g,"")}if(F(v.value)===F(s.value))return"";const j=F(v.value).trim(),K=F(s.value).trim();if(j.length!==K.length)return console.log("length diff",j.length,K.length),"Unsaved";for(let Z=0;Z<j.length;Z++)if(j[Z]!==K[Z]){console.log("diff at",Z,j[Z],K[Z]),console.log("char code",j.charCodeAt(Z),K.charCodeAt(Z));break}return"Unsaved"});function x(){s.value="",v.value="",f.value=[]}async function D(){if(!e.datapoint||e.datapoint.isDummy())return;const F=await e.datapoint.fetchNote();v.value=F,s.value=F}async function C(){!e.datapoint||e.datapoint.isDummy()||(f.value=await e.datapoint.listMiscFiles())}async function m(){!e.datapoint||e.datapoint.isDummy()||await Promise.all([D(),C()])}Je(m),he(m),oe(()=>e.datapoint,()=>{r.value?x():(m(),console.log("datapoint changed, fetching note and misc files..."))});async function $(){!e.datapoint||e.datapoint.isDummy()||(await e.datapoint.uploadNote(s.value),v.value=s.value)}const P=async F=>{!e.datapoint||e.datapoint.isDummy()||(await e.datapoint.deleteMiscFile(F),f.value=f.value.filter(j=>j.fname!==F),z().showPopup("File deleted","info"))},w=async(F,j)=>{if(!(!e.datapoint||e.datapoint.isDummy())){if(F.split(".").pop()!==j.split(".").pop()){z().showPopup("File extension must be the same","error");return}await e.datapoint.renameMiscFile(F,j),s.value=s.value.replace(F,j),C(),z().showPopup("File renamed","info")}},b=async F=>{if(!e.datapoint||e.datapoint.isDummy())return;d.showPopup("Upload","info"),(await e.datapoint.uploadMisc(F)).map(K=>u.value.insert(()=>({targetValue:`![image](${K})`,select:!1,deviationStart:0,deviationEnd:0}))),$(),C()},T=U({get:()=>d.showNotePreview===null?s.value.trim().length>0:d.showNotePreview,set:F=>{d.showNotePreview=F}});function Y(F){return s.value.indexOf(F)>=0}function le(F){const j=window.prompt(F);if(!j)throw new Error("User cancelled");return j}return t({preview:T,fetchNote:D}),rn("update_note",F=>{if(!e.datapoint||e.datapoint.isDummy()||F.session_id===ee().wsConn.sessionID)return;F.datapoint_summary.uuid===e.datapoint.uid&&m().then(()=>{z().showPopup("update note from other clients","info")})}),(F,j)=>(p(),g("div",Ai,[n("div",{class:"editor",onDblclick:j[1]||(j[1]=K=>T.value=!1)},[T.value?(p(),Q(S(Yt),{key:1,"model-value":_.value,theme:l.value,"preview-theme":"vuepress"},null,8,["model-value","theme"])):(p(),Q(S(Qt),{key:0,ref_key:"mdEditor",ref:u,modelValue:s.value,"onUpdate:modelValue":j[0]||(j[0]=K=>s.value=K),preview:!1,language:"en-US",theme:l.value,onOnSave:$,onOnUploadImg:b,disabled:r.value,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme","disabled"])),!T.value&&h.value?(p(),g("div",Mi,I(h.value),1)):A("",!0)],32),n("div",Bi,[(p(!0),g(H,null,te(i.value,(K,Z)=>(p(),g(H,{key:Z},[Z=="links"?(p(),g("div",Li,[qi,(p(!0),g(H,null,te(K,(_e,O)=>(p(),g(H,null,[typeof O=="string"?(p(),g("a",{key:0,class:"frontmatter-link",href:_e,target:"_blank"},I(O),9,Ei)):A("",!0)],64))),256))])):(p(),g("div",Fi,[q(" [unknown-entry] "),n("b",null,I(Z)+": ",1),q(I(K),1)]))],64))),128))]),n("div",zi,[n("button",{onClick:j[2]||(j[2]=K=>T.value=!T.value)},I(T.value?"Edit":"Preview"),1),k(S(Ue),{action:K=>{!e.datapoint||e.datapoint.isDummy()||e.datapoint.uploadMisc([K]).then(Z=>{S(z)().showPopup("File uploaded","success"),C(),u.value.insert(()=>({targetValue:`[${K.name}](${Z[0]})`,select:!1,deviationStart:0,deviationEnd:0}))})}},null,8,["action"])]),n("div",{id:"misc-toggle",onClick:j[3]||(j[3]=()=>{S(d).showMiscPanel=!S(d).showMiscPanel})},[n("div",{id:S(d).showMiscPanel?"triangle-down":"triangle"},null,8,Oi)]),S(d).showMiscPanel?(p(),g("div",Hi,[f.value.length===0?(p(),g("div",Ni," No attached files. ")):A("",!0),(p(!0),g(H,null,te(f.value,K=>(p(),g("div",{key:K.fname,class:"misc-file"},[n("div",null,[n("a",{href:K.url,target:"_blank"},I(K.fname),9,Wi),Y(K.fname)?A("",!0):(p(),g("label",ji," (no-ref) "))]),n("div",Vi,[n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:Z=>{S(Ye)(K.fname),S(z)().showPopup("Copied")}}," copy ",8,Ki),n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:Z=>w(K.fname,le("New name"))}," rename ",8,Zi),Y(K.fname)?A("",!0):(p(),g("a",{key:0,style:{color:"var(--color-danger)",cursor:"pointer"},onClick:Z=>P(K.fname)}," delete ",8,Gi))])]))),128))])):A("",!0)]))}}),Tt=E(Ji,[["__scopeId","data-v-d773806f"]]);function Ut(){const o=Nt({width:window.innerWidth,height:window.innerHeight});function t(){o.width=window.innerWidth,o.height=window.innerHeight}window.addEventListener("resize",t);function e(){window.removeEventListener("resize",t)}return{...Wt(o),cleanup:e}}function Qi(o){const t=ee().conn,e=y({}),a=()=>{Promise.all(o.value.map(s=>t.query({searchBy:"author",searchContent:s}))).then(s=>{for(let i=0;i<o.value.length;i++)e.value[o.value[i]]=s[i].uids})};return oe(o,a,{immediate:!0}),{authorPapers:e,updateAuthorPapers:a}}const Yi=o=>(se("data-v-165f5216"),o=o(),ie(),o),Xi={style:{"font-weight":"bold"}},er=Yi(()=>n("div",{style:{height:"10px"}},null,-1)),tr={key:0,id:"summary-panel-main"},nr={class:"title"},ar={class:"authors-div"},or={class:"author-container"},sr={class:"author"},ir=["onClick"],rr={class:"publication"},lr={key:0,class:"docsize"},ur=B({__name:"InfoPanel",props:{datapoint:{}},setup(o){const t=o,e=U(()=>t.datapoint?kt(t.datapoint.summary.bibtex):""),a=U(()=>{var u;return((u=t.datapoint)==null?void 0:u.authors)||[]}),{authorPapers:s}=Qi(a),i=U(()=>{const u={};for(const[d,f]of Object.entries(s.value))u[d]=f.filter(v=>{var h;return v!==((h=t.datapoint)==null?void 0:h.uid)});return u}),r=y(""),{width:l}=Ut(),c=U(()=>l.value>768?"horizontal":"vertical"),_=l.value>768?.3:.5;return(u,d)=>(p(),g(H,null,[k(ke,{show:r.value.length>0,onClose:d[0]||(d[0]=f=>r.value="")},{default:M(()=>[n("h2",Xi," All entries by "+I(r.value),1),er,k(Ie,{uids:S(s)[r.value]},null,8,["uids"])]),_:1},8,["show"]),k(it,{direction:c.value,"split-ratio":S(_)},{a:M(()=>[u.datapoint?(p(),g("div",tr,[n("h2",nr,I(u.datapoint.summary.title),1),n("div",ar,[(p(!0),g(H,null,te(a.value,f=>(p(),g("div",or,[n("span",sr,I(f),1),i.value[f].length>0?(p(),g("span",{key:0,class:"author-paper-count",onClick:v=>r.value=f}," ("+I(i.value[f].length)+") ",9,ir)):A("",!0)]))),256))]),n("div",rr,I(u.datapoint.publication+`. (${u.datapoint.year})`+(e.value?", "+e.value:"")),1),u.datapoint.summary.doc_size?(p(),g("div",lr,[n("span",null,I(u.datapoint.summary.doc_size)+" MB ",1)])):A("",!0)])):A("",!0)]),b:M(()=>[k(Tt,{datapoint:u.datapoint},null,8,["datapoint"])]),_:1},8,["direction","split-ratio"])],64))}}),cr=E(ur,[["__scopeId","data-v-165f5216"]]),dr=o=>(se("data-v-3d4d3304"),o=o(),ie(),o),hr={id:"main-home",class:"gradIn compact"},pr={class:"horizontal fullHeight"},fr={key:0,id:"left-panel"},mr={id:"doc-panel",class:"panel1"},vr={key:0,class:"fullWidth"},gr={id:"doc-top-bar"},_r={style:{"flex-grow":"1"}},yr={style:{display:"flex","flex-grow":"0","margin-right":"5px","margin-block":"5px"}},wr={key:1,id:"blankPlaceholder"},br={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},kr=dr(()=>n("br",null,null,-1)),$r={name:"Home",inheritAttrs:!1,customOptions:{}},Sr=B({...$r,setup(o){const t=z(),e=G(),a=W(),{width:s}=Ut(),r=ye().currentRoute.value.query.tags;r!=null&&(t.tagStatus.checked=new N(r.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const l=y(null);oe(()=>t.focusedDataUID,f=>{f?e.database.aget(f).then(v=>{l.value=v}):l.value=null});const c=y(null);function _(){c.value.show({datapoint:null})}function u(f){var h;f.preventDefault();const v=(h=f.dataTransfer)==null?void 0:h.files;v&&(_(),c.value.loadFiles(v)||c.value.close())}function d(){t.reloadDatabase(),ee().wsConn.resetReconnect()}return(f,v)=>(p(),g(H,null,[k(ot,{ref_key:"dataEditor",ref:c},null,512),k(Fe,{"return-home":!1,compact:!0}),n("div",hr,[n("div",pr,[k(Be,{name:"left-in"},{default:M(()=>[S(a).showTagPanel?(p(),g("div",fr,[k(Wn,{onOnCheck:v[0]||(v[0]=()=>S(t).updateShownData())})])):A("",!0)]),_:1}),k(it,{direction:S(s)>768?"vertical":"horizontal",mode:S(a).showHomeInfoPanel?"ab":"a","split-ratio":S(s)>768?.8:.6},{a:M(()=>[n("div",mr,[S(a).show3DScatterPlot?(p(),g("div",vr,[k(Si)])):A("",!0),n("div",{class:"scrollable",id:"doc-container",onDragover:v[2]||(v[2]=h=>h.preventDefault()),onDrop:u},[n("div",gr,[n("div",_r,[k(Ii)]),n("div",yr,[k(be,{iconSrc:S(mi),labelText:"New",title:"Add new data to database",onClick:_,shortcut:"ctrl+n"},null,8,["iconSrc"]),k(be,{iconSrc:S(It),labelText:"Reload",title:"Reload database",onClick:d},null,8,["iconSrc"])])]),S(t).shownDataUIDs.length>0?(p(),Q(Ie,{key:0,uids:S(t).shownDataUIDs,unfoldedIds:S(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":v[1]||(v[1]=h=>S(t).unfoldedDataUIDs=h)},null,8,["uids","unfoldedIds"])):(p(),g("div",wr,[S(e).database.initialized?(p(),g("p",br,[q(" Nothing to show "),n("p",{style:{"font-size":"medium"}},[q(" Add your first enty by clicking the "),n("b",null,[n("a",{onClick:_,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),q(" button above."),kr])])):(p(),Q(We,{key:1}))]))],32)])]),b:M(()=>[k(cr,{datapoint:l.value},null,8,["datapoint"])]),_:1},8,["direction","mode","split-ratio"])])])],64))}}),xr=E(Sr,[["__scopeId","data-v-3d4d3304"]]);function Cr(o,t=!1){t&&(o*=1e3);const e=new Date(o);let a=e.getFullYear().toString();a.length!==4&&(a="0".repeat(4-a.length)+a);let s=(e.getMonth()+1).toString();s.length===1&&(s="0"+s);let i=e.getDate().toString();i.length===1&&(i="0"+i);let r=`${a}-${s}-${i} `;const l={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};return r+=e.toLocaleTimeString([],l),r}const Dr=o=>(se("data-v-8a4a3cb8"),o=o(),ie(),o),Pr={id:"authorPapers"},Ir={id:"feed-main",class:"slideInFast"},Tr={class:"articleBlock"},Ur={class:"titleBlock"},Rr={style:{"font-weight":"bold"}},Ar={style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},Mr={class:"titleId"},Br={class:"authors"},Lr={class:"authorSpan"},qr=["href"];const Er=["onClick"],Fr={key:3},zr={class:"actions"},Or=["href"],Hr=["href"],Nr=Dr(()=>n("summary",null,"Abstract",-1)),Wr={id:"relatedArticles"},jr=B({__name:"ArticleBlock",props:{article:{}},setup(o){const t=o,e=G(),a=ee().conn,s=y(null);async function i(){var D;(D=s.value)==null||D.show({datapoint:null,bibtex:t.article.bibtex,tags:[],url:t.article.url})}const r=y({});async function l(){for(let D=0;D<t.article.authors.length;D++){const C=t.article.authors[D],m=t.article.authors_other_publications[D],$=await e.database.agetMany(m);r.value[C]=$}}l();const c=U(()=>{const D={};for(const C in r.value)r.value[C]?D[C]=r.value[C].length:D[C]=null;return D}),_=y(!1),u=y([]);function d(D){u.value=r.value[D],u.value||(u.value=[]),_.value=!0}const f=y([]),v=y([]),h=U(()=>{const D={};for(let C=0;C<f.value.length;C++)D[f.value[C].summary.uuid]=v.value[C].toPrecision(4);return D});function x(){f.value.length>0||a.query({searchBy:"feature",searchContent:t.article.abstract,maxResults:10}).then(D=>{const C=D.scores,m=D.uids,$=St(m,C);e.database.agetMany($[0],!1).then(P=>{f.value=P;const w=[];for(const b of P){const T=m.indexOf(b.summary.uuid);T>=0&&w.push(C[T])}v.value=w})})}return(D,C)=>(p(),g(H,null,[k(ot,{ref_key:"dataEditor",ref:s},null,512),k(ke,{show:_.value,"onUpdate:show":C[0]||(C[0]=m=>_.value=m),title:"Publications in the database",onOnClose:C[1]||(C[1]=m=>u.value=[])},{default:M(()=>[n("div",Pr,[k(Ie,{uids:u.value.map(m=>m.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),n("div",Ir,[n("div",Tr,[n("div",Ur,[n("h2",Rr,I(t.article.title),1),n("div",Ar,[k(et,{tags:t.article.tags},null,8,["tags"]),n("label",Mr,I(t.article.uuid),1)])]),n("div",Br,[(p(!0),g(H,null,te(t.article.authors,(m,$)=>(p(),g("span",Lr,[(p(),g("a",{key:0,class:"link",href:`https://arxiv.org/search/?query=${m}&searchtype=author`,target:"_blank"},I(m),9,qr)),c.value[m]?(p(),g("a",{key:2,class:"pubCount",onClick:()=>d(m)},I(`(${c.value[m]})`),9,Er)):A("",!0),$<t.article.authors.length-1?(p(),g("span",Fr,", ")):A("",!0)]))),256))]),n("div",zr,[n("a",{href:D.article.url,target:"_blank"},"Link",8,Or),q(" | "),n("a",{href:`https://arxiv.org/pdf/${D.article.uuid}.pdf`,target:"_blank"},"PDF",8,Hr),q(" | "),n("a",{onClick:i},"Collect")]),n("p",null,"Added: "+I(S(Cr)(t.article.time_added,!0)),1),n("details",null,[Nr,n("p",null,I(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:x},"Related articles"),n("div",Wr,[k(Ie,{uids:f.value.map(m=>m.summary.uuid),scores:h.value},null,8,["uids","scores"])])])])])],64))}}),Vr=E(jr,[["__scopeId","data-v-8a4a3cb8"]]),Rt=o=>(se("data-v-ed7e2b2f"),o=o(),ie(),o),Kr={id:"toolbar"},Zr={id:"main"},Gr={style:{"margin-block":"1rem"}},Jr=["src"],Qr={id:"settings"},Yr={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem","flex-flow":"row wrap"}},Xr=["value"],el=["value"],tl={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem"}},nl={key:0,id:"loadingPlaceholder"},al=Rt(()=>n("b",null,"Fetching...",-1)),ol={key:1,id:"loadingPlaceholder"},sl=Rt(()=>n("b",null,"No articles found",-1)),il=[sl],rl=B({__name:"Feed",setup(o){const t=ee().conn,e=ye();function a($=0){const P=new Date;return P.setDate(P.getDate()+$),P.toISOString().split("T")[0]}const s=y("arxiv"),i=y(!1),r=y(["arxiv"]),l=y(a(1)),c=y(a(-1)),_=y(parseInt(e.currentRoute.value.query.maxResults)||100),u=y(""),d=y(null),f=y([]),v=U(function(){return[...f.value].sort((P,w)=>{if(d.value===null||!P.feature||!w.feature)return 0;{const b=new Float32Array(P.feature),T=new Float32Array(w.feature),Y=d.value,le=b.reduce((j,K,Z)=>j+(K-Y[Z])**2,0),F=T.reduce((j,K,Z)=>j+(K-Y[Z])**2,0);return le-F}})});function h(){if(u.value.trim()===""){d.value=null;return}t.featurizeText(u.value).then($=>{d.value=new Float32Array($)},()=>{console.log("failed to featurize")})}const x=bt(h,100);_.value>200&&(window.alert("maxResults cannot be larger than 200"),_.value=200);let D=e.currentRoute.value.query.search||"";D!==""&&(u.value=D);const C=y(null);async function m(){f.value=[];const $=ee().conn;r.value=["arxiv"].concat(await $.reqFeedCategories()),i.value=!0;const P=new Date(l.value).getTime()/1e3,w=new Date(c.value).getTime()/1e3;try{const b=await $.reqFeedList({maxResults:_.value,category:s.value,timeBefore:P,timeAfter:w});f.value=b,h()}finally{i.value=!1}}return he(()=>{m().then(()=>C.value.classList.remove("spin"),()=>{C.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),($,P)=>(p(),g(H,null,[n("div",Kr,[k(Fe,{ref:"toolbar"},null,512)]),n("div",Zr,[n("h1",Gr,[q(" Daily Feed "),n("img",{ref_key:"refreshButton",ref:C,src:S(It),alt:"",class:"icon spin",title:"refresh the page",onClick:P[0]||(P[0]=w=>{const b=w.target;b.classList.contains("spin")||(b.classList.add("spin"),m().then(()=>b.classList.remove("spin")))})},null,8,Jr)]),n("div",Qr,[n("div",Yr,[n("span",null,[q(" Category: "),V(n("select",{name:"category",id:"category-select","onUpdate:modelValue":P[1]||(P[1]=w=>s.value=w),onChange:m},[(p(!0),g(H,null,te(r.value,w=>(p(),g("option",{value:w},I(w),9,Xr))),256))],544),[[Le,s.value]])]),n("span",null,[q(" Max results: "),V(n("select",{"onUpdate:modelValue":P[2]||(P[2]=w=>_.value=w),onChange:m},[(p(),g(H,null,te([20,50,100,200,500],w=>n("option",{value:w},I(w),9,el)),64))],544),[[Le,_.value]])]),n("span",null,[q(" From: "),V(n("input",{type:"date","onUpdate:modelValue":P[3]||(P[3]=w=>c.value=w),onChange:m},null,544),[[X,c.value]])]),n("span",null,[q(" To: "),V(n("input",{type:"date","onUpdate:modelValue":P[4]||(P[4]=w=>l.value=w),onChange:m},null,544),[[X,l.value]])])]),n("div",tl,[V(n("input",{type:"text",placeholder:"Search",onInput:P[5]||(P[5]=(...w)=>S(x)&&S(x)(...w)),"onUpdate:modelValue":P[6]||(P[6]=w=>u.value=w),autocomplete:"off"},null,544),[[X,u.value]])])]),v.value.length===0&&i.value?(p(),g("div",nl,[al,k(We)])):A("",!0),v.value.length===0&&!i.value?(p(),g("div",ol,il)):A("",!0),(p(!0),g(H,null,te(v.value,w=>(p(),Q(Vr,{article:w},null,8,["article"]))),256))])],64))}}),ll=E(rl,[["__scopeId","data-v-ed7e2b2f"]]),ul={class:"main"},cl={id:"login",class:"slideIn"},dl={class:"loginLine"},hl={class:"loginLine"},pl=["type"],fl={class:"options"},ml={key:0,class:"error"},vl=B({__name:"LoginInput",setup(o){const t=y(""),e=y(""),a=y(""),s=y(!0),i=y(!1),r=U(()=>i.value?"text":"password"),l=y("Login"),c=ye(),_=y(""),u=y("");c.isReady().then(()=>{_t(()=>{_.value=W().backendHost,u.value=W().backendPort})});function d(){W().setBackendHost(_.value),W().setBackendPort(u.value),l.value="Connecting...";const f=ee().conn,v=vn(t.value,e.value);W().setEncKey(v,!1),f.authorize().then(h=>{Xe(v,h,s.value),a.value="";const x=c.currentRoute.value.query.from;x?(console.log("Redirecting to",x),c.push(x)):c.push("/"),l.value="Login"},h=>{a.value=h,l.value="Login"})}return(f,v)=>(p(),g("div",ul,[n("div",cl,[n("form",null,[n("div",dl,[V(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":v[0]||(v[0]=h=>t.value=h),placeholder:"Username",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,t.value]])]),n("div",hl,[V(n("input",{class:"key-input",type:r.value,id:"password-input","onUpdate:modelValue":v[1]||(v[1]=h=>e.value=h),placeholder:"Password"},null,8,pl),[[Ze,e.value]])]),n("div",fl,[k(Se,{checked:s.value,onOnCheck:v[2]||(v[2]=()=>{s.value=!s.value})},{default:M(()=>[q("Stay login")]),_:1},8,["checked"]),k(Se,{checked:i.value,onOnCheck:v[3]||(v[3]=()=>{i.value=!i.value})},{default:M(()=>[q("Show key")]),_:1},8,["checked"])]),A("",!0),n("button",{type:"submit",onClick:Oe(d,["prevent"])},I(l.value),1)]),a.value?(p(),g("p",ml,I(a.value),1)):A("",!0)])]))}}),gl=E(vl,[["__scopeId","data-v-34f6e322"]]),_l={props:{defaultInvitationCode:{type:String,default:""}},data(){return{invitationCode:this.defaultInvitationCode,username:"",password:"",passwordConfirm:"",name:Pe[Math.floor(Math.random()*Pe.length)],showPassword:!1}},emits:["register-success","register-fail"],components:{SwitchToggle:Te},methods:{submitForm(o){if(this.password!==this.passwordConfirm){this.$emit("register-fail","Passwords do not match");return}ee().conn.registerUser(this.invitationCode,this.username,this.password,this.name).then(()=>{this.$emit("register-success")},t=>{t.message.includes("409")?this.$emit("register-fail","Username already exists"):t.message.includes("401")?this.$emit("register-fail","Invalid invitation code"):t.message.includes("403")?this.$emit("register-fail","Invitation code expired"):t.message.includes("507")?this.$emit("register-fail","Maximum number of users reached"):this.$emit("register-fail",t)}),o.preventDefault()}}},$e=o=>(se("data-v-892e7367"),o=o(),ie(),o),yl={id:"form-container"},wl={class:"form-elem"},bl=$e(()=>n("div",{style:{color:"var(--color-text-soft)","font-size":"smaller","padding-inline":"0.5rem"}}," Get an invitation from the server administrator ",-1)),kl=$e(()=>n("span",null,"Invitation code",-1)),$l={class:"form-elem"},Sl=$e(()=>n("span",null,"Username",-1)),xl={class:"form-elem"},Cl=["type"],Dl=$e(()=>n("span",null,"Password",-1)),Pl={class:"form-elem"},Il=["type"],Tl=$e(()=>n("span",null,"Confirm password",-1)),Ul={class:"form-elem"},Rl=$e(()=>n("span",null,"Name",-1)),Al={id:"show-password-container"},Ml=$e(()=>n("label",null,"Show password",-1)),Bl=$e(()=>n("button",{type:"submit"},"Register",-1));function Ll(o,t,e,a,s,i){const r=Ge("SwitchToggle");return p(),g("form",{onSubmit:t[6]||(t[6]=(...l)=>i.submitForm&&i.submitForm(...l)),id:"registration-form"},[n("div",yl,[n("div",wl,[bl,V(n("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>s.invitationCode=l),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.invitationCode]]),kl]),n("div",$l,[V(n("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>s.username=l),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.username]]),Sl]),n("div",xl,[V(n("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[2]||(t[2]=l=>s.password=l),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Cl),[[Ze,s.password]]),Dl]),n("div",Pl,[V(n("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[3]||(t[3]=l=>s.passwordConfirm=l),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Il),[[Ze,s.passwordConfirm]]),Tl]),n("div",Ul,[V(n("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=l=>s.name=l),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.name]]),Rl])]),n("div",Al,[k(r,{checked:s.showPassword,"onUpdate:checked":t[5]||(t[5]=l=>s.showPassword=l)},null,8,["checked"]),Ml]),Bl],32)}const ql=E(_l,[["render",Ll],["__scopeId","data-v-892e7367"]]),El={id:"login-main"},Fl={id:"container"},zl={for:"login",id:"info"},Ol=["href"],Hl=B({__name:"Login",setup(o){J.setDefaultDarkMode();const t=y(""),e=y(!1),a=ye();return console.log(a.currentRoute.value.query.invitation),a.currentRoute.value.query.invitation&&(e.value=!0,t.value=a.currentRoute.value.query.invitation),(s,i)=>(p(),g(H,null,[k(ke,{title:"User registration",show:e.value,"onUpdate:show":i[2]||(i[2]=r=>e.value=r),compact:!0},{default:M(()=>[k(ql,{"default-invitation-code":t.value,onRegisterSuccess:i[0]||(i[0]=()=>{e.value=!1,S(z)().showPopup("Registration successful","success")}),onRegisterFail:i[1]||(i[1]=r=>S(z)().showPopup(r,"error"))},null,8,["default-invitation-code"])]),_:1},8,["show"]),n("div",El,[n("div",Fl,[k(gl),n("label",zl,[q(" Need assistant? - "),n("a",{onClick:i[3]||(i[3]=r=>e.value=!0)},"Register"),q(" | "),n("a",{href:`mailto:${S(_s).email}`},"Contact me",8,Ol)])])])],64))}}),Nl=E(Hl,[["__scopeId","data-v-def42eb3"]]),Wl=o=>(se("data-v-c3f015a3"),o=o(),ie(),o),jl={id:"body"},Vl=["src"],Kl=Wl(()=>n("div",{style:{color:"var(--color-text-soft)","font-weight":"bold","font-size":"large"}},"No file, drag and drop to  ",-1)),Zl=B({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(o,{expose:t}){const e=o,a=ye(),s=U(()=>{const d=a.currentRoute.value.query.docHashMark;return d||""}),i=y(!1),r=y(null);t({noteEditor:r});function l(u){W().setReaderLayoutType(u)}oe(()=>e.layoutType,(u,d)=>{console.log("layoutType changed:",d,"->",u),l(u)});const c=y(J.isDarkMode()?"dark":"light");J.registerThemeChangeCallback(()=>c.value=J.isDarkMode()?"dark":"light");const _=U(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":c.value},urlHashMark:s.value})}`);return he(()=>{l(e.layoutType)}),(u,d)=>(p(),g("div",jl,[k(it,{direction:"vertical","split-ratio":S(z)().preferredReaderLeftPanelWidthPerc,"onUpdate:splitRatio":d[2]||(d[2]=f=>S(z)().preferredReaderLeftPanelWidthPerc=f),"splitter-width":"4px",mode:{0:"a",1:"b",2:"ab"}[u.layoutType],onMoveStart:d[3]||(d[3]=()=>i.value=!0),onMoveStop:d[4]||(d[4]=()=>i.value=!1),overflow:"unset"},{a:M(()=>[u.datapoint.summary.has_file?(p(),g("iframe",{key:0,src:_.value,title:"doc",frameborder:"0",style:ae({"pointer-events":i.value?"none":"auto"})},null,12,Vl)):(p(),g("div",{key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%"},onDragover:d[0]||(d[0]=f=>f.preventDefault()),onDrop:d[1]||(d[1]=f=>{var h;f.preventDefault();const v=(h=f.dataTransfer)==null?void 0:h.files;S(z)().showPopup("Upload file","info"),v&&v.length==1&&u.datapoint.uploadDocument(v[0]).then(()=>{S(z)().showPopup("File uploaded","success")})})},[Kl,k(S(Ue),{action:f=>u.datapoint.uploadDocument(f),text:"upload","as-link":!0,style:{"font-weight":"bold","font-size":"large",cursor:"pointer"}},null,8,["action"])],32))]),b:M(()=>[k(Tt,{datapoint:u.datapoint,ref_key:"noteEditor",ref:r},null,8,["datapoint"])]),_:1},8,["split-ratio","mode"])]))}}),Gl=E(Zl,[["__scopeId","data-v-c3f015a3"]]),Jl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",Ql="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",Yl={id:"toolbarOps"},Xl={id:"recently-read"},eu={id:"main-reader",class:"gradIn"},tu={name:"Reader",inheritAttrs:!1,customOptions:{}},nu=B({...tu,setup(o){const t=G(),e=z(),a=yt(),s=ye(),i=y(t.database.getDummy());async function r(){const h=await t.database.aget(a.params.id);h&&(i.value=h),e.addRecentlyReadDataUID(h.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(x=>{c(x)}),console.log("Reader: updated datapoint",h.summary.title,"uid",h.uid)}oe(()=>a.params.id,()=>{r()});const l=y([]);function c(h){const x=[];for(const D of h)D.summary.uuid!==a.params.id&&x.push({name:D.authorYear(),action:()=>{s.push("/reader/"+D.summary.uuid)}});console.log("Reader: updated recent read menu items",x),l.value=x}const _=y(W().readerLayoutType);window.innerWidth<800&&(_.value=0);function u(){if(window.innerWidth<800)_.value=(_.value+1)%2;else switch(_.value){case 0:_.value=2;break;case 1:_.value=2;break;case 2:_.value=0;break}}const d=y(null);function f(h){function x(){i.value.uploadDocument(h).then(D=>{i.value.update(D),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}i.value.summary.has_file?i.value.freeDocument().then(D=>{i.value.update(D),x()},()=>e.showPopup("Failed to free document","error")):x()}const v=y(null);return he(()=>{console.log("Reader mounted"),r()}),(h,x)=>(p(),g(H,null,[k(S(Ue),{action:f,ref_key:"fileSelectionBtn",ref:d,style:{display:"none"}},null,512),k(Fe,{compact:!0,"show-navigator":!1},{default:M(()=>[n("div",Yl,[k(be,{iconSrc:S(Jl),labelText:"layout",shortcut:"ctrl+r",onOnClick:u,title:"change layout"},null,8,["iconSrc"]),k(be,{iconSrc:S(Ql),labelText:"replace",shortcut:"ctrl+u",onOnClick:x[0]||(x[0]=()=>d.value.click()),title:"upload a new document"},null,8,["iconSrc"]),k(S(Dt),{"menu-items":l.value},{default:M(()=>[n("div",Xl,I(`${i.value.authorAbbr()} (${i.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),n("div",eu,[k(Gl,{datapoint:i.value,layoutType:_.value,ref_key:"readerBody",ref:v},null,8,["datapoint","layoutType"])])],64))}}),au=E(nu,[["__scopeId","data-v-39571ec0"]]),ou="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",re=o=>(se("data-v-ab4897ef"),o=o(),ie(),o),su={id:"users-widget-main"},iu={id:"user-editor-main"},ru={class:"horizontal"},lu=["src"],uu={id:"user-editor"},cu={class:"horizontal"},du={class:"horizonal",style:{display:"flex","align-items":"center",gap:"0.5rem"}},hu=re(()=>n("b",null,"Administrator ",-1)),pu={class:"full-width left-align"},fu=re(()=>n("b",null,"Max Storage (MB):",-1)),mu=re(()=>n("br",null,null,-1)),vu={key:0,class:"full-width left-align"},gu=re(()=>n("b",null,"Mandatory Tags:",-1)),_u={id:"mandatory-tag-edit"},yu={id:"delete-user-dialog-main"},wu=re(()=>n("p",{style:{color:"var(--color-danger)"}}," All data under this user will be deleted! ",-1)),bu=re(()=>n("hr",{style:{"margin-block":"1rem"}},null,-1)),ku={id:"create-user-main"},$u={id:"create-user-table"},Su=re(()=>n("td",null,"Username:",-1)),xu=re(()=>n("td",null,"Name:",-1)),Cu=re(()=>n("td",null,"Password:",-1)),Du=re(()=>n("td",null,"Max Storage (MB):",-1)),Pu=re(()=>n("td",null,"Mandatory Tags:",-1)),Iu=re(()=>n("td",null,"Administrator:",-1)),Tu={style:{display:"flex","align-items":"center","padding-block":"0.25rem"}},Uu={id:"user-widget-header"},Ru=re(()=>n("div",null,[n("b",null," Users ")],-1)),Au={key:0},Mu=re(()=>n("th",null," Avatar ",-1)),Bu=re(()=>n("th",null," Username ",-1)),Lu=re(()=>n("th",null," Name ",-1)),qu=re(()=>n("th",null," Storage ",-1)),Eu=re(()=>n("th",null," Accessibility ",-1)),Fu={class:"user-line"},zu={key:0},Ou=["onClick"],Hu=["src"],Nu={class:"center full-width full-height"},Wu=["src"],ju={class:"username"},Vu={style:{"text-align":"right"}},Ku={key:1,class:"admin_hint"},Zu={key:0,colspan:"5"},Gu=B({__name:"UsersWidget",setup(o){const t=y([]),e=U(()=>G().user.is_admin),a=ee().conn,s=y(!1),i=y({});function r(w){if(!e.value)return;const b=JSON.parse(JSON.stringify(w));i.value=b,i.value.max_storage/=1024*1024,s.value=!0}function l(w){const b=w.split(";").map(T=>T.trim());b.length===1&&b[0]===""?i.value.mandatory_tags=[]:i.value.mandatory_tags=b}function c(){console.log(i.value),a.updateUserAccess(i.value.username,i.value.is_admin,i.value.mandatory_tags,i.value.max_storage*1024*1024).then(w=>{s.value=!1},w=>{console.log(w),z().showPopup(w,"error")})}const _=y(!1),u=y("");function d(){if(u.value!==i.value.username){z().showPopup("Wrong input","error");return}a.deleteUser(i.value.username).then(w=>{z().showPopup(`User ${i.value.username} deleted`,"info"),_.value=!1,s.value=!1},w=>{console.log(w),z().showPopup(w,"error")})}const f=y(!1),v=y(""),h=y(Pe[Math.floor(Math.random()*Pe.length)]),x=y(""),D=y(!1),C=y(""),m=y(100);function $(){f.value=!1,v.value="",h.value=Pe[Math.floor(Math.random()*Pe.length)],x.value="",D.value=!1,C.value=""}function P(){if(v.value===""){z().showPopup("Please enter the username","error");return}const w=C.value.split(";").map(b=>b.trim());w.length===1&&w[0]===""&&w.splice(0,1),a.createUser(v.value,h.value,x.value,D.value,w,m.value).then(b=>{z().showPopup(`User ${v.value} created`,"success"),$()},b=>{console.log(b),z().showPopup(b,"error")})}return he(()=>{a.reqUserList().then(w=>{t.value=w},w=>{console.log(w)})}),de("add_user",w=>{const b=w.user_info;t.value.push(b)}),de("update_user",w=>{const b=w.user_info;t.value.map((T,Y)=>{T.id===b.id&&(t.value[Y]=b)})}),de("delete_user",w=>{const b=w.username;t.value=t.value.filter(T=>T.username!==b)}),(w,b)=>(p(),g("div",su,[k(xe,{show:s.value,"onUpdate:show":b[4]||(b[4]=T=>s.value=T),title:"editor",onOnAccept:c,onOnCancel:b[5]||(b[5]=()=>s.value=!1)},{default:M(()=>[n("div",iu,[n("div",ru,[n("img",{src:`${S(qe)()}/user-avatar/${i.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,lu),n("div",uu,[n("div",cu,[n("h2",null,I(i.value.name),1),q(" ("+I(i.value.username)+") ",1)]),n("div",du,[hu,k(Te,{checked:i.value.is_admin,"onUpdate:checked":b[0]||(b[0]=T=>i.value.is_admin=T)},null,8,["checked"])]),n("div",pu,[fu,mu,V(n("input",{type:"number","onUpdate:modelValue":b[1]||(b[1]=T=>i.value.max_storage=T)},null,512),[[X,i.value.max_storage]])]),i.value.is_admin?A("",!0):(p(),g("div",vu,[gu,n("div",_u,[k(S(at),{style:{width:"100%"},"content-editable":!i.value.is_admin,onFinish:b[2]||(b[2]=T=>l(T))},{default:M(()=>[q(I(i.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])])]))])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:b[3]||(b[3]=()=>{_.value=!0})})])]),_:1},8,["show"]),k(xe,{show:_.value,"onUpdate:show":b[7]||(b[7]=T=>_.value=T),title:"Delete user",onOnCancel:b[8]||(b[8]=()=>{_.value=!1,u.value=""}),onOnClose:b[9]||(b[9]=()=>{_.value=!1,u.value=""}),onOnAccept:d},{default:M(()=>[n("div",yu,[n("p",null,[q(" Are you sure to delete user "),n("b",null,I(i.value.name)+" ("+I(i.value.username)+")",1),q("? "),wu]),bu,q(" Type "),n("b",null,I(i.value.username),1),q(" to confirm: "),V(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":b[6]||(b[6]=T=>u.value=T),autocomplete:"off"},null,512),[[X,u.value]])])]),_:1},8,["show"]),k(xe,{show:f.value,"onUpdate:show":b[16]||(b[16]=T=>f.value=T),onOnCancel:$,onOnAccept:P,onOnClose:$},{default:M(()=>[n("div",ku,[n("table",$u,[n("tr",null,[Su,n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":b[10]||(b[10]=T=>v.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,v.value]])])]),n("tr",null,[xu,n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":b[11]||(b[11]=T=>h.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,h.value]])])]),n("tr",null,[Cu,n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":b[12]||(b[12]=T=>x.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,x.value]])])]),n("tr",null,[Du,n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":b[13]||(b[13]=T=>m.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,m.value]])])]),n("tr",null,[Pu,n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":b[14]||(b[14]=T=>C.value=T),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[X,C.value]])])]),n("tr",null,[Iu,n("td",Tu,[k(Te,{checked:D.value,"onUpdate:checked":b[15]||(b[15]=T=>D.value=T)},null,8,["checked"])])])])])]),_:1},8,["show"]),n("div",Uu,[Ru,e.value?(p(),g("div",{key:0,id:"add-user-div",onClick:b[17]||(b[17]=()=>f.value=!0)},"+")):A("",!0)]),n("table",null,[n("tr",null,[e.value?(p(),g("th",Au)):A("",!0),Mu,Bu,Lu,qu,Eu]),(p(!0),g(H,null,te(t.value,T=>(p(),g("tr",Fu,[e.value?(p(),g("td",zu,[n("div",{class:"edit-button",onClick:()=>r(T)},[n("img",{src:S(ou),alt:"",class:"icon"},null,8,Hu)],8,Ou)])):A("",!0),n("td",null,[n("div",Nu,[n("img",{src:`${S(qe)()}/user-avatar/${T.username}?size=60`,alt:"",class:"avatar"},null,8,Wu)])]),n("td",ju,I(T.username),1),n("td",null,I(T.name),1),n("td",Vu,I(T.max_storage/1024/1024>1024?`${(T.max_storage/1024/1024/1024).toFixed(1)} G`:`${(T.max_storage/1024/1024).toFixed(0)} M`),1),n("td",null,[T.is_admin?(p(),g("label",Ku,"ADMIN")):(p(),Q(et,{key:0,tags:T.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),n("tr",null,[t.value.length===0?(p(),g("td",Zu," No users ")):A("",!0)])])]))}}),At=E(Gu,[["__scopeId","data-v-ab4897ef"]]),ce=o=>(se("data-v-2f65f22c"),o=o(),ie(),o),Ju={class:"toolbar"},Qu={id:"about-main",class:"slideIn"},Yu=ce(()=>n("h1",null,"About",-1)),Xu=ce(()=>n("div",{class:"content"},[n("p",null,[q(" Lires is a self-hosted web application for research literature management. "),n("br"),q(" It is open source and available at "),n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires"),q(". "),n("br")])],-1)),ec={class:"content"},tc=ce(()=>n("h2",null," Resources ",-1)),nc=["href"],ac=ce(()=>n("b",null,"User manual",-1)),oc=[ac],sc=["href"],ic=["href"],rc=["href"],lc={class:"content"},uc=ce(()=>n("h2",null," Dashboard ",-1)),cc=ce(()=>n("summary",null,"Server status ",-1)),dc=ce(()=>n("b",null,"Backend",-1)),hc=ce(()=>n("b",null,"Version",-1)),pc=ce(()=>n("b",null,"Uptime",-1)),fc=ce(()=>n("b",null,"Connection count",-1)),mc={key:0},vc=ce(()=>n("b",null,"Total connection count",-1)),gc={key:0},_c=ce(()=>n("summary",null," User management ",-1)),yc={style:{border:"1px solid var(--color-border)","border-radius":"10px",display:"flex","justify-content":"center","margin-block":"10px",padding:"10px",width:"100%"}},wc={class:"content link-container"},bc=["href"],kc=["href"],$c={id:"versionHistory",class:"content"},Sc=ce(()=>n("h1",{style:{"margin-bottom":"0px"}}," Version history ",-1)),xc={class:"block"},Cc={key:0},Dc={key:1},Pc=B({__name:"About",setup(o){const t=y([]),e=y(!1),a=ee().conn,s=G().user.is_admin,i=()=>{a.changelog().then(d=>{t.value=d},d=>{console.error(d)})},r=y(-1),l=U(()=>{if(r.value===-1)return"N/A";const d=Math.floor(r.value/3600),f=Math.floor((r.value-d*3600)/60),v=Math.floor(r.value-d*3600-f*60);return`${d}h ${f}m ${v}s`}),c=y({backend:qe(),version:"",uptime:l,_uptime:-1,numDocs:-1,numConnections:-1,numConnectionsAll:-1}),_=()=>{a.status().then(d=>{r.value=d.uptime,c.value.version=d.version,c.value.numDocs=d.n_data,c.value.numConnections=d.n_connections,c.value.numConnectionsAll=d.n_connections_all},d=>{console.error(d)})},u=U(()=>t.value.slice().reverse());return i(),_(),window.setInterval(()=>r.value++,1e3),de("login",d=>{c.value.numConnectionsAll++,d.user_info.id==G().user.id&&c.value.numConnections++}),de("logout",d=>{c.value.numConnectionsAll--,d.user_info.id==G().user.id&&c.value.numConnections--}),(d,f)=>(p(),g(H,null,[n("div",Ju,[k(Fe)]),n("div",Qu,[Yu,Xu,n("div",ec,[tc,n("ul",null,[n("li",null,[n("a",{class:"resource",href:S(gs),target:"_blank"},oc,8,nc)]),n("li",null,[n("a",{class:"resource",onClick:f[0]||(f[0]=v=>e.value=!0),style:{cursor:"pointer"}},"Change log")]),n("li",null,[n("a",{class:"resource",href:S(W)().backend()+`/_resources/lires-obsidian-plugin.zip?key=${S(W)().encKey}`},"Obsidian plugin",8,sc)]),n("li",null,[n("a",{class:"resource",href:S(W)().backend()+`/_resources/api.zip?key=${S(W)().encKey}`},"API-Javascript",8,ic)]),n("li",null,[n("a",{class:"resource",href:S(W)().backend()+`/_resources/api.py?key=${S(W)().encKey}`},"API-Python",8,rc)])])]),n("div",lc,[uc,n("details",null,[cc,n("ul",null,[n("li",null,[dc,q(": "+I(c.value.backend),1)]),n("li",null,[hc,q(": "+I(c.value.version),1)]),n("li",null,[pc,q(": "+I(c.value.uptime),1)]),n("li",null,[fc,q(": "+I(c.value.numConnections),1)]),S(s)?(p(),g("li",mc,[vc,q(": "+I(c.value.numConnectionsAll),1)])):A("",!0)])]),S(s)?(p(),g("details",gc,[_c,n("div",yc,[k(At)])])):A("",!0)]),n("div",wc,[n("a",{href:S(a).resolve.databaseDownload(!1),target:"_blank"},"Download database index",8,bc),q(" | "),n("a",{href:S(a).resolve.databaseDownload(!0),target:"_blank"},"Download full database",8,kc)]),k(ke,{show:e.value,"onUpdate:show":f[1]||(f[1]=v=>e.value=v),title:"Change log"},{default:M(()=>[n("div",$c,[Sc,(p(!0),g(H,null,te(u.value.length,v=>(p(),g("div",xc,[n("h2",null,I(u.value[v-1][0].toString()),1),n("ul",null,[(p(!0),g(H,null,te(u.value[v-1][1],h=>(p(),g("li",null,[typeof h=="string"?(p(),g("div",Cc,I(h),1)):typeof h=="object"?(p(),g("div",Dc,[q(I(Object.keys(h)[0])+" ",1),n("ul",null,[(p(!0),g(H,null,te(h[Object.keys(h)[0]],x=>(p(),g("li",null,I(x),1))),256))])])):A("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),Ic=E(Pc,[["__scopeId","data-v-2f65f22c"]]),Tc={},Uc={id:"widget-container-main"};function Rc(o,t){return p(),g("div",Uc,[fe(o.$slots,"default",{},void 0)])}const Ac=E(Tc,[["render",Rc],["__scopeId","data-v-257ac3c4"]]),Mc={id:"main-dashboard",class:"slideIn"},Bc=B({__name:"Dashboard",setup(o){return(t,e)=>(p(),g(H,null,[k(Fe),n("div",Mc,[k(Ac,null,{default:M(()=>[k(At)]),_:1})])],64))}}),Lc=E(Bc,[["__scopeId","data-v-6b501763"]]),ze=o=>(se("data-v-3b8741a7"),o=o(),ie(),o),qc={key:0,class:"test"},Ec=ze(()=>n("td",null," Test API ",-1)),Fc=ze(()=>n("td",null," HTTP Method ",-1)),zc=["value"],Oc=ze(()=>n("td",null," Request Body ",-1)),Hc=["onUpdate:modelValue"],Nc=["onUpdate:modelValue"],Wc=["onClick"],jc=ze(()=>n("button",{type:"submit"},"Send Request",-1)),Vc={key:0,style:{"text-align":"left"}},Kc=ze(()=>n("h2",{style:{"font-weight":"bold"}},"Response",-1)),Zc={key:1},Gc=B({__name:"_Test",setup(o){const e=["get","post","put","delete"],a=y("post"),s=y(""),i=ee().conn.fetcher,r=y([{key:"",value:""}]),l=U(()=>{const u={};return r.value.forEach(d=>{d.key&&(u[d.key]=d.value)}),u}),c=y("");async function _(){if(a.value&&s.value)try{let u;switch(a.value){case"get":u=await i.get(s.value,l.value);break;case"post":u=await i.post(s.value,l.value);break;case"delete":u=await i.delete(s.value,l.value);break;case"put":throw new Error("PUT method is not implemented yet")}c.value=await(u==null?void 0:u.json())}catch(u){console.error("HTTP request failed:",u),c.value=u.toString()}}return(u,d)=>S(!1)?(p(),g("div",qc,[n("form",{onSubmit:Oe(_,["prevent"])},[n("table",null,[n("tr",null,[Ec,n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=f=>s.value=f),placeholder:"/api/xxx",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.value]])])]),n("tr",null,[Fc,n("td",null,[V(n("select",{"onUpdate:modelValue":d[1]||(d[1]=f=>a.value=f),style:{width:"100%"}},[(p(),g(H,null,te(e,f=>n("option",{value:f},I(f.toUpperCase()),9,zc)),64))],512),[[Le,a.value]])])]),n("tr",null,[Oc,n("td",null,[(p(!0),g(H,null,te(r.value,(f,v)=>(p(),g("div",{key:v,style:{display:"flex",gap:"0.5rem","margin-bottom":"0.5rem"}},[V(n("input",{type:"text","onUpdate:modelValue":h=>r.value[v].key=h,placeholder:"key",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Hc),[[X,r.value[v].key]]),V(n("input",{type:"text","onUpdate:modelValue":h=>r.value[v].value=h,placeholder:"value",style:{"flex-grow":"1"},autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Nc),[[X,r.value[v].value]]),n("a",{onClick:Oe(h=>r.value.splice(v,1),["prevent"]),style:{cursor:"pointer","padding-inline":"0.5rem","border-radius":"0.5rem"}}," Remove ",8,Wc)]))),128)),n("button",{onClick:d[2]||(d[2]=Oe(f=>r.value.push({key:"",value:""}),["prevent"]))},"Add Field")])])]),jc],32),c.value?(p(),g("div",Vc,[Kc,n("pre",null,I(c.value),1)])):A("",!0)])):(p(),g("p",Zc," Test is not available in production "))}}),Jc=E(Gc,[["__scopeId","data-v-3b8741a7"]]),Qc=[{path:"/",component:xr},{path:"/feed",component:ll},{path:"/login",component:Nl},{path:"/reader/:id",component:au},{path:"/about",component:Ic},{path:"/dashboard/:username",component:Lc},{path:"/_test",component:Jc}],Yc=Kt({history:Zt(),routes:Qc}),Xc=Vt();jt(Cn).use(Xc).use(Yc).mount("#app");
