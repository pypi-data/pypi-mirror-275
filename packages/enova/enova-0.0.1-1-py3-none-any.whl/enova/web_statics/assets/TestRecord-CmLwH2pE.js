import{n as Y,ap as X,at as W,r as x,l as D,x as s,U as h,T as t,K as l,$ as r,Y as i,y as f,L as I,aq as z,X as M,ar as ue,as as ce,G as pe,a8 as _e,B as P,Z as g,W as de,an as me,al as fe,aw as ve}from"./index-C7E9Deej.js";import{O as Z,v as xe,w as he,P as ge,Q as be,R as ye,T as ke,V as we,u as $e,_ as Te,z as Ce,A as De,D as Se,F as Ie,B as Ne,G as Ve,W as Re,H as ze,I as Ee,N as Be}from"./InstanceDetail.vue_vue_type_script_setup_true_lang-BKjJuzS8.js";const Le={class:"collapse-title"},Me=r("span",{class:"collapse-title"},"API",-1),Fe={class:"h-full flex flex-col border border-gray7 py-3 px-4 bg-white rounded"},Ue={class:"text-gray4 text-xs font-normal"},qe={class:"mt-1 text-black1"},Pe={class:"font-extrabold text-2xl"},We={class:"text-xs pl-1"},Ye=r("span",{class:"collapse-title"},"LLM",-1),Ae={class:"h-full flex flex-col border border-gray7 py-3 px-4 bg-white rounded"},He={class:"text-gray4 text-xs font-normal"},Oe={class:"mt-1 text-black1"},Ge={class:"font-extrabold text-2xl"},Qe=r("span",{class:"text-xs pl-1"},"tokens/s",-1),je={class:"collapse-title"},Ke={class:"collapse-title"},Xe={class:"collapse-title"},Ze=Y({__name:"BaseInfo",setup(A){const{t:e}=X(),{activeExperiment:b}=W(Z()),$=x(["result","config"]),k=x(["api","llm"]),T=x(["data","parameter"]),S=D(()=>{const{result:o,test_status:u}=b.value??{result:{success:0,total:0,elasped_avg:0},test_status:"running"};let c=o.total==null||o.total===0?0:(o.success??0)/(o.total??0)*100;c=[0,100].includes(Number(c))?Number(c):c.toFixed(3);const m=Number(o.elasped_avg??0)===0?0:(Number(o.elasped_avg??0)/1e3).toFixed(3),d=u==="success";return[{key:"requestNum",title:e("experiment.title.requestNum"),value:d?o.total??0:"-"},{key:"successNum",title:e("experiment.title.requestSuccessNum"),value:d?o.success??0:"-"},{key:"successRate",title:e("experiment.title.requestsuccessRate"),value:d?c:"-",unit:"%"},{key:"avgTime",title:e("experiment.title.avgTime"),value:d?m:"-",unit:"s"}]}),F=D(()=>{const{prompt_tps:o,generation_tps:u,test_status:c}=b.value??{prompt_tps:"-",generation_tps:"-",test_status:"running"},m=c==="success";return[{key:"prompt",title:e("experiment.title.prompt"),value:m?o??0:"-"},{key:"generation",title:e("experiment.title.generation"),value:m?u??0:"-"}]}),E=D(()=>({sec:e("common.time.second"),min:e("common.time.minute"),hour:e("common.time.hour")})),N=D(()=>{var C;const{data_set:o,duration:u,duration_unit:c,distribution:m,tps_mean:d,tps_std:w}=((C=b.value)==null?void 0:C.test_spec)||{test_spec:{data_set:"-",duration:"-",duration_unit:"min",distribution:"-",tps_mean:"-",tps_std:"-"}};return[{key:e("common.title.dataset"),value:o||"-"},{key:e("instance.title.injectTime"),value:`${u||"-"} ${E.value[c]}`},{key:e("instance.title.distribution"),value:m||"-"},{key:`Requests per Sec (${m==="poisson"?"Lambda":"Mean"})`,value:d||"-"},{key:"Requests per Sec (Std)",value:w||"-"}]}),V=D(()=>{var d;const{max_tokens:o,temperature:u,top_p:c,others:m}=((d=b.value)==null?void 0:d.param_spec)||{param_spec:{max_tokens:"-",temperature:"-",top_p:"-",others:"-"}};return[{key:"Max_tokens",value:o||"-"},{key:"Temperature",value:u||"-"},{key:"Top_p",value:c||"-"},{key:e("instance.title.otherParams"),value:m||"-"}]});return(o,u)=>{const c=ue,m=ce,d=xe,w=he,C=ge,B=be;return s(),h(w,{class:"experiment pb-7",modelValue:$.value,"onUpdate:modelValue":u[2]||(u[2]=n=>$.value=n)},{default:t(()=>[l(d,{name:"result"},{title:t(()=>[r("span",Le,i(o.$t("experiment.title.testResultOverview")),1)]),default:t(()=>[l(w,{class:"subCollapse px-5",modelValue:k.value,"onUpdate:modelValue":u[0]||(u[0]=n=>k.value=n)},{default:t(()=>[l(d,{name:"api"},{title:t(()=>[Me]),default:t(()=>[l(m,{gutter:24,class:"pb-5"},{default:t(()=>[(s(!0),f(I,null,z(S.value,n=>(s(),h(c,{span:6,key:n.key},{default:t(()=>[r("div",Fe,[r("span",Ue,i(n.title),1),r("span",qe,[r("span",Pe,i(n.value),1),r("span",We,i(n.unit),1)])])]),_:2},1024))),128)),l(c,{span:6})]),_:1})]),_:1}),l(d,{name:"llm"},{title:t(()=>[Ye]),default:t(()=>[l(m,{gutter:24,class:"pb-5"},{default:t(()=>[(s(!0),f(I,null,z(F.value,n=>(s(),h(c,{span:6,key:n.key},{default:t(()=>[r("div",Ae,[r("span",He,i(n.title),1),r("span",Oe,[r("span",Ge,i(n.value),1),Qe])])]),_:2},1024))),128)),l(c,{span:6})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{name:"config"},{title:t(()=>[r("span",je,i(o.$t("experiment.title.testConfig")),1)]),default:t(()=>[l(w,{class:"subCollapse p-5 hasBorder",modelValue:T.value,"onUpdate:modelValue":u[1]||(u[1]=n=>T.value=n)},{default:t(()=>[l(d,{name:"data",class:"pb-5"},{title:t(()=>[r("span",Ke,i(o.$t("common.title.data")),1)]),default:t(()=>[l(B,{column:2,border:""},{default:t(()=>[(s(!0),f(I,null,z(N.value,n=>(s(),h(C,{key:n.key,label:n.key,width:"25%"},{default:t(()=>[M(i(n.value),1)]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),l(d,{name:"parameter"},{title:t(()=>[r("span",Xe,i(o.$t("common.title.parameters")),1)]),default:t(()=>[l(B,{column:2,border:""},{default:t(()=>[(s(!0),f(I,null,z(V.value,n=>(s(),h(C,{key:n.key,label:n.key,width:"25%"},{default:t(()=>[M(i(n.value),1)]),_:2},1032,["label"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),Je=Y({__name:"TestDetail",props:{showDrawer:{type:Boolean,default:!1}},setup(A){const e=x("baseInfo");return(b,$)=>{const k=ke,T=we;return s(),h(T,{modelValue:e.value,"onUpdate:modelValue":$[0]||($[0]=S=>e.value=S),class:"enova-tabs h-full"},{default:t(()=>[l(k,{label:b.$t("common.title.baseInfo"),name:"baseInfo",lazy:!0},{default:t(()=>[l(Ze)]),_:1},8,["label"]),l(k,{label:b.$t("common.title.metrics"),name:"gpuInfo",class:"h-full",lazy:!0},{default:t(()=>[l(ye)]),_:1},8,["label"])]),_:1},8,["modelValue"])}}}),et={class:"flex h-full flex-col pb-5 px-4"},tt={class:"flex flex-col w-full h-full flex-1"},at={class:"flex flex-row-reverse gap-4 items-center py-4"},st={class:"w-[440px]"},lt={class:"truncate"},nt=["onClick"],ot={key:1},rt={key:3},it={key:4,class:"flex items-center gap-3"},ut={key:5,class:"flex items-center gap-2"},ct={key:6},pt={key:7},mt=Y({__name:"TestRecord",setup(A){const{t:e}=X(),b=Z(),$=$e(),{testList:k,currentId:T}=W(b),{currentId:S,instanceList:F,instanceNameMap:E}=W($),N=x(!1),V=x(""),o=x("detail"),u=x([]),c=x(!1),m=x({current_page:1,page_count:10,total:0,pageSize:20}),d=D(()=>o.value==="detail"?e("instance.title.instanceDetail"):e("experiment.title.testResult")),w={running:{color:"#909399",text:e("experiment.title.testing")},success:{color:"#67C23A",text:e("experiment.title.testSuccess")},failed:{color:"#F56C6C",text:e("experiment.title.testFail")},unknown:{color:"#909399",text:e("experiment.title.testUnknown")},init:{color:"#909399",text:e("experiment.title.testInit")},finsihed:{color:"#909399",text:e("experiment.title.finsihed")}},C=D(()=>k.value.length===0?[]:[...new Set(k.value.map(a=>a.test_status))].map(a=>{var v;return{text:((v=w[a])==null?void 0:v.text)??a,value:a}})),B=(a,v)=>v.test_status===a,n=x([{prop:"create_time",label:e("experiment.title.testTime"),sortable:!0,minWidth:"180px"},{prop:"test_id",label:e("experiment.title.testId"),width:"220px",showTip:!0},{prop:"instanceName",label:e("experiment.title.testInstance"),sortable:!0,width:"180px"},{prop:"dataset",label:e("experiment.title.testDataset"),sortable:!0,width:"180px"},{prop:"state",label:e("experiment.title.testStatus"),sortable:!0,filterData:C,filterMethod:B,width:"180px"},{prop:"generation_tps",label:e("experiment.title.generation"),sortable:!0,minWidth:"180px"},{prop:"avg_time",label:e("experiment.title.avgTime"),sortable:!0,minWidth:"180px"},{prop:"operation",label:e("common.title.operation"),fixed:"right",width:"150px"}]),U=(a,v)=>{v==="detail"?(S.value=a.instance_id,V.value=E.value.get(a.instance_id)??a.instance_id):(T.value=a.test_id,V.value=a.test_id),o.value=v,N.value=!0},J=()=>{N.value=!1,S.value="",T.value=""},ee=()=>{Se()},te=a=>{u.value=a,L()},q=x(""),ae=a=>{q.value=a,L()},L=async()=>{c.value=!0;const{current_page:a,pageSize:v}=m.value;let R=`page=${a}&size=${v}`;u.value!=null&&u.value.length>0&&(R+=`&start_time=${u.value[0]}&end_time=${u.value[1]}`),q.value!==""&&(R+=`&fuzzy=${q.value}`);try{const y=await b.getTestList(R);y!=null&&(m.value={current_page:y.page,page_count:y.total_page,total:y.total_num,pageSize:y.size})}catch(y){console.log(y)}c.value=!1},se=a=>{const v=a!=null?Number(a):0;return v===0?0:(v/1e3).toFixed(3)};return pe(()=>{F.value.length===0&&$.getInstanceList(),L()}),(a,v)=>{const R=me,y=fe,le=ve,ne=Be,oe=Ie,re=Ne,ie=Ve;return s(),f("main",et,[l(Te,{title:a.$t("experiment.title.testRecord"),count:m.value.total},null,8,["title","count"]),r("div",tt,[r("div",at,[l(Ce,{"search-tips":a.$t("experiment.inst.searchPlaceholder"),onChangeSearch:ae},null,8,["search-tips"]),r("div",st,[l(Re,{onChangTimeRange:te})])]),_e((s(),h(oe,{class:"enova-table test-record-table flex-1",data:P(k),style:{width:"100%"}},{default:t(()=>[(s(!0),f(I,null,z(n.value,p=>(s(),h(ne,{key:p.prop,prop:p.prop,label:p.label,width:p.width,"min-width":p.minWidth,fixed:p.fixed,"column-key":p.prop,sortable:p.sortable,"sort-orders":["ascending","descending"],filters:p.filterData,"filter-method":p.filterMethod,"show-overflow-tooltip":p.showTip},{header:t(({column:_})=>[["avg_time","generation_tps"].includes(_.property)?(s(),h(R,{key:0,content:_.label},{default:t(()=>[r("span",lt,i(_.label),1)]),_:2},1032,["content"])):g("",!0)]),default:t(_=>{var H,O,G,Q,j;return[p.prop==="test_id"?(s(),f("span",{key:0,class:"cursor-pointer text-sm text-secondary font-medium",onClick:K=>U(_.row,"reslut")},i(_.row.test_id),9,nt)):g("",!0),p.prop==="create_time"?(s(),f("span",ot,i(P(ze)(_.row.create_time,"YYYY-MM-DD HH:mm:ss").value),1)):g("",!0),p.prop==="instanceName"?(s(),h(y,{key:2,link:"",type:"primary",size:"small",onClick:K=>U(_.row,"detail")},{default:t(()=>[M(i(P(E).get(_.row.instance_id)??_.row.instance_id),1)]),_:2},1032,["onClick"])):g("",!0),p.prop==="dataset"?(s(),f("span",rt,i((H=_.row.test_spec)==null?void 0:H.data_set),1)):g("",!0),p.prop==="state"?(s(),f("div",it,[r("span",{class:"shrink-0 w-3 h-3 block border-2 rounded-full",style:de({borderColor:(O=w[_.row.test_status])==null?void 0:O.color})},null,4),r("span",null,i((G=w[_.row.test_status])==null?void 0:G.text),1)])):g("",!0),p.prop==="creator"?(s(),f("div",ut,[l(le,{name:"user",class:"shrink-0 text-[#c0c4cc]"}),r("span",null,i(_.row.creator),1)])):g("",!0),p.prop==="generation_tps"?(s(),f("span",ct,i(_.row.test_status==="success"?_.row.generation_tps:"-"),1)):g("",!0),p.prop==="avg_time"?(s(),f("span",pt,i(_.row.test_status==="success"?`${se((j=(Q=_.row)==null?void 0:Q.result)==null?void 0:j.elasped_avg)}s`:"-"),1)):g("",!0),p.prop==="operation"?(s(),f(I,{key:8},[l(y,{link:"",type:"primary",size:"small",onClick:K=>U(_.row,"result")},{default:t(()=>[M(i(a.$t("experiment.title.testResult")),1)]),_:2},1032,["onClick"]),g("",!0)],64)):g("",!0)]}),_:2},1032,["prop","label","width","min-width","fixed","column-key","sortable","filters","filter-method","show-overflow-tooltip"]))),128))]),_:1},8,["data"])),[[ie,c.value]]),l(De,{pagination:m.value,"onUpdate:pageChanged":L},null,8,["pagination"])]),l(re,{showDrawer:N.value,title:d.value,"title-desc":V.value,size:"95%",onOpen:ee,onCloseDrawer:J},{default:t(()=>[o.value==="detail"?(s(),h(Ee,{key:0})):(s(),h(Je,{key:1}))]),_:1},8,["showDrawer","title","title-desc"])])}}});export{mt as default};
