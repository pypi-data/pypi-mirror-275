"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6652],{87138:function(e,t,n){n.d(t,{default:function(){return l.a}});var o=n(231),l=n.n(o)},20720:function(e,t,n){n.d(t,{Z:function(){return er}});var o,l,a=n(57437),r=n(2265),i=n(82517),s=n(12098),u=n(14088),d=n(55948),c=n(61317),p=n(237);let m={TimeStamp:{id:"TimeStamp",label:(0,a.jsx)(u.VE,{className:"w-5 h-5"}),value:"TimeStamp"},TimeInterval:{id:"TimeInterval",label:(0,a.jsx)(u.jE,{className:"w-5 h-5"}),value:"TimeInterval"},BoundingBox:{id:"BoundingBox",label:(0,a.jsx)(u.Iz,{className:"w-5 h-5"}),value:"BoundingBox"},LineString:{id:"LineString",label:(0,a.jsx)(u.yb,{className:"w-5 h-5"}),value:"LineString"}};function v(e){let{isDrawing:t,isDeleting:n,isSelecting:o,isEditing:l,geometryType:r,disabled:i=!1,onDraw:v,onDelete:f,onSelect:g,onSelectGeometryType:y}=e;return i?(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)(p.Z,{tooltip:(0,a.jsxs)("div",{className:"inline-flex gap-1",children:["Select",(0,a.jsx)("span",{className:"text-xs",children:(0,a.jsx)(d.Z,{code:"s"})})]}),placement:"bottom",autoPlacement:!1,children:(0,a.jsx)(s.Z,{variant:o?"primary":"secondary",onClick:g,children:(0,a.jsx)(u.GV,{className:"w-5 h-5"})})})}):(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(p.Z,{tooltip:(0,a.jsxs)("div",{className:"inline-flex gap-1",children:["Create",(0,a.jsx)("span",{className:"text-xs",children:(0,a.jsx)(d.Z,{code:"a"})})]}),placement:"bottom",autoPlacement:!1,children:(0,a.jsx)(s.Z,{variant:t?"primary":"secondary",onClick:v,children:(0,a.jsx)(u.O4,{className:"w-5 h-5"})})}),l?(0,a.jsx)(s.Z,{variant:"warning",onClick:g,children:(0,a.jsx)(u.dY,{className:"w-5 h-5"})}):(0,a.jsx)(p.Z,{tooltip:(0,a.jsxs)("div",{className:"inline-flex gap-1",children:["Select",(0,a.jsx)("span",{className:"text-xs",children:(0,a.jsx)(d.Z,{code:"s"})})]}),placement:"bottom",autoPlacement:!1,children:(0,a.jsx)(s.Z,{variant:o?"primary":"secondary",onClick:g,children:(0,a.jsx)(u.GV,{className:"w-5 h-5"})})}),(0,a.jsx)(p.Z,{tooltip:(0,a.jsxs)("div",{className:"inline-flex gap-1",children:["Delete",(0,a.jsx)("span",{className:"text-xs",children:(0,a.jsx)(d.Z,{code:"d"})})]}),placement:"bottom",autoPlacement:!1,children:(0,a.jsx)(s.Z,{variant:n?"danger":"secondary",onClick:f,children:(0,a.jsx)(u.pJ,{className:"w-5 h-5"})})}),(0,a.jsx)(c.Z,{placement:"bottom",options:Object.values(m),selected:m[r],onChange:e=>null==y?void 0:y(e)})]})}var f=n(24729),g=n(71672),y=n(58992),h=n(36305),x=n(25648),b=n(4791),C=n(81032),w=n(74257),k=n(73944),S=n(7832),Z=n(99563),E=n(80325),j=n(26735);let A="rgb(16 185 129)",M={borderColor:A,fillColor:A,borderWidth:2,borderDash:[5,5],fillAlpha:.2};var T=n(59296),N=n(79001),B=n(79105);function D(e){let{viewport:t,dimensions:n,annotations:o,enabled:l=!0}=e,[a,i]=(0,r.useState)(null),s=(0,r.useMemo)(()=>{if(!l)return[];let{min:e,max:n}=t.time,{min:a,max:r}=t.freq;return o.filter(t=>{let{geometry:o}=t.sound_event;if(null==o)return!1;switch(o.type){case"Point":let[l,i]=o.coordinates;return l>=e&&l<=n&&i>=a&&i<=r;case"TimeStamp":let s=o.coordinates;return s>=e&&s<=n;case"TimeInterval":let[u,d]=o.coordinates;return d>=e&&u<=n;case"BoundingBox":let[c,p,m,v]=o.coordinates;return m>=e&&c<=n&&v>=a&&p<=r}return!0})},[l,o,t]),u=(0,r.useMemo)(()=>l?s.map(e=>{let{sound_event:{geometry:o}}=e;return(0,S.w9)(n,o,t)}):[],[l,s,t,n]),d=(0,r.useCallback)(e=>{if(!l)return;let{time:o,freq:a}=e,[r,d]=(0,S.f8)(n,[o,a],t),c=u.findIndex(e=>(0,S.MR)([r,d],e));if(c<0){i(null);return}let p=s[c];i(null!=p?p:null)},[u,s,t,n,l]);return(0,r.useEffect)(()=>{l||null==a||i(null)},[l,a]),{props:function(e){let{viewport:t,dimensions:n,enabled:o=!0,onHover:l}=e,a=(0,r.useMemo)(()=>({onMouseMove:e=>{if(!o)return;let a={x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY},r=(0,S._l)(a,t,n);null==l||l(r)}}),[t,n,o,l]);return o?a:{}}({enabled:l,viewport:t,dimensions:n,onHover:d}),hoveredAnnotation:a,clear:(0,r.useCallback)(()=>i(null),[])}}let P={borderColor:B.hM,fillColor:B.hM,borderWidth:3,fillAlpha:.2};var _=n(46964);let K={borderColor:B.Ej,borderWidth:1,size:7};function L(e,t){let{size:n=6,...o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K,[l,a]=t;(0,B.F6)(e,o),e.strokeRect(l-n/2,a-n/2,n,n)}var F=n(44237);let q=B.ZA,I=B.ZA;var W=n(19198);let z="rgb(16 185 129)",R={borderColor:z,fillColor:z,borderWidth:2,borderDash:[6,6],fillAlpha:.2};function G(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{length:n}=e.coordinates;return[...e.coordinates.map((e,t)=>({id:"vertex-".concat(t),type:"Keypoint",coords:e,drag:(e,n,o)=>{let l=[...e.coordinates],a=o.x-n.x,r=o.y-n.y,i=l[t];return l[t]=[i[0]+a,i[1]+r],{type:"LineString",coordinates:l}}})),...e.coordinates.slice(t?0:1).map((o,l)=>{let a=e.coordinates[t?(n+l-1)%n:l];return{id:"edge-".concat(l),type:"Edge",coords:[a,o],drag:(e,o,a)=>{let r=t?(n+l-1)%n:l,i=t?l:l+1,s=[...e.coordinates],u=a.x-o.x,d=a.y-o.y,c=s[r];s[r]=[c[0]+u,c[1]+d];let p=s[i];return s[i]=[p[0]+u,p[1]+d],{type:"LineString",coordinates:s}}}})]}function X(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];return e.coordinates.forEach((e,o)=>{n.push(...G({type:"LineString",coordinates:e},t).map(e=>(function(e,t){let{drag:n,id:o}=e;return{...e,id:"".concat(o,"-").concat(t),drag:(e,o,l)=>{let a=[...e.coordinates],r=n({type:"LineString",coordinates:a[t]},o,l).coordinates;return a[t]=r,{type:"MultiLineString",coordinates:a}}}})(e,o)))}),n}function Y(e){let{drag:t}=e;return{...e,drag:(e,n,o)=>({type:"Polygon",coordinates:t({type:"MultiLineString",coordinates:e.coordinates},n,o).coordinates})}}function J(e){let t=X({type:"MultiLineString",coordinates:e.coordinates},!0).map(Y),n={id:"area",type:"Area",coords:e.coordinates,drag:(e,t,n)=>(0,S.zM)(e,[t.x,t.y],[n.x,n.y])};return t.push(n),t}let O=(o=function(e,t){let{type:n}=e;switch(n){case"TimeStamp":return function(e,t){let{height:n}=t,o=e.coordinates;return[{id:"onset",type:"Edge",coords:[[o,0],[o,n]],drag:(e,t,n)=>{let o=n.x-t.x;return{type:"TimeStamp",coordinates:e.coordinates+o}}}]}(e,t);case"TimeInterval":return function(e,t){let{height:n}=t,[o,l]=e.coordinates;return[{id:"left",type:"Edge",coords:[[o,0],[o,n]],drag:(e,t,n)=>{let o=n.x-t.x,[l,a]=e.coordinates;return{type:"TimeInterval",coordinates:[l+o,a]}}},{id:"right",type:"Edge",coords:[[l,0],[l,n]],drag:(e,t,n)=>{let o=n.x-t.x,[l,a]=e.coordinates;return{type:"TimeInterval",coordinates:[l,a+o]}}},{id:"area",type:"Area",coords:[[[o,n],[o,0],[l,0],[l,n]]],drag:(e,t,n)=>{let o=n.x-t.x,[l,a]=e.coordinates;return{type:"TimeInterval",coordinates:[l+o,a+o]}}}]}(e,t);case"BoundingBox":return function(e){let[t,n,o,l]=e.coordinates;return[{id:"top-left",type:"Keypoint",coords:[t,n],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[a,r,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[a+o,r+l,i,s]}}},{id:"bottom-left",type:"Keypoint",coords:[t,l],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[a,r,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[a+o,r,i,s+l]}}},{id:"bottom-right",type:"Keypoint",coords:[o,n],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[a,r,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[a,r+l,i+o,s]}}},{id:"top-right",type:"Keypoint",coords:[o,l],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[a,r,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[a,r,i+o,s+l]}}},{id:"left",type:"Edge",coords:[[t,n],[t,l]],drag:(e,t,n)=>{let o=n.x-t.x,[l,a,r,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l+o,a,r,i]}}},{id:"bottom",type:"Edge",coords:[[t,l],[o,l]],drag:(e,t,n)=>{let o=n.y-t.y,[l,a,r,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l,a,r,i+o]}}},{id:"right",type:"Edge",coords:[[o,l],[o,n]],drag:(e,t,n)=>{let o=n.x-t.x,[l,a,r,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l,a,r+o,i]}}},{id:"top",type:"Edge",coords:[[o,n],[t,n]],drag:(e,t,n)=>{let o=n.y-t.y,[l,a,r,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l,a+o,r,i]}}},{id:"area",type:"Area",coords:[[[t,n],[t,l],[o,l],[o,n]]],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[a,r,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[a+o,r+l,i+o,s+l]}}}]}(e);case"Point":return[{id:"point",type:"Keypoint",coords:e.coordinates,drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[a,r]=e.coordinates;return{type:"Point",coordinates:[a+o,r+l]}}}];case"MultiPoint":return e.coordinates.map((e,t)=>({id:"point-".concat(t),type:"Keypoint",coords:e,drag:(e,n,o)=>{let l=[...e.coordinates],a=o.x-n.x,r=o.y-n.y,[i,s]=e.coordinates[t];return l[t]=[i+a,s+r],{type:"MultiPoint",coordinates:l}}}));case"LineString":return G(e);case"MultiLineString":return X(e);case"Polygon":return J(e);case"MultiPolygon":return function(e){let t=[];return e.coordinates.forEach((e,n)=>{t.push(...J({type:"Polygon",coordinates:e}).map(e=>(function(e,t){let{drag:n,id:o}=e;return{...e,id:"".concat(o,"-").concat(t),drag:(e,o,l)=>{let a=[...e.coordinates],r=n({type:"Polygon",coordinates:a[t]},o,l).coordinates;return a[t]=r,{type:"MultiPolygon",coordinates:a}}}})(e,n)))}),t}(e);default:throw Error}},l=function(e,t,n){return(0,S.vZ)(e,[t.x,t.y],[n.x,n.y])},function(e){let{dimensions:t,object:n,enabled:a,style:i=R,onChange:s,onDrop:u,onDeselect:d}=e,[c,p]=(0,r.useState)(null),[m,v]=(0,r.useState)({shiftKey:!1,ctrlKey:!1}),{hovered:f,hoverProps:g}=function(e){let{elements:t,enabled:n=!0}=e,[o,l]=(0,r.useState)(null);return{hovered:o,hoverProps:function(e){let{enabled:t=!0,onHover:n}=e,o=(0,r.useMemo)(()=>({onMouseMove:e=>{n({position:{x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY},shift:e.shiftKey,ctrl:e.ctrlKey})}}),[n]);return t?o:{}}({onHover:(0,r.useCallback)(e=>{let{position:n}=e,o=t.find(e=>{let t=function(e){let{type:t}=e;switch(t){case"Keypoint":return{type:"Point",coordinates:e.coords};case"Edge":return{type:"LineString",coordinates:e.coords};case"Area":return{type:"Polygon",coordinates:e.coords};default:throw Error()}}(e);return(0,S.MR)([n.x,n.y],t)});if(!o){l(null);return}l(o)},[t]),enabled:n})}}({elements:(0,r.useMemo)(()=>null==n?[]:o(n,t),[n,t]),enabled:a}),{props:y,isDragging:h}=function(e){let{enabled:t=!0,onClick:n,onMoveStart:o,onMove:l,onMoveEnd:a}=e,[i,s]=(0,r.useState)(!1),[u,d]=(0,r.useState)({x:0,y:0}),[c,p]=(0,r.useState)(null),m=(0,r.useMemo)(()=>{if(!t)return{};let e=e=>{if(!t)return;let o={x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY};p(o),null==n||n({position:o,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey})};return{onMouseDown:e,onPointerDown:e,onClick:e}},[t,n]),v=(0,r.useCallback)(function(){let{shiftKey:e,ctrlKey:n,altKey:l,metaKey:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(d({x:0,y:0}),s(!0),null==o||o({shiftKey:e,ctrlKey:n,altKey:l,metaKey:a}))},[t,o]),f=(0,r.useCallback)(e=>{let{deltaX:n,deltaY:o,shiftKey:a,ctrlKey:r,altKey:i,metaKey:s}=e;t&&null!=c&&(d(e=>{let{x:t,y:l}=e;return{x:t+n,y:l+o}}),null==l||l({initial:c,current:{x:c.x+u.x+n,y:c.y+u.y+o},shiftKey:a,ctrlKey:r,altKey:i,metaKey:s}))},[t,c,u,l]),g=(0,r.useCallback)(function(){let{shiftKey:e,ctrlKey:n,altKey:o,metaKey:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(p(null),s(!1),d({x:0,y:0}),null==a||a({shiftKey:e,ctrlKey:n,altKey:o,metaKey:l}))},[t,a]),{moveProps:y}=(0,W.r)({onMoveStart:v,onMove:f,onMoveEnd:g});return{props:t?(0,N.d)(y,m):{},isDragging:i}}({onMoveStart:(0,r.useCallback)(()=>{a&&(v({shiftKey:!1,ctrlKey:!1}),p(n))},[a,n]),onMoveEnd:(0,r.useCallback)(function(){let{ctrlKey:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a&&(p(null),null!=c&&c!==n&&(e?null==u||u(c):null==s||s(c)),v({shiftKey:!1,ctrlKey:!1}))},[a,n,c,s,u]),onMove:(0,r.useCallback)(e=>{let{initial:t,current:o,shiftKey:a=!1,ctrlKey:r=!1}=e;null!=f&&null!=n&&(v({shiftKey:a,ctrlKey:r}),a?p(l(n,t,o)):p(f.drag(n,t,o)))},[f,n])}),x=(0,r.useCallback)(()=>{a&&null==f&&!h&&(null==d||d())},[a,f,h,d]),{pressProps:b}=(0,T.r)({onPress:x}),C=(0,r.useCallback)(e=>{a&&null!=n&&(e.canvas.style.cursor="default",null!=f&&(e.canvas.style.cursor="pointer"),null!=c&&(e.canvas.style.cursor="grabbing",m.ctrlKey&&(e.canvas.style.cursor="copy")),o(null!=c?c:n,{width:e.canvas.width,height:e.canvas.height}).forEach(t=>(function(e,t,n,o){let{type:l}=t;switch(l){case"Keypoint":!function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];L(e,t.coords,{size:n?10:5,borderColor:n?I:q,borderWidth:n?3:1})}(e,t,o);break;case"Edge":!function(e,t,n){let{borderColor:o,borderWidth:l,borderAlpha:a,borderDash:r}=n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],[s,u]=t.coords,d=[(s[0]+u[0])/2,(s[1]+u[1])/2];(0,E.s6)(e,{type:"LineString",coordinates:[s,u]},{borderColor:i?B.ZA:o,borderWidth:i?3:l,borderAlpha:a,borderDash:r}),L(e,d,{size:i?10:5,borderColor:i?I:q,borderWidth:i?3:1})}(e,t,n,o);break;case"Area":!function(e,t,n){let{fillAlpha:o,fillColor:l,borderColor:a}=n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,F.is)(e,{type:"Polygon",coordinates:t.coords},{fillAlpha:r?.3:o,fillColor:r?B.ZA:null!=l?l:a,borderWidth:0,borderAlpha:0})}(e,t,n,o)}})(e,t,i,t.id===(null==f?void 0:f.id))))},[a,n,i,f,c,m.ctrlKey]);return{props:a?(0,N.d)(y,b,g):{},object:n,tmpObject:c,isEditing:null!=c,active:a,hovered:f,draw:C}}),V="rgb(16 185 129)",H={borderColor:V,fillColor:V,borderWidth:2,borderDash:[6,6],fillAlpha:.2},U={borderColor:B.ud,fillColor:B.ud,borderWidth:2,fillAlpha:.2};var Q=n(63038),$=n(48422),ee=n(38243),et=n(19551),en=n(26140),eo=n(87697),el=n(2803),ea=n(99258);function er(e){var t,n;let{clipAnnotation:o,tagFilter:l,parameters:s=i._z,disabled:u=!1,height:d=384,withBar:c=!0,withPlayer:p=!0,withControls:m=!0,withSettings:A=!0,withAudioShortcuts:B=!0,withSpectrogramShortcuts:K=!0,defaultTags:L,onAddSoundEventTag:F,onRemoveSoundEventTag:q,onCreateSoundEventAnnotation:I,onUpdateSoundEventAnnotation:W,onDeleteSoundEventAnnotation:z,onParameterSave:R,onSelectAnnotation:G,onCreateTag:X}=e,[Y,J]=(0,r.useState)(!1),V=(0,r.useRef)(null),er=null!==(n=null===(t=V.current)||void 0===t?void 0:t.getBoundingClientRect())&&void 0!==n?n:{width:0,height:0},{clip:ei}=o,{recording:es}=ei,eu=(0,r.useMemo)(()=>({time:{min:ei.start_time,max:ei.end_time},freq:{min:0,max:es.samplerate/2}}),[ei.start_time,ei.end_time,es.samplerate]),ed=(0,r.useMemo)(()=>(0,ea.AX)({startTime:ei.start_time,endTime:ei.end_time,samplerate:es.samplerate,parameters:s}),[es.samplerate,ei.start_time,ei.end_time,s]),ec=(0,et.Z)({recording:es,endTime:eu.time.max,startTime:eu.time.min,withShortcuts:B}),ep=(0,r.useCallback)(e=>{J("idle"===e),"idle"!==e&&(null==G||G(null))},[G]),{seek:em}=ec,ev=(0,r.useCallback)(e=>{let{position:t}=e;em(t.time)},[em]),ef=(0,eo.Z)({dimensions:er,recording:es,bounds:eu,initial:ed,parameters:s,onDoubleClick:ev,onModeChange:ep,enabled:!Y&&!ec.isPlaying,withShortcuts:K}),{centerOn:eg}=ef,ey=(0,r.useCallback)(e=>eg({time:e}),[eg]),{draw:eh,enabled:ex}=(0,el.Z)({viewport:ef.viewport,currentTime:ec.currentTime,isPlaying:ec.isPlaying,onTimeChange:ey}),eb=(0,r.useCallback)(e=>J("idle"!==e),[]),eC=(0,r.useCallback)(()=>{J(!1),null==G||G(null)},[G]),ew=function(e){let{clipAnnotation:t,viewport:n,dimensions:o,defaultTags:l,mode:a="select",active:i=!0,disabled:s=!1,onModeChange:u,onSelectAnnotation:d,onCreateAnnotation:c,onAddAnnotationTag:p,onRemoveAnnotationTag:m,onUpdateAnnotation:v,onDeleteAnnotation:f,onDeselect:g}=e,{mode:y,geometryType:h,selectedAnnotation:x,setMode:b,setGeometryType:A,setSelectedAnnotation:B}=function(e){let{mode:t="select",geometryType:n="BoundingBox",selectedAnnotation:o=null,onChangeMode:l,onSelectAnnotation:a,onChangeGeometryType:i,disabled:s=!1}=e,[u,d]=(0,r.useState)(t),[c,p]=(0,r.useState)(n),[m,v]=(0,r.useState)(o),f=(0,r.useCallback)(e=>{if(s&&"idle"!==e&&"select"!==e)throw Error("Cannot change mode when disabled");d(e),null==l||l(e),"edit"==e||s||(v(null),null==a||a(null)),"idle"===e&&s&&(v(null),null==a||a(null))},[l,a,s]),g=(0,r.useCallback)(e=>{p(e),null==i||i(e)},[i]),y=(0,r.useCallback)(e=>{v(e),null==a||a(e),s||f("edit")},[a,f,s]);return{mode:u,geometryType:c,selectedAnnotation:m,setMode:f,setSelectedAnnotation:y,setGeometryType:g}}({mode:a,geometryType:"BoundingBox",onSelectAnnotation:d,onChangeMode:u}),{data:K,addSoundEvent:{mutate:L},removeSoundEvent:{mutate:F},updateSoundEvent:{mutate:q},addTagToSoundEvent:{mutate:I},removeTagFromSoundEvent:{mutate:W}}=(0,Q.Z)({uuid:t.uuid,clipAnnotation:t,onAddSoundEventAnnotation:c,onUpdateSoundEventAnnotation:v,onDeleteSoundEventAnnotation:f,onAddTagToSoundEventAnnotation:p,onRemoveTagFromSoundEventAnnotation:m}),z=(0,r.useMemo)(()=>(null==K?void 0:K.sound_events)||[],[K]),R=(0,r.useCallback)(e=>{s||L({geometry:e,tags:l||[]},{onSuccess:e=>{B(e)}})},[l,L,s,B]),{props:G,draw:X}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,geometryType:l="TimeStamp",onCreate:a}=e,{props:i,draw:s}=function(e){let{viewport:t,dimensions:n,enabled:o,style:l=C.y,onCreate:a}=e,[i,s]=(0,r.useState)(null),u=(0,r.useCallback)(()=>{s(null)},[]),d=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;s({type:"BoundingBox",coordinates:[Math.min(t.time,t.time+n.time),Math.min(t.freq,t.freq-n.freq),Math.max(t.time,t.time+n.time),Math.max(t.freq,t.freq-n.freq)]})},[]),c=(0,r.useCallback)(()=>{null!=i&&(null==a||a(i),s(null))},[i,a]),{props:p,isDragging:m}=(0,k.Z)({enabled:o,viewport:t,dimensions:n,onMoveStart:u,onMove:d,onMoveEnd:c});return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:p,draw:(0,r.useCallback)(e=>{if(!o||null==i)return;let a=(0,S.w9)(n,i,t);(0,w.Z)(e,a,l)},[o,i,l,t,n]),isDragging:m}}({viewport:t,dimensions:n,onCreate:a,style:M,enabled:o&&"BoundingBox"===l}),{props:u,draw:d}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,style:l=Z.X,onCreate:a}=e,[i,s]=(0,r.useState)(null),u=(0,r.useCallback)(()=>{s(null)},[]),d=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;s({type:"TimeInterval",coordinates:[Math.min(t.time,t.time+n.time),Math.max(t.time,t.time+n.time)]})},[]),c=(0,r.useCallback)(()=>{null!=i&&(null==a||a(i))},[i,a]),{props:p,isDragging:m}=(0,k.Z)({enabled:o,viewport:t,dimensions:n,onMoveStart:u,onMove:d,onMoveEnd:c});return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:p,draw:(0,r.useCallback)(e=>{if(!o||!m||null==i)return;let a=(0,S.w9)(n,i,t);(0,w.Z)(e,a,l)},[o,i,l,m,n,t]),isDragging:m}}({viewport:t,dimensions:n,onCreate:a,style:M,enabled:o&&"TimeInterval"===l}),{props:c,draw:p}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,style:l=j.n,onCreate:a}=e,[i,s]=(0,r.useState)(null),u=(0,r.useCallback)(()=>{s(null)},[]),d=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;s({type:"TimeStamp",coordinates:t.time+n.time})},[]),c=(0,r.useCallback)(()=>{null!=i&&(null==a||a(i))},[i,a]),{props:p,isDragging:m}=(0,k.Z)({enabled:o,viewport:t,dimensions:n,onMoveStart:u,onMove:d,onMoveEnd:c});return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:p,draw:(0,r.useCallback)(e=>{if(!o||null==i)return;let a=(0,S.w9)(n,i,t);(0,w.Z)(e,a,l)},[o,i,l,n,t]),isDragging:m}}({viewport:t,dimensions:n,onCreate:a,style:M,enabled:o&&"TimeStamp"===l}),{props:m,draw:v}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,style:l=E.nK,onCreate:a}=e,[i,s]=(0,r.useState)(null),[u,d]=(0,r.useState)(null),c=(0,r.useCallback)(()=>{s(e=>{var t;return null!==(t=null==e?void 0:e.slice(0,-1))&&void 0!==t?t:null}),d(null)},[]),p=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;d({time:t.time+n.time,freq:t.freq-n.freq})},[]),m=(0,r.useCallback)(e=>{let{point:t,shiftKey:n=!1,ctrlKey:o=!1}=e;if(o)return;if(null==i||i.length<2||!n){s(e=>null==e?[[t.time,t.freq]]:[...e,[t.time,t.freq]]);return}let l=null==i?[[t.time,t.freq]]:[...i,[t.time,t.freq]];null==a||a({type:"LineString",coordinates:l}),s(null)},[i,a]),v=(0,r.useCallback)(e=>{let{position:t,shiftKey:n=!1,ctrlKey:o=!1}=e;m({point:t,shiftKey:n,ctrlKey:o})},[m]),f=(0,r.useCallback)(function(){let{ctrlKey:e=!1,shiftKey:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=u&&(m({point:u,ctrlKey:e,shiftKey:t}),d(null))},[u,m]),{props:g,isDragging:y}=(0,k.Z)({enabled:o,viewport:t,dimensions:n,onClick:v,onMoveStart:c,onMove:p,onMoveEnd:f}),h=(0,r.useCallback)(e=>{if(o){if(null!=i){let o=(0,S.w9)(n,{type:"LineString",coordinates:i},t);(0,w.Z)(e,o,l)}if(null!=u){let o=(0,S.w9)(n,{type:"Point",coordinates:[u.time,u.freq]},t);(0,w.Z)(e,o,l)}if(null!=i&&null!=u&&i.length>0){let o={type:"LineString",coordinates:[i[i.length-1],[u.time,u.freq]]},a=(0,S.w9)(n,o,t);(0,w.Z)(e,a,l)}}},[o,i,l,t,n,u]);return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:g,isDragging:y,draw:h,clear:(0,r.useCallback)(()=>{s(null),d(null)},[])}}({viewport:t,dimensions:n,onCreate:a,style:M,enabled:o&&"LineString"===l});switch(l){case"BoundingBox":return{props:i,draw:s};case"TimeInterval":return{props:u,draw:d};case"TimeStamp":return{props:c,draw:p};case"LineString":return{props:m,draw:v};default:throw Error("Invalid geometry type: ".concat(l))}}({viewport:n,dimensions:o,geometryType:h,enabled:i&&"draw"===y&&!s,onCreate:R}),{props:Y,draw:J}=function(e){let{annotations:t,viewport:n,dimensions:o,enabled:l=!0,onSelect:a,onDeselect:i}=e,{props:s,hoveredAnnotation:u}=D({viewport:n,dimensions:o,annotations:t,enabled:l}),d=(0,r.useCallback)(()=>{l&&(null==u?null==i||i():null==a||a(u))},[u,l,a,i]),{pressProps:c}=(0,T.r)({onPress:d,isDisabled:!l}),p=(0,r.useCallback)(e=>{if(!l||null==u)return;e.canvas.style.cursor="pointer";let t=(0,S.w9)({width:e.canvas.width,height:e.canvas.height},u.sound_event.geometry,n);(0,w.Z)(e,t,U)},[n,u,l]);return{props:(0,N.d)(c,s),draw:p}}({viewport:n,dimensions:o,annotations:z,onSelect:B,onDeselect:g,enabled:i&&"select"===y}),{props:V,draw:et}=function(e){let{annotations:t,viewport:n,dimensions:o,enabled:l=!0,onDelete:a,onDeselect:i}=e,{props:s,hoveredAnnotation:u,clear:d}=D({viewport:n,dimensions:o,annotations:t,enabled:l}),c=(0,r.useCallback)(()=>{l&&(null==u?null==i||i():(null==a||a(u),d()))},[u,l,a,i,d]),{pressProps:p}=(0,T.r)({onPress:c,isDisabled:!l}),m=(0,r.useCallback)(e=>{if(!l||null==u)return;e.canvas.style.cursor="pointer";let t=(0,S.w9)({width:e.canvas.width,height:e.canvas.height},u.sound_event.geometry,n);(0,w.Z)(e,t,P)},[n,u,l]);return{props:(0,N.d)(p,s),draw:m}}({viewport:n,dimensions:o,annotations:z,onDelete:(0,r.useCallback)(e=>{s||(F(e),b("idle"))},[F,b,s]),onDeselect:g,enabled:i&&"delete"===y&&!s}),en=(0,r.useCallback)(e=>{null==x||s||q({soundEventAnnotation:x,geometry:e},{onSuccess:e=>{B(e)}})},[x,q,B,s]),{props:eo,draw:el}=function(e){let{viewport:t,dimensions:n,annotation:o,enabled:l=!0,onEdit:a,onCopy:i,onDeselect:s}=e,u=(0,r.useCallback)(e=>{null!==o&&(null==i||i(o,e))},[o,i]),{draw:d,props:c}=function(e){var t;let{viewport:n,dimensions:o,soundEventAnnotation:l,enabled:a=!0,onChange:i,onCopy:s,onDeselect:u,style:d}=e,{geometry:c}=null!==(t=null==l?void 0:l.sound_event)&&void 0!==t?t:{},p=(0,r.useMemo)(()=>null==c?null:(0,S.w9)(o,c,n),[c,n,o]),m=(0,r.useCallback)(e=>{if(null==e)return;let t=(0,S.WC)(o,e,n);null==i||i(t)},[i,n,o]),v=(0,r.useCallback)(e=>{if(null==e)return;let t=(0,S.WC)(o,e,n);null==s||s(t)},[s,n,o]),f=O({dimensions:o,object:p,enabled:a,style:d,onDrop:v,onChange:m,onDeselect:u}),g=(0,r.useMemo)(()=>null===f.object?null:(0,S.WC)(o,f.object,n),[o,n,f.object]);return{...f,geometry:g}}({viewport:t,dimensions:n,soundEventAnnotation:o,enabled:l,onChange:a,onCopy:u,onDeselect:s,style:H});return{draw:d,props:c}}({viewport:n,dimensions:o,annotation:x,onDeselect:g,onEdit:en,onCopy:(0,r.useCallback)((e,t)=>{s||L({geometry:t,tags:e.tags||[]},{onSuccess:e=>{B(e)}})},[L,B,s]),enabled:i&&"edit"===y&&!s}),ea=(0,r.useCallback)((e,t)=>{s||W({soundEventAnnotation:e,tag:t})},[W,s]),er=(0,r.useCallback)((e,t)=>{s||I({soundEventAnnotation:e,tag:t})},[I,s]),ei=(0,$.Z)({annotations:z,viewport:n,dimensions:o,onClickTag:ea,onAddTag:er,active:"draw"!==y&&"delete"!==y,disabled:s}),es=(0,_.Z)({viewport:n,annotations:z}),eu={};if(i)switch(y){case"select":eu=Y;break;case"delete":eu=V;break;case"draw":eu=G;break;case"edit":eu=eo;break;default:eu={}}let ed=(0,r.useMemo)(()=>{if(!i)return es;let e={select:J,delete:et,edit:el,draw:X,idle:()=>void 0}[y];return t=>{es(t),e(t)}},[i,y,es,X,J,et,el]),ec=(0,r.useCallback)(()=>{b("delete")},[b]),ep=(0,r.useCallback)(()=>{b("select")},[b]),em=(0,r.useCallback)(()=>{b("draw")},[b]),ev=(0,r.useCallback)(()=>{b("edit")},[b]),ef=(0,r.useCallback)(()=>{b("idle")},[b]);return(0,ee.Z)({onGoCreate:em,onGoDelete:ec,onGoSelect:ep,enabled:!s}),{mode:y,props:eu,draw:ed,geometryType:h,selectedAnnotation:x,enabled:"idle"!==y&&i,isSelecting:"select"===y&&i,isDrawing:"draw"===y&&i,isEditing:"edit"===y&&i,isDeleting:"delete"===y&&i,enableDelete:ec,enableSelect:ep,enableDraw:em,enableEdit:ev,disable:ef,setGeometryType:A,tags:ei}}({clipAnnotation:o,viewport:ef.viewport,dimensions:er,defaultTags:L,onModeChange:eb,onDeselect:eC,active:Y&&!ec.isPlaying,onSelectAnnotation:G,disabled:u,onAddAnnotationTag:F,onRemoveAnnotationTag:q,onCreateAnnotation:I,onUpdateAnnotation:W,onDeleteAnnotation:z}),{props:ek,draw:eS,isLoading:eZ}=ef,{props:eE,draw:ej}=ew,eA=(0,r.useMemo)(()=>eZ?e=>{e.canvas.style.cursor="wait"}:ex?e=>{eS(e),eh(e),ej(e)}:e=>{eS(e),ej(e)},[eS,eh,ej,eZ,ex]);return(0,en.Z)({ref:V,draw:eA}),(0,a.jsxs)(g.Z,{children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[m&&(0,a.jsx)(h.Z,{canDrag:ef.canDrag,canZoom:ef.canZoom,onReset:ef.reset,onDrag:ef.enableDrag,onZoom:ef.enableZoom}),!u&&m&&(0,a.jsx)(v,{disabled:u,isDrawing:ew.isDrawing,isDeleting:ew.isDeleting,isSelecting:ew.isSelecting,isEditing:ew.isEditing,geometryType:ew.geometryType,onDraw:ew.enableDraw,onDelete:ew.enableDelete,onSelect:ew.enableSelect,onSelectGeometryType:ew.setGeometryType}),A&&(0,a.jsx)(x.Z,{samplerate:es.samplerate,settings:ef.parameters,onChange:ef.setParameters,onReset:ef.resetParameters,onSave:()=>null==R?void 0:R(ef.parameters)}),p&&(0,a.jsx)(f.Z,{...ec})]}),(0,a.jsx)("div",{className:"relative overflow-hidden rounded-md",style:{height:d},children:(0,a.jsx)(b.ZP,{disabled:u,tags:ew.tags,filter:l,onCreate:X,children:(0,a.jsx)("canvas",{ref:V,...Y?eE:ek,className:"absolute w-full h-full"})})}),c&&(0,a.jsx)(y.Z,{bounds:ef.bounds,viewport:ef.viewport,onMove:ef.zoom})]})}},4791:function(e,t,n){n.d(t,{ZP:function(){return g}});var o=n(57437),l=n(49896),a=n(35933),r=n(56800),i=n.n(r),s=n(2265),u=n(14088),d=n(48423),c=n(75728);function p(e){let{onClose:t,onAdd:n,onCreate:l,filter:a,...r}=e;return(0,o.jsx)(d.Z,{onSelect:e=>{null==n||n(e)},onCreate:l,autoFocus:!0,onKeyDown:e=>{"Escape"===e.key?null==t||t():"Enter"===e.key&&(null==t||t())},initialFilter:a,...r})}function m(e){let{tag:t,onClick:n,disabled:l=!1}=e,a=(0,c.Z)(e=>e.getTagColor)(t),r=(0,s.useMemo)(()=>"bg-".concat(a.color,"-500"),[a]);return(0,o.jsxs)("span",{className:"flex flex-row gap-1 -my-2 items-center px-2 rounded-full transition-all group bg-stone-200/0 dark:bg-stone-800/0 hover:bg-stone-200 hover:dark:bg-stone-800",children:[(0,o.jsx)("span",{className:"inline-block my-2 w-2 h-2 rounded-full ".concat(r," ring-1 ring-stone-900 opacity-100")}),(0,o.jsxs)("button",{type:"button",className:"hidden flex-row gap-1 items-center opacity-0 transition-all group-hover:flex group-hover:opacity-100 hover:text-red-500 text-stone-800 dark:text-stone-400",onClick:n,children:[(0,o.jsx)("span",{className:"hidden text-xs font-thin whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:t.key}),(0,o.jsx)("span",{className:"hidden text-sm font-medium whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:t.value}),!l&&(0,o.jsx)(u.Tw,{className:"inline-block w-3 h-3 stroke-2"})]})]})}function v(e){let{filter:t,onCreate:n,onAdd:r}=e;return(0,o.jsx)(l.J,{as:"div",children:(0,o.jsxs)(a.bv,{placement:"bottom",offset:4,zIndex:20,enter:"transition duration-200 ease-out",enterFrom:"scale-95 opacity-0",enterTo:"scale-100 opacity-100",leave:"transition duration-150 ease-in",leaveFrom:"scale-100 opacity-100",leaveTo:"scale-95 opacity-0",portal:!0,children:[(0,o.jsxs)(l.J.Button,{className:"rounded hover:text-emerald-500 focus:ring-4 focus:outline-none group focus:ring-emerald-500/50 z-20",children:["+",(0,o.jsx)(u.lO,{className:"inline-block ml-1 w-4 h-4 stroke-2"}),(0,o.jsx)("span",{className:"hidden absolute ml-1 whitespace-nowrap opacity-0 transition-all duration-200 group-hover:inline-block group-hover:opacity-100",children:"Add tag"})]}),(0,o.jsx)(l.J.Panel,{className:"w-52",focus:!0,unmount:!0,children:e=>{let{close:l}=e;return(0,o.jsx)(p,{filter:t,onClose:l,onCreate:e=>{null==n||n(e),l()},onAdd:e=>{null==r||r(e),l()}})}})]})})}function f(e){let{group:t,filter:n,onCreate:l,disabled:a=!1}=e,{x:r,y:s}=t.position;return(0,o.jsxs)("div",{className:i()({"pointer-events-none":!t.active},"h-5 flex flex-col absolute px-2 text-stone-300 hover:z-50 z-40"),style:{left:r,top:s},children:[(0,o.jsx)("div",{className:"-ms-2 relative flex flex-col right-0 hover:gap-2",children:t.tags.map(e=>(0,o.jsx)(m,{...e,disabled:a},"".concat(e.tag.key,":").concat(e.tag.value)))}),!a&&(0,o.jsx)(v,{filter:n,onCreate:e=>{var n;null==l||l(e),null===(n=t.onAdd)||void 0===n||n.call(t,e)},onAdd:e=>{var n;null===(n=t.onAdd)||void 0===n||n.call(t,e)}})]})}function g(e){let{tags:t,children:n,filter:l,onCreate:a,disabled:r=!1}=e;return(0,o.jsxs)("div",{className:"relative w-full h-full rounded",children:[n,t.map(e=>(0,o.jsx)(f,{group:e,filter:l,onCreate:a,disabled:r},e.annotation.uuid))]})}},38243:function(e,t,n){n.d(t,{Y:function(){return a},Z:function(){return r}});var o=n(68561),l=n(9025);let a=[{label:"Add Annotation",shortcut:"a",description:"Add a new annotation"},{label:"Select Annotation",shortcut:"s",description:"Select an annotation"},{label:"Delete Annotation",shortcut:"d",description:"Delete an annotation"}];function r(e){let{onGoCreate:t,onGoSelect:n,onGoDelete:a,enabled:r=!0}=e;(0,o.Z)((0,l.Z)({enabled:r,key:"a"}),t),(0,o.Z)((0,l.Z)({enabled:r,key:"s"}),n),(0,o.Z)((0,l.Z)({enabled:r,key:"d"}),a)}},46964:function(e,t,n){n.d(t,{Z:function(){return s}});var o=n(2265),l=n(74257),a=n(79105),r=n(7832);let i={borderColor:a.Ej,fillColor:a.Ej,borderWidth:2,fillAlpha:.1};function s(e){let{viewport:t,annotations:n}=e;return(0,o.useCallback)(e=>{for(let o of n){let n=(0,r.w9)({width:e.canvas.width,height:e.canvas.height},o.sound_event.geometry,t);(0,l.Z)(e,n,i)}},[t,n])}},63038:function(e,t,n){n.d(t,{Z:function(){return r}});var o=n(25524),l=n(37051),a=n(26731);function r(e){let{uuid:t,clipAnnotation:n,onDelete:r,onAddTag:i,onRemoveTag:s,onAddNote:u,onRemoveNote:d,onError:c,onAddSoundEventAnnotation:p,onDeleteSoundEventAnnotation:m,onUpdateSoundEventAnnotation:v,onAddTagToSoundEventAnnotation:f,onRemoveTagFromSoundEventAnnotation:g,enabled:y=!0}=e,{query:h,useMutation:x,useDestruction:b,setData:C,client:w}=(0,a.ZP)({name:"clip_annotation",uuid:t,initial:n,enabled:y,getFn:l.Z.clipAnnotations.get,onError:c}),k=b({mutationFn:l.Z.clipAnnotations.delete,onSuccess:r}),S=x({mutationFn:l.Z.clipAnnotations.addTag,onSuccess:i}),Z=x({mutationFn:l.Z.clipAnnotations.removeTag,onSuccess:s}),E=x({mutationFn:l.Z.clipAnnotations.addNote,onSuccess:u}),j=x({mutationFn:l.Z.clipAnnotations.removeNote,onSuccess:d}),A=(0,o.D)({mutationFn:e=>{let{geometry:t,tags:n}=e;if(null==h.data)throw Error("No clip annotation to add to.");return l.Z.soundEventAnnotations.create(h.data,{geometry:t,tags:n})},onSuccess:e=>{null==p||p(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:[...t.sound_events||[],e]}})}}),M=(0,o.D)({mutationFn:e=>{let{soundEventAnnotation:t,geometry:n}=e;return l.Z.soundEventAnnotations.update(t,{geometry:n})},onSuccess:e=>{w.setQueryData(["sound_event_annotation",e.uuid],e),null==v||v(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).map(t=>t.uuid===e.uuid?e:t)}})}}),T=(0,o.D)({mutationFn:e=>l.Z.soundEventAnnotations.delete(e),onSuccess:e=>{null==m||m(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).filter(t=>t.uuid!==e.uuid)}})}}),N=(0,o.D)({mutationFn:e=>{let{soundEventAnnotation:t,tag:n}=e;return l.Z.soundEventAnnotations.addTag(t,n)},onSuccess:e=>{null==f||f(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).map(t=>t.uuid===e.uuid?e:t)}})}}),B=(0,o.D)({mutationFn:e=>{let{soundEventAnnotation:t,tag:n}=e;return l.Z.soundEventAnnotations.removeTag(t,n)},onSuccess:e=>{null==g||g(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).map(t=>t.uuid===e.uuid?e:t)}})}});return{...h,delete:k,addTag:S,removeTag:Z,addNote:E,removeNote:j,addSoundEvent:A,updateSoundEvent:M,removeSoundEvent:T,addTagToSoundEvent:N,removeTagFromSoundEvent:B}}},48422:function(e,t,n){n.d(t,{Z:function(){return r}});var o=n(2265),l=n(7832),a=n(56943);function r(e){let{annotations:t,viewport:n,dimensions:r,onClickTag:i,onAddTag:s,active:u=!0,disabled:d=!1}=e,c=(0,o.useMemo)(()=>t.filter(e=>(0,l.PT)(e.sound_event.geometry,n)),[t,n]);return(0,o.useMemo)(()=>c.map(e=>{var t;let o=(0,a.D)(e,n,r);return{tags:(null===(t=e.tags)||void 0===t?void 0:t.map(t=>({tag:t,onClick:()=>null==i?void 0:i(e,t)})))||[],onAdd:t=>null==s?void 0:s(e,t),position:o,annotation:e,active:u,disabled:d}}),[c,n,r,u,i,s,d])}}}]);