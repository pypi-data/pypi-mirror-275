(self.webpackChunkpaper_admin=self.webpackChunkpaper_admin||[]).push([[117],{1873:(t,e,r)=>{var o=r(9325).Symbol;t.exports=o},2552:(t,e,r)=>{var o=r(1873),n=r(659),s=r(9350),i=o?o.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":i&&i in Object(t)?n(t):s(t)}},4128:(t,e,r)=>{var o=r(1800),n=/^\s+/;t.exports=function(t){return t?t.slice(0,o(t)+1).replace(n,""):t}},2459:(t,e,r)=>{var o="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;t.exports=o},659:(t,e,r)=>{var o=r(1873),n=Object.prototype,s=n.hasOwnProperty,i=n.toString,a=o?o.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),r=t[a];try{t[a]=void 0;var o=!0}catch(t){}var n=i.call(t);return o&&(e?t[a]=r:delete t[a]),n}},9350:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},9325:(t,e,r)=>{var o=r(2459),n="object"==typeof self&&self&&self.Object===Object&&self,s=o||n||Function("return this")();t.exports=s},1800:t=>{var e=/\s/;t.exports=function(t){for(var r=t.length;r--&&e.test(t.charAt(r)););return r}},8221:(t,e,r)=>{var o=r(3805),n=r(124),s=r(9374),i=Math.max,a=Math.min;t.exports=function(t,e,r){var m,l,d,c,u,h,f=0,p=!1,g=!1,F=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function w(e){var r=m,o=l;return m=l=void 0,f=e,c=t.apply(o,r)}function v(t){var r=t-h;return void 0===h||r>=e||r<0||g&&t-f>=d}function x(){var t=n();if(v(t))return S(t);u=setTimeout(x,function(t){var r=e-(t-h);return g?a(r,d-(t-f)):r}(t))}function S(t){return u=void 0,F&&m?w(t):(m=l=void 0,c)}function y(){var t=n(),r=v(t);if(m=arguments,l=this,h=t,r){if(void 0===u)return function(t){return f=t,u=setTimeout(x,e),p?w(t):c}(h);if(g)return clearTimeout(u),u=setTimeout(x,e),w(h)}return void 0===u&&(u=setTimeout(x,e)),c}return e=s(e)||0,o(r)&&(p=!!r.leading,d=(g="maxWait"in r)?i(s(r.maxWait)||0,e):d,F="trailing"in r?!!r.trailing:F),y.cancel=function(){void 0!==u&&clearTimeout(u),f=0,m=h=l=u=void 0},y.flush=function(){return void 0===u?c:S(n())},y}},3805:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},346:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},4394:(t,e,r)=>{var o=r(2552),n=r(346);t.exports=function(t){return"symbol"==typeof t||n(t)&&"[object Symbol]"==o(t)}},124:(t,e,r)=>{var o=r(9325);t.exports=function(){return o.Date.now()}},7350:(t,e,r)=>{var o=r(8221),n=r(3805);t.exports=function(t,e,r){var s=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return n(r)&&(s="leading"in r?!!r.leading:s,i="trailing"in r?!!r.trailing:i),o(t,e,{leading:s,maxWait:e,trailing:i})}},9374:(t,e,r)=>{var o=r(4128),n=r(3805),s=r(4394),i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,m=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(s(t))return NaN;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=o(t);var r=a.test(t);return r||m.test(t)?l(t.slice(2),r?2:8):i.test(t)?NaN:+t}},1943:(t,e,r)=>{"use strict";r.r(e);var o=r(8872),n=r(2776);const s='input[name$="-TOTAL_FORMS"]',i='input[name$="-INITIAL_FORMS"]',a='input[name$="-MIN_NUM_FORMS"]',m='input[name$="-MAX_NUM_FORMS"]';const l=class{constructor(t){this.root=t}get totalForms(){const t=this.root.querySelector(s);return parseInt(t.value.toString())}set totalForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(s).value=e}get initialForms(){const t=this.root.querySelector(i);return parseInt(t.value.toString())}set initialForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(i).value=e}get minForms(){const t=this.root.querySelector(a);return t?parseInt(t.value.toString()):0}set minForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(a).value=e}get maxForms(){const t=this.root.querySelector(m);return t?parseInt(t.value.toString()):1/0}set maxForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(m).value=e}};const d=class{constructor(t){this.root=t,this.management_form=new l(t),this._initAddFormButtons(),this._initDeleteFormButtons(),this._initSortFormButtons(),this.updateFormIndexes()}get prefix(){const t=this.root.dataset.formsetPrefix;if(!t)throw new Error("formset prefix required");return t}get formContainer(){const t=this.root.dataset.formsetFormContainer;if(!t)throw new Error("container selector required");const e=this.root.querySelector(t);if(!e)throw new Error("container not found");return e}get formSelector(){const t=this.root.dataset.formsetFormSelector;if(!t)throw new Error("form selector required");return t}get templateId(){const t=this.root.dataset.formsetFormTemplate;if(!t)throw new Error("form template ID required");return t}get formTemplate(){const t=document.getElementById(this.templateId);if(!t)throw new Error("form template element not found");return t}getForms(){return this.formContainer.querySelectorAll(this.formSelector)}getFormIndex(t){return Array.from(this.getForms()).indexOf(t)}getAddFormButtons(){const t=[];return document.querySelectorAll('[data-formset-toggle="add"]').forEach((e=>{(this.root.id&&e.dataset.formset===this.root.id||this.root.contains(e)&&!e.dataset.formset)&&t.push(e)})),t}getDeleteFormButtons(){let t=[];return this.getForms().forEach((e=>{const r=e.querySelectorAll('[data-formset-toggle="delete"]');r.length&&(t=t.concat(Array.from(r)))})),t}getSortFormButtons(){let t=[];return this.getForms().forEach((e=>{const r=e.querySelectorAll('[data-formset-toggle="up"]');r.length&&(t=t.concat(Array.from(r)));const o=e.querySelectorAll('[data-formset-toggle="down"]');o.length&&(t=t.concat(Array.from(o)))})),t}hasOriginal(t){return t.classList.contains("has_original")}setAddFormButtonState(t,e){t.disabled=!e}setDeleteFormButtonState(t,e){t.disabled=!e}setSortFormButtonState(t,e){t.disabled=!e}_initAddFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="add"]');e&&(this.root.id&&e.dataset.formset===this.root.id||this.root.contains(e)&&!e.dataset.formset)&&this.addForm()}))}_initDeleteFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="delete"]');if(e&&this.root.contains(e)){const t=e.closest(this.formSelector);t&&this.deleteForm(t)}}))}_initSortFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="up"]'),r=t.target.closest('[data-formset-toggle="down"]');if(e&&this.root.contains(e)){const t=e.closest(this.formSelector);t&&this.moveFormUp(t)}else if(r&&this.root.contains(r)){const t=r.closest(this.formSelector);t&&this.moveFormDown(t)}}))}addForm(){if(this.management_form.totalForms>=this.management_form.maxForms)throw new Error("Maximum number of forms is reached");const t=this.formTemplate.content.cloneNode(!0),e=t.children[0];return this.formContainer.appendChild(t),this.management_form.totalForms++,this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState(),e}deleteForm(t){if(this.management_form.totalForms<=this.management_form.minForms)throw new Error("Minimum number of forms is reached");this.management_form.totalForms--,t.remove(),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}moveFormUp(t){const e=this.getFormIndex(t);if(0===e)throw new Error("form is already first");const r=this.getForms()[e-1];t.after(r),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}moveFormDown(t){const e=this.getForms().length,r=this.getFormIndex(t);if(r===e-1)throw new Error("form is already last");const o=this.getForms()[r+1];t.before(o),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}updateFormIndexes(t){void 0===t&&(t=null);let e=0;this.getForms().forEach((r=>{r!==t&&this.hasOriginal(r)&&this.setFormIndex(r,e++)})),this.getForms().forEach((r=>{r===t||this.hasOriginal(r)||this.setFormIndex(r,e++)}))}setFormIndex(t,e){t.dataset.formsetIndex=e.toString(),this._setElementIndex(t,e),t.querySelectorAll("*").forEach((t=>{this._setElementIndex(t,e)}))}_setElementIndex(t,e){const r=new RegExp("("+this.prefix+"-(\\d+|__prefix__))"),o=this.prefix+"-"+e;t.htmlFor&&(t.htmlFor=t.htmlFor.replace(r,o)),t.id&&(t.id=t.id.replace(r,o)),t.name&&(t.name=t.name.replace(r,o))}updateFormOrder(t){void 0===t&&(t=null);let e=0;this.getForms().forEach((r=>{r!==t&&this.setFormOrder(r,e++)}))}setFormOrder(t,e){}updateButtonsState(){const t=this.management_form.totalForms>=this.management_form.maxForms;this.getAddFormButtons().forEach((e=>{this.setAddFormButtonState(e,!t)}));const e=this.management_form.totalForms<=this.management_form.minForms;this.getDeleteFormButtons().forEach((t=>{this.setDeleteFormButtonState(t,!e)}));const r=this.getForms().length;this.getSortFormButtons().forEach((t=>{const e=t.closest(this.formSelector),o=this.getFormIndex(e),n=t.dataset.formsetToggle;let s=!0;0===o&&"up"===n&&(s=!1),o===r-1&&"down"===n&&(s=!1),this.setSortFormButtonState(t,s)}))}};const c=class extends d{constructor(t){super(t),this._isTransitioning=!1}get isTabular(){return this.root.classList.contains("paper-formset--tabular")}setAddFormButtonState(t,e){const r=!this._isTransitioning&&e;super.setAddFormButtonState(t,r),t.classList.toggle("disabled",!r)}setDeleteFormButtonState(t,e){const r=!this._isTransitioning&&e;super.setDeleteFormButtonState(t,r),t.classList.toggle("disabled",!r)}setSortFormButtonState(t,e){const r=!this._isTransitioning&&e;super.setSortFormButtonState(t,r),t.classList.toggle("disabled",!r)}addForm(){this._isTransitioning=!0;const t=super.addForm(),e=()=>{this._isTransitioning=!1,this.updateButtonsState(),$(document).trigger("formset:added",[$(t),this.prefix]),t.dispatchEvent(new CustomEvent("formset:added",{bubbles:!0,detail:{formsetName:this.prefix}}))},r={targets:t,direction:"reverse",easing:"easeInOutSine"};return this.isTabular?(t.style.willChange="opacity",r.duration=200,r.opacity=0,r.complete=()=>{t.style.opacity="",e()}):(t.style.willChange="height",r.duration=300,r.height=0,r.complete=()=>{t.style.height="",e()}),(0,n.A)(r),t}deleteForm(t){if(this.management_form.totalForms<=this.management_form.minForms)throw new Error("Minimum number of forms is reached");this.management_form.totalForms--,this.setFormIndex(t,this.management_form.totalForms),this.updateFormIndexes(t),this.updateFormOrder(t),this._isTransitioning=!0,this.updateButtonsState();const e={targets:t,easing:"easeInOutSine",complete:()=>{t.remove(),this._isTransitioning=!1,this.updateButtonsState(),$(document).trigger("formset:removed",[$(t),this.prefix]),document.dispatchEvent(new CustomEvent("formset:removed",{detail:{formsetName:this.prefix}}))}};this.isTabular?(t.style.willChange="opacity",e.duration=200,e.opacity=0):(t.style.willChange="height",e.duration=300,e.height=0),(0,n.A)(e)}moveFormUp(t){const e=this.getFormIndex(t);if(0===e)throw new Error("the form is first already");const r=this.getForms()[e-1];this._swapForms(r,t,"up")}moveFormDown(t){const e=this.getForms().length,r=this.getFormIndex(t);if(r===e-1)throw new Error("the form is last already");const o=this.getForms()[r+1];this._swapForms(t,o,"down")}_swapForms(t,e,r){const o=t.getBoundingClientRect(),s=e.getBoundingClientRect(),i=window.scrollY;e.after(t),window.scrollTo(0,i);const a=t.getBoundingClientRect(),m=e.getBoundingClientRect();this.updateFormIndexes(),this.updateFormOrder(),this.formContainer.style.transformStyle="preserve-3d",t.style.willChange="transform",e.style.willChange="transform","up"===r?(t.style.transform=`translateY(${o.top-a.top}px)`,e.style.transform=`translateY(${s.top-m.top}px) translateZ(1px)`):(t.style.transform=`translateY(${o.top-a.top}px) translateZ(1px)`,e.style.transform=`translateY(${s.top-m.top}px)`),this._isTransitioning=!0,this.updateButtonsState();const l=n.A.timeline({duration:this.isTabular?250:500,easing:"easeOutQuad",complete:()=>{this._isTransitioning=!1,this.updateButtonsState(),this.formContainer.style.transformStyle=""}}).add({targets:t,translateY:0,complete:()=>{t.style.transform=""}}).add({targets:e,translateY:0,complete:()=>{e.style.transform=""}},0);let d,c;"up"===r?(d=i+(m.top-s.top),c=s.top>.5*window.innerHeight&&m.top>.5*window.innerHeight):(d=i+(a.top-o.top),c=o.top<.5*window.innerHeight&&a.top<.5*window.innerHeight),c||l.add({targets:document.documentElement,scrollTop:Math.max(0,d)},0)}setFormOrder(t,e){super.setFormOrder(t,e);const r=t.querySelector(".paper-formset__order");r&&(r.value=e)}setFormIndex(t,e){const r=parseInt(t.dataset.formsetIndex);super.setFormIndex(t,e),r!==e&&t.dispatchEvent(new CustomEvent("formset:setindex",{bubbles:!0,detail:{formsetName:this.prefix,index:e}}));const o=t.querySelector(".paper-formset__form-caption");o&&(o.innerHTML=o.innerHTML.replace(/#(\d+|__prefix__)/g,"#"+(e+1)));const n=t.querySelector('[data-formset-toggle="delete"]');if(n&&n.dataset.formsetForm){const t=new RegExp("("+this.prefix+"-(\\d+|__prefix__))"),r=this.prefix+"-"+e,o=n.dataset.formsetForm.replace(t,r);n.setAttribute("data-formset-form",o)}}};var u=r(7350);$(document).on("shown.bs.tab",(t=>{const e=t.target,r=e.id.replace(/-tab$/,"");window._paperTabs.setUnderline(e),history.replaceState(null,"",`#${r}`);const o=e.closest(".paper-form");if(o){const t=new URL(o.action);t.hash=r,o.action=t.toString()}})),window.addEventListener("load",(()=>{window._paperTabs.updateUnderlines()})),window.addEventListener("resize",u((()=>{window._paperTabs.updateUnderlines()}),50));const h=document.querySelector(".paper-widget--invalid, .paper-message--error");if(h){const t=h.closest("[role=tabpanel]");if(t){!function(t){const e=document.querySelector(`#${t}-tab`);e&&$(e).tab("show")}(t.id.replace(/-panel$/,""))}!function(t,e,r){void 0===e&&(e=.3),void 0===r&&(r={});const o=t.getBoundingClientRect().top,s=e*document.documentElement.clientHeight;o>s&&o<document.documentElement.clientHeight-s||(0,n.A)(Object.assign({targets:document.documentElement,scrollTop:Math.max(0,o-s),easing:"easeOutExpo",delay:50,duration:500},r))}(h)}document.addEventListener("click",(t=>{t.target.closest(".scroll-top-button")&&(0,n.A)({targets:document.documentElement,scrollTop:0,easing:"easeOutExpo",duration:300})})),window.addEventListener("scroll",(()=>{const t=document.querySelector(".scroll-top-button");t&&t.classList.toggle("show",window.scrollY>=.75*document.documentElement.clientHeight)}));let f=[];document.querySelectorAll(".paper-formset").forEach((t=>{const e=new c(t);e.updateButtonsState(),f.push(e)}));let p=!1;const g=document.querySelector(".paper-form");g&&g.addEventListener("submit",(t=>{if(!p)return void(p=!0);t.preventDefault();window.confirm(gettext("You have already submitted this form. Are you sure you want to submit it again?"))&&t.target.submit()})),document.addEventListener("submit",(()=>{f.forEach((t=>{let e=0;t.getForms().forEach((r=>{(r.classList.contains("has_original")||o.A.containsChangedField(r))&&t.setFormOrder(r,e++)}))}))}))}}]);
//# sourceMappingURL=changeform.9feeb4ba29bfebd42c1e.js.map