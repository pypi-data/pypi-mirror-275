import{c as e,gb as n,fn as t,j as r,gc as i,gd as o,Y as a,bm as s,aY as l,O as c,o as u,a5 as d,a6 as m,a7 as f,a8 as p,a9 as h,aa as g,ab as y,L as v,ge as x,a_ as N,b8 as b,r as E,e as w,B as T,gf as C,fE as S,gg as A,u as k,eD as D,ei as O,T as M,X as I,R as U,g7 as F}from"./index-CJA8CbVP.js";import{i as j,c as _,N as P,V as R}from"./VegaLite-DzIWSg5G.js";import"./time-DgM3ZAP8.js";import"./timer-D8GWrtRJ.js";import"./linear-x0yx5cNT.js";import"./init-DLRA0X12.js";import"./range-CtcPcB_L.js";import"./index-tYOaxszt.js";import"./ordinal-DDUp3AbE.js";import"./arc-DIImc9ZO.js";import"./path-qnb_ma6O.js";import"./step-BEJ6WznM.js";import"./array-DmjLdZ15.js";import"./line-Dz7yhIWK.js";
/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=e("BarChartBig",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["rect",{width:"4",height:"7",x:"7",y:"10",rx:"1",key:"14u6mf"}],["rect",{width:"4",height:"12",x:"15",y:"5",rx:"1",key:"b3pek6"}]]),q=e("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),B=e("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),L=e("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]),V=e("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);
/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function W(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(t[r[i]]=e[r[i]])}return t}var H,G;H={exports:{}},G=function(){function e(e,n){return null!=n&&e instanceof n}var n,t,r;try{n=Map}catch(s){n=function(){}}try{t=Set}catch(s){t=function(){}}try{r=Promise}catch(s){r=function(){}}function i(o,s,l,c,u){"object"==typeof s&&(l=s.depth,c=s.prototype,u=s.includeNonEnumerable,s=s.circular);var d=[],m=[],f="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function o(l,p){if(null===l)return null;if(0===p)return l;var h,g;if("object"!=typeof l)return l;if(e(l,n))h=new n;else if(e(l,t))h=new t;else if(e(l,r))h=new r((function(e,n){l.then((function(n){e(o(n,p-1))}),(function(e){n(o(e,p-1))}))}));else if(i.__isArray(l))h=[];else if(i.__isRegExp(l))h=new RegExp(l.source,a(l)),l.lastIndex&&(h.lastIndex=l.lastIndex);else if(i.__isDate(l))h=new Date(l.getTime());else{if(f&&Buffer.isBuffer(l))return h=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(h),h;e(l,Error)?h=Object.create(l):void 0===c?(g=Object.getPrototypeOf(l),h=Object.create(g)):(h=Object.create(c),g=c)}if(s){var y=d.indexOf(l);if(-1!=y)return m[y];d.push(l),m.push(h)}for(var v in e(l,n)&&l.forEach((function(e,n){var t=o(n,p-1),r=o(e,p-1);h.set(t,r)})),e(l,t)&&l.forEach((function(e){var n=o(e,p-1);h.add(n)})),l){var x;g&&(x=Object.getOwnPropertyDescriptor(g,v)),x&&null==x.set||(h[v]=o(l[v],p-1))}if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(l);for(v=0;v<N.length;v++){var b=N[v];(!(w=Object.getOwnPropertyDescriptor(l,b))||w.enumerable||u)&&(h[b]=o(l[b],p-1),w.enumerable||Object.defineProperty(h,b,{enumerable:!1}))}}if(u){var E=Object.getOwnPropertyNames(l);for(v=0;v<E.length;v++){var w,T=E[v];(w=Object.getOwnPropertyDescriptor(l,T))&&w.enumerable||(h[T]=o(l[T],p-1),Object.defineProperty(h,T,{enumerable:!1}))}}return h}(o,l)}function o(e){return Object.prototype.toString.call(e)}function a(e){var n="";return e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),n}return i.clonePrototype=function(e){if(null===e)return null;var n=function(){};return n.prototype=e,new n},i.__objToStr=o,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===o(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===o(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===o(e)},i.__getRegExpFlags=a,i}(),H.exports&&(H.exports=G);var z=function(e,n){n||(n={}),"function"==typeof n&&(n={cmp:n});var t="boolean"==typeof n.cycles&&n.cycles,r=n.cmp&&function(e){return function(n){return function(t,r){var i={key:t,value:n[t]},o={key:r,value:n[r]};return e(i,o)}}}(n.cmp),i=[];return function e(n){if(n&&n.toJSON&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0!==n){if("number"==typeof n)return isFinite(n)?""+n:"null";if("object"!=typeof n)return JSON.stringify(n);var o,a;if(Array.isArray(n)){for(a="[",o=0;o<n.length;o++)o&&(a+=","),a+=e(n[o])||"null";return a+"]"}if(null===n)return"null";if(-1!==i.indexOf(n)){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=i.push(n)-1,l=Object.keys(n).sort(r&&r(n));for(a="",o=0;o<l.length;o++){var c=l[o],u=e(n[c]);u&&(a&&(a+=","),a+=JSON.stringify(c)+":"+u)}return i.splice(s,1),"{"+a+"}"}}(e)};const Y=n(z);function Q(e,n,t){return e.fields=n||[],e.fname=t,e}function K(e){throw Error(e)}function J(e){var n,t,r,i=[],o=null,a=0,s=e.length,l="";function c(){i.push(l+e.substring(n,t)),l="",n=t+1}for(e+="",n=t=0;t<s;++t)if("\\"===(r=e[t]))l+=e.substring(n,t),n=++t;else if(r===o)c(),o=null,a=-1;else{if(o)continue;n===a&&'"'===r||n===a&&"'"===r?(n=t+1,o=r):"."!==r||a?"["===r?(t>n&&c(),a=n=t+1):"]"===r&&(a||K("Access path missing open bracket: "+e),a>0&&c(),a=0,n=t+1):t>n?c():n=t+1}return a&&K("Access path missing closing bracket: "+e),o&&K("Access path missing closing quote: "+e),t>n&&(t++,c()),i}const X=Array.isArray;function Z(e){return e===Object(e)}function ee(e){return"string"==typeof e}function ne(e){return X(e)?"["+e.map(ne)+"]":Z(e)||ee(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}var te,re,ie,oe,ae=[];function se(e,n,t){var r=[n].concat([].slice.call(t));console[e](...r)}ie=J(te="id"),oe="return _["+ie.map(ne).join("][")+"];",Q(Function("_",oe),[te=1===ie.length?ie[0]:te],re||te),Q((function(e){return e}),ae,"identity"),Q((function(){return 0}),ae,"zero"),Q((function(){return 1}),ae,"one"),Q((function(){return!0}),ae,"true"),Q((function(){return!1}),ae,"false");function le(e){return"boolean"==typeof e}function ce(e){for(var n={},t=0,r=e.length;t<r;++t)n[e[t]]=!0;return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>Y(e))).join(",")})`};const ue=Y;function de(e,n){return e.indexOf(n)>-1}const me=Object.keys;const fe="row",pe="column",he="facet",ge="x",ye="y",ve="x2",xe="y2",Ne="latitude",be="longitude",Ee="latitude2",we="longitude2",Te="color",Ce="fill",Se="stroke",Ae="shape",ke="size",De="opacity",Oe="fillOpacity",Me="strokeOpacity",Ie="strokeWidth",Ue="text",Fe="order",je="detail",_e="key",Pe="tooltip",Re="href",$e=Object.assign({},{x:1,y:1,x2:1,y2:1},{longitude:1,longitude2:1,latitude:1,latitude2:1},{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});function qe(e){return"color"===e||"fill"===e||"stroke"===e}const Be=Object.assign({},$e,{row:1,column:1,facet:1}),Le=me(Be);W(Be,["order","detail"]),W(Be,["order","detail","row","column","facet"]);const Ve=W($e,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"]),We=me(Ve),He=W(Ve,["text","tooltip","href","detail","key","order"]),Ge=Object.assign({},{x:1,y:1},He);function ze(e,n){return function(e){switch(e){case Te:case Ce:case Se:case je:case _e:case Pe:case Re:case Fe:case De:case Oe:case Me:case Ie:case he:case fe:case pe:return Ye;case ge:case ye:case Ne:case be:return Qe;case ve:case xe:case Ee:case we:return{rule:"always",bar:"always",rect:"always",area:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case ke:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Ae:return{point:"always",geoshape:"always"};case Ue:return{text:"always"}}}(e)[n]}const Ye={area:"always",bar:"always",circle:"always",geoshape:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Qe=W(Ye,["geoshape"]);function Ke(e){switch(e){case ge:case ye:case ke:case Ie:case De:case Oe:case Me:case ve:case xe:return;case he:case fe:case pe:case Ae:case Ue:case Pe:case Re:return"discrete";case Te:case Ce:case Se:return"flexible";case Ne:case be:case Ee:case we:case je:case _e:case Fe:return}throw new Error("rangeType not implemented for "+e)}const Je={orient:1,bandPosition:1,domain:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,values:1,zindex:1},Xe=Object.assign({},Je,{encoding:1});Object.assign({gridScale:1,scale:1},Je,{encode:1});const Ze=me(Xe),en={clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};Object.assign({},en,{opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,encode:1});const nn=me(en);const tn=Object.freeze(Object.defineProperty({__proto__:null,BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL:"Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",CANNOT_FIX_RANGE_STEP_WITH_FIT:'Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN:"custom domain scale cannot be unioned with default field-based domain",CONCAT_CANNOT_SHARE_AXIS:"Axes cannot be shared in concatenated views yet (https://github.com/vega/vega-lite/issues/2415).",FIT_NON_SINGLE:'Autosize "fit" only works for single views and layered views.',INVALID_CHANNEL_FOR_AXIS:"Invalid channel for axis.",INVALID_SPEC:"Invalid spec",LINE_WITH_VARYING_SIZE:"Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.",MORE_THAN_ONE_SORT:"Domains that should be unioned has conflicting sort properties. Sort will be set to true.",NO_FIELDS_NEEDS_AS:'If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.',NO_INIT_SCALE_BINDINGS:"Selections bound to scales cannot be separately initialized.",REPEAT_CANNOT_SHARE_AXIS:"Axes cannot be shared in repeated views yet (https://github.com/vega/vega-lite/issues/2415).",SCALE_BINDINGS_CONTINUOUS:"Scale bindings are currently only supported for scales with unbinned, continuous domains.",UNABLE_TO_MERGE_DOMAINS:"Unable to merge domains",cannotApplySizeToNonOrientedMark:function(e){return`Cannot apply size to non-oriented mark "${e}".`},cannotProjectOnChannelWithoutField:function(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`},cannotStackNonLinearScale:function(e){return`Cannot stack non-linear scale (${e})`},cannotStackRangedMark:function(e){return`Cannot stack "${e}" if there is already "${e}2"`},cannotUseScalePropertyWithNonColor:function(e){return`Cannot use the scale property "${e}" with non-color channel.`},channelRequiredForBinned:function(e){return`Channel ${e} is required for "binned" bin`},columnsNotSupportByRowCol:function(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`},dayReplacedWithDate:function(e){return`Time unit "${e}" is not supported. We are replacing it with ${e.replace("day","date")}.`},differentParse:function(e,n,t){return`An ancestor parsed field "${e}" as ${t} but a child wants to parse the field as ${n}.`},discreteChannelCannotEncode:function(e,n){return`Using discrete channel "${e}" to encode "${n}" field can be misleading as it does not encode ${"ordinal"===n?"order":"magnitude"}.`},domainRequiredForThresholdScale:function(e){return`Domain for ${e} is required for threshold scale`},domainSortDropped:function(e){return`Dropping sort property ${ue(e)} as unioned domains only support boolean or op 'count'.`},droppedDay:function(e){return`Dropping day from datetime ${ue(e)} as day cannot be combined with other units.`},droppingColor:function(e,n){const{fill:t,stroke:r}=n;return`Dropping color ${e} as the plot also has `+(t&&r?"fill and stroke":t?"fill":"stroke")},emptyFieldDef:function(e,n){return`Dropping ${ue(e)} from channel "${n}" since it does not contain data field or value.`},encodingOverridden:function(e){return`Layer's shared ${e.join(",")} channel ${1===e.length?"is":"are"} overriden`},errorBand1DNotSupport:function(e){return`1D error band does not support ${e}`},errorBarCenterAndExtentAreNotNeeded:function(e,n){return`${n?"extent ":""}${n&&e?"and ":""}${e?"center ":""}${n&&e?"are ":"is "}not needed when data are aggregated.`},errorBarCenterIsNotNeeded:function(e,n){return`Center is not needed to be specified in ${n} when extent is ${e}.`},errorBarCenterIsUsedWithWrongExtent:function(e,n,t){return`${e} is not usually used with ${n} for ${t}.`},errorBarContinuousAxisHasCustomizedAggregate:function(e,n){return`Continuous axis should not have customized aggregation function ${e}; ${n} already agregates the axis.`},facetChannelDropped:function(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`},facetChannelShouldBeDiscrete:function(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`},incompatibleChannel:function(e,n,t){return`${e} dropped as it is incompatible with "${n}"${t?` when ${t}`:""}.`},independentScaleMeansIndependentGuide:function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`},invalidAggregate:function(e){return`Invalid aggregation operator "${e}"`},invalidEncodingChannel:function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`},invalidFieldType:function(e){return`Invalid field type "${e}"`},invalidFieldTypeForCountAggregate:function(e,n){return`Invalid field type "${e}" for aggregate: "${n}", using "quantitative" instead.`},invalidTimeUnit:function(e,n){return`Invalid ${e}: ${ue(n)}`},invalidTransformIgnored:function(e){return`Ignoring an invalid transform: ${ue(e)}.`},latLongDeprecated:function(e,n,t){return`${e}-encoding with type ${n} is deprecated. Replacing with ${t}-encoding.`},lineWithRange:function(e,n){return`Line mark is for continuous lines and thus cannot be used with ${e&&n?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`},mergeConflictingDomainProperty:function(e,n,t,r){return`Conflicting ${n.toString()} property "${e.toString()}" (${ue(t)} and ${ue(r)}).  Using the union of the two domains.`},mergeConflictingProperty:function(e,n,t,r){return`Conflicting ${n.toString()} property "${e.toString()}" (${ue(t)} and ${ue(r)}).  Using ${ue(t)}.`},missingFieldType:function(e,n){return`Missing type for channel "${e}", using "${n}" instead.`},nearestNotSupportForContinuous:function(e){return`The "nearest" transform is not supported for ${e} marks.`},noSuchRepeatedValue:function(e){return`Unknown repeated value "${e}".`},nonZeroScaleUsedWithLengthMark:function(e,n,t){return`A ${t.scaleType?`${t.scaleType} scale`:t.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero"} is used to encode ${e}'s ${n}. This can be misleading as the ${"x"===n?"width":"height"} of the ${e} can be arbitrary based on the scale domain. You may want to use point mark instead.`},orientOverridden:function(e,n){return`Specified orient "${e}" overridden with "${n}"`},primitiveChannelDef:function(e,n,t){return`Channel ${e} is a ${n}. Converted to {value: ${ue(t)}}.`},projectionOverridden:function(e){const{parentProjection:n,projection:t}=e;return`Layer's shared projection ${ue(n)} is overridden by a child projection ${ue(t)}.`},rangeStepDropped:function(e){return`rangeStep for "${e}" is dropped as top-level ${"x"===e?"width":"height"} is provided.`},scalePropertyNotWorkWithScaleType:function(e,n,t){return`${t}-scale's "${n}" is dropped as it does not work with ${e} scale.`},scaleTypeNotWorkWithChannel:function(e,n,t){return`Channel "${e}" does not work with "${n}" scale. We are using "${t}" scale instead.`},scaleTypeNotWorkWithFieldDef:function(e,n){return`FieldDef does not work with "${e}" scale. We are using "${n}" scale instead.`},scaleTypeNotWorkWithMark:function(e,n){return`Scale type "${n}" does not work with mark "${e}".`},selectionNotFound:function(e){return`Cannot find a selection named "${e}"`},selectionNotSupported:function(e){return`Selection not supported for ${e} yet`},stackNonSummativeAggregate:function(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}")`},unaggregateDomainHasNoEffectForRawField:function(e){return`Using unaggregated domain with raw field has no effect (${ue(e)}).`},unaggregateDomainWithNonSharedDomainOp:function(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`},unaggregatedDomainWithLogScale:function(e){return`Unaggregated domain is currently unsupported for log scale (${ue(e)}).`},unrecognizedParse:function(e){return`Unrecognized parse "${e}".`}},Symbol.toStringTag,{value:"Module"})),rn=tn;var on,an;let sn=(an=2||0,{level:function(e){return arguments.length?(an=+e,this):an},error:function(){return an>=1&&se(on||"error","ERROR",arguments),this},warn:function(){return an>=2&&se(on||"warn","WARN",arguments),this},info:function(){return an>=3&&se(on||"log","INFO",arguments),this},debug:function(){return an>=4&&se(on||"log","DEBUG",arguments),this}});function ln(...e){sn.warn.apply(sn,arguments)}const cn={quantitative:1,ordinal:1,temporal:1,nominal:1,geojson:1},un="quantitative",dn="ordinal",mn="temporal",fn="nominal";var pn,hn;(hn=pn||(pn={})).LINEAR="linear",hn.LOG="log",hn.POW="pow",hn.SQRT="sqrt",hn.SYMLOG="symlog",hn.TIME="time",hn.UTC="utc",hn.QUANTILE="quantile",hn.QUANTIZE="quantize",hn.THRESHOLD="threshold",hn.BIN_ORDINAL="bin-ordinal",hn.ORDINAL="ordinal",hn.POINT="point",hn.BAND="band";const gn=me({linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"}),yn=["linear","log","pow","sqrt","symlog","time","utc"],vn=ce(yn),xn=ce(["quantile","quantize","threshold"]),Nn=ce(yn.concat(["quantile","quantize","threshold"])),bn=ce(["ordinal","bin-ordinal","point","band"]);function En(e){return e in bn}function wn(e){return e in vn}const Tn={type:1,domain:1,align:1,range:1,rangeStep:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Cn=me(Tn);function Sn(e,n){switch(n){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!de(["point","band","identity"],e);case"bins":return!de(["point","band","identity","ordinal"],e);case"round":return wn(e)||"band"===e||"point"===e;case"padding":return wn(e)||de(["point","band"],e);case"paddingOuter":case"rangeStep":case"align":return de(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return wn(e);case"nice":return wn(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return e in Nn&&!de(["log","time","utc","threshold","quantile"],e)}}function An(e,n){switch(n){case"interpolate":case"scheme":return qe(e)?void 0:rn.cannotUseScalePropertyWithNonColor(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}}function kn(e,n){return de([dn,fn],n)?void 0===e||En(e):n===mn?de([pn.TIME,pn.UTC,void 0],e):n!==un||de([pn.LOG,pn.POW,pn.SQRT,pn.SYMLOG,pn.QUANTILE,pn.QUANTIZE,pn.THRESHOLD,pn.LINEAR,void 0],e)}function Dn(e,n){switch(e){case ge:case ye:return wn(n)||de(["band","point"],n);case ke:case Ie:case De:case Oe:case Me:return wn(n)||n in xn||de(["band","point"],n);case Te:case Ce:case Se:return"band"!==n;case Ae:return"ordinal"===n}return!1}function On(e,n){return e+"_"+n}W(Tn,["type","domain","range","rangeStep","scheme"]),function(){const e={};for(const n of Le)for(const t of me(cn))for(const r of gn){const i=On(n,t);Dn(n,r)&&kn(r,t)&&(e[i]=e[i]||[],e[i].push(r))}}();var Mn={exports:{}};!function(e){var n=Mn.exports,t="__name__";n.namedfunc=function(e,n){return n[t]=e,n},n.name=function(e){return null==e?null:e[t]},n.identity=function(e){return e},n.true=n.namedfunc("true",(function(){return!0})),n.false=n.namedfunc("false",(function(){return!1})),n.duplicate=function(e){return JSON.parse(JSON.stringify(e))},n.equal=function(e,n){return JSON.stringify(e)===JSON.stringify(n)},n.extend=function(e){for(var n,t,r=1,i=arguments.length;r<i;++r)for(t in n=arguments[r])e[t]=n[t];return e},n.length=function(e){return null!=e&&null!=e.length?e.length:null},n.keys=function(e){var n,t=[];for(n in e)t.push(n);return t},n.vals=function(e){var n,t=[];for(n in e)t.push(e[n]);return t},n.toMap=function(e,t){return(t=n.$(t))?e.reduce((function(e,n){return e[t(n)]=1,e}),{}):e.reduce((function(e,n){return e[n]=1,e}),{})},n.keystr=function(e){var n=e.length;if(!n)return"";for(var t=String(e[0]),r=1;r<n;++r)t+="|"+String(e[r]);return t};var r=Object.prototype.toString;n.isObject=function(e){return e===Object(e)},n.isFunction=function(e){return"[object Function]"===r.call(e)},n.isString=function(e){return"string"==typeof value||"[object String]"===r.call(e)},n.isArray=Array.isArray||function(e){return"[object Array]"===r.call(e)},n.isNumber=function(e){return"number"==typeof e||"[object Number]"===r.call(e)},n.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==r.call(e)},n.isDate=function(e){return"[object Date]"===r.call(e)},n.isValid=function(e){return null!=e&&e==e},n.isBuffer="function"==typeof Buffer&&Buffer.isBuffer||n.false,n.number=function(e){return null==e||""===e?null:+e},n.boolean=function(e){return null==e||""===e?null:"false"!==e&&!!e},n.date=function(e,n){var t=n||Date;return null==e||""===e?null:t.parse(e)},n.array=function(e){return null!=e?n.isArray(e)?e:[e]:[]},n.str=function(e){return n.isArray(e)?"["+e.map(n.str)+"]":n.isObject(e)||n.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var i=/\[(.*?)\]|[^.\[]+/g;function o(e,n){var t,r="";for(t=0;t<e;++t)r+=n;return r}function a(e,n,t){var r=0,i=e.split(s);return(e=t?(i=i.reverse()).filter((function(e){return(r+=e.length)<=n})).reverse():i.filter((function(e){return(r+=e.length)<=n}))).length?e.join("").trim():i[0].slice(0,n)}n.field=function(e){return String(e).match(i).map((function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")}))},n.accessor=function(e){return null==e||n.isFunction(e)?e:n.namedfunc(e,Function("x","return x["+n.field(e).map(n.str).join("][")+"];"))},n.$=n.accessor,n.mutator=function(e){var t;return n.isString(e)&&(t=n.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(n,t){n[e]=t}},n.$func=function(e,t){return function(r){r=n.$(r)||n.identity;var i=e+(n.name(r)?"_"+n.name(r):"");return n.namedfunc(i,(function(e){return t(r(e))}))}},n.$valid=n.$func("valid",n.isValid),n.$length=n.$func("length",n.length),n.$in=function(e,t){e=n.$(e);var r=n.isArray(t)?n.toMap(t):t;return function(n){return!!r[e(n)]}},n.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=n.array(e).map((function(e){var r=1;return"-"===e[0]?(r=-1,e=e.slice(1)):"+"===e[0]&&(r=1,e=e.slice(1)),t.push(r),n.accessor(e)})),function(r,i){var o,a,s,l;for(o=0,a=e.length;o<a;++o)if(s=e[o],l=n.cmp(s(r),s(i)))return l*t[o];return 0}},n.cmp=function(e,n){return(e<n||null==e)&&null!=n?-1:(e>n||null==n)&&null!=e?1:(n=n instanceof Date?+n:n,(e=e instanceof Date?+e:e)!==e&&n==n?-1:n!=n&&e==e?1:0)},n.numcmp=function(e,n){return e-n},n.stablesort=function(e,n,t){var r=e.reduce((function(e,n,r){return e[t(n)]=r,e}),{});return e.sort((function(e,i){var o=n(e),a=n(i);return o<a?-1:o>a?1:r[t(e)]-r[t(i)]})),e},n.permute=function(e){for(var n,t,r=e.length;r;)t=Math.floor(Math.random()*r--),n=e[r],e[r]=e[t],e[t]=n},n.pad=function(e,n,t,r){r=r||" ";var i=n-e.length;if(i<=0)return e;switch(t){case"left":return o(i,r)+e;case"middle":case"center":return o(Math.floor(i/2),r)+e+o(Math.ceil(i/2),r);default:return e+o(i,r)}},n.truncate=function(e,n,t,r,i){var o=e.length;if(o<=n)return e;i=void 0!==i?String(i):"…";var s=Math.max(0,n-i.length);switch(t){case"left":return i+(r?a(e,s,1):e.slice(o-s));case"middle":case"center":var l=Math.ceil(s/2),c=Math.floor(s/2);return(r?a(e,l):e.slice(0,l))+i+(r?a(e,c,1):e.slice(o-c));default:return(r?a(e,s):e.slice(0,s))+i}};var s=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}();var In=Mn.exports;function Un(e,n){return-1!==e.indexOf(n)}function Fn(e,n){for(let t=0;t<e.length;t++)if(!n(e[t],t))return!1;return!0}function jn(e,n,t){if(e.forEach)e.forEach.call(t,n);else for(let r in e)n.call(t,e[r],r,e)}function _n(e,n){let t,r=0;for(t in e)if(n(e[t],t,r++))return!0;return!1}function Pn(e){return!!e.parent}const Rn={channel:1,aggregate:1,autoCount:1,bin:1,timeUnit:1,hasFn:1,sort:1,stack:1,field:1,type:1,format:1,scale:1,axis:1,legend:1,value:1},$n=(qn=Rn,Object.keys(qn));var qn;const Bn={bin:1,scale:1,sort:1,axis:1,legend:1};function Ln(e){return Bn[e]}const Vn=["maxbins","divide","extent","base","step","steps","minstep"].map((e=>({parent:"bin",child:e}))),Wn=["field","op","order"].map((e=>({parent:"sort",child:e}))),Hn=Cn.map((e=>({parent:"scale",child:e}))),Gn=Ze.map((e=>({parent:"axis",child:e}))),zn=nn.map((e=>({parent:"legend",child:e}))),Yn=[].concat(Vn,Wn,Hn,Gn,zn),Qn=["width","height","background","padding","title"],Kn=".";function Jn(e){return Pn(e)?e.parent+Kn+e.child:e}const Xn=Yn.reduce(((e,n)=>(e[n.parent]=e[n.parent]||[],e[n.parent][n.child]=n,e)),{});function Zn(e,n){return(Xn[e]||{})[n]}function et(e){return function(e){return e in Rn}(e)||Pn(e)}const nt=[].concat($n,Yn),tt=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","stack","scale","sort","axis","legend"].concat(Vn,Hn,Gn,zn,Wn);var rt,it;(it=rt||(rt={})).MARK="mark",it.TRANSFORM="transform",it.STACK="stack",it.FORMAT="format",it.CHANNEL="channel",it.AGGREGATE="aggregate",it.AUTOCOUNT="autoCount",it.BIN="bin",it.HAS_FN="hasFn",it.TIMEUNIT="timeUnit",it.FIELD="field",it.TYPE="type",it.SORT="sort",it.SCALE="scale",it.AXIS="axis",it.LEGEND="legend",it.WIDTH="width",it.HEIGHT="height",it.BACKGROUND="background",it.PADDING="padding",it.TITLE="title";const ot="area",at="bar",st="line",lt="point",ct="rect",ut="rule",dt="text",mt="tick",ft="circle",pt="square";function ht(e){return de(["line","area","trail"],e)}ce(me({area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1}));["january","february","march","april","may","june","july","august","september","october","november","december"].map((e=>e.substr(0,3)));var gt,yt;["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].map((e=>e.substr(0,3))),(yt=gt||(gt={})).YEAR="year",yt.MONTH="month",yt.DAY="day",yt.DATE="date",yt.HOURS="hours",yt.MINUTES="minutes",yt.SECONDS="seconds",yt.MILLISECONDS="milliseconds",yt.YEARMONTH="yearmonth",yt.YEARMONTHDATE="yearmonthdate",yt.YEARMONTHDATEHOURS="yearmonthdatehours",yt.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",yt.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",yt.MONTHDATE="monthdate",yt.MONTHDATEHOURS="monthdatehours",yt.HOURSMINUTES="hoursminutes",yt.HOURSMINUTESSECONDS="hoursminutesseconds",yt.MINUTESSECONDS="minutesseconds",yt.SECONDSMILLISECONDS="secondsmilliseconds",yt.QUARTER="quarter",yt.YEARQUARTER="yearquarter",yt.QUARTERMONTH="quartermonth",yt.YEARQUARTERMONTH="yearquartermonth",yt.UTCYEAR="utcyear",yt.UTCMONTH="utcmonth",yt.UTCDAY="utcday",yt.UTCDATE="utcdate",yt.UTCHOURS="utchours",yt.UTCMINUTES="utcminutes",yt.UTCSECONDS="utcseconds",yt.UTCMILLISECONDS="utcmilliseconds",yt.UTCYEARMONTH="utcyearmonth",yt.UTCYEARMONTHDATE="utcyearmonthdate",yt.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",yt.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",yt.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",yt.UTCMONTHDATE="utcmonthdate",yt.UTCMONTHDATEHOURS="utcmonthdatehours",yt.UTCHOURSMINUTES="utchoursminutes",yt.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",yt.UTCMINUTESSECONDS="utcminutesseconds",yt.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",yt.UTCQUARTER="utcquarter",yt.UTCYEARQUARTER="utcyearquarter",yt.UTCQUARTERMONTH="utcquartermonth",yt.UTCYEARQUARTERMONTH="utcyearquartermonth";const vt={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},xt=me(vt);const Nt={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};const bt={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utcmonthdatehours:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},Et=Object.assign({},Nt,bt);const wt=Object.assign({},vt,Nt,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,monthdatehours:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},bt);const Tt={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};function Ct(e,n){const t=!!Et[e];const r=t?new Date(Date.UTC(1972,0,1,0,0,0,0)):new Date(1972,0,1,0,0,0,0);for(const i of xt)if(At(e,i))switch(i){case gt.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case gt.QUARTER:{const{getDateMethod:e,setDateMethod:i}=St("month",t);r[i](3*Math.floor(n[e]()/3));break}default:{const{getDateMethod:e,setDateMethod:o}=St(i,t);r[o](n[e]())}}return r}function St(e,n){const t=Tt[e];return{setDateMethod:n?"setUTC"+t.substr(3):t,getDateMethod:"get"+(n?"UTC":"")+t.substr(3)}}function At(e,n){const t=e.indexOf(n);return t>-1&&(n!==gt.SECONDS||0===t||"i"!==e.charAt(t-1))}const kt="?";function Dt(e){return Ot(e)||function(e){return!(void 0===e||null==e||!e.enum&&!e.name||In.isArray(e))}(e)}function Ot(e){return e===kt}function Mt(e,n,t){return In.extend({},{name:n,enum:t},e===kt?{}:e)}function It(e){let n={},t={};for(const r of e){const e=[0];for(let n=0;n<r.length;n++)r.charAt(n).toUpperCase()===r.charAt(n)&&e.push(n);let i=e.map((e=>r.charAt(e))).join("").toLowerCase();if(t[i])if(e[e.length-1]===r.length-1||(i=e.concat([r.length-1]).map((e=>r.charAt(e))).join("").toLowerCase(),t[i]))for(let o=1;!n[r];o++){let e=i+"_"+o;if(!t[e]){n[r]=e,t[e]=!0;break}}else n[r]=i,t[i]=!0;else n[r]=i,t[i]=!0}return n}const Ut={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",stack:"st",scale:"s",format:"f",axis:"ax",legend:"l",value:"v",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:It(Cn),axisProps:It(Ze),legendProps:It(nn)};function Ft(e){if(Pn(e))return Ut[e.parent]+"-"+Ut[e.parent+"Props"][e.child];if(Ut[e])return Ut[e];throw new Error("Default name undefined for "+e)}const jt=[!1,!0],_t={type:[void 0,pn.LOG],domain:[void 0],base:[void 0],exponent:[1,2],constant:[void 0],bins:[void 0],clamp:jt,nice:jt,reverse:jt,round:jt,zero:jt,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeStep:[17,21],scheme:[void 0]},Pt={zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],bandPosition:[void 0],encoding:[void 0],domain:jt,domainColor:[void 0],domainDash:[void 0],domainDashOffset:[void 0],domainOpacity:[void 0],domainWidth:[void 0],formatType:[void 0],grid:jt,gridColor:[void 0],gridDash:[void 0],gridDashOffset:[void 0],gridOpacity:[void 0],gridWidth:[void 0],format:[void 0],labels:jt,labelAlign:[void 0],labelAngle:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelFlushOffset:[void 0],labelFont:[void 0],labelFontSize:[void 0],labelFontStyle:[void 0],labelFontWeight:[void 0],labelLimit:[void 0],labelOpacity:[void 0],labelSeparation:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelBound:[void 0],labelFlush:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],ticks:jt,tickColor:[void 0],tickCount:[void 0],tickDash:[void 0],tickExtra:[void 0],tickDashOffset:[void 0],tickMinStep:[void 0],tickOffset:[void 0],tickOpacity:[void 0],tickRound:[void 0],tickSize:[void 0],tickWidth:[void 0],title:[void 0],titleAlign:[void 0],titleAnchor:[void 0],titleAngle:[void 0],titleBaseline:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontStyle:[void 0],titleFontWeight:[void 0],titleLimit:[void 0],titleOpacity:[void 0],titlePadding:[void 0],titleX:[void 0],titleY:[void 0]},Rt={mark:[lt,at,st,ot,ct,mt,dt],channel:[ge,ye,fe,pe,ke,Te],aggregate:[void 0,"mean"],autoCount:jt,bin:jt,hasFn:jt,timeUnit:[void 0,gt.YEAR,gt.MONTH,gt.MINUTES,gt.SECONDS],field:[void 0],type:[fn,dn,un,mn],sort:["ascending","descending"],stack:["zero","normalize","center",null],value:[void 0],format:[void 0],title:[void 0],scale:[!0],axis:jt,legend:jt,binProps:{maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]],binned:[!1],anchor:[void 0],nice:[!0]},sortProps:{field:[void 0],op:["min","mean"],order:["ascending","descending"]},scaleProps:_t,axisProps:Pt,legendProps:{orient:["left","right"],format:[void 0],type:[void 0],values:[void 0],zindex:[void 0],clipHeight:[void 0],columnPadding:[void 0],columns:[void 0],cornerRadius:[void 0],direction:[void 0],encoding:[void 0],fillColor:[void 0],formatType:[void 0],gridAlign:[void 0],offset:[void 0],padding:[void 0],rowPadding:[void 0],strokeColor:[void 0],labelAlign:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelFont:[void 0],labelFontSize:[void 0],labelFontStyle:[void 0],labelFontWeight:[void 0],labelLimit:[void 0],labelOffset:[void 0],labelOpacity:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelSeparation:[void 0],legendX:[void 0],legendY:[void 0],gradientLength:[void 0],gradientOpacity:[void 0],gradientStrokeColor:[void 0],gradientStrokeWidth:[void 0],gradientThickness:[void 0],symbolDash:[void 0],symbolDashOffset:[void 0],symbolFillColor:[void 0],symbolOffset:[void 0],symbolOpacity:[void 0],symbolSize:[void 0],symbolStrokeColor:[void 0],symbolStrokeWidth:[void 0],symbolType:[void 0],tickCount:[void 0],tickMinStep:[void 0],title:[void 0],titleAnchor:[void 0],titleAlign:[void 0],titleBaseline:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontStyle:[void 0],titleFontWeight:[void 0],titleLimit:[void 0],titleOpacity:[void 0],titleOrient:[void 0],titlePadding:[void 0]}};function $t(e,n,t){if("field"===e||Pn(e)&&"sort"===e.parent&&"field"===e.child)return n.fieldNames();let r;if(r=Pn(e)?t.enum[e.parent+"Props"][e.child]:t.enum[e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}const qt={verbose:!1,defaultSpecConfig:{line:{point:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:tt.map(Jn),enum:Rt,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,omitInvalidStackSpec:!0,omitNonSumStack:!0,preferredBinAxis:ge,preferredTemporalAxis:ge,preferredOrdinalAxis:ye,preferredNominalAxis:ye,preferredFacet:fe,minCardinalityForBin:15,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7,minPercentUniqueForKey:.8,minCardinalityForKey:50},Bt={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};const Lt=["count","sum","distinct","valid","missing"];function Vt(e){return le(e)&&(e=function(e,n){return le(e)?{maxbins:Ht(n)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign({},e,{maxbins:Ht(n)})}(e,void 0)),"bin"+me(e).map((n=>function(e){const n=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+n}(`_${n}_${e[n]}`))).join("")}function Wt(e){return!0===e||function(e){return Z(e)}(e)&&!e.binned}function Ht(e){switch(e){case fe:case pe:case ke:case Te:case Ce:case Se:case Ie:case De:case Oe:case Me:case Ae:return 6;default:return 10}}function Gt(e){return!!e&&!!e.condition&&!X(e.condition)&&zt(e.condition)}function zt(e){return!(!e||!e.field&&"count"!==e.aggregate)}function Yt(e){return zt(e)&&ee(e.field)}function Qt(e,n={}){let t=e.field;const r=n.prefix;let i=n.suffix,o="";if(function(e){return"count"===e.aggregate}(e))t=function(e){return function(e){return 0===e.indexOf("__")}(e)?e:`__${e}`}("count");else{let r;if(!n.nofn)if(function(e){return!!e.op}(e))r=e.op;else{const{bin:s,aggregate:l,timeUnit:c}=e;Wt(s)?(r=Vt(s),i=(n.binSuffix||"")+(n.suffix||"")):l?(a=l)&&a.argmax?(o=`.${t}`,t=`argmax_${l.argmax}`):!function(e){return!!e&&!!e.argmin}(l)?r=String(l):(o=`.${t}`,t=`argmin_${l.argmin}`):c&&(r=String(c))}r&&(t=t?`${r}_${t}`:r)}var a;return i&&(t=`${t}_${i}`),r&&(t=`${r}_${t}`),n.forAs?t:n.expr?function(e,n="datum"){return`${n}[${ne(J(e).join("."))}]`}(t,n.expr)+o:function(e){return`${J(e).map((e=>e.replace(".","\\."))).join("\\.")}`}(t)+o}function Kt(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"temporal":return!1}throw new Error(rn.invalidFieldType(e.type))}ce(["mean","average","median","q1","q3","min","max"]);const Jt={compatible:!0};function Xt(e,n){const t=e.type;if("geojson"===t&&"shape"!==n)return{compatible:!1,warning:`Channel ${n} should not be used with a geojson data.`};switch(n){case"row":case"column":case"facet":return function(e){return!Kt(e)}(e)?{compatible:!1,warning:rn.facetChannelShouldBeDiscrete(n)}:Jt;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return Jt;case"longitude":case"longitude2":case"latitude":case"latitude2":return t!==un?{compatible:!1,warning:`Channel ${n} should be used with a quantitative field only, not ${e.type} field.`}:Jt;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"size":case"x2":case"y2":return"nominal"!==t||e.sort?Jt:{compatible:!1,warning:`Channel ${n} should not be used with an unsorted discrete field.`};case"shape":return de(["ordinal","nominal","geojson"],e.type)?Jt:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==e.type||"sort"in e?Jt:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}throw new Error("channelCompatability not implemented for channel "+n)}function Zt(e,n,t,r){const i=function(e,n,t){switch(n.type){case"nominal":case"ordinal":if(qe(e)||"discrete"===Ke(e))return"shape"===e&&"ordinal"===n.type&&ln(rn.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(de(["x","y"],e)){if(de(["rect","bar","rule"],t))return"band";if("bar"===t)return"band"}return"point";case"temporal":return qe(e)?"time":"discrete"===Ke(e)?(ln(rn.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return qe(e)?Wt(n.bin)?"bin-ordinal":"linear":"discrete"===Ke(e)?(ln(rn.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(rn.invalidFieldType(n.type))}(n,t,r),{type:o}=e;return function(e){return!!Ge[e]}(n)?void 0!==o?Dn(n,o)?kn(o,t.type)?o:(ln(rn.scaleTypeNotWorkWithFieldDef(o,i)),i):(ln(rn.scaleTypeNotWorkWithChannel(n,o,i)),i):i:null}var er,nr;function tr(e){return e===dn||e===fn||e===er.KEY}(nr=er||(er={})).QUANTITATIVE=un,nr.ORDINAL=dn,nr.TEMPORAL=mn,nr.NOMINAL=fn,nr.KEY="key";class rr{constructor(e=null){this.index=e?Object.assign({},e):{}}has(e){return Jn(e)in this.index}get(e){return this.index[Jn(e)]}set(e,n){return this.index[Jn(e)]=n,this}setByKey(e,n){this.index[e]=n}map(e){const n=new rr;for(const t in this.index)n.index[t]=e(this.index[t]);return n}size(){return In.keys(this.index).length}duplicate(){return new rr(this.index)}}function ir(e,n){const t=e&&e[n];return!!t&&(X(t)?function(e,n){let t=0;for(const[r,i]of e.entries())if(n(i,r,t++))return!0;return!1}(t,(e=>!!e.field)):zt(t)||Gt(t))}const or={zero:1,center:1,normalize:1};const ar=[at,ot,ut,lt,ft,pt,st,dt,mt],sr=[at,ot];function lr(e,n,t,r={}){const i=function(e){return e.type}(e)?e.type:e;if(!de(ar,i))return null;const o=function(e){const n=e.x,t=e.y;if(zt(n)&&zt(t))if("quantitative"===n.type&&"quantitative"===t.type){if(n.stack)return"x";if(t.stack)return"y";if(!!n.aggregate!=!!t.aggregate)return n.aggregate?"x":"y"}else{if("quantitative"===n.type)return"x";if("quantitative"===t.type)return"y"}else{if(zt(n)&&"quantitative"===n.type)return"x";if(zt(t)&&"quantitative"===t.type)return"y"}}(n);if(!o)return null;const a=n[o],s=Yt(a)?Qt(a,{}):void 0,l="x"===o?"y":"x",c=n[l],u=Yt(c)?Qt(c,{}):void 0,d=We.reduce(((e,t)=>{if("tooltip"!==t&&ir(n,t)){const r=n[t];(X(r)?r:[r]).forEach((n=>{const r=function(e){return zt(e)?e:Gt(e)?e.condition:void 0}(n);if(r.aggregate)return;const i=Yt(r)?Qt(r,{}):void 0;(!i||i!==u&&i!==s)&&e.push({channel:t,fieldDef:r})}))}return e}),[]);let m;if(void 0!==a.stack?m=le(a.stack)?a.stack?"zero":null:a.stack:d.length>0&&(m=de(sr,i)?function(...e){for(const n of e)if(void 0!==n)return n}(t,"zero"):t),!m||!or[m])return null;if(a.scale&&a.scale.type&&a.scale.type!==pn.LINEAR){if(r.disallowNonLinearStack)return null;ln(rn.cannotStackNonLinearScale(a.scale.type))}return ir(n,o===ge?ve:xe)?(void 0!==a.stack&&ln(rn.cannotStackRangedMark(o)),null):(a.aggregate&&!de(Lt,a.aggregate)&&ln(rn.stackNonSummativeAggregate(a.aggregate)),{groupbyChannel:c?l:void 0,fieldChannel:o,impute:ht(i),stackBy:d,offset:m})}function cr(e){if(!function(e){if(Dt(e.mark))return!1;const n=[rt.STACK,rt.CHANNEL,rt.MARK,rt.FIELD,rt.AGGREGATE,rt.AUTOCOUNT,rt.SCALE,Zn("scale","type"),rt.TYPE],t=In.toMap((i=nt,o=n,i.filter((function(e){return!Un(o,e)})))),r=e.encodings.filter((e=>!Cr(e)));var i,o;for(const a of r)if(ur(a,{exclude:t}))return!1;return!0}(e))return null;const n=kr(e.encodings,{schema:null,wildcardMode:"null"});return lr(e.mark,n,void 0,{disallowNonLinearStack:!0})}function ur(e,n={}){if(!In.isObject(e))return!1;for(const t in e)if(e.hasOwnProperty(t)){if(Dt(e[t])&&(!n.exclude||!n.exclude[t])||ur(e[t],n))return!0}return!1}function dr(e){return e.map((e=>{return n=e,e=>void 0!==n[e]?n[e]:e;var n}))}function mr(e,n){return Dt(e)?!Ot(e)&&e.enum?kt+JSON.stringify(e.enum):kt:n?n(e):e}function fr(e,n){return n?n(e):e}const pr=new rr,hr=[].concat(tt,Wn,[rt.TRANSFORM,rt.STACK],Qn).reduce(((e,n)=>e.set(n,!0)),new rr),gr={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0},stack:{x:!0,y:!0}};function yr(e,n=hr,t=pr){const r=[];let i;if(n.get(rt.MARK)&&r.push(mr(e.mark,t.get(rt.MARK))),e.transform&&e.transform.length>0&&r.push("transform:"+JSON.stringify(e.transform)),n.get(rt.STACK)&&(i=cr(e)),e.encodings){const o=e.encodings.reduce(((e,r)=>{if(!Cr(r)){let o;o=i&&r.channel===i.fieldChannel?vr(Object.assign({},r,{stack:i.offset}),n,t):vr(r,n,t),o&&e.push(o)}return e}),[]).sort().join("|");o&&r.push(o)}for(let o of Qn){const t=o.toString();if(n.get(o)&&e[t]){const n=e[t];r.push(`${t}=${JSON.stringify(n)}`)}}return r.join("|")}function vr(e,n=hr,t=pr){const r=[];if(n.get(rt.CHANNEL)&&r.push(mr(e.channel,t.get(rt.CHANNEL))),wr(e)){const i=xr(e,n,t);i&&r.push(i)}else Er(e)?r.push(e.value):Tr(e)&&r.push("autocount()");return r.join(":")}function xr(e,n=hr,t=pr){if(n.get(rt.AGGREGATE)&&Cr(e))return"-";const r=function(e,n,t){if(n.get(rt.AGGREGATE)&&e.aggregate&&!Dt(e.aggregate))return fr(e.aggregate,t.get(rt.AGGREGATE));if(n.get(rt.AGGREGATE)&&Sr(e))return fr("count",t.get(rt.AGGREGATE));if(n.get(rt.TIMEUNIT)&&e.timeUnit&&!Dt(e.timeUnit))return fr(e.timeUnit,t.get(rt.TIMEUNIT));if(n.get(rt.BIN)&&e.bin&&!Dt(e.bin))return"bin";{let t=null;for(const r of[rt.AGGREGATE,rt.AUTOCOUNT,rt.TIMEUNIT,rt.BIN]){const i=e[r];n.get(r)&&e[r]&&Dt(i)&&(t=t||{},t[r]=Ot(i)?i:i.enum)}return t&&e.hasFn&&(t.hasFn=!0),t}}(e,n,t),i=function(e,n,t){const r=[];if(!In.isBoolean(e.bin)&&!Ot(e.bin)){const i=e.bin;for(const e in i){const o=Zn("bin",e);o&&n.get(o)&&void 0!==i[e]&&r.push({key:e,value:mr(i[e],t.get(o))})}r.sort(((e,n)=>e.key.localeCompare(n.key)))}for(const i of[rt.SCALE,rt.SORT,rt.STACK,rt.AXIS,rt.LEGEND])if((Dt(e.channel)||gr[i][e.channel])&&n.get(i)&&void 0!==e[i]){const o=e[i];if(In.isBoolean(o)||null===o)r.push({key:i+"",value:o||!1});else if(In.isString(o))r.push({key:i+"",value:fr(JSON.stringify(o),t.get(i))});else{let e=[];for(const r in o){const a=Zn(i,r);a&&n.get(a)&&void 0!==o[r]&&e.push({key:r,value:mr(o[r],t.get(a))})}if(e.length>0){const n=e.sort(((e,n)=>e.key.localeCompare(n.key))).reduce(((e,n)=>(e[n.key]=n.value,e)),{});r.push({key:i+"",value:JSON.stringify(n)})}}}return r}(e,n,t);let o;if(wr(e)){if(o=n.get("field")?mr(e.field,t.get("field")):"...",n.get(rt.TYPE))if(Dt(e.type))o+=","+mr(e.type,t.get(rt.TYPE));else{o+=","+mr(((e.type||un)+"").substr(0,1),t.get(rt.TYPE))}o+=i.map((e=>{let n=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+n})).join("")}else Tr(e)&&(o="*,q");if(!o)return null;if(r){return(In.isString(r)?r:kt+(In.keys(r).length>0?JSON.stringify(r):""))+"("+o+")"}return o}function Nr(e,n,t){let r=[],i=0;for(let o=0;o<t;o++){let t=e.indexOf(n,i);if(-1===t)break;r.push(e.substring(i,t)),i=t+1}if(r.push(e.substr(i)),r.length!==t+1)for(;r.length!==t+1;)r.push("");return r}var br;function Er(e){return null!=e&&void 0!==e.value}function wr(e){return null!=e&&(e.field||"count"===e.aggregate)}function Tr(e){return null!=e&&"autoCount"in e}function Cr(e){return Tr(e)&&!1===e.autoCount}function Sr(e){return Tr(e)&&!0===e.autoCount}!function(e){function n(e){const n={};n.field=e[0],n.type=function(e){if(e)switch(e=e.toLowerCase()){case"q":case un:return"quantitative";case"t":case mn:return"temporal";case"o":case dn:return"ordinal";case"n":case fn:return"nominal";case"geojson":return"geojson"}}(e[1].toUpperCase())||"?";let r=e[2],i=0,o=0;for(;o<r.length;){let e,a=r.indexOf("=",o);if(-1===a)break;{let s=r.substring(o,a);if("{"===r[o+s.length+1]){let n=o+s.length+1;i=t(n,r,"}");const a=r.substring(n,i+1);e=JSON.parse(a),o=i+2}else if("["===r[o+s.length+1]){let n=o+s.length+1,i=t(n,r,"]");const a=r.substring(n,i+1);e=JSON.parse(a),o=i+2}else{let n=o,t=r.indexOf(",",o+s.length);-1===t&&(t=r.length),o=t+1,e=JSON.parse(r.substring(n+s.length+1,t))}Ln(s)?n[s]=e:(n.bin=n.bin||{},n.bin[s]=e)}}return n}function t(e,n,t){for(let r=e;r<n.length;r++)if(n[r]===t)return r}function r(e){const r={};if("?"===e[0]){let i=t(1,e,"}"),o=JSON.parse(e.substring(1,i+1));for(let e in o)In.isArray(o[e])?r[e]={enum:o[e]}:r[e]=o[e];return Object.assign({},r,n(Nr(e.substring(i+2,e.length-1),",",2)))}{let t=e.substring(0,e.indexOf("(")),r=Nr(e.substring(t.length+1,e.length-1),",",2);if(ee(i=t)&&Bt[i])return Object.assign({aggregate:t},n(r));if(wt[t])return Object.assign({timeUnit:t},n(r));if("bin"===t)return Object.assign({bin:{}},n(r))}var i}e.encoding=function(e,t){let i=-1!==t.indexOf("(")?r(t):n(Nr(t,",",2));return Object.assign({channel:e},i)},e.rawFieldDef=n,e.getClosingIndex=t,e.fn=r}(br||(br={}));const Ar=[rt.AGGREGATE,rt.BIN,rt.TIMEUNIT,rt.FIELD,rt.TYPE,rt.SCALE,rt.SORT,rt.AXIS,rt.LEGEND,rt.STACK,rt.FORMAT];function kr(e,n){let t={};for(const r of e){if(Cr(r))continue;const{channel:e}=r;if(Dt(e))throw new Error("Cannot convert wildcard channel to a fixed channel");const i=Er(r)?Dr(r):Or(r,n);if(null!==i)t[e]=i;else if("null"===n.wildcardMode)return null}return t}function Dr(e){const{value:n}=e;return Dt(n)?null:{value:n}}function Or(e,n={}){const{props:t=Ar,schema:r,wildcardMode:i="skip"}=n;if(wr(e)){const n={};for(const o of t){let t=e[o];if(Dt(t)){if("skip"===i)continue;return null}if(void 0!==t){if(!(!gr[o]||gr[o][e.channel]))continue;if(Ln(o)&&In.isObject(t)){t=Object.assign({},t);for(const e in t)if(Dt(t[e])){if("null"===i)return null;delete t[e]}}if("bin"===o&&!1===t)continue;"type"===o&&"key"===t?n.type="nominal":n[o]=t}if(o===rt.SCALE&&r&&e.type===dn){const t=e.scale,{ordinalDomain:i}=r.fieldSchema(e.field);null!==t&&i&&(n[rt.SCALE]=Object.assign({domain:i},In.isObject(t)?t:{}))}}return n}if(!1===e.autoCount)throw new Error("Cannot convert {autoCount: false} into a field def");return{aggregate:"count",field:"*",type:"quantitative"}}function Mr(e){return wr(e)?!Ir(e)&&"temporal"!==e.type:Tr(e)}function Ir(e){if(wr(e)){const n=Or(e,{props:["bin","timeUnit","type"]});return Kt(n)||!!n.timeUnit}return!1}function Ur(e){const n=!0===e.scale||e.scale===kt?{}:e.scale||{},{type:t,channel:r,timeUnit:i,bin:o}=e;if(Dt(n.type)||Dt(t)||Dt(r)||Dt(o))return;if(n.type)return n.type;if("temporal"===t&&Dt(i))return;if("quantitative"===t&&Dt(o))return;const a={type:t===er.KEY?"nominal":t,timeUnit:i,bin:o};return Zt({type:n.type},r,a,void 0)}var Fr={exports:{}},jr=new Date,_r=new Date;function Pr(e,n,t,r){function i(n){return e(n=new Date(+n)),n}return i.floor=i,i.round=function(t){var r=new Date(+t),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},i.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},i.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},i.range=function(t,r,i){var o=[];if(t=new Date(t-1),r=new Date(+r),i=null==i?1:Math.floor(i),!(t<r&&i>0))return o;for(n(t,1),e(t),t<r&&o.push(new Date(+t));n(t,i),e(t),t<r;)o.push(new Date(+t));return o},i.filter=function(t){return Pr((function(n){for(;e(n),!t(n);)n.setTime(n-1)}),(function(e,r){for(;--r>=0;)for(;n(e,1),!t(e););}))},t&&(i.count=function(n,r){return jr.setTime(+n),_r.setTime(+r),e(jr),e(_r),Math.floor(t(jr,_r))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(n){return r(n)%e==0}:function(n){return i.count(0,n)%e==0}):i:null}),i}var Rr=Pr((function(){}),(function(e,n){e.setTime(+e+n)}),(function(e,n){return n-e}));Rr.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Pr((function(n){n.setTime(Math.floor(n/e)*e)}),(function(n,t){n.setTime(+n+t*e)}),(function(n,t){return(t-n)/e})):Rr:null};const $r=Pr((function(e){e.setMilliseconds(0)}),(function(e,n){e.setTime(+e+1e3*n)}),(function(e,n){return(n-e)/1e3}),(function(e){return e.getSeconds()})),qr=Pr((function(e){e.setSeconds(0,0)}),(function(e,n){e.setTime(+e+6e4*n)}),(function(e,n){return(n-e)/6e4}),(function(e){return e.getMinutes()})),Br=Pr((function(e){e.setMinutes(0,0,0)}),(function(e,n){e.setTime(+e+36e5*n)}),(function(e,n){return(n-e)/36e5}),(function(e){return e.getHours()})),Lr=Pr((function(e){e.setHours(0,0,0,0)}),(function(e,n){e.setDate(e.getDate()+n)}),(function(e,n){return(n-e-6e4*(n.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function Vr(e){return Pr((function(n){n.setHours(0,0,0,0),n.setDate(n.getDate()-(n.getDay()+7-e)%7)}),(function(e,n){e.setDate(e.getDate()+7*n)}),(function(e,n){return(n-e-6e4*(n.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var Wr=Vr(0),Hr=Vr(1),Gr=Vr(2),zr=Vr(3),Yr=Vr(4),Qr=Vr(5),Kr=Vr(6);const Jr=Pr((function(e){e.setHours(0,0,0,0),e.setDate(1)}),(function(e,n){e.setMonth(e.getMonth()+n)}),(function(e,n){return n.getMonth()-e.getMonth()+12*(n.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),Xr=Pr((function(e){e.setHours(0,0,0,0),e.setMonth(0,1)}),(function(e,n){e.setFullYear(e.getFullYear()+n)}),(function(e,n){return n.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})),Zr=Pr((function(e){e.setUTCMilliseconds(0)}),(function(e,n){e.setTime(+e+1e3*n)}),(function(e,n){return(n-e)/1e3}),(function(e){return e.getUTCSeconds()})),ei=Pr((function(e){e.setUTCSeconds(0,0)}),(function(e,n){e.setTime(+e+6e4*n)}),(function(e,n){return(n-e)/6e4}),(function(e){return e.getUTCMinutes()})),ni=Pr((function(e){e.setUTCMinutes(0,0,0)}),(function(e,n){e.setTime(+e+36e5*n)}),(function(e,n){return(n-e)/36e5}),(function(e){return e.getUTCHours()})),ti=Pr((function(e){e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCDate(e.getUTCDate()+n)}),(function(e,n){return(n-e)/864e5}),(function(e){return e.getUTCDate()-1}));function ri(e){return Pr((function(n){n.setUTCHours(0,0,0,0),n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7)}),(function(e,n){e.setUTCDate(e.getUTCDate()+7*n)}),(function(e,n){return(n-e)/6048e5}))}var ii=ri(0),oi=ri(1),ai=ri(2),si=ri(3),li=ri(4),ci=ri(5),ui=ri(6);const di=Pr((function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)}),(function(e,n){e.setUTCMonth(e.getUTCMonth()+n)}),(function(e,n){return n.getUTCMonth()-e.getUTCMonth()+12*(n.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),mi=Pr((function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)}),(function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));var fi=Rr.range,pi=$r.range,hi=qr.range,gi=Br.range,yi=Lr.range,vi=Wr.range,xi=Hr.range,Ni=Gr.range,bi=zr.range,Ei=Yr.range,wi=Qr.range,Ti=Kr.range,Ci=Wr.range,Si=Jr.range,Ai=Xr.range,ki=Rr,Di=fi,Oi=Zr.range,Mi=ei.range,Ii=ni.range,Ui=ti.range,Fi=ii.range,ji=oi.range,_i=ai.range,Pi=si.range,Ri=li.range,$i=ci.range,qi=ui.range,Bi=ii.range,Li=di.range,Vi=mi.range;var Wi=t(Object.freeze(Object.defineProperty({__proto__:null,day:Lr,days:yi,friday:Qr,fridays:wi,hour:Br,hours:gi,interval:Pr,millisecond:Rr,milliseconds:fi,minute:qr,minutes:hi,monday:Hr,mondays:xi,month:Jr,months:Si,saturday:Kr,saturdays:Ti,second:$r,seconds:pi,sunday:Wr,sundays:vi,thursday:Yr,thursdays:Ei,tuesday:Gr,tuesdays:Ni,utcDay:ti,utcDays:Ui,utcFriday:ci,utcFridays:$i,utcHour:ni,utcHours:Ii,utcMillisecond:ki,utcMilliseconds:Di,utcMinute:ei,utcMinutes:Mi,utcMonday:oi,utcMondays:ji,utcMonth:di,utcMonths:Li,utcSaturday:ui,utcSaturdays:qi,utcSecond:Zr,utcSeconds:Oi,utcSunday:ii,utcSundays:Fi,utcThursday:li,utcThursdays:Ri,utcTuesday:ai,utcTuesdays:_i,utcWednesday:si,utcWednesdays:Pi,utcWeek:ii,utcWeeks:Bi,utcYear:mi,utcYears:Vi,wednesday:zr,wednesdays:bi,week:Wr,weeks:Ci,year:Xr,years:Ai},Symbol.toStringTag,{value:"Module"}))),Hi=new Date,Gi=new Date(0,0,1).setFullYear(0),zi=new Date(Date.UTC(0,0,1)).setUTCFullYear(0);function Yi(e){return Hi.setTime(+e),Hi}function Qi(e,n,t,r,i,o){var a={type:e,date:n,unit:t};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function Ki(e,n,t,r,i,o){return Qi(e,(function(e){return n.offset(t,e)}),(function(e){return n.count(t,e)}),r,i,o)}var Ji=[Ki("second",Wi.second,Gi),Ki("minute",Wi.minute,Gi),Ki("hour",Wi.hour,Gi),Ki("day",Wi.day,Gi,[1,7]),Ki("month",Wi.month,Gi,[1,3,6]),Ki("year",Wi.year,Gi),Qi("seconds",(function(e){return new Date(1970,0,1,0,0,e)}),(function(e){return Yi(e).getSeconds()}),null,0,59),Qi("minutes",(function(e){return new Date(1970,0,1,0,e)}),(function(e){return Yi(e).getMinutes()}),null,0,59),Qi("hours",(function(e){return new Date(1970,0,1,e)}),(function(e){return Yi(e).getHours()}),null,0,23),Qi("weekdays",(function(e){return new Date(1970,0,4+e)}),(function(e){return Yi(e).getDay()}),[1],0,6),Qi("dates",(function(e){return new Date(1970,0,e)}),(function(e){return Yi(e).getDate()}),[1],1,31),Qi("months",(function(e){return new Date(1970,e%12,1)}),(function(e){return Yi(e).getMonth()}),[1],0,11)],Xi=[Ki("second",Wi.utcSecond,zi),Ki("minute",Wi.utcMinute,zi),Ki("hour",Wi.utcHour,zi),Ki("day",Wi.utcDay,zi,[1,7]),Ki("month",Wi.utcMonth,zi,[1,3,6]),Ki("year",Wi.utcYear,zi),Qi("seconds",(function(e){return new Date(Date.UTC(1970,0,1,0,0,e))}),(function(e){return Yi(e).getUTCSeconds()}),null,0,59),Qi("minutes",(function(e){return new Date(Date.UTC(1970,0,1,0,e))}),(function(e){return Yi(e).getUTCMinutes()}),null,0,59),Qi("hours",(function(e){return new Date(Date.UTC(1970,0,1,e))}),(function(e){return Yi(e).getUTCHours()}),null,0,23),Qi("weekdays",(function(e){return new Date(Date.UTC(1970,0,4+e))}),(function(e){return Yi(e).getUTCDay()}),[1],0,6),Qi("dates",(function(e){return new Date(Date.UTC(1970,0,e))}),(function(e){return Yi(e).getUTCDate()}),[1],1,31),Qi("months",(function(e){return new Date(Date.UTC(1970,e%12,1))}),(function(e){return Yi(e).getUTCMonth()}),[1],0,11)],Zi=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];function eo(e){var n,t,r={};for(n=0,t=e.length;n<t;++n)r[e[n].type]=e[n];return r.find=function(n,t,r){return function(e,n,t,r){var i,o,a,s=Zi[0];for(i=1,o=Zi.length;i<o;++i)if(n>(s=Zi[i])[0]){if((a=n/s[0])>r)return e[Zi[i-1][1]];if(a>=t)return e[s[1]]}return e[Zi[o-1][1]]}(e,n,t,r)},r}Fr.exports=eo(Ji),Fr.exports.utc=eo(Xi);var no=Fr.exports,to=In,ro=no,io=1e-15;function oo(e){if(!e)throw Error("Missing binning options.");var n,t,r,i,o,a,s,l=e.maxbins||15,c=e.base||10,u=Math.log(c),d=e.div||[5,2],m=e.min,f=e.max,p=f-m;if(e.step)n=e.step;else if(e.steps)n=e.steps[Math.min(e.steps.length-1,function(e,n,t,r){for(;t<r;){var i=t+r>>>1;to.cmp(e[i],n)<0?t=i+1:r=i}return t}(e.steps,p/l,0,e.steps.length))];else{for(t=Math.ceil(Math.log(l)/u),r=e.minstep||0,n=Math.max(r,Math.pow(c,Math.round(Math.log(p)/u)-t));Math.ceil(p/n)>l;)n*=c;for(a=0;a<d.length;++a)(o=n/d[a])>=r&&p/o<=l&&(n=o)}return i=(o=Math.log(n))>=0?0:1+~~(-o/u),s=Math.pow(c,-i-1),{start:m=Math.min(m,Math.floor(m/n+s)*n),stop:f=Math.ceil(f/n)*n,step:n,unit:{precision:i},value:ao,index:so}}function ao(e){return this.step*Math.floor(e/this.step+io)}function so(e){return Math.floor((e-this.start)/this.step+io)}function lo(e){return this.unit.date(ao.call(this,e))}function co(e){return so.call(this,this.unit.unit(e))}oo.date=function(e){if(!e)throw Error("Missing date binning options.");var n=e.utc?ro.utc:ro,t=e.min,r=e.max,i=e.maxbins||20,o=e.minbins||4,a=+r-+t,s=e.unit?n[e.unit]:n.find(a,o,i),l=oo({min:null!=s.min?s.min:s.unit(t),max:null!=s.max?s.max:s.unit(r),maxbins:i,minstep:s.minstep,steps:s.step});return l.unit=s,l.index=co,e.raw||(l.value=lo),l};const uo=n(oo);var mo=In,fo="__types__",po={boolean:mo.boolean,integer:mo.number,number:mo.number,date:mo.date,string:function(e){return null==e||""===e?null:e+""}},ho={boolean:function(e){return"true"===e||"false"===e||mo.isBoolean(e)},integer:function(e){return ho.number(e)&&(e=+e)==~~e},number:function(e){return!isNaN(+e)&&!mo.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};function go(e){return mo.keys(e)}function yo(e){return"["+e+"]"}function vo(e,n){var t,r,i;if(e=mo.array(e),n=mo.$(n),e[fo]&&(t=n(e[fo]),mo.isString(t)))return t;for(r=0,i=e.length;!mo.isValid(t)&&r<i;++r)t=n?n(e[r]):e[r];return mo.isDate(t)?"date":mo.isNumber(t)?"number":mo.isBoolean(t)?"boolean":mo.isString(t)?"string":null}function xo(e,n){var t,r,i;e=mo.array(e),n=mo.$(n);var o=["boolean","integer","number","date"];for(t=0;t<e.length;++t){for(i=n?n(e[t]):e[t],r=0;r<o.length;++r)mo.isValid(i)&&!ho[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}vo.annotation=function(e,n){if(!n)return e&&e[fo]||null;e[fo]=n},vo.all=function(e,n){if(e.length){var t=n?mo.identity:(n=go(e[0]),yo);return n.reduce((function(n,r){return n[r]=vo(e,t(r)),n}),{})}},vo.infer=xo,vo.inferAll=function(e,n){var t=n?mo.identity:(n=go(e[0]),yo);return n.reduce((function(n,r){return n[r]=xo(e,t(r)),n}),{})},vo.parsers=po;var No,bo,Eo=vo,wo={exports:{}},To={exports:{}};No=In,(bo=To.exports).repeat=function(e,n){var t,r=Array(n);for(t=0;t<n;++t)r[t]=e;return r},bo.zeros=function(e){return bo.repeat(0,e)},bo.range=function(e,n,t){if(arguments.length<3&&(t=1,arguments.length<2&&(n=e,e=0)),(n-e)/t==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(t<0)for(;(r=e+t*++o)>n;)i.push(r);else for(;(r=e+t*++o)<n;)i.push(r);return i},bo.random={},bo.random.uniform=function(e,n){void 0===n&&(n=void 0===e?1:e,e=0);var t=n-e,r=function(){return e+t*Math.random()};return r.samples=function(e){return bo.zeros(e).map(r)},r.pdf=function(r){return r>=e&&r<=n?1/t:0},r.cdf=function(r){return r<e?0:r>n?1:(r-e)/t},r.icdf=function(n){return n>=0&&n<=1?e+n*t:NaN},r},bo.random.integer=function(e,n){void 0===n&&(n=e,e=0);var t=n-e,r=function(){return e+Math.floor(t*Math.random())};return r.samples=function(e){return bo.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&r<n?1/t:0},r.cdf=function(r){var i=Math.floor(r);return i<e?0:i>=n?1:(i-e+1)/t},r.icdf=function(n){return n>=0&&n<=1?e-1+Math.floor(n*t):NaN},r},bo.random.normal=function(e,n){var t;e=e||0,n=n||1;var r=function(){var r,i,o=0,a=0;if(void 0!==t)return o=t,t=void 0,o;do{r=(o=2*Math.random()-1)*o+(a=2*Math.random()-1)*a}while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),t=e+a*i*n,e+o*i*n};return r.samples=function(e){return bo.zeros(e).map(r)},r.pdf=function(t){var r=Math.exp(Math.pow(t-e,2)/(-2*Math.pow(n,2)));return 1/(n*Math.sqrt(2*Math.PI))*r},r.cdf=function(t){var r,i=(t-e)/n,o=Math.abs(i);if(o>37)r=0;else{var a=Math.exp(-o*o/2);o<7.07106781186547?(r=a*((((((.0352624965998911*o+.700383064443688)*o+6.37396220353165)*o+33.912866078383)*o+112.079291497871)*o+221.213596169931)*o+220.206867912376),r/=((((((.0883883476483184*o+1.75566716318264)*o+16.064177579207)*o+86.7807322029461)*o+296.564248779674)*o+637.333633378831)*o+793.826512519948)*o+440.413735824752):r=a/(o+1/(o+2/(o+3/(o+4/(o+.65)))))/2.506628274631}return i>0?1-r:r},r.icdf=function(t){if(t<=0||t>=1)return NaN;var r=2*t-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,s=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+n*Math.SQRT2*s},r},bo.random.bootstrap=function(e,n){var t=e.filter(No.isValid),r=t.length,i=n?bo.random.normal(0,n):null,o=function(){return t[~~(Math.random()*r)]+(i?i():0)};return o.samples=function(e){return bo.zeros(e).map(o)},o};var Co=To.exports;!function(e){var n=In,t=Eo,r=Co,i=wo.exports;function o(e,n,t){var o=e&&e.nullh||0,a=r.random.normal(0,1),s=i.mean(n,t),l=i.stdev(n,t)/Math.sqrt(i.count.valid(n,t));if(0===l)return s-o==0?1:0;var c=(s-o)/l;return 2*a.cdf(-Math.abs(c))}function a(e,t,r,o){var a,s=o?t.map(n.$(r)):t,l=o?t.map(n.$(o)):r,c=i.count(s),u=i.count(l),d=Array();if(c!==u)throw Error("Array lengths must match.");for(a=0;a<c;++a)n.isValid(s[a])&&n.isValid(l[a])&&d.push(s[a]-l[a]);return i.z.test(d,e&&e.nullh||0)}function s(e,t,o,a){var s=a?t.map(n.$(o)):t,l=a?t.map(n.$(a)):o,c=i.count.valid(s),u=i.count.valid(l),d=r.random.normal(0,1),m=i.mean(s)-i.mean(l)-(e&&e.nullh||0),f=Math.sqrt(i.variance(s)/c+i.variance(l)/u);if(0===f)return 0===m?1:0;var p=m/f;return 2*d.cdf(-Math.abs(p))}i.unique=function(e,t,r){t=n.$(t),r=r||[];var i,o,a,s={};for(o=0,a=e.length;o<a;++o)(i=t?t(e[o]):e[o])in s||(s[i]=1,r.push(i));return r},i.count=function(e){return e&&e.length||0},i.count.valid=function(e,t){t=n.$(t);var r,i,o,a=0;for(i=0,o=e.length;i<o;++i)r=t?t(e[i]):e[i],n.isValid(r)&&(a+=1);return a},i.count.missing=function(e,t){t=n.$(t);var r,i,o=0;for(r=0,i=e.length;r<i;++r)null==(t?t(e[r]):e[r])&&(o+=1);return o},i.count.distinct=function(e,t){t=n.$(t);var r,i,o,a={},s=0;for(i=0,o=e.length;i<o;++i)(r=t?t(e[i]):e[i])in a||(a[r]=1,s+=1);return s},i.count.map=function(e,t){t=n.$(t);var r,i,o,a={};for(i=0,o=e.length;i<o;++i)a[r=t?t(e[i]):e[i]]=r in a?a[r]+1:1;return a},i.median=function(e,t){return t&&(e=e.map(n.$(t))),e=e.filter(n.isValid).sort(n.cmp),i.quantile(e,.5)},i.quartile=function(e,t){t&&(e=e.map(n.$(t))),e=e.filter(n.isValid).sort(n.cmp);var r=i.quantile;return[r(e,.25),r(e,.5),r(e,.75)]},i.quantile=function(e,t,r){void 0===r&&(r=t,t=n.identity),t=n.$(t);var i=(e.length-1)*r+1,o=Math.floor(i),a=+t(e[o-1]),s=i-o;return s?a+s*(t(e[o])-a):a},i.sum=function(e,t){t=n.$(t);for(var r,i=0,o=0,a=e.length;o<a;++o)r=t?t(e[o]):e[o],n.isValid(r)&&(i+=r);return i},i.mean=function(e,t){t=n.$(t);var r,i,o,a,s=0;for(r=0,o=0,i=e.length;r<i;++r)a=t?t(e[r]):e[r],n.isValid(a)&&(s+=(a-s)/++o);return s},i.mean.geometric=function(e,t){t=n.$(t);var r,i,o,a,s=1;for(a=0,r=0,i=e.length;a<i;++a)if(o=t?t(e[a]):e[a],n.isValid(o)){if(o<=0)throw Error("Geometric mean only defined for positive values.");s*=o,++r}return s=r>0?Math.pow(s,1/r):0},i.mean.harmonic=function(e,t){t=n.$(t);var r,i,o,a,s=0;for(a=0,r=0,i=e.length;a<i;++a)o=t?t(e[a]):e[a],n.isValid(o)&&(s+=1/o,++r);return r/s},i.variance=function(e,t){if(t=n.$(t),!n.isArray(e)||e.length<2)return 0;var r,i,o,a,s=0,l=0;for(i=0,o=0;i<e.length;++i)a=t?t(e[i]):e[i],n.isValid(a)&&(l+=(r=a-s)*(a-(s+=r/++o)));return l/=o-1},i.stdev=function(e,n){return Math.sqrt(i.variance(e,n))},i.modeskew=function(e,n){var t=i.mean(e,n),r=i.median(e,n),o=i.stdev(e,n);return 0===o?0:(t-r)/o},i.min=function(e,n){return i.extent(e,n)[0]},i.max=function(e,n){return i.extent(e,n)[1]},i.extent=function(e,t){t=n.$(t);var r,i,o,a,s=e.length;for(a=0;a<s;++a)if(o=t?t(e[a]):e[a],n.isValid(o)){r=i=o;break}for(;a<s;++a)o=t?t(e[a]):e[a],n.isValid(o)&&(o<r&&(r=o),o>i&&(i=o));return[r,i]},i.extent.index=function(e,t){t=n.$(t);var r,i,o,a,s=-1,l=-1,c=e.length;for(a=0;a<c;++a)if(o=t?t(e[a]):e[a],n.isValid(o)){r=i=o,s=l=a;break}for(;a<c;++a)o=t?t(e[a]):e[a],n.isValid(o)&&(o<r&&(r=o,s=a),o>i&&(i=o,l=a));return[s,l]},i.dot=function(e,t,r){var i,o,a=0;if(r)for(t=n.$(t),r=n.$(r),i=0;i<e.length;++i)(o=t(e[i])*r(e[i]))==o&&(a+=o);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(i=0;i<e.length;++i)(o=e[i]*t[i])==o&&(a+=o)}return a},i.dist=function(e,t,r,i){var o,a,s=n.isFunction(r)||n.isString(r),l=e,c=s?e:t,u=s?i:r,d=2===u||null==u,m=e.length,f=0;for(s&&(t=n.$(t),r=n.$(r)),a=0;a<m;++a)o=s?t(l[a])-r(c[a]):l[a]-c[a],f+=d?o*o:Math.pow(Math.abs(o),u);return d?Math.sqrt(f):Math.pow(f,1/u)},i.cohensd=function(e,t,r){var o=r?e.map(n.$(t)):e,a=r?e.map(n.$(r)):t,s=i.mean(o),l=i.mean(a),c=i.count.valid(o),u=i.count.valid(a);if(c+u-2<=0)return 0;var d=i.variance(o),m=i.variance(a),f=Math.sqrt(((c-1)*d+(u-1)*m)/(c+u-2));return 0===f?0:(s-l)/f},i.covariance=function(e,t,r){var o,a,s,l,c,u=r?e.map(n.$(t)):e,d=r?e.map(n.$(r)):t,m=u.length,f=i.mean(u),p=i.mean(d),h=0,g=0;if(m!==d.length)throw Error("Input lengths must match.");for(o=0;o<m;++o)if(a=u[o],l=n.isValid(a),s=d[o],c=n.isValid(s),l&&c)h+=(a-f)*(s-p),++g;else if(l||c)throw Error("Valid values must align.");return h/(g-1)},i.rank=function(e,t){t=n.$(t)||n.identity;var r,i,o,a=e.map((function(e,n){return{idx:n,val:t(e)}})).sort(n.comparator("val")),s=e.length,l=Array(s),c=-1,u={};for(r=0;r<s;++r){if(i=a[r].val,c<0&&u===i)c=r-1;else if(c>-1&&u!==i){for(o=1+(r-1+c)/2;c<r;++c)l[a[c].idx]=o;c=-1}l[a[r].idx]=r+1,u=i}if(c>-1)for(o=1+(s-1+c)/2;c<s;++c)l[a[c].idx]=o;return l},i.cor=function(e,t,r){var o=r;r=o?e.map(n.$(r)):t,t=o?e.map(n.$(t)):e;var a=i.dot(t,r),s=i.mean(t),l=i.mean(r),c=i.stdev(t),u=i.stdev(r),d=e.length;return(a-d*s*l)/((d-1)*c*u)},i.cor.rank=function(e,n,t){var r,o,a,s=t?i.rank(e,n):i.rank(e),l=t?i.rank(e,t):i.rank(n),c=e.length;for(r=0,o=0;r<c;++r)o+=(a=s[r]-l[r])*a;return 1-6*o/(c*(c*c-1))},i.cor.dist=function(e,t,r){var o,a,s,l,c=r?e.map(n.$(t)):e,u=r?e.map(n.$(r)):t,d=i.dist.mat(c),m=i.dist.mat(u),f=d.length;for(o=0,a=0,s=0,l=0;o<f;++o)a+=d[o]*d[o],s+=m[o]*m[o],l+=d[o]*m[o];return Math.sqrt(l/Math.sqrt(a*s))},i.linearRegression=function(e,t,r){var o,a,s=r?e.map(n.$(t)):e,l=r?e.map(n.$(r)):t,c=s.length,u=i.covariance(s,l),d=i.stdev(s),m=i.stdev(l),f=u/(d*d),p=i.mean(l)-f*i.mean(s),h={slope:f,intercept:p,R:u/(d*m),rss:0};for(a=0;a<c;++a)n.isValid(s[a])&&n.isValid(l[a])&&(o=f*s[a]+p-l[a],h.rss+=o*o);return h},i.bootstrap={},i.bootstrap.ci=function(e,t,o,a,s){var l,c,u,d,m,f,p;for(n.isFunction(t)||n.isString(t)?(l=e.map(n.$(t)),c=o,u=a,d=s):(l=e,c=t,u=o,d=a),c=c?+c:1e3,u=u||.05,m=r.random.bootstrap(l,d),p=0,f=Array(c);p<c;++p)f[p]=i.mean(m.samples(l.length));return f.sort(n.numcmp),[i.quantile(f,u/2),i.quantile(f,1-u/2)]},i.z={},i.z.ci=function(e,t,o){var a=e,s=t;(n.isFunction(t)||n.isString(t))&&(a=e.map(n.$(t)),s=o);var l=.05===(s=s||.05)?1.96:r.random.normal(0,1).icdf(1-s/2),c=i.mean(a),u=i.stdev(a)/Math.sqrt(i.count.valid(a));return[c-l*u,c+l*u]},i.z.test=function(e,t,r,i){return n.isFunction(r)||n.isString(r)?(i&&i.paired?a:s)(i,e,t,r):n.isArray(t)?(r&&r.paired?a:s)(r,e,t):n.isFunction(t)||n.isString(t)?o(r,e,t):o(t,e)},i.dist.mat=function(e){var n,t,i,o=e.length,a=o*o,s=Array(a),l=r.zeros(o),c=0;for(t=0;t<o;++t)for(s[t*o+t]=0,i=t+1;i<o;++i)s[t*o+i]=n=Math.abs(e[t]-e[i]),s[i*o+t]=n,l[t]+=n,l[i]+=n;for(t=0;t<o;++t)c+=l[t],l[t]/=o;for(c/=a,t=0;t<o;++t)for(i=t;i<o;++i)s[t*o+i]+=c-l[t]-l[i],s[i*o+t]=s[t*o+i];return s},i.entropy=function(e,t){t=n.$(t);var r,i,o=0,a=0,s=e.length;for(r=0;r<s;++r)o+=t?t(e[r]):e[r];if(0===o)return 0;for(r=0;r<s;++r)(i=(t?t(e[r]):e[r])/o)&&(a+=i*Math.log(i));return-a/Math.LN2},i.mutual=function(e,t,r,i){var o,a,s,l=i?e.map(n.$(t)):e,c=i?e.map(n.$(r)):t,u=i?e.map(n.$(i)):r,d={},m={},f=u.length,p=0,h=0,g=0;for(s=0;s<f;++s)d[l[s]]=0,m[c[s]]=0;for(s=0;s<f;++s)d[l[s]]+=u[s],m[c[s]]+=u[s],p+=u[s];for(a=1/(p*Math.LN2),s=0;s<f;++s)0!==u[s]&&(o=p*u[s]/(d[l[s]]*m[c[s]]),h+=u[s]*a*Math.log(o),g+=u[s]*a*Math.log(u[s]/p));return[h,1+h/g]},i.mutual.info=function(e,n,t,r){return i.mutual(e,n,t,r)[0]},i.mutual.dist=function(e,n,t,r){return i.mutual(e,n,t,r)[1]},i.profile=function(e,r){var o,a,s,l,c,u=0,d=0,m=0,f=0,p=null,h=null,g=0,y=[],v={};for(s=0;s<e.length;++s)v[l=r?r(e[s]):e[s]]=l in v?v[l]+1:(f+=1,1),null==l?++m:n.isValid(l)&&(c="string"==typeof l?l.length:l,(null===p||c<p)&&(p=c),(null===h||c>h)&&(h=c),g+=(o=c-u)*(c-(u+=o/++d)),y.push(c));return g/=d-1,a=Math.sqrt(g),y.sort(n.cmp),{type:t(e,r),unique:v,count:e.length,valid:d,missing:m,distinct:f,min:p,max:h,mean:u,stdev:a,median:l=i.quantile(y,.5),q1:i.quantile(y,.25),q3:i.quantile(y,.75),modeskew:0===a?0:(u-l)/a}},i.summary=function(e,t){var r=(t=t||n.keys(e[0])).map((function(t){var r=i.profile(e,n.$(t));return r.field=t,r}));return r.__summary__=!0,r}}();var So=wo.exports;const Ao=uo;const ko={nominal:0,key:1,ordinal:2,temporal:3,quantitative:4};class Do{constructor(e){this._tableSchema=e,e.fields.sort((function(e,n){return ko[e.vlType]<ko[n.vlType]?-1:ko[e.vlType]>ko[n.vlType]?1:e.name.localeCompare(n.name)})),e.fields.forEach(((e,n)=>e.index=n)),this._fieldSchemaIndex=e.fields.reduce(((e,n)=>(e[n.name]=n,e)),{})}fieldNames(){return this._tableSchema.fields.map((e=>e.name))}get fieldSchemas(){return this._tableSchema.fields}fieldSchema(e){return this._fieldSchemaIndex[e]}tableSchema(){const e=In.duplicate(this._tableSchema);return e.fields.sort(((e,n)=>e.originalIndex-n.originalIndex)),e}primitiveType(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null}vlType(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].vlType:null}cardinality(e,n=!0,t=!1){const r=this._fieldSchemaIndex[e.field];if(e.aggregate||Tr(e)&&e.autoCount)return 1;if(e.bin){let n;n="boolean"==typeof e.bin?{maxbins:Ht(e.channel)}:"?"===e.bin?{enum:[!0,!1]}:e.bin;const t=n.maxbins;return r.binStats[t]||(r.binStats[t]=Oo(t,r.stats)),r.binStats[t].distinct}if(e.timeUnit){if(n)switch(e.timeUnit){case gt.SECONDS:case gt.MINUTES:return 60;case gt.HOURS:return 24;case gt.DAY:return 7;case gt.DATE:return 31;case gt.MONTH:return 12;case gt.QUARTER:return 4;case gt.MILLISECONDS:return 1e3}let i=e.timeUnit,o=r.timeStats;return o&&o[i]||(o=Object.assign({},o,{[i]:Mo(e.timeUnit,r.stats)})),t?o[i].distinct-Io(o[i].unique,["Invalid Date",null]):o[i].distinct}return r?t?r.stats.distinct-Io(r.stats.unique,[NaN,null]):r.stats.distinct:null}timeUnitHasVariation(e){if(!e.timeUnit)return;if(e.timeUnit===gt.DAY){const n=In.extend({},e,{timeUnit:gt.DATE});if(this.cardinality(n,!1,!0)<=1)return!1}let n=e.timeUnit;for(let t of xt)if(At(n,t)){const n=In.extend({},e,{timeUnit:t});if(this.cardinality(n,!1,!0)<=1)return!1}return!0}domain(e){const n=this._fieldSchemaIndex[e.field];let t=In.keys(n.stats.unique);return n.vlType===un?[+n.stats.min,+n.stats.max]:n.type===Uo.DATETIME?[n.stats.min,n.stats.max]:n.type===Uo.INTEGER||n.type===Uo.NUMBER?(t=t.map((e=>+e)),t.sort(In.cmp)):n.vlType===dn&&n.ordinalDomain?n.ordinalDomain:t.map((e=>"null"===e?null:e)).sort(In.cmp)}stats(e){const n=this._fieldSchemaIndex[e.field];return n?n.stats:null}}function Oo(e,n){const t=Ao({min:n.min,max:n.max,maxbins:e}),r=In.extend({},n);return r.unique=function(e,n){const t={};for(let r in n){let i;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),t[i]=(t[i]||0)+n[r]}return t}(t,n.unique),r.distinct=(t.stop-t.start)/t.step,r.min=t.start,r.max=t.stop,r}function Mo(e,n){const t=In.extend({},n);let r={};return In.keys(n.unique).forEach((function(t){let i,o="null"===t?null:new Date(t);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===gt.DAY?o.getDay():Ct(e,o)).toString(),r[i]=(r[i]||0)+n.unique[t]})),t.unique=r,t.distinct=In.keys(r).length,t}function Io(e,n){return n.reduce((function(n,t){return e[t]?n+1:n}),0)}var Uo,Fo;(Fo=Uo||(Uo={}))[Fo.STRING="string"]="STRING",Fo[Fo.NUMBER="number"]="NUMBER",Fo[Fo.INTEGER="integer"]="INTEGER",Fo[Fo.BOOLEAN="boolean"]="BOOLEAN",Fo[Fo.DATETIME="datetime"]="DATETIME";class jo{constructor(e){this.constraint=e}name(){return this.constraint.name}description(){return this.constraint.description}properties(){return this.constraint.properties}strict(){return this.constraint.strict}}class _o extends jo{constructor(e){super(e)}hasAllRequiredPropertiesSpecific(e){return Fn(this.constraint.properties,(n=>{if(Pn(n)){let t=n.parent,r=n.child;return!e[t]||!Dt(e[t][r])}return!e[n]||!Dt(e[n])}))}satisfy(e,n,t,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,n,t,r)}}const Po=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[rt.TYPE,rt.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>!e.aggregate||!tr(e.type)},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[rt.FIELD,rt.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>"*"===e.field==("count"===e.aggregate)},{name:"minCardinalityForBin",description:"binned quantitative field should not have too low cardinality",properties:[rt.BIN,rt.FIELD,rt.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>{if(e.bin&&e.type===un){let t={channel:e.channel,field:e.field,type:e.type};return n.cardinality(t)>=r.minCardinalityForBin}return!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[rt.TYPE,rt.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>!e.bin||e.type===un},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[rt.CHANNEL,rt.TYPE,rt.BIN,rt.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>{const i=Object.assign({field:"f"},Or(e,{schema:n,props:["bin","timeUnit","type"]})),{compatible:o}=Xt(i,e.channel);if(o)return!0;return!("row"!==e.channel&&"column"!==e.channel||(a=i.timeUnit,!vt[a]&&!function(e){return!!Nt[e]}(i.timeUnit)));var a}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[rt.AGGREGATE,rt.BIN,rt.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:(e,n,t,r)=>!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[rt.SCALE,Zn("scale","zero"),rt.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>!e.bin||!e.scale||!0!==e.scale.zero},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[rt.AGGREGATE,rt.AUTOCOUNT,rt.TIMEUNIT,rt.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:(e,n,t,r)=>{if(wr(e)){return(!Dt(e.aggregate)&&e.aggregate?1:0)+(!Dt(e.bin)&&e.bin?1:0)+(!Dt(e.timeUnit)&&e.timeUnit?1:0)<=1}return!0}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[rt.TYPE,rt.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>!e.timeUnit||e.type===mn},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[rt.TIMEUNIT,rt.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t,r)=>!e.timeUnit||e.type!==mn||(!t.has("timeUnit")&&!r.constraintManuallySpecifiedValue||n.timeUnitHasVariation(e))},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(Hn,[rt.SCALE,rt.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:(e,n,t,r)=>{if(e.scale){const n=e.scale,t=Ur(e);if(null==t)return!0;for(let e in n){if("type"===e||"name"===e||"enum"===e)continue;const n=e;if("point"===t){if(!Sn("point",n)&&!Sn("band",n))return!1}else if(!Sn(t,n))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(Hn,[rt.SCALE,rt.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:(e,n,t,r)=>{if(e){let n=e.channel,t=e.scale;if(n&&!Dt(n)&&t){if("row"===n||"column"===n)return!1;for(let e in t){if(!t.hasOwnProperty(e))continue;if("type"===e||"name"===e||"enum"===e)continue;if(!(void 0===An(n,e)))return!1}}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[rt.FIELD,rt.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>{if("*"===e.field)return!0;const i=n.primitiveType(e.field),o=e.type;if(!t.has("field")&&!t.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case Uo.BOOLEAN:case Uo.STRING:return o!==un&&o!==mn;case Uo.NUMBER:case Uo.INTEGER:return o!==mn;case Uo.DATETIME:return o===mn;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[rt.FIELD,rt.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t,r)=>!(t.has("field")||t.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===un:n.vlType(e.field)===e.type)},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[rt.CHANNEL,rt.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t,r)=>e.channel!==Te||e.type!==fn&&e.type!==er.KEY||n.cardinality(e)<=r.maxCardinalityForCategoricalColor},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[rt.CHANNEL,rt.FIELD,rt.BIN,rt.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t,r)=>e.channel!==fe&&e.channel!==pe||n.cardinality(e)<=r.maxCardinalityForFacet},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[rt.CHANNEL,rt.FIELD,rt.BIN,rt.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t,r)=>e.channel!==Ae||n.cardinality(e)<=r.maxCardinalityForShape},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[rt.TYPE,rt.SCALE,Zn("scale","type"),rt.TIMEUNIT,rt.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>{if(e.scale){const n=e.type,t=Ur(e);if(tr(n))return void 0===t||En(t);if(n===mn)return e.timeUnit?Un([pn.TIME,pn.UTC,void 0],t)||En(t):Un([pn.TIME,pn.UTC,void 0],t);if(n===un)return e.bin?Un([pn.LINEAR,void 0],t):Un([pn.LOG,pn.POW,pn.SQRT,pn.QUANTILE,pn.QUANTIZE,pn.LINEAR,void 0],t)}return!0}},{name:"stackIsOnlyUsedWithXY",description:"stack should only be allowed for x and y channels",properties:[rt.STACK,rt.CHANNEL],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>!e.stack||(e.channel===ge||e.channel===ye)}].map((e=>new _o(e)));Po.reduce(((e,n)=>(e[n.name()]=n,e)),{});const Ro=Po.reduce(((e,n)=>{for(const t of n.properties())e.set(t,e.get(t)||[]),e.get(t).push(n);return e}),new rr),$o=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, order, and detail should not work with constant values.",properties:[rt.TYPE,rt.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t,r)=>!Un(["row","column","x","y","detail","order"],e.channel)}].map((e=>new _o(e)));$o.reduce(((e,n)=>(e[n.name()]=n,e)),{});const qo=$o.reduce(((e,n)=>{for(const t of n.properties())e.set(t,e.get(t)||[]),e.get(t).push(n);return e}),new rr);const Bo=We.reduce(((e,n)=>(e[n]=!0,e)),{});class Lo extends jo{constructor(e){super(e)}hasAllRequiredPropertiesSpecific(e){return Fn(this.constraint.properties,(n=>{if(n===rt.MARK)return!Dt(e.getMark());if(Pn(n)){let t=n.parent,r=n.child;return Fn(e.getEncodings(),(e=>!e[t]||!Dt(e[t][r])))}if(!et(n))throw new Error("UNIMPLEMENTED");return Fn(e.getEncodings(),(e=>!e[n]||!Dt(e[n])))}))}satisfy(e,n,t){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,n,t)}}const Vo=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[rt.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:(e,n,t)=>{let r={};return Fn(e.getEncodings(),(e=>!!Dt(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)))}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[rt.MARK,rt.SCALE,Zn("scale","zero"),rt.CHANNEL,rt.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t)=>{const r=e.getMark(),i=e.getEncodings();if(r===at)for(let o of i)if(wr(o)&&(o.channel===ge||o.channel===ye)&&o.type===un&&o.scale&&!1===o.scale.zero)return!1;return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[rt.BIN,rt.TIMEUNIT,rt.TYPE,rt.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>{if(_n(e.getEncodings(),(e=>Sr(e))))return Fn(e.getEncodings(),(e=>{if(Er(e))return!0;if(Tr(e))return!0;switch(e.type){case un:return!!e.bin;case mn:return!!e.timeUnit;case dn:case er.KEY:case fn:return!0}throw new Error("Unsupported Type")}));if(Fn(e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],(n=>{let t=e.getEncodingQueryByIndex(n);return Tr(t)&&!Dt(t.autoCount)})))return _n(e.getEncodings(),(e=>(wr(e)||Tr(e))&&e.type===un?!Cr(e)&&(wr(e)&&(!e.bin||Dt(e.bin))):!(!wr(e)||e.type!==mn)&&(!e.timeUnit||Dt(e.timeUnit))));return!0}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[rt.CHANNEL,rt.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:(e,n,t)=>{const r=e.getMark();return!!Dt(r)||Fn(e.getEncodings(),(e=>!!Dt(e.channel)||!!ze(e.channel,r)))}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[rt.CHANNEL,rt.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t)=>{const r=e.getMark();switch(r){case ot:case st:return e.channelUsed(ge)&&e.channelUsed(ye);case dt:return e.channelUsed(Ue);case at:case ft:case pt:case mt:case ut:case ct:return e.channelUsed(ge)||e.channelUsed(ye);case lt:return!e.wildcardIndex.hasProperty(rt.CHANNEL)||e.channelUsed(ge)||e.channelUsed(ye)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>!e.isAggregate()},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"Omit aggregate plots with dimensions only on facets as that leads to inefficient use of space.",properties:[rt.CHANNEL,rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>{if(e.isAggregate()){let n=!1,r=!1,i=!1;if(e.specQuery.encodings.forEach(((t,o)=>{Er(t)||Cr(t)||wr(t)&&!t.aggregate&&(r=!0,Un([fe,pe],t.channel)?e.wildcardIndex.hasEncodingProperty(o,rt.CHANNEL)&&(i=!0):n=!0)})),r&&!n&&(i||t.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[rt.AGGREGATE,rt.AUTOCOUNT,rt.BIN,rt.TIMEUNIT,rt.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>!e.isAggregate()||_n(e.getEncodings(),(e=>!!(Ir(e)||wr(e)&&"temporal"===e.type)))},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[rt.MARK,rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>!Un([at,st,ot],e.getMark())||e.isAggregate()},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[rt.CHANNEL,rt.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>{const r=e.getMark();if(Un([mt,at],r)&&e.channelEncodingField(ke)){if(t.constraintManuallySpecifiedValue)return!1;{const n=e.specQuery.encodings;for(let t=0;t<n.length;t++){if(n[t].channel===ke)return!e.wildcardIndex.hasEncodingProperty(t,rt.CHANNEL)}}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[rt.MARK,rt.CHANNEL,rt.SCALE,Zn("scale","type"),rt.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t)=>{const r=e.getMark(),i=e.getEncodings();if(r===ot||r===at)for(let o of i)if(wr(o)&&(o.channel===ge||o.channel===ye)&&o.scale){if(Ur(o)===pn.LOG)return!1}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[rt.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>{const r=e.specQuery.encodings;let i=0,o=!1;for(let a=0;a<r.length;a++){const n=r[a];if(Er(n)||Cr(n))continue;const s=n.channel;if(!Dt(s)&&Bo[s+""]&&(i+=1,e.wildcardIndex.hasEncodingProperty(a,rt.CHANNEL)&&(o=!0),i>1&&(o||t.constraintManuallySpecifiedValue)))return!1}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[rt.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>{const r=e.specQuery.encodings;let i=!1,o=!1,a=!1,s=!1;for(let l=0;l<r.length;l++){const n=r[l];if(Er(n)||Cr(n))continue;const t=n.channel;t===ge?a=!0:t===ye?s=!0:Dt(t)||(i=!0,e.wildcardIndex.hasEncodingProperty(l,rt.CHANNEL)&&(o=!0))}return!(o||t.constraintManuallySpecifiedValue&&i)||a&&s}},{name:"omitRaw",description:"Omit raw plots.",properties:[rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>!!e.isAggregate()},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[rt.AGGREGATE,rt.AUTOCOUNT,rt.TIMEUNIT,rt.BIN,rt.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>{if(e.isAggregate()){const n=e.specQuery.encodings;for(let r=0;r<n.length;r++){const i=n[r];if(!Er(i)&&!Cr(i)){if(wr(i)&&i.type===mn&&!i.timeUnit&&(e.wildcardIndex.hasEncodingProperty(r,rt.TIMEUNIT)||t.constraintManuallySpecifiedValue))return!1;if(i.type===un&&wr(i)&&!i.bin&&!i.aggregate){if(e.wildcardIndex.hasEncodingProperty(r,rt.BIN)||e.wildcardIndex.hasEncodingProperty(r,rt.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(r,rt.AUTOCOUNT))return!1;if(t.constraintManuallySpecifiedValue)return!1}}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[rt.CHANNEL,rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t)=>!!e.isAggregate()||Fn(e.specQuery.encodings,((n,r)=>!(!Er(n)&&!Cr(n))||(n.channel!==je||!e.wildcardIndex.hasEncodingProperty(r,rt.CHANNEL)&&!t.constraintManuallySpecifiedValue)))},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[rt.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>{let r={},i={};const o=e.specQuery.encodings;for(let a=0;a<o.length;a++){const n=o[a];if(Er(n)||Tr(n))continue;let s;if(n.field&&!Dt(n.field)&&(s=n.field),Tr(n)&&!Dt(n.autoCount)&&(s="count_*"),s){if(e.wildcardIndex.hasEncodingProperty(a,rt.FIELD)&&(i[s]=!0),r[s]&&(i[s]||t.constraintManuallySpecifiedValue))return!1;r[s]=!0}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[rt.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:(e,n,t)=>{const r=e.getEncodings();return 1!==r.length||r[0].channel!==ye}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[rt.CHANNEL,rt.MARK,rt.TYPE,rt.TIMEUNIT,rt.BIN,rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>{const r=e.getMark();switch(r){case ot:case st:if(e.isAggregate()){const n=e.getEncodingQueryByChannel(ge),t=e.getEncodingQueryByChannel(ye),r=Mr(n),i=Mr(t);return n&&t&&r!==i&&!(wr(n)&&!r&&Un(["nominal","key"],n.type))&&!(wr(t)&&!i&&Un(["nominal","key"],t.type))}return!0;case dt:return!0;case at:case mt:if(e.channelEncodingField(ke))return!1;{const n=e.getEncodingQueryByChannel(ge),t=e.getEncodingQueryByChannel(ye);return Mr(n)!==Mr(t)}case ct:const n=e.getEncodingQueryByChannel(ge),t=e.getEncodingQueryByChannel(ye),r=Ir(n),i=Ir(t),o=e.getEncodingQueryByChannel(Te),a=Mr(o),s=!!wr(o)&&o.type===dn;return(r&&i||r&&!e.channelUsed(ye)||i&&!e.channelUsed(ge))&&(!o||o&&(a||s));case ft:case lt:case pt:case ut:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitInvalidStackSpec",description:"If stack is specified, must follow Vega-Lite stack rules",properties:[rt.STACK,rt.FIELD,rt.CHANNEL,rt.MARK,rt.AGGREGATE,rt.AUTOCOUNT,rt.SCALE,Zn("scale","type"),rt.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t)=>{if(!e.wildcardIndex.hasProperty(rt.STACK))return!0;const r=e.getVlStack();return(null!==r||null===e.getStackOffset())&&r.fieldChannel===e.getStackChannel()}},{name:"omitNonSumStack",description:"Stack specifications that use non-summative aggregates should be omitted (even implicit ones)",properties:[rt.CHANNEL,rt.MARK,rt.AGGREGATE,rt.AUTOCOUNT,rt.SCALE,Zn("scale","type"),rt.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,n,t)=>{const r=e.getVlStack();if(null!=r){const n=e.getEncodingQueryByChannel(r.fieldChannel);if(!Un(Lt,n.aggregate))return!1}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[rt.CHANNEL,rt.TYPE,rt.TIMEUNIT,rt.BIN,rt.AGGREGATE,rt.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,n,t)=>{if(t.autoAddCount){const n=e.getEncodingQueryByChannel("x"),t=e.getEncodingQueryByChannel("y");if((!wr(n)||Ir(n))&&(!wr(t)||Ir(t)))return!!e.isAggregate()&&Fn(e.getEncodings(),(e=>{let n=e.channel;return!(n!==ge&&n!==ye&&n!==fe&&n!==pe&&wr(e)&&!e.aggregate)}))}return!0}}].map((e=>new Lo(e)));Vo.reduce(((e,n)=>(e[n.name()]=n,e)),{});const Wo=Vo.reduce(((e,n)=>{for(const t of n.properties())e.set(t,e.get(t)||[]),e.get(t).push(n);return e}),new rr);function Ho(e,n,t,r,i){const o=Wo.get(e)||[];for(const a of o)if(a.strict()||i[a.name()]){if(!a.satisfy(t,r,i)){let e="(spec) "+a.name();return i.verbose&&console.log(e+" failed with "+t.toShorthand()+" for "+n.name),e}}return null}const Go=new rr;function zo(e){return(n,t,r)=>(i,o)=>{const a=n.encodingIndicesByProperty.get(e);return function s(l){if(l===a.length)return void i.push(o.duplicate());const c=a[l],u=n.encodings[c].get(e),d=o.getEncodingQueryByIndex(c),m=o.getEncodingProperty(c,e);Er(d)||Cr(d)||!m?s(l+1):(u.enum.forEach((n=>{null===n&&(n=void 0),o.setEncodingProperty(c,e,n,u);const i=function(e,n,t,r,i,o){const a=Ro.get(e)||[],s=r.getEncodingQueryByIndex(t);for(const c of a)if((c.strict()||o[c.name()])&&!c.satisfy(s,i,r.wildcardIndex.encodings[t],o)){let e="(enc) "+c.name();return o.verbose&&console.log(e+" failed with "+r.toShorthand()+" for "+n.name),e}const l=qo.get(e)||[];for(const c of l)if((c.strict()||o[c.name()])&&Er(s)&&!c.satisfy(s,i,r.wildcardIndex.encodings[t],o)){let e="(enc) "+c.name();return o.verbose&&console.log(e+" failed with "+r.toShorthand()+" for "+n.name),e}return null}(e,u,c,o,t,r);if(i)return;Ho(e,u,o,t,r)||s(l+1)})),o.resetEncodingProperty(c,e,u))}(0),i}}function Yo(e,n,t){return n=n||new rr,t=t||new rr,e.forEach((e=>{var r;r=e,In.isObject(r)&&r.property?(n.setByKey(e.property,!0),t.setByKey(e.property,e.replace)):n.setByKey(e,!0)})),{include:n,replaceIndex:t,replacer:dr(t)}}Go.set("mark",((e,n,t)=>(r,i)=>(i.getMark().enum.forEach((o=>{i.setMark(o);Ho("mark",e.mark,i,n,t)||r.push(i.duplicate())})),i.resetMark(),r))),$n.forEach((e=>{Go.set(e,zo(e))})),Yn.forEach((e=>{Go.set(e,zo(e))}));const Qo=[rt.FIELD,rt.TYPE,rt.AGGREGATE,rt.BIN,rt.TIMEUNIT,rt.STACK],Ko=Qo.concat([{property:rt.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}]);let Jo={};function Xo(e,n){Jo[e]=n}const Zo=Yo([rt.FIELD]);Xo("field",(e=>yr(e,Zo.include,Zo.replacer)));const ea=Yo(Qo);Xo("fieldTransform",(e=>yr(e,ea.include,ea.replacer)));const na=Yo(Ko);Xo("encoding",(e=>yr(e,na.include,na.replacer))),Xo("spec",(e=>JSON.stringify(e)));class ta{constructor(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new rr}setEncodingProperty(e,n,t){const r=this._encodings;(r[e]=r[e]||new rr).set(n,t);const i=this._encodingIndicesByProperty;return i.set(n,i.get(n)||[]),i.get(n).push(e),this}hasEncodingProperty(e,n){return!!this._encodings[e]&&this._encodings[e].has(n)}hasProperty(e){if(et(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)}isEmpty(){return!this.mark&&0===this.encodingIndicesByProperty.size()}setMark(e){return this._mark=e,this}get mark(){return this._mark}get encodings(){return this._encodings}get encodingIndicesByProperty(){return this._encodingIndicesByProperty}}class ra{constructor(e,n,t,r,i){this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(((e,n)=>(Dt(n.channel)||Tr(n)&&!1===n.autoCount||(e[n.channel+""]=1),e)),{}),this._wildcardIndex=n,this._assignedWildcardIndex=i,this._opt=r,this._schema=t}static build(e,n,t){let r=new ta;if(Dt(e.mark)){const n=Ft(rt.MARK);e.mark=Mt(e.mark,n,t.enum.mark),r.setMark(e.mark)}if(e.encodings.forEach(((e,i)=>{Tr(e)&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=un),wr(e)&&void 0===e.type&&(e.type=kt),$n.forEach((o=>{if(Dt(e[o])){const a=Ft(o)+i,s=$t(o,n,t),l=e[o]=Mt(e[o],a,s);r.setEncodingProperty(i,o,l)}})),Yn.forEach((o=>{const a=e[o.parent];if(a){const e=o.child;if(Dt(a[e])){const s=Ft(o)+i,l=$t(o,n,t),c=a[e]=Mt(a[e],s,l);r.setEncodingProperty(i,o,c)}}}))})),t.autoAddCount){const i={name:Ft(rt.CHANNEL)+e.encodings.length,enum:$t(rt.CHANNEL,n,t)},o={name:Ft(rt.AUTOCOUNT)+e.encodings.length,enum:[!1,!0]},a={channel:i,autoCount:o,type:un};e.encodings.push(a);const s=e.encodings.length-1;r.setEncodingProperty(s,rt.CHANNEL,i),r.setEncodingProperty(s,rt.AUTOCOUNT,o)}return new ra(e,r,n,t,{})}get wildcardIndex(){return this._wildcardIndex}get schema(){return this._schema}get specQuery(){return this._spec}duplicate(){return new ra(In.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,In.duplicate(this._assignedWildcardIndex))}setMark(e){const n=this._wildcardIndex.mark.name;this._assignedWildcardIndex[n]=this._spec.mark=e}resetMark(){const e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]}getMark(){return this._spec.mark}getEncodingProperty(e,n){const t=this._spec.encodings[e];return Pn(n)?t[n.parent][n.child]:t[n]}setEncodingProperty(e,n,t,r){const i=this._spec.encodings[e];n===rt.CHANNEL&&i.channel&&!Dt(i.channel)&&this._channelFieldCount[i.channel]--,Pn(n)?i[n.parent][n.child]=t:Ln(n)&&!0===t?i[n]=In.extend({},i[n],{enum:void 0,name:void 0}):i[n]=t,this._assignedWildcardIndex[r.name]=t,n===rt.CHANNEL&&(this._channelFieldCount[t]=(this._channelFieldCount[t]||0)+1)}resetEncodingProperty(e,n,t){const r=this._spec.encodings[e];n===rt.CHANNEL&&this._channelFieldCount[r.channel]--,Pn(n)?r[n.parent][n.child]=t:r[n]=t,delete this._assignedWildcardIndex[t.name]}channelUsed(e){return this._channelFieldCount[e]>0}channelEncodingField(e){return wr(this.getEncodingQueryByChannel(e))}getEncodings(){return this._spec.encodings.filter((e=>!Cr(e)))}getEncodingQueryByChannel(e){for(let n of this._spec.encodings)if(n.channel===e)return n}getEncodingQueryByIndex(e){return this._spec.encodings[e]}isAggregate(){return _n(this._spec.encodings,(e=>wr(e)&&!Dt(e.aggregate)&&!!e.aggregate||Sr(e)))}getVlStack(){return cr(this._spec)}getStackOffset(){return function(e){for(const n of e.encodings)if(void 0!==n[rt.STACK]&&!Dt(n[rt.STACK]))return n[rt.STACK]}(this._spec)}getStackChannel(){return function(e){for(const n of e.encodings)if(void 0!==n[rt.STACK]&&!Dt(n.channel))return n.channel;return null}(this._spec)}toShorthand(e){if(e){if(In.isString(e))return function(e,n){return Jo[n](e)}(this.specQuery,e);const n=Yo(e);return yr(this._spec,n.include,n.replacer)}return yr(this._spec)}toSpec(e){if(Dt(this._spec.mark))return null;let n={};return(e=e||this._spec.data)&&(n.data=e),this._spec.transform&&(n.transform=this._spec.transform),n.mark=this._spec.mark,n.encoding=kr(this.specQuery.encodings,{schema:this._schema,wildcardMode:"null"}),this._spec.width&&(n.width=this._spec.width),this._spec.height&&(n.height=this._spec.height),this._spec.background&&(n.background=this._spec.background),this._spec.padding&&(n.padding=this._spec.padding),this._spec.title&&(n.title=this._spec.title),null===n.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(n.config=In.extend({},this._opt.defaultSpecConfig,this._spec.config)),n)}getRankingScore(e){return this._rankingScore[e]}setRankingScore(e,n){this._rankingScore[e]=n}}function ia(e){return void 0!==e.items}function oa(e){let n=e.items[0];for(;n&&ia(n);)n=n.items[0];return n}class aa{constructor(e){this.type=e,this.scoreIndex=this.initScore()}getFeatureScore(e){const n=this.type,t=this.scoreIndex[e];if(void 0!==t)return{type:n,feature:e,score:t}}}var sa,la;(la=sa||(sa={}))[la.Q=un]="Q",la[la.BIN_Q="bin_"+un]="BIN_Q",la[la.T=mn]="T",la[la.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",la[la.TIMEUNIT_O="timeUnit_"+dn]="TIMEUNIT_O",la[la.O=dn]="O",la[la.N=fn]="N",la[la.K=er.KEY]="K",la[la.NONE="-"]="NONE";const ca=sa.Q,ua=sa.BIN_Q,da=sa.T,ma=sa.TIMEUNIT_T,fa=sa.TIMEUNIT_O,pa=sa.O,ha=sa.N,ga=sa.K,ya=sa.NONE;function va(e){if(e.bin)return sa.BIN_Q;if(e.timeUnit){return En(Ur(e))?sa.TIMEUNIT_O:sa.TIMEUNIT_T}return e.type}const xa=-10;function Na(e,n,t,r){return e+"_"+n+"_"+t+"_"+r}const ba=[new class extends aa{constructor(){super("Axis")}initScore(e={}){e=Object.assign({},qt,e);let n={};return[{feature:ua,opt:"preferredBinAxis"},{feature:da,opt:"preferredTemporalAxis"},{feature:ma,opt:"preferredTemporalAxis"},{feature:fa,opt:"preferredTemporalAxis"},{feature:pa,opt:"preferredOrdinalAxis"},{feature:ha,opt:"preferredNominalAxis"}].forEach((t=>{e[t.opt]===ge?n[t.feature+"_"+ye]=-.01:e[t.opt]===ye&&(n[t.feature+"_"+ge]=-.01)})),n}featurize(e,n){return e+"_"+n}getScore(e,n,t){return e.getEncodings().reduce(((e,n)=>{if(wr(n)||Tr(n)){const t=va(n),r=this.featurize(t,n.channel),i=this.getFeatureScore(r);i&&e.push(i)}return e}),[])}},new class extends aa{constructor(){super("Dimension")}initScore(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}}getScore(e,n,t){return e.isAggregate()&&e.getEncodings().reduce(((e,n)=>{if(Tr(n)||wr(n)&&!n.aggregate){const t=this.getFeatureScore(n.channel+"");if(t&&t.score>e.score)return t}return e}),{type:"Dimension",feature:"No Dimension",score:-5}),[]}},new class extends aa{constructor(){super("Facet")}initScore(e){let n={};return(e=Object.assign({},qt,e)).preferredFacet===fe?n[pe]=-.01:e.preferredFacet===pe&&(n[fe]=-.01),n}getScore(e,n,t){return e.getEncodings().reduce(((e,n)=>{if(wr(n)||Tr(n)){const t=this.getFeatureScore(n.channel);t&&e.push(t)}return e}),[])}},new class extends aa{constructor(){super("Mark")}initScore(){return function(){const e=[ca,da],n=[ua,fa,pa,ha,ga].concat([ya]);let t={};e.forEach((n=>{e.forEach((e=>{jn({point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=Na(n,e,!0,i);t[o]=r}));jn({point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=Na(n,e,!1,i);t[o]=r}))}))})),e.forEach((e=>{n.forEach((n=>{jn({tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=Na(e,n,!0,i);t[o]=r;const a=Na(n,e,!0,i);t[a]=r}))})),[ma].forEach((n=>{jn({point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=Na(e,n,!0,i);t[o]=r;const a=Na(n,e,!0,i);t[a]=r}))})),[ya,ha,pa,ga].forEach((n=>{jn({bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5},((r,i)=>{const o=Na(e,n,!1,i);t[o]=r;const a=Na(n,e,!1,i);t[a]=r}))})),[ua].forEach((n=>{jn({bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5},((r,i)=>{const o=Na(e,n,!1,i);t[o]=r;const a=Na(n,e,!1,i);t[a]=r}))})),[ma,fa].forEach((n=>{jn({line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5},((r,i)=>{const o=Na(e,n,!1,i);t[o]=r;const a=Na(n,e,!1,i);t[a]=r}))}))})),[ma].forEach((e=>{[ma].forEach((n=>{const r={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};jn(r,((r,i)=>{const o=Na(e,n,!0,i);t[o]=r})),jn(r,((r,i)=>{const o=Na(e,n,!1,i);t[o]=r}))})),n.forEach((n=>{const r={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};jn(r,((r,i)=>{const o=Na(e,n,!0,i);t[o]=r})),jn(r,((r,i)=>{const o=Na(n,e,!0,i);t[o]=r})),jn(r,((r,i)=>{const o=Na(e,n,!1,i);t[o]=r})),jn(r,((r,i)=>{const o=Na(n,e,!1,i);t[o]=r}))}))}));for(const r of n)for(const e of n){const n={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};jn(n,((n,i)=>{const o=Na(r,e,!0,i);t[o]=n})),jn(n,((n,i)=>{const o=Na(r,e,!1,i);t[o]=n}))}return t}()}getScore(e,n,t){let r=e.getMark();r!==ft&&r!==pt||(r=lt);const i=e.getEncodingQueryByChannel(ge),o=i?va(i):ya,a=e.getEncodingQueryByChannel(ye),s=o+"_"+(a?va(a):ya)+"_"+!e.isAggregate()+"_"+r,l=this.getFeatureScore(s);return l?[l]:(console.error("feature score missing for",s),[])}},new class extends aa{constructor(){super("SizeChannel")}initScore(){return{bar_size:-2,tick_size:-2}}getScore(e,n,t){const r=e.getMark();return e.getEncodings().reduce(((e,n)=>{if(wr(n)||Tr(n)){const t=r+"_"+n.channel,i=this.getFeatureScore(t);i&&e.push(i)}return e}),[])}},new class extends aa{constructor(){super("TypeChannel")}initScore(){let e={};const n={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:xa,row:xa,column:xa,detail:-20};[ca,da,ma].forEach((t=>{In.keys(n).forEach((r=>{e[this.featurize(t,r)]=n[r]}))}));const t=In.extend({},n,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[ua,fa,pa].forEach((n=>{In.keys(t).forEach((r=>{e[this.featurize(n,r)]=t[r]}))}));const r={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return In.keys(r).forEach((n=>{e[this.featurize(ha,n)]=r[n],e[this.featurize(ga,n)]=Un(["x","y","detail"],n)?-1:r[n]-2})),e}featurize(e,n){return e+"_"+n}getScore(e,n,t){const r=e.getEncodings().reduce(((e,n)=>{if(wr(n)||Tr(n)){const t=xr(n);(e[t]=e[t]||[]).push(n)}return e}),{}),i=[];return jn(r,(e=>{const n=e.reduce(((e,n)=>{if(wr(n)||Tr(n)){const t=va(n),r=this.featurize(t,n.channel),i=this.getFeatureScore(r);if(null===e||i.score>e.score)return i}return e}),null);i.push(n)})),i}}];const Ea="aggregationQuality";let wa={};function Ta(e,n){wa[e]=n}function Ca(e,n,t,r){return n.nest&&r!==n.nest.length?(e.items.forEach((e=>{Ca(e,n,t,r+1)})),n.nest[r].orderGroupBy&&e.items.sort(function(e,n,t){return(r,i)=>{const o=oa(r),a=oa(i);return Sa(e instanceof Array?e:[e],o,a,n,t)}}(n.nest[r].orderGroupBy,t,n.config))):(n.orderBy||n.chooseBy)&&(e.items.sort(function(e,n,t){return(r,i)=>Sa(e instanceof Array?e:[e],r,i,n,t)}(n.orderBy||n.chooseBy,t,n.config)),n.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function Sa(e,n,t,r,i){for(let o of e){let e=Aa(t,o,r,i).score-Aa(n,o,r,i).score;if(0!==e)return e}return 0}function Aa(e,n,t,r){if(void 0!==e.getRankingScore(n))return e.getRankingScore(n);const i=function(e){return wa[e]}(n),o=i(e,t,r);return e.setRankingScore(n,o),o}function ka(e,n,t){let r={};return e=e.map((function(e){return t.smallRangeStepForHighCardinalityOrFacet&&(e=function(e,n,t,r){[fe,ye,pe,ge].forEach((n=>{t[n]=e.getEncodingQueryByChannel(n)}));const i=t[ye];if(void 0!==i&&wr(i)&&(t[fe]||n.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});const e=Ur(i);i.scale&&(void 0===e||En(e))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}const o=t[ge];if(wr(o)&&(t[pe]||n.cardinality(o)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===o.scale&&(o.scale={});const e=Ur(o);o.scale&&(void 0===e||En(e))&&(o.scale.rangeStep||(o.scale.rangeStep=12))}return e}(e,n,r,t)),t.nominalColorScaleForHighCardinality&&(e=function(e,n,t,r){t[Te]=e.getEncodingQueryByChannel(Te);const i=t[Te];wr(i)&&void 0!==i&&(i.type===fn||i.type===er.KEY)&&n.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.scheme=r.nominalColorScaleForHighCardinality.palette)));return e}(e,n,r,t)),t.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=function(e,n,t,r){if([pe,ge,ye].forEach((n=>{t[n]=e.getEncodingQueryByChannel(n)})),void 0===t[pe]){const e=t[ge],i=t[ye];wr(e)&&wr(i)&&void 0!==i&&i.field&&En(Ur(i))&&void 0!==e&&n.cardinality(i)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===e.axis&&(e.axis={}),e.axis&&!e.axis.orient&&(e.axis.orient="top"))}return e}(e,n,r,t)),e})),e}function Da(e,n,t=qt){const r=ra.build(e,n,t),i=r.wildcardIndex;let o=[r];return t.propertyPrecedence.forEach((e=>{const r=function(e){const n=e.split(Kn);if(1===n.length)return e;if(2===n.length)return{parent:n[0],child:n[1]};throw"Invalid property key with "+n.length+" dots: "+e}(e);if(i.hasProperty(r)){const e=function(e){return Go.get(e)}(r),a=e(i,n,t);o=o.reduce(a,[])}})),!t.stylize||null===t.nominalColorScaleForHighCardinality&&null===t.smallRangeStepForHighCardinalityOrFacet&&null===t.xAxisOnTopForHighYCardinalityWithoutColumn?o:ka(o,n,t)}function Oa(e,n,t){const r=function(e,n){if(n){const t={name:"",path:"",items:[]};let r={},i=[],o=[],a=[];for(let e=0;e<n.length;e++){i.push(e>0?i[e-1].duplicate():new rr),o.push(e>0?o[e-1].duplicate():new rr);const t=n[e].groupBy;if(In.isArray(t)){let n=Yo(t,i[e],o[e]);a.push(n.replacer)}}return e.forEach((e=>{let o="",s=t;for(let t=0;t<n.length;t++){const l=s.groupBy=n[t].groupBy;s.orderGroupBy=n[t].orderGroupBy;const c=In.isArray(l)?yr(e.specQuery,i[t],a[t]):Jo[l](e.specQuery);o+="/"+c,r[o]||(r[o]={name:c,path:o,items:[]},s.items.push(r[o])),s=r[o]}s.items.push(e)})),t}return{name:"",path:"",items:e}}(Da((e=Object.assign({},function(e){if(e.groupBy){let n={groupBy:e.groupBy};e.orderBy&&(n.orderGroupBy=e.orderBy);let t={spec:In.duplicate(e.spec),nest:[n]};return e.chooseBy&&(t.chooseBy=e.chooseBy),e.config&&(t.config=e.config),t}return In.duplicate(e)}(e),{config:Object.assign({},qt,t,e.config)})).spec,n,e.config),e.nest);return{query:e,result:Ca(r,e,n,0)}}Ta("effectiveness",(function(e,n,t){const r=ba.reduce(((r,i)=>{const o=i.getScore(e,n,t);return r.concat(o)}),[]);return{score:r.reduce(((e,n)=>e+n.score),0),features:r}})),Ta(Ea,(function(e,n,t){const r=function(e,n,t){const r=e.getEncodings();if(e.isAggregate()){if(_n(r,(e=>wr(e)&&(e.type===un&&!e.bin&&!e.aggregate||e.type===mn&&!e.timeUnit))))return{type:Ea,score:.1,feature:"Aggregate with raw continuous"};if(_n(r,(e=>wr(e)&&Ir(e)))){let e=_n(r,(e=>wr(e)&&"count"===e.aggregate||Sr(e))),n=_n(r,(e=>wr(e)&&!!e.bin));return e?{type:Ea,score:.8,feature:"Aggregate with count"}:n?{type:Ea,score:.7,feature:"Aggregate with bin but without count"}:{type:Ea,score:.9,feature:"Aggregate without count and without bin"}}return{type:Ea,score:.3,feature:"Aggregate without dimension"}}return _n(r,(e=>wr(e)&&!Ir(e)))?{type:Ea,score:1,feature:"Raw with measure"}:{type:Ea,score:.2,feature:"Raw without measure"}}(e);return{score:r.score,features:[r]}})),Ta("fieldOrder",(function(e,n,t){const r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};const i=e.specQuery.encodings,o=n.fieldSchemas.length,a=[];let s=0,l=1;for(let c=r.length-1;c>=0;c--){const t=r[c],u=i[t];let d;if(!wr(u))continue;d=u.field;const m=e.wildcardIndex.encodings[t].get("field"),f=n.fieldSchema(d).index,p=-f*l;s+=p,a.push({score:p,type:"fieldOrder",feature:`field ${m.name} is ${d} (#${f} in the schema)`}),l*=o}return{score:s,features:a}}));const Ma={[Uo.BOOLEAN]:r.jsxDEV(i,{className:"h-5 w-5 inline-flex opacity-60"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/icons.tsx",lineNumber:16,columnNumber:5},void 0),[Uo.DATETIME]:r.jsxDEV(o,{className:"h-5 w-5 inline-flex opacity-60"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/icons.tsx",lineNumber:19,columnNumber:5},void 0),[Uo.NUMBER]:r.jsxDEV(q,{className:"h-5 w-5 inline-flex opacity-60"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/icons.tsx",lineNumber:22,columnNumber:5},void 0),[Uo.STRING]:r.jsxDEV(V,{className:"h-5 w-5 inline-flex opacity-60"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/icons.tsx",lineNumber:25,columnNumber:5},void 0),[Uo.INTEGER]:r.jsxDEV(L,{className:"h-5 w-5 inline-flex opacity-60"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/icons.tsx",lineNumber:28,columnNumber:5},void 0)};function Ia(e){const{type:n,limit:t,additionalFieldQuery:r}=e;return{type:n,limit:t,createQuery:e=>({spec:{...e.spec,encodings:[...e.spec.encodings,r]},groupBy:"field",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!0}})}}const Ua=Ia({type:"addCategoricalField",limit:4,additionalFieldQuery:{channel:kt,field:kt,type:"nominal"}}),Fa=Ia({type:"addQuantitativeField",limit:4,additionalFieldQuery:{channel:kt,bin:kt,aggregate:kt,field:kt,type:"quantitative"}}),ja=Ia({type:"addTemporalField",limit:2,additionalFieldQuery:{channel:kt,hasFn:!0,timeUnit:kt,field:kt,type:"temporal"}});function _a(e){return e?"bin"===e?{bin:!0}:j(e)?{aggregate:e}:function(e){if(!e)return!1;return Ra.includes(e)||$a.includes(e)}(e)?{timeUnit:e}:{}:{}}const Pa=["bin","min","max","mean","median","sum"],Ra=["year","month","date","day","hours","minutes","seconds","milliseconds"],$a=["yearmonth","yearmonthdate","monthdate"];function qa(e){const n={};for(const t in e)void 0!==e[t]&&(n[t]=e[t]);return n}function Ba(e){const{aggregate:n,bin:t,timeUnit:r,field:i,scale:o,legend:l,axis:c,sort:u,description:d}=e;let{type:m}=e;if(Dt(m))throw new Error("Wildcard not support");"ordinal"===m&&(a.warn("Ordinal type is not supported. Using nominal type instead."),m="nominal");const f=function(e){const{aggregate:n,bin:t,timeUnit:r}=e;return t?"bin":n?n.toString():r?r.toString():void 0}({aggregate:n,bin:t,timeUnit:r});return s(void 0!==i,"Field is required for fieldQ"),qa({field:i,fn:f,type:m,sort:u,scale:o,axis:c,legend:l,description:d})}function La(e){return 0===e.encodings.length}function Va(e){let n=!1,t=!1,r=!1;for(const i of e.encodings)Er(i)||(Tr(i)?Dt(i.autoCount)&&(t=!0):(Dt(i.field)&&(n=!0),(Dt(i.aggregate)||Dt(i.bin)||Dt(i.timeUnit))&&(t=!0),Dt(i.channel)&&(r=!0)));return{hasAnyWildcard:r||n||t,hasWildcardField:n,hasWildcardFn:t,hasWildcardChannel:r}}function Wa(e){return{mark:e.mark,encodings:(n=e.encoding,Object.entries(n).map((([e,n])=>function(e,n){const{fn:t,...r}=e;return{channel:n,..._a(t),...r}}(n,e)))),config:e.config};var n}const Ha={name:"source"};function Ga(e,n){const t={},{hasOpenPosition:r,hasStyleChannel:i,hasOpenFacet:o}=function(e){let n=!1,t=!1,r=!1;return e.encodings.forEach((e=>{"x"===e.channel||"y"===e.channel?n=!0:"row"===e.channel||"column"===e.channel?r=!0:"string"==typeof e.channel&&_(P,e.channel)&&(t=!0)})),{hasOpenPosition:n,hasStyleChannel:t,hasOpenFacet:r}}(e.spec);return(r||i)&&(t.addQuantitativeField=Ya(Fa,e,n)),(r||i||o)&&(t.addCategoricalField=Ya(Ua,e,n)),r&&(t.addTemporalField=Ya(ja,e,n)),t}function za(e,n){if(La(e.spec))return{plots:[],query:e,limit:1};return{plots:[Qa(Oa(e,n).result,Ha)[0]],query:e,limit:1}}function Ya(e,n,t){const r=e.createQuery(n);return{plots:Qa(Oa(r,t).result,Ha),query:r,limit:e.limit}}function Qa(e,n){return e.items.map((e=>ia(e)?Ka(n,oa(e)):Ka(n,e)))}function Ka(e,n){return{fieldInfos:n.getEncodings().filter(wr).map((e=>({fieldDef:Ba(e),channel:e.channel}))),spec:n.toSpec(e)}}const Ja={type:"histograms",limit:12,createQuery:e=>({spec:{data:e.spec.data,mark:kt,transform:e.spec.transform,encodings:[{channel:kt,bin:kt,timeUnit:kt,field:kt,type:kt},{channel:kt,aggregate:"count",field:"*",type:"quantitative"}]},groupBy:"fieldTransform",orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:{autoAddCount:!1}})};const{valueAtom:Xa,useActions:Za}=l((function(){return{mark:kt,encoding:{},config:{},schema:null}}),{setSchema:(e,n)=>({...e,schema:n}),setMark:(e,n)=>({...e,mark:n}),setEncoding:(e,n)=>{const t=qa({...e.encoding,...n});return{...e,encoding:t}},set:(e,n)=>{const{schema:t,...r}=n;return{...e,...r}}});function es(){return Za()}const ns=c((e=>{const n=e(Xa);if(!n.schema)return{};const t=function(e){const{spec:n,autoAddCount:t}=e,r=Wa(n),{hasAnyWildcard:i,hasWildcardFn:o,hasWildcardField:a}=Va(r),s=function(e){const{hasWildcardFn:n,hasWildcardField:t}=e;return n?"fieldTransform":t?"field":"encoding"}({hasWildcardFn:o,hasWildcardField:a});return{spec:r,groupBy:s,orderBy:["fieldOrder","aggregationQuality","effectiveness"],chooseBy:["aggregationQuality","effectiveness"],config:i?{autoAddCount:t}:void 0}}({spec:n,autoAddCount:!0});return La(t.spec)?{main:za(t,n.schema),histograms:Ya(Ja,t,n.schema)}:function(e){return!Va(e).hasAnyWildcard}(t.spec)&&!function(e){const n=new Set(e.encodings.map((e=>e.channel))),t=["x","y","color"].every((e=>n.has(e))),r=["row","column"].some((e=>n.has(e)));return t&&r}(t.spec)?{main:za(t,n.schema),...Ga(t,n.schema)}:{main:za(t,n.schema)}})),ts=[kt,"area","bar","circle","geoshape","line","point","rect","rule","square","text","tick","trail"],rs=["x","y","row","column"],is=["color","size","shape"],os=({schema:e,mark:n})=>{const t=u(Xa),i=es(),o=t.encoding.x&&t.encoding.y,a=n=>{const a=("row"===n||"column"===n)&&!o;return r.jsxDEV(as,{schema:e,label:n,disabled:a,fieldDefinition:t.encoding[n],onChange:e=>i.setEncoding({[n]:e})},n,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:55,columnNumber:7},void 0)},s=r.jsxDEV(d,{"data-testid":"marimo-plugin-data-explorer-mark-select",value:n.toString(),onValueChange:e=>i.setMark(e),children:[r.jsxDEV(m,{children:r.jsxDEV(f,{placeholder:"Mark"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:73,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:72,columnNumber:7},void 0),r.jsxDEV(p,{children:r.jsxDEV(h,{children:[r.jsxDEV(g,{children:"Mark"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:77,columnNumber:11},void 0),ts.map((e=>r.jsxDEV(y,{value:e,children:e===kt?"auto":e},e,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:79,columnNumber:13},void 0)))]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:76,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:75,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:67,columnNumber:5},void 0);return r.jsxDEV("div",{className:"grid gap-x-2 gap-y-4 justify-items-start py-3 pl-4 pr-2 bg-[var(--slate-1)] border rounded items-center grid-template-columns-[repeat(2,_minmax(0,_min-content))] self-start",children:[r.jsxDEV("span",{className:"col-span-2 flex items-center justify-between w-full",children:r.jsxDEV("div",{className:"text-sm font-semibold",children:"Encodings"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:91,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:90,columnNumber:7},void 0),rs.map(a),r.jsxDEV("span",{className:"col-span-2 text-sm font-semibold w-full border-t border-divider flex items-center justify-between pt-2 pr-[30px]",children:[r.jsxDEV("div",{children:"Mark"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:95,columnNumber:9},void 0),s]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:94,columnNumber:7},void 0),is.map(a)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:89,columnNumber:5},void 0)},as=({label:e,schema:n,fieldDefinition:t,disabled:i,onChange:o})=>{const a=(null==t?void 0:t.field.toString())??"";return r.jsxDEV(r.Fragment,{children:[r.jsxDEV(v,{className:"text-[var(--slate-11)] font-semibold",children:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:158,columnNumber:7},void 0),r.jsxDEV("div",{className:"flex flex-row gap-1 h-[26px]",children:[r.jsxDEV(d,{value:a,disabled:i,onValueChange:e=>{o("*"===e?{field:"*",fn:"count",type:"quantitative"}:{field:e,type:n.vlType(e)})},children:[r.jsxDEV(m,{className:"min-w-[140px] lg:min-w-[210px] h-full",onClear:a?()=>{o(void 0)}:void 0,children:(()=>{if(!t)return"--";if("*"===t.field)return r.jsxDEV("span",{className:"flex gap-2 flex-1",children:[Ma[Uo.NUMBER],r.jsxDEV("span",{className:"text-left flex-1",children:"Count"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:128,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:126,columnNumber:9},void 0);const e=t.field.toString();return r.jsxDEV("span",{className:"flex gap-2 flex-1",children:[Ma[n.primitiveType(e)],r.jsxDEV("span",{className:"text-left flex-1",children:t.fn?`${t.fn}(${t.field})`:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:145,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:143,columnNumber:7},void 0)})()},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:178,columnNumber:11},void 0),r.jsxDEV(p,{children:r.jsxDEV(h,{children:[n.fieldNames().map((e=>r.jsxDEV(y,{value:e.toString(),children:r.jsxDEV("span",{className:"flex items-center gap-2 flex-1",children:[Ma[n.primitiveType(e)],r.jsxDEV("span",{className:"flex-1",children:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:191,columnNumber:23},void 0),r.jsxDEV("span",{className:"text-muted-foreground text-xs font-semibold",children:["(",n.vlType(e),")"]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:192,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:189,columnNumber:21},void 0)},e,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:188,columnNumber:19},void 0))),0===n.fieldNames().length&&r.jsxDEV(y,{disabled:!0,value:"--",children:"No columns"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:200,columnNumber:17},void 0),r.jsxDEV(x,{},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:204,columnNumber:15},void 0),r.jsxDEV(y,{value:"*",children:r.jsxDEV("span",{className:"flex items-center gap-1 flex-1",children:[Ma[Uo.NUMBER],r.jsxDEV("span",{className:"flex-1",children:"Count"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:208,columnNumber:19},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:206,columnNumber:17},void 0)},"*",!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:205,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:185,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:184,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:160,columnNumber:9},void 0),r.jsxDEV("div",{className:"w-[26px]",children:t&&r.jsxDEV(ls,{field:t,onChange:o},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:216,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:214,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:159,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:157,columnNumber:5},void 0)},ss="__",ls=({field:e,onChange:n})=>{if("*"===e.field)return null;let t=[];return e.type===er.QUANTITATIVE&&(t=[["",Pa]]),e.type===er.TEMPORAL&&(t=[["Single",Ra],["Multi",$a]]),t.length>0?r.jsxDEV(d,{"data-testid":"marimo-plugin-data-explorer-field-options",value:e.fn,onValueChange:t=>{n({...e,fn:t===ss?void 0:t})},children:[r.jsxDEV(m,{className:"h-full px-1",hideChevron:!0,variant:"ghost",children:r.jsxDEV(N,{size:14,strokeWidth:1.5},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:270,columnNumber:11},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:265,columnNumber:9},void 0),r.jsxDEV(p,{children:[r.jsxDEV(h,{children:r.jsxDEV(y,{value:ss,children:"None"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:274,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:273,columnNumber:11},void 0),r.jsxDEV(x,{},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:276,columnNumber:11},void 0),t.map((([e,n])=>r.jsxDEV(h,{children:[e&&r.jsxDEV(g,{children:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:280,columnNumber:27},void 0),n.map((e=>r.jsxDEV(y,{value:e??ss,children:b(e)},e,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:282,columnNumber:19},void 0)))]},e,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:279,columnNumber:15},void 0)))]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:272,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/query-form.tsx",lineNumber:255,columnNumber:7},void 0):null},cs=({schema:e})=>{const[n,t]=E.useState(),[i,o]=E.useState(),a=e.fieldNames(),s=n?e.stats({field:n,channel:"x"}):void 0,l=r.jsxDEV($,{className:"text-muted-foreground",width:40,height:40,strokeWidth:1.5},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:37,columnNumber:5},void 0),c=i?a:a.slice(0,12),u=a.length>12;return r.jsxDEV("div",{className:"flex flex-col justify-center items-center h-full flex-1 gap-2",children:[l,r.jsxDEV("span",{className:"text-muted-foreground font-semibold",children:[a.length>0?a.length:"No"," fields"]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:51,columnNumber:7},void 0),r.jsxDEV("div",{className:"hidden lg:grid grid-cols-2 xl:grid-cols-3 gap-2 p-2 bg-[var(--slate-1)] border rounded lg:items-center items-start w-fit grid-flow-dense max-h-[300px] overflow-auto",children:[c.map((i=>{const o=e.cardinality({channel:"x",field:i});return r.jsxDEV("span",{className:w("hover:bg-muted self-start px-2 py-2 rounded flex flex-row gap-1 items-center cursor-pointer lg:justify-center text-sm truncate flex-shrink-0 overflow-hidden",n===i&&"bg-muted"),onClick:()=>{t(n!==i?i:void 0)},children:[Ma[e.primitiveType(i)],i,o>1&&r.jsxDEV("span",{className:"text-xs text-muted-foreground",children:["(",o,")"]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:78,columnNumber:17},void 0)]},i,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:61,columnNumber:13},void 0)})),u&&r.jsxDEV(T,{"data-testid":"marimo-plugin-data-explorer-show-more-columns",variant:"link",size:"sm",className:"self-center col-span-3 -mt-1",onClick:()=>o((e=>!e)),children:i?"Show less":"Show more"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:86,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:54,columnNumber:7},void 0),r.jsxDEV("div",{className:"lg:hidden",children:r.jsxDEV(d,{"data-testid":"marimo-plugin-data-explorer-column-select",value:n||"",disabled:0===a.length,onValueChange:e=>{t(e)},children:[r.jsxDEV(m,{className:"min-w-[210px] h-full",children:r.jsxDEV(f,{placeholder:"Select a column"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:107,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:106,columnNumber:11},void 0),r.jsxDEV(p,{children:r.jsxDEV(h,{children:e.fieldNames().map((n=>r.jsxDEV(y,{value:n.toString(),children:r.jsxDEV("span",{className:"flex items-center gap-2 flex-1",children:[Ma[e.primitiveType(n)],r.jsxDEV("span",{className:"flex-1",children:n},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:116,columnNumber:23},void 0),r.jsxDEV("span",{className:"text-muted-foreground text-xs font-semibold",children:["(",e.vlType(n),")"]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:117,columnNumber:23},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:114,columnNumber:21},void 0)},n,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:113,columnNumber:19},void 0)))},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:110,columnNumber:13},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:109,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:98,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:97,columnNumber:7},void 0),n&&r.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-2 p-2 text-sm",children:us.map((e=>r.jsxDEV("div",{className:"flex flex-row gap-2 min-w-[100px]",children:[r.jsxDEV("span",{className:"font-semibold",children:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:132,columnNumber:15},void 0),r.jsxDEV("span",{children:ds(null==s?void 0:s[e])},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:133,columnNumber:15},void 0)]},e,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:131,columnNumber:13},void 0)))},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:129,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/components/column-summary.tsx",lineNumber:49,columnNumber:5},void 0)},us=["distinct","min","max","mean","median","q1","q3","stdev"];function ds(e){return"number"==typeof e?new Intl.NumberFormat("en-US",{maximumFractionDigits:2}).format(e):"string"==typeof e?e:"object"==typeof e&&e instanceof Date?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(e):String(e)}const ms=e=>{const n=E.useMemo((()=>C()),[]);return S((()=>{const t=n.sub(Xa,(()=>{const t=n.get(Xa),{schema:r,...i}=t;e.setValue(i)})),r=e.value;return r&&Object.keys(r).length>0&&n.set(Xa,r),t})),r.jsxDEV(A,{store:n,children:r.jsxDEV(hs,{...e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:61,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:60,columnNumber:5},void 0)},fs={export:{svg:!0,png:!0},source:!1,compiled:!1,editor:!1},ps={left:20,right:20,top:20,bottom:20},hs=({data:e})=>{var n,t,i,o,a,s;const l=es(),{data:c,loading:d,error:m}=k((async()=>{if(!e)return{};const n=await F(e,{type:"csv",parse:"auto"},{replacePeriod:!0}),t=function(e,n={},t={fields:[]}){n=In.extend({},qt,n);let r=So.summary(e),i=Eo.inferAll(e),o=t.fields.reduce(((e,n)=>(e[n.name]=n,e)),{}),a=r.map((function(t,r){const a=t.field,s="date"===i[a]?Uo.DATETIME:i[a];let l,c=t.distinct;if(s===Uo.NUMBER)l=un;else if(s===Uo.INTEGER)l=c<n.numberNominalLimit&&c/t.count<n.numberNominalProportion?fn:un;else if(s===Uo.DATETIME){l=mn,t.min=new Date(e[0][a]),t.max=new Date(e[0][a]);for(const n of e){const e=new Date(n[a]).getTime();e<t.min.getTime()&&(t.min=new Date(e)),e>t.max.getTime()&&(t.max=new Date(e))}}else l=fn;l===fn&&c/t.count>n.minPercentUniqueForKey&&t.count>n.minCardinalityForKey&&(l=er.KEY);let u={name:a,originalIndex:r,vlType:l,type:s,stats:t,timeStats:{},binStats:{}};const d=o[u.name];return u=In.extend(u,d),u}));for(let l of a)if(l.vlType===un)for(let e of n.enum.binProps.maxbins)l.binStats[e]=Oo(e,l.stats);else if(l.vlType===mn)for(let e of n.enum.timeUnit)void 0!==e&&(l.timeStats[e]=Mo(e,l.stats));const s=Object.assign({},t,{fields:a});return new Do(s)}(n);return l.setSchema(t),{chartData:n,schema:t}}),[e]),{mark:f}=u(Xa),p=u(ns);if(m)return r.jsxDEV(D,{error:m},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:109,columnNumber:12},void 0);if(!c)return r.jsxDEV("div",{},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:112,columnNumber:12},void 0);const{chartData:h,schema:g}=c;if(d||!g)return r.jsxDEV("div",{},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:116,columnNumber:12},void 0);const y=null==(t=null==(n=p.main)?void 0:n.plots)?void 0:t[0],v=new Set(null==y?void 0:y.fieldInfos.map((e=>e.fieldDef.field)));return r.jsxDEV("div",{className:"flex flex-col gap-2",children:[r.jsxDEV("div",{className:"flex items-center gap-2",children:[r.jsxDEV(os,{mark:f,schema:g},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:144,columnNumber:9},void 0),y?r.jsxDEV("div",{className:"flex overflow-y-auto justify-center items-center flex-1 w-[90%]",children:r.jsxDEV(R,{data:{source:h},padding:ps,actions:fs,spec:vs(y.spec)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:131,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:130,columnNumber:7},void 0):r.jsxDEV(cs,{schema:g},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:126,columnNumber:14},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:143,columnNumber:7},void 0),r.jsxDEV(gs,{children:[null==(i=p.histograms)?void 0:i.plots,null==(o=p.addCategoricalField)?void 0:o.plots,null==(a=p.addQuantitativeField)?void 0:a.plots,null==(s=p.addTemporalField)?void 0:s.plots].filter(Boolean).flat().map(((e,n)=>r.jsxDEV(ys,{title:r.jsxDEV("div",{className:"flex flex-row gap-1",children:e.fieldInfos.map((e=>{const n="*"===e.fieldDef.field?"Count":e.fieldDef.fn?`${e.fieldDef.fn}(${e.fieldDef.field})`:e.fieldDef.field.toString();return r.jsxDEV(O,{variant:v.has(e.fieldDef.field)?"secondary":"defaultOutline",children:n},n,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:170,columnNumber:23},void 0)}))},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:161,columnNumber:17},void 0),actions:r.jsxDEV(M,{content:"Make main plot",children:r.jsxDEV(T,{"data-testid":"marimo-plugin-data-explorer-make-main-plot",variant:"text",size:"icon",onClick:()=>{const n=I.fromEntries(e.fieldInfos.map((e=>[e.channel,e.fieldDef])));l.setEncoding(n)},children:r.jsxDEV(B,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:200,columnNumber:21},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:186,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:185,columnNumber:17},void 0),children:r.jsxDEV(R,{data:{source:h},actions:!1,spec:e.spec},n,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:205,columnNumber:15},void 0)},n,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:158,columnNumber:13},void 0)))},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:148,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:142,columnNumber:5},void 0)},gs=({children:e})=>0===U.Children.count(e)?null:r.jsxDEV("div",{className:"flex flex-row overflow-x-auto overflow-y-hidden gap-4 snap-x pb-4",children:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:228,columnNumber:5},void 0),ys=({title:e,children:n,actions:t})=>r.jsxDEV("div",{className:"flex-shrink-0 bg-card shadow-md border overflow-hidden rounded snap-start",children:[r.jsxDEV("div",{className:"flex flex-row justify-between items-center bg-[var(--slate-3)] py-0.5 px-2",children:[r.jsxDEV("div",{className:"text-sm font-medium",children:e},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:245,columnNumber:9},void 0),t]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:244,columnNumber:7},void 0),r.jsxDEV("div",{className:"px-6 pt-2 max-h-[280px] overflow-y-auto",children:n},void 0,!1,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:248,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/runner/work/marimo/marimo/frontend/src/plugins/impl/data-explorer/ConnectedDataExplorerComponent.tsx",lineNumber:243,columnNumber:5},void 0);function vs(e){var n,t;return Boolean((null==(n=e.encoding)?void 0:n.row)||(null==(t=e.encoding)?void 0:t.column))||(e.width="container"),e}export{hs as DataExplorerComponent,ms as default};
