const __vite__fileDeps=["assets/pdf-doc-BTdS9hUz.js","assets/admin-drawer-panel-B2rmpAVA.js","assets/admin-drawer-panel-BHdNPwzF.css","assets/main-gSW7TFDY.js","assets/main-sK7HC5h4.css","assets/index-DUjeNg4x.js","assets/pagination-toolbar-Dlm70Bhs.js","assets/VSelect-ChOlLRyH.js","assets/VTextField-Dftcik85.js","assets/VDialog-pzwzInEh.js","assets/VDialog-C5Nxd_zP.css","assets/VSelectionControl-DKOhc2zB.js","assets/VSelectionControl-BFq--28I.css","assets/VTextField-BssVoDhB.css","assets/VCheckboxBtn-Coc7g8m7.js","assets/VSlideGroup-zFz5_byd.js","assets/VSlideGroup-Dk_1upHt.css","assets/VSelect-MGVSeLgr.css","assets/to-case-kUm8NPpW.js","assets/unauthorized-kEuFL5br.js","assets/change-password-dialog-BIBG6Bk8.js","assets/change-password-dialog-HvIvmmIE.css","assets/unauthorized-DHV6Q1n-.css","assets/settings-drawer-xSctoxZn.js","assets/settings-drawer-BJOfMtqA.css","assets/pagination-toolbar-ClZui9Zf.css","assets/VWindowItem-CYCwnt3s.js","assets/VWindowItem-ByIod57Y.css","assets/VExpansionPanels-CKSq1GpG.js","assets/VExpansionPanels-DsEXVcCv.css","assets/VRadioGroup-CW5GobGU.js","assets/VRadioGroup-i2qP9Wu9.css","assets/VCheckbox-BF_99tgB.js","assets/VCheckbox-CMKdyl0R.css","assets/pdf-doc-CMzaSV_K.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{l as $e,bw as Oe,bx as Ne,ag as P,N as v,O as b,_ as f,Q as g,R as d,P as p,T as c,L as l,ah as R,ad as k,ai as _,ae as B,aD as w,aA as S,aS as ce,M as T,by as Ve,bz as Ee,ap as W,bA as ue,bB as de,aC as he,bC as ge,bD as Ae,b1 as Fe,b0 as D,bt as ze,aB as V,bo as pe,aN as i,a_ as Ue,bE as Me,bF as We,k as q,aj as Y,ak as H,bG as He,bH as je,bI as Ge,bJ as qe,bK as Ke,aO as Ye,aP as Xe,aJ as Qe,m as I,bL as Je,ao as me,aQ as X,bM as Ze,bN as et,bf as tt,af as ot,bO as st,bh as rt,bP as at,b3 as Q,bk as nt,bQ as it}from"./admin-drawer-panel-B2rmpAVA.js";import{t as lt}from"./index-DUjeNg4x.js";import{C as O,r as J,B as Z,_ as ct,a as ke}from"./main-gSW7TFDY.js";import{g as ut,A as F,h as j,i as dt,j as ht,T as gt,M as pt,V as z,c as mt,P as fe,d as kt,e as ft}from"./pagination-toolbar-Dlm70Bhs.js";import{d as bt,b as _t,S as Pt,V as vt,a as St}from"./settings-drawer-xSctoxZn.js";import{P as wt,a as be,U as Rt,V as Ct}from"./unauthorized-kEuFL5br.js";import{b as _e,V as Pe}from"./VWindowItem-CYCwnt3s.js";import{b as Bt}from"./VSelect-ChOlLRyH.js";import{V as Tt,a as yt,b as Dt,c as It}from"./VExpansionPanels-CKSq1GpG.js";import{V as L,a as U}from"./VRadioGroup-CW5GobGU.js";import{V as M}from"./VCheckbox-BF_99tgB.js";const ve={fitTo:"",twoPages:null,readingDirection:"",readRtlInReverse:null};Object.freeze(ve);const Se={cacheBook:!1};Object.freeze(Se);const N=new Set(["",null,void 0]);Object.freeze(N);const we={prev:"next",next:"prev"};Object.freeze(we);const G={rel:"prefetch",as:"image"};Object.freeze(G);const K=new Set(["ttb","btt"]);Object.freeze(K);const Re=new Set(["rtl","btt"]);Object.freeze(Re);const y=1,Ce={S:"Screen",W:"Width",H:"Height",O:"Original"};Object.freeze(Ce);const Lt=()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>600?"HEIGHT":"WIDTH",ee=e=>{K.has(e.readingDirection)&&e.twoPages&&(e.twoPages=!1)},u=$e("reader",{state:()=>({choices:{fitTo:O.reader.fitTo,readingDirection:O.reader.readingDirection,nullValues:N},readerSettings:{fitTo:Lt(),twoPages:!1,readingDirection:"ltr",readRtlInReverse:!1},books:{current:void 0,prev:!1,next:!1},arcs:[],arc:{},empty:!1,page:void 0,routes:{prev:!1,next:!1,books:{prev:!1,next:!1},close:O.browser.breadcrumbs[0]},bookChange:void 0,reactWithScroll:!1,clientSettings:{cacheBook:!1,scale:y}}),getters:{groupBooks(e){const t=[];return e.books.prev[0]&&t.push[e.books.prev[0]],t.push[e.books.current],e.books.next[0]&&t.push[e.books.next[0]],t},activeSettings(e){return e.getSettings(e.books.current)||{}},activeTitle(e){var n;const t=e.books.current;let o;return t?(((n=e.arcs[0])==null?void 0:n.group)!="f"&&(o=ut(t)),o||(o=t.filename||"")):o="",o},routeParams(e){return{pk:+e.books.current.pk,page:+e.page}},isVertical(e){return K.has(e.activeSettings.readingDirection)},isPDF(e){var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.fileType)=="PDF"},cacheBook(e){return e.clientSettings.cacheBook&&!(this.isPDF&&this.isVertical)},isPagesNotRoutes(e){return e.isVertical||this.cacheBook},isReadInReverse(e){return Re.has(e.activeSettings.readingDirection)},isBTT(e){return e.activeSettings.readingDirection==="btt"},isFirstPage(e){return e.page===0},isLastPage(e){const t=e.books.current?e.books.current.maxPage:0,o=e.activeSettings.twoPages?1:0,n=t-o;return this.page>=n}},actions:{setReadRTLInReverse(e){return this.readerSettings.readRtlInReverse&&e.readingDirection==="rtl"?{...e,readingDirection:"ltr"}:e},getSettings(e){const t={...N};let o=e?e.settings:{};o=this.setReadRTLInReverse(o);const n=[this.readerSettings,o];for(const r of n)for(const[s,a]of Object.entries(r))N.has(a)||(t[s]=a);return ee(t),t},bookChangeLocation(e){let t;return this.isBTT?t=e==="next"?"left":"right":t=e==="next"?"right":"left",t},bookChangeCursorClass(e){let t;return this.isReadInReverse?t=e==="next"?"up":"down":t=e==="next"?"down":"up",t+"Cursor"},bookChangeShow(e){return e==="prev"?this.books.prev&&this.isFirstPage:this.books.next&&this.isLastPage},bookChangeIcon(e){let t=e==="next";return this.isBTT&&(t=!t),t?Oe:Ne},isCoverPage(e,t){return e.readLtr!==!1&&t===0||e.readLtr&&t===e.maxPage},_getRouteParams(e,t,o){const n=o==="prev"?-1:1;let r=1;this.getSettings(e).twoPages&&!this.isCoverPage(e,+t+n)&&(r=2),r=r*n;const a=+t+r;let h=!1;return a>=0&&a<=e.maxPage&&(h={pk:e.pk,page:a}),h},fitToClass(e){const t=this.getSettings(e),o={};let n;if(this.clientSettings.scale>y?n="Orig":n=Ce[t.fitTo],n){let r="fitTo";r+=lt(n),this.isVertical?r+="Vertical":t.twoPages&&(r+="Two"),o[r]=!0}return o},_updateSettings(e,t){t?(this.books.current.settings={...this.books.current.settings,...e},ee(this.books.current.settings)):this.readerSettings={...this.readerSettings,...e}},_getBookRoutePage(e,t){let o=0;if(t&&e.readLtr!==!1||!t&&e.readLtr===!1){const r=this.getSettings(e).twoPages?-1:0;o=e.maxPage+r}return o},_getBookRoute(e,t){if(!e)return!1;const o=this._getBookRoutePage(e,t);return{pk:e.pk,page:o}},_getBookRoutes(e,t){return{prev:this._getBookRoute(e,!0),next:this._getBookRoute(t,!1)}},async setRoutesAndBookmarkPage(e){const t=this.books.current;this.$patch(o=>{o.routes.prev=this._getRouteParams(t,e,"prev"),o.routes.next=this._getRouteParams(t,e,"next")}),await this._setBookmarkPage(e).then(()=>(this.bookChange=void 0,!0))},setActivePage(e,t=!0){if(e<0)return console.warn("Page out of bounds. Redirecting to 0."),this.routeToPage(0);if(e>this.books.current.maxPage)return console.warn(`Page out of bounds. Redirecting to ${this.books.current.maxPage}.`),this.routeToPage(this.books.current.maxPage);if(this.reactWithScroll=!!t,this.page=+e,this.setRoutesAndBookmarkPage(e),this.isPagesNotRoutes){const o={params:{pk:this.books.current.pk,page:e}},{href:n}=J.resolve(o);window.history.pushState({},void 0,n)}else window.scrollTo(0,0)},async loadReaderSettings(){return F.getReaderSettings().then(e=>{const t=e.data;return this._updateSettings(t,!1),this.empty=!1,!0}).catch(console.error)},async loadBooks(e){await F.getReaderInfo(e).then(t=>{const o=t.data,n=[o.books.prevBook,o.books.current,o.books.nextBook];for(const s of n)s&&!s.settings&&(s.settings={});const r=this._getBookRoutes(o.books.prevBook,o.books.nextBook);return this.$patch(s=>{s.books.current=o.books.current,s.books.prev=o.books.prevBook,s.books.next=o.books.nextBook,s.arcs=o.arcs,s.arc=o.arc,s.routes.prev=this._getRouteParams(s.books.current,e.page,"prev"),s.routes.next=this._getRouteParams(s.books.current,e.page,"next"),s.routes.books=r,s.routes.close=o.closeRoute,s.empty=!1}),!0}).catch(t=>{console.debug(t),this.empty=!0})},async _setBookmarkPage(e){const t={group:"c",ids:[+this.books.current.pk]};e=Math.max(Math.min(this.books.current.maxPage,e),0);const o={page:e};await Z.setGroupBookmarks(t,o)},async setSettingsLocal(e){this._updateSettings(e,!0);const t={group:"c",ids:[+this.books.current.pk]};await Z.setGroupBookmarks(t,this.books.current.settings)},setSettingsClient(e){this.clientSettings={...this.clientSettings,...e}},async clearSettingsLocal(){await this.setSettingsLocal(ve),this.setSettingsClient(Se)},async setSettingsGlobal(e){this._updateSettings(e,!1),await F.setReaderSettings(this.readerSettings),await this.clearSettingsLocal()},setBookChangeFlag(e){e=this.normalizeDirection(e),this.bookChange=this.routes.books[e]?e:void 0},normalizeDirection(e){return this.isReadInReverse?we[e]:e},_validateRoute(e,t){if(t||(t=this.books.current),!t)return{};const o=t.maxPage??0;return e.page>o?(e.page=o,console.warn("Tried to navigate past the end of the book.")):e.page<0&&(e.page=0,console.warn("Tried to navigate before the beginning of the book.")),e},_routeTo(e,t){if(e=this._validateRoute(e,t),this.isPagesNotRoutes&&+e.pk===this.books.current.pk)this.setActivePage(+e.page,!0);else{const o={name:"reader",params:e};J.push(o).catch(console.debug)}},routeToDirectionOne(e){e=this.normalizeDirection(e);const t=e==="prev"?-1:1,o=this.page+=t;if(o<0||o>this.books.current.maxPage)return;const n={pk:this.books.current.pk,page:o};this._routeTo(n)},routeToDirection(e){if(e=this.normalizeDirection(e),this.routes[e]){const t=this.routes[e];this._routeTo(t)}else this.routes.books[e]?this.bookChange===e?this._routeTo(this.routes.books[e],this.books[e]):this.setBookChangeFlag(e):console.debug("No route to direction",e)},routeToPage(e){const t={pk:this.books.current.pk,page:e};this._routeTo(t)},routeToBook(e){this._routeTo(this.routes.books[e],this.books[e])},_prefetchSrc(e,t,o=!1,n=!1){if(!e)return!1;const r=o?this.books[t]:this.books.current;if(!r)return!1;let s=e.page;if(n){if(!this.getSettings(r).twoPages)return!1;s+=1}if(s>r.maxPage)return!1;const a={pk:e.pk,page:s,mtime:r.mtime};return j(a)},prefetchLinks(e,t,o=!1){if(!o&&this.cacheBook)return{};const n=[this._prefetchSrc(e,t,o,!1),this._prefetchSrc(e,t,o,!0)],r=[];for(const s of n)s&&r.push({...G,href:s});return{link:r}},prefetchBook(e){if(!this.cacheBook||e.fileType=="PDF")return{};const t=e.pk,o=[];for(let n=0;n<=e.maxPage;n++){const r={pk:t,page:n,mtime:e.mtime},s=j(r);s&&o.push({...G,href:s})}return{link:o}},toRoute(e){return e?{params:e}:{}},linkLabel(e,t){return`${e==="prev"?"Previous":"Next"} ${t}`}}}),xt={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...P(u,["isBTT"]),...v(u,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.bookChangeIcon(this.computedDirection)}}),drawerLocation(){return this.bookChangeLocation(this.direction)},cursorClass(){return this.bookChangeCursorClass(this.computedDirection)},show(){return this.bookChangeShow(this.computedDirection)},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{...b(u,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute","bookChangeLocation","bookChangeCursorClass","bookChangeShow","bookChangeIcon"])}};function $t(e,t,o,n,r,s){const a=g("router-link");return s.show?(d(),p(bt,{key:0,class:B(["bookChangeDrawer",{drawerActivated:e.isDrawerOpen}]),"disable-resize-watcher":"","disable-route-watcher":"",location:s.drawerLocation,"model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:c(()=>[l(a,{class:B({navLink:!0,[s.cursorClass]:!0}),to:s.route,"aria-label":s.label,title:s.label,onClick:t[0]||(t[0]=h=>h.stopImmediatePropagation())},{default:c(()=>[l(R,{class:"bookChangeIcon"},{default:c(()=>[k(_(e.icon),1)]),_:1})]),_:1},8,["class","to","aria-label","title"])]),_:1},8,["location","model-value","class"])):w("",!0)}const Ot=f(xt,[["render",$t],["__scopeId","data-v-03e41a14"]]),Nt={name:"BookChangeActivator",components:{BookChangeDrawer:Ot},props:{direction:{type:String,required:!0}},computed:{computedDirection(){return this.normalizeDirection(this.direction)},positionClass(){return this.bookChangeLocation(this.direction)+"Pos"},cursorClass(){return this.bookChangeCursorClass(this.direction)},show(){return this.bookChangeShow(this.computedDirection)}},methods:{...b(u,["setBookChangeFlag","normalizeDirection","bookChangeLocation","bookChangeCursorClass","bookChangeShow"])}};function Vt(e,t,o,n,r,s){const a=g("BookChangeDrawer");return d(),S(T,null,[s.show?(d(),S("div",{key:0,class:B(["bookChangeColumn",{[s.positionClass]:!0,[s.cursorClass]:!0}]),onClick:t[0]||(t[0]=ce(h=>e.setBookChangeFlag(o.direction),["stop"]))},null,2)):w("",!0),l(a,{direction:o.direction},null,8,["direction"])],64)}const Et=f(Nt,[["render",Vt],["__scopeId","data-v-db3eb561"]]),At={name:"LoadingPage",components:{Placeholder:wt},props:{twoPages:{type:Boolean,required:!0}}};function Ft(e,t,o,n,r,s){const a=g("Placeholder");return d(),S("div",{class:B(["pageLoading",{twoPages:o.twoPages}])},[l(a,{class:"pagePlaceholder"})],2)}const zt=f(At,[["render",Ft],["__scopeId","data-v-04027168"]]),te="unauthorized",Ut={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===te?"Protected page":"Failed to load page"},icon(){return this.type===te?Ve:Ee}}};function Mt(e,t,o,n,r,s){return d(),p(be,{class:B(["pageError",{twoPages:o.twoPages}]),headline:s.text,icon:s.icon},null,8,["class","headline","icon"])}const Wt=f(Ut,[["render",Mt],["__scopeId","data-v-417a4cab"]]),Ht={name:"ImgPage",props:{book:{type:Object,required:!0},src:{type:String,required:!0}},emits:["load","error"],computed:{...v(u,{scale:e=>e.clientSettings.scale}),style(){const e={};if(this.scale==1)return e;const t=this.$el;if(!(t!=null&&t.naturalWidth))return e;const o=t.naturalWidth/2;return e.transformOrigin=`${o}px top`,e.transform=`scale(${this.scale})`,e},classes(){return this.fitToClass(this.book)}},methods:{...b(u,["fitToClass"])}},jt=["src"];function Gt(e,t,o,n,r,s){return d(),S("img",W({class:[s.classes,"img"],draggable:"false",src:o.src,style:s.style},e.$attrs,{onError:t[0]||(t[0]=a=>e.$emit("error",a)),onLoad:t[1]||(t[1]=a=>e.$emit("load",a))}),null,16,jt)}const oe=f(Ht,[["render",Gt],["__scopeId","data-v-559e2ecc"]]),se=ue(de(()=>ct(()=>import("./pdf-doc-BTdS9hUz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])))),qt=333,Kt={name:"BookPage",components:{ErrorPage:Wt,LoadingPage:zt,PDFDoc:se,ImgPage:oe},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{...P(u,["isVertical"]),...v(u,{scale:e=>e.clientSettings.scale}),style(){var o;const e={};if(this.book.fileType==="PDF"||this.scale==1)return e;const t=(o=this.$refs.pageComponent)==null?void 0:o.$el;return t!=null&&t.naturalHeight&&(e.height=t.naturalHeight*this.scale+"px",e.width=t.naturalWidth*this.scale+"px"),e},src(){const e={pk:this.book.pk,page:this.page,mtime:this.book.mtime};return j(e)},component(){return this.book.fileType==="PDF"?se:oe},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},qt)},methods:{...b(u,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},Yt=["id","data-page"];function Xt(e,t,o,n,r,s){const a=g("ErrorPage"),h=g("LoadingPage");return d(),S("div",{id:`page${o.page}`,"data-page":o.page,class:"page",style:ge(s.style)},[r.error?(d(),p(a,{key:0,"two-pages":s.settings.twoPages,type:r.error},null,8,["two-pages","type"])):r.showProgress&&!r.loaded?(d(),p(h,{key:1,"two-pages":s.settings.twoPages},null,8,["two-pages"])):(d(),p(he(s.component),{key:2,ref:"pageComponent",book:o.book,page:1,src:s.src,onError:s.onError,onLoad:s.onLoad,onUnauthorized:s.onUnauthorized},null,40,["book","src","onError","onLoad","onUnauthorized"]))],12,Yt)}const Be=f(Kt,[["render",Xt],["__scopeId","data-v-87996fa1"]]),Qt=.5,Jt={name:"ScaleForScroll",emits:["click"],data(){return{mdiMagnifyMinusOutline:Ae}},computed:{...v(u,{scale:e=>e.clientSettings.scale}),showReset(){return this.scale!=y},style(){return{cursor:this.scale==y?"zoom-in":"all-scroll"}}},methods:{...b(u,["setSettingsClient"]),clearSelection(){window.getSelection&&window.getSelection().removeAllRanges()},onDoubleClick(){this.clearSelection();const e=this.scale+Qt;this.setSettingsClient({scale:e})},scaleReset(){this.setSettingsClient({scale:y})}}};function Zt(e,t,o,n,r,s){const a=Fe("drag-scroller");return D((d(),S("div",{class:"scaleForScroll",style:ge(s.style),onDblclick:t[0]||(t[0]=(...h)=>s.onDoubleClick&&s.onDoubleClick(...h))},[ze(e.$slots,"default",{},void 0,!0),s.showReset?(d(),p(R,{key:0,class:"resetIcon",onClick:ce(s.scaleReset,["stop"])},{default:c(()=>[k(_(r.mdiMagnifyMinusOutline),1)]),_:1},8,["onClick"])):w("",!0)],36)),[[a,,void 0,{onlyX:!0}]])}const Te=f(Jt,[["render",Zt],["__scopeId","data-v-b24267c0"]]),eo={name:"HorizontalPages",components:{BookPage:Be,ScaleForScroll:Te},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},emits:["click"],computed:{...P(u,["isCoverPage","isReadInReverse"]),showSecondPage(){return this.getSettings(this.book).twoPages&&this.page<this.book.maxPage&&!this.isCoverPage(this.book,this.page)},showPageOne(){return!this.isReadInReverse||this.showSecondPage},showPageTwo(){return this.isReadInReverse||this.showSecondPage},pageOne(){return this.isReadInReverse?this.page+1:this.page},pageTwo(){return this.isReadInReverse?this.page:this.page+1}},methods:{...b(u,["getSettings"])}};function to(e,t,o,n,r,s){const a=g("BookPage"),h=g("ScaleForScroll");return d(),p(h,{class:"noWrap"},{default:c(()=>[s.showPageOne?(d(),p(a,{key:0,ref:"pageOne",book:o.book,page:s.pageOne,class:"horizontalPage"},null,8,["book","page"])):w("",!0),s.showPageTwo?(d(),p(a,{key:1,book:o.book,page:s.pageTwo,class:"horizontalPage"},null,8,["book","page"])):w("",!0)]),_:1})}const oo=f(eo,[["render",to],["__scopeId","data-v-9a560964"]]),so={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...P(u,["isVertical","isFirstPage","isLastPage"]),...v(u,{params(e){return e.routes[this.computedDirection]}}),computedDirection(){return this.normalizeDirection(this.direction)},show(){return this.computedDirection==="prev"?!this.isFirstPage:!this.isLastPage},pageChangeClass(){let e="pageChange";return e+=this.isVertical?"Row":"Column",e},directionClass(){let e=this.direction;return this.isVertical&&(e+="Vertical"),e},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{...b(u,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function ro(e,t,o,n,r,s){const a=g("router-link");return s.show?(d(),p(a,{key:0,to:s.route,"aria-label":s.label,class:B({[s.pageChangeClass]:!0,[s.directionClass]:!0}),onClick:t[0]||(t[0]=h=>h.stopImmediatePropagation())},null,8,["to","aria-label","class"])):w("",!0)}const ao=f(so,[["render",ro],["__scopeId","data-v-9ade7d96"]]),no=48,io=48,lo={name:"PagerHorizontal",components:{HorizontalPages:oo,PageChangeLink:ao},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...P(u,["isReadInReverse"]),...v(u,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.books.current.pk}),twoPages(){return this.getSettings(this.book).twoPages},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),o=this.pages.at(-1);(e<t||e>o)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...b(u,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-no,0),t=Math.min(this.activePage+io,this.book.maxPage),o=ke.range(e,t+1);this.pages=o}}};function co(e,t,o,n,r,s){const a=g("PageChangeLink"),h=g("HorizontalPages");return d(),p(Pe,{"show-arrows":"",continuous:"","model-value":s.windowIndex,reverse:e.isReadInReverse},{prev:c(()=>[l(a,{direction:"prev"})]),next:c(()=>[l(a,{direction:"next"})]),default:c(()=>[(d(!0),S(T,null,V(r.pages,m=>(d(),p(_e,{key:`c/${o.book.pk}/${m}`,class:"windowItem",disabled:"",eager:m>=e.storePage-1&&m<=e.storePage+2,"model-value":m,transition:!0},{default:c(()=>[l(h,{book:o.book,page:m},null,8,["book","page"])]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const re=f(lo,[["render",co],["__scopeId","data-v-e04bbc00"]]);function ye(e,t){const{self:o=!1}=t.modifiers??{},n=t.value,r=typeof n=="object"&&n.options||{passive:!0},s=typeof n=="function"||"handleEvent"in n?n:n.handler,a=o?e:t.arg?document.querySelector(t.arg):window;a&&(a.addEventListener("scroll",s,r),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:s,options:r,target:o?void 0:a})}function De(e,t){var s;if(!((s=e._onScroll)!=null&&s[t.instance.$.uid]))return;const{handler:o,options:n,target:r=e}=e._onScroll[t.instance.$.uid];r.removeEventListener("scroll",o,n),delete e._onScroll[t.instance.$.uid]}function uo(e,t){t.value!==t.oldValue&&(De(e,t),ye(e,t))}const ho={mounted:ye,unmounted:De,updated:uo},go=12,ae=250,po={name:"PagerVertical",components:{BookPage:Be,ScaleForScroll:Te},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...v(u,{storePage:e=>e.page}),...pe(u,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var o;const e=(o=this.book)!=null&&o.maxPage?this.book.maxPage+1:0,t=ke.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,go)}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},ae)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...b(u,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const n=+t[0].target.dataset.page;this.setActivePage(n,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const o=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=o&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find verticalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},ae)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},mo=["data-page"];function ko(e,t,o,n,r,s){const a=g("BookPage"),h=g("ScaleForScroll");return d(),p(h,null,{default:c(()=>[D((d(),p(Bt,{id:"verticalScroll",key:s.readInReverse,ref:"verticalScroll",items:s.items,height:r.innerHeight,width:r.innerWidth},{default:c(({item:m})=>[l(a,{book:o.book,page:m,class:"verticalPage"},null,8,["book","page"]),D(i("div",{class:"pageTracker","data-page":m},null,8,mo),[[Ue,{handler:s.onIntersect,options:{threshold:[.75]}},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[ho,s.onScroll,"#verticalScroll"]])]),_:1})}const ne=f(po,[["render",ko],["__scopeId","data-v-97638fc3"]]),ie=ue(de(()=>"@/components/reader/pager/pager-full-pdf.vue")),fo={name:"PagerSelector",components:{PagerHorizontal:re,PagerPDF:ie,PagerVertical:ne},props:{book:{type:Object,required:!0}},emits:["click"],head(){return this.prefetchBook(this.book)},computed:{...P(u,["isVertical","cacheBook"]),...v(u,{storePk:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk)||0}}),readFullPdf(){return this.book.fileType=="PDF"&&this.cacheBook},component(){return this.readFullPdf?ie:this.isVertical?ne:re}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{...b(u,["getSettings","setActivePage","prefetchBook"])}};function bo(e,t,o,n,r,s){return d(),p(he(s.component),{book:o.book},null,8,["book"])}const _o=f(fo,[["render",bo]]),Po={name:"BooksWindow",components:{BookChangeActivator:Et,Pager:_o},emits:["click"],computed:{...P(u,["isBTT"]),...v(u,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk)||0},bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag(),this.loadBooks(this.$route.params)},methods:{...b(u,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function vo(e,t,o,n,r,s){const a=g("BookChangeActivator"),h=g("Pager");return d(),p(Pe,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,reverse:e.isBTT,"show-arrows":"",onClick:s.click},{prev:c(()=>[l(a,{direction:"prev"})]),next:c(()=>[l(a,{direction:"next"})]),default:c(()=>[(d(!0),S(T,null,V(e.books,m=>(d(),p(_e,{key:`c/${m.pk}`,class:"windowItem",disabled:"",eager:s.eager(m.pk),value:m.pk,transition:!0},{default:c(()=>[l(h,{book:m,onClick:s.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","reverse","onClick"])}const So=f(Po,[["render",vo],["__scopeId","data-v-2a90783e"]]),wo={name:"DownloadPanel",data(){return{mdiDownload:Me,mdiFileImage:We}},computed:{...P(u,["activeTitle","routeParams"]),...v(u,{currentBook:e=>{var t;return(t=e.books)==null?void 0:t.current},storePage:e=>e.page}),downloadURL(){return dt(this.currentBook)},filename(){var e;return(e=this.currentBook)==null?void 0:e.filename},pageSrc(){const{pk:e,mtime:t}=this.currentBook;return ht({pk:e,page:this.storePage,mtime:t})},pageName(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...b(q,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.filename)}}},Ro={key:0,id:"downloadPanel"};function Co(e,t,o,n,r,s){return e.currentBook?(d(),S("div",Ro,[l(H,{onClick:s.downloadPage},{default:c(()=>[l(Y,null,{default:c(()=>[l(R,null,{default:c(()=>[k(_(r.mdiFileImage),1)]),_:1}),k("Download Page "+_(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),l(H,{onClick:s.downloadBook},{default:c(()=>[l(Y,null,{default:c(()=>[l(R,null,{default:c(()=>[k(_(r.mdiDownload),1)]),_:1}),k("Download Book ")]),_:1})]),_:1},8,["onClick"])])):w("",!0)}const Bo=f(wo,[["render",Co],["__scopeId","data-v-9e01f4cb"]]),To={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:He,mdiMenuRight:je,mdiKeyboardOutline:Ge,mdiKeyboardSpace:qe,mdiAppleKeyboardShift:Ke}},computed:{...P(q,["isMobile"])}},C=e=>(Ye("data-v-a8b4ac47"),e=e(),Xe(),e),yo=C(()=>i("h4",null,"Navigation",-1)),Do={class:"highlight-table"},Io=C(()=>i("td",null,"Previous page",-1)),Lo=C(()=>i("td",null,"Next page",-1)),xo=C(()=>i("tr",null,[i("td",null,","),i("td",null,[k("Next "),i("em",null,"only"),k(" one page in two page mode.")])],-1)),$o=C(()=>i("tr",null,[i("td",null,"."),i("td",null,[k("Previous "),i("em",null,"only"),k(" one page in two page mode.")])],-1)),Oo=C(()=>i("tr",null,[i("td",null,"p"),i("td",null,"Previous Book")],-1)),No=C(()=>i("tr",null,[i("td",null,"n"),i("td",null,"Next Book")],-1)),Vo=C(()=>i("tr",null,[i("td",null,"esc"),i("td",null,"Close book")],-1)),Eo=C(()=>i("h4",null,"Fit Page To",-1)),Ao=C(()=>i("table",{class:"highlight-table"},[i("tbody",null,[i("tr",null,[i("td",null,"s"),i("td",null,"screen")]),i("tr",null,[i("td",null,"h"),i("td",null,"screen height")]),i("tr",null,[i("td",null,"w"),i("td",null,"screen width")]),i("tr",null,[i("td",null,"o"),i("td",null,"Show page at original size")]),i("tr",null,[i("td",null,"2"),i("td",null,"Toggle two page view")]),i("tr",null,[i("td",null,"r"),i("td",null,"Read Right to Left")]),i("tr",null,[i("td",null,"l"),i("td",null,"Read Left to Right")]),i("tr",null,[i("td",null,"t"),i("td",null,"Read Top to Bottom")]),i("tr",null,[i("td",null,"b"),i("td",null,"Read in Bottom to Top")])])],-1)),Fo=C(()=>i("h4",null,"Other",-1)),zo=C(()=>i("table",{class:"highlight-table"},[i("tbody",null,[i("tr",null,[i("td",null,"m"),i("td",null,"Show comic's metadata")]),i("tr",null,[i("td",null,"double click"),i("td",null,"Zoom page")])])],-1));function Uo(e,t,o,n,r,s){return e.isMobile?w("",!0):(d(),p(It,{key:0},{default:c(()=>[l(Tt,{id:"readerKeyboardShortcuts"},{default:c(()=>[l(yt,{id:"shortcutsTitle"},{default:c(()=>[l(R,{id:"keyboardIcon"},{default:c(()=>[k(_(r.mdiKeyboardOutline),1)]),_:1}),k("Keyboard Shortcuts ")]),_:1}),l(Dt,null,{default:c(()=>[yo,i("table",Do,[i("tbody",null,[i("tr",null,[i("td",null,[l(R,{class:"keyIcon",density:"compact"},{default:c(()=>[k(_(r.mdiMenuLeft),1)]),_:1}),k(", j, "),i("div",null,[l(R,{class:"keyIcon",density:"compact"},{default:c(()=>[k(_(r.mdiAppleKeyboardShift),1)]),_:1}),l(R,{class:"keyIcon",density:"compact"},{default:c(()=>[k(_(r.mdiKeyboardSpace),1)]),_:1})])]),Io]),i("tr",null,[i("td",null,[l(R,{class:"keyIcon",density:"compact"},{default:c(()=>[k(_(r.mdiMenuRight),1)]),_:1}),k(", k, "),l(R,{class:"keyIcon",density:"compact"},{default:c(()=>[k(_(r.mdiKeyboardSpace),1)]),_:1})]),Lo]),xo,$o,Oo,No,Vo])]),Eo,Ao,Fo,zo]),_:1})]),_:1})]),_:1}))}const Mo=f(To,[["render",Uo],["__scopeId","data-v-a8b4ac47"]]),Ie=["fitTo","readingDirection","twoPages"];Object.freeze(Ie);const Wo={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1,mdiOpenInNew:Qe}},computed:{...P(I,["isAuthDialogOpen"]),...P(u,["isVertical","isPDF","cacheBook"]),...v(u,{choices:e=>e.choices,validBook:e=>{var t;return!!((t=e.books)!=null&&t.current)},selectedSettings(e){var t,o;return this.isGlobalScope||!((t=e.books)!=null&&t.current)?e.readerSettings:(o=e.books)==null?void 0:o.current.settings},isClearSettingsButtonDisabled(e){var t,o;if(this.isGlobalScope||!((t=e.books)!=null&&t.current))return!0;for(const n of Ie){const r=(o=e.books)==null?void 0:o.current.settings[n];if(!e.choices.nullValues.has(r))return!1}return!0},bookInBrowserURL(e){var t,o;return(t=e.books)!=null&&t.current?Je((o=e.books)==null?void 0:o.current):""}}),...pe(u,["readRtlInReverse"]),fitToChoices(){return this.choicesWithoutNull("fitTo")},readingDirectionChoices(){return this.choicesWithoutNull("readingDirection")},disableTwoPages(){return this.isVertical||this.isPDF&&this.cacheBook},disableCacheBook(){return this.isVertical&&this.isPDF}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...b(u,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal","setSettingsClient"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},choicesWithoutNull(e){const t=[];for(const o of this.choices[e])o.value&&t.push(o);return Object.freeze(t),t},_keyUpListener(e){if(e.stopPropagation(),this.isAuthDialogOpen)return;let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"l":t={readingDirection:"ltr"};break;case"r":t={readingDirection:"rtl"};break;case"t":t={readingDirection:"ttb"};break;case"b":t={readingDirection:"bbt"};break}t&&this.setSettingsLocal(t)}}},Ho={key:0,id:"readerSettings"},jo=["href"];function Go(e,t,o,n,r,s){return e.validBook?(d(),S("div",Ho,[l(U,{modelValue:r.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=a=>r.isGlobalScope=a),density:"compact",label:"Scope","hide-details":"auto"},{default:c(()=>[l(L,{label:"Only this comic",value:!1}),l(L,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),l(U,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=a=>s.settingsDialogChanged({fitTo:a}))},{default:c(()=>[(d(!0),S(T,null,V(s.fitToChoices,a=>(d(),p(L,{key:a.value,label:a.title,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),l(M,{disabled:s.disableTwoPages,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=a=>s.settingsDialogChanged({twoPages:a}))},null,8,["disabled","model-value","indeterminate"]),l(U,{class:"displayRadioGroup",density:"compact",label:"Reading Direction","hide-details":"auto","model-value":e.selectedSettings.readingDirection,"onUpdate:modelValue":t[3]||(t[3]=a=>s.settingsDialogChanged({readingDirection:a}))},{default:c(()=>[(d(!0),S(T,null,V(s.readingDirectionChoices,a=>(d(),p(L,{key:a.value,label:a.title,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),l(M,{"model-value":e.cacheBook,class:"cacheBook",density:"compact",disabled:s.disableCacheBook,label:"Cache Entire Book","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[4]||(t[4]=a=>e.setSettingsClient({cacheBook:a}))},null,8,["model-value","disabled"]),e.isPDF?(d(),S("a",{key:0,id:"readPDFInBrowser",href:e.bookInBrowserURL,target:"_blank"},[l(R,null,{default:c(()=>[k(_(r.mdiOpenInNew),1)]),_:1}),k("Read PDF in Browser ")],8,jo)):w("",!0),r.isGlobalScope?(d(),p(M,{key:1,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL Comics as LTR","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=a=>s.settingsDialogChanged({readRtlInReverse:a}))},null,8,["model-value"])):w("",!0),r.isGlobalScope?w("",!0):(d(),p(me,{key:2,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:e.clearSettingsLocal},{default:c(()=>[k(" Clear Comic Settings ")]),_:1},8,["disabled","onClick"]))])):w("",!0)}const qo=f(Wo,[["render",Go],["__scopeId","data-v-599636e1"]]),Ko={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:Bo,ReaderKeyboardShortcutsPanel:Mo,ReaderSettingsPanel:qo}};function Yo(e,t,o,n,r,s){const a=g("ReaderSettingsPanel"),h=g("ReaderKeyboardShortcutsPanel"),m=g("DownloadPanel");return d(),S(T,null,[l(a),l(X),l(h),l(X),l(m)],64)}const Xo=f(Ko,[["render",Yo]]),Qo={name:"ReaderSettingsDrawer",components:{SettingsDrawer:_t,ReaderSettingsSuperPanel:Xo}};function Jo(e,t,o,n,r,s){const a=g("ReaderSettingsSuperPanel"),h=g("SettingsDrawer");return d(),p(h,{title:"Reader",temporary:"","disable-resize-watcher":""},{panel:c(()=>[l(a)]),_:1})}const Zo=f(Qo,[["render",Jo]]),le={a:et,f:tt,s:ot},es={a:"Story Arc",f:"Folder",s:"Series"},ts={name:"ReaderArcSelect",components:{ToolbarSelect:gt},computed:{...v(u,{arcGroup:e=>{var t;return((t=e.arc)==null?void 0:t.group)||"s"},arc:e=>e.arc,arcName:e=>{for(const t of e.arcs)if(e.arc.group===t.group&&e.arc.pks===t.pks)return t.name;return"Unknown"},arcItems:e=>{const t=[];for(const o of e.arcs){const n={value:o,title:o.name,group:o.group,subtitle:es[o.group],prependIcon:le[o.group]};t.push(n)}return t}})},methods:{...b(u,["loadBooks"]),arcIcon(e){return le[e]},checkIcon(e){return e===this.arc?Ze:""},onUpdate(e){const t=this.$route.params;if(!t)return;const o={group:e.group,pks:e.pks},n={...t,arc:o};this.loadBooks(n)}}},os={id:"arcPos"};function ss(e,t,o,n,r,s){const a=g("ToolbarSelect");return d(),p(a,{"model-value":e.arc,class:"arcSelect","select-label":"reading order",items:e.arcItems,disabled:!e.arcItems||e.arcItems.length<=1,"onUpdate:modelValue":s.onUpdate},{item:c(({item:h,props:m})=>[l(H,W(m,{density:"compact",variant:"plain","prepend-icon":h.raw.prependIcon,subtitle:h.raw.subtitle,"append-icon":s.checkIcon(m.value)}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:c(({item:h,props:m})=>[l(R,W({size:"large"},m,{class:"arcSelectIcon"}),{default:c(()=>[k(_(s.arcIcon(h.raw.group)),1)]),_:2},1040),i("span",os,_(e.arc.index)+" / "+_(e.arc.count),1)]),_:1},8,["model-value","items","disabled","onUpdate:modelValue"])}const rs=f(ts,[["render",ss],["__scopeId","data-v-42a57aca"]]),as={name:"ReaderTitleToolbar",components:{MetadataDialog:pt,ReaderArcSelect:rs,SettingsDrawerButton:Pt},data(){return{mdiClose:st,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...P(I,["isAuthDialogOpen"]),...P(u,["activeTitle"]),...v(u,{currentBook:e=>{var t;return((t=e.books)==null?void 0:t.current)||{}},closeRoute:e=>e.routes.close,empty:e=>e.empty,subtitle:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.name)||""}}),closeBookRoute(){var t;const e={name:"browser",params:this.closeRoute};return e.params?e.hash=`#card-${(t=this.currentBook)==null?void 0:t.pk}`:e.params=window.CODEX.LAST_ROUTE||O.browser.breadcrumbs[0],e},title(){return this.activeTitle},extensionHeight(){let e=32;return this.subtitle&&(e*=2),e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...b(q,["setTimestamp"]),...b(u,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.empty||this.openMetadata();break}}}},ns={id:"title"},is={key:0,id:"subtitle"};function ls(e,t,o,n,r,s){const a=g("ReaderArcSelect"),h=g("MetadataDialog"),m=g("SettingsDrawerButton");return d(),p(St,{id:"readerToolbarTop",density:"compact","extension-height":s.extensionHeight},rt({default:c(()=>[l(z,null,{default:c(()=>[l(me,{ref:"closeBook",class:"closeBook",to:s.closeBookRoute,size:"large",density:"compact",variant:"plain",onClick:s.onCloseBook},{default:c(()=>[k(" close book ")]),_:1},8,["to","onClick"])]),_:1}),l(mt),e.empty?w("",!0):(d(),p(z,{key:0},{default:c(()=>[l(a),l(h,{ref:"metadataDialog",group:"c",toolbar:!0,book:e.currentBook},null,8,["book"])]),_:1})),l(z,null,{default:c(()=>[l(m)]),_:1})]),_:2},[s.title?{name:"extension",fn:c(()=>[l(vt,{class:"readerTitle"},{default:c(()=>[i("div",ns,_(s.title),1),e.subtitle?(d(),S("div",is,_(e.subtitle),1)):w("",!0)]),_:1})]),key:"0"}:void 0]),1032,["extension-height"])}const Le=f(as,[["render",ls],["__scopeId","data-v-0217ea46"]]),cs={name:"ReaderEmpty",components:{ReaderTopToolbar:Le},data(){return{mdiBookRemoveOutline:at}}};function us(e,t,o,n,r,s){const a=g("ReaderTopToolbar");return d(),S(T,null,[l(a),l(be,{class:"empty",headline:"Book Not Found",title:"Close the reader and find another book",icon:r.mdiBookRemoveOutline},null,8,["icon"])],64)}const ds=f(cs,[["render",us],["__scopeId","data-v-65d65e48"]]),hs={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:fe},props:{direction:{type:String,required:!0}},computed:{...P(u,["isBTT"]),...v(u,{toRoute(e){var o;const t=(o=e==null?void 0:e.routes)==null?void 0:o.books[this.direction];return t?{params:{...t}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.bookChangeIcon(this.direction)},classes(){return{bookChangeNavButtonLeft:this.direction==="prev",bookChangeNavButtonRight:this.direction==="next"}}},methods:{...b(u,["bookChangeIcon"])}};function gs(e,t,o,n,r,s){const a=g("PaginationNavButton");return e.toRoute?(d(),p(a,{key:0,class:B(s.classes),icon:"",variant:"plain",title:s.title,to:e.toRoute},{default:c(()=>[l(R,null,{default:c(()=>[k(_(s.icon),1)]),_:1})]),_:1},8,["class","title","to"])):w("",!0)}const ps=f(hs,[["render",gs],["__scopeId","data-v-4be59e7e"]]),ms={name:"ReaderNavButton",components:{PaginationNavButton:fe},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...P(u,["isVertical"]),...v(u,{storePage:e=>e.page,toRoute(e){if(!this.isVertical)return{params:{pk:e.books.current.pk,page:this.value}}},isBookPrev:e=>!!e.routes.books.prev,isBookNext:e=>!!e.routes.books.next}),classes(){return{readerNavButtonLeft:!this.isBookPrev&&this.value===0,readerNavButtonRight:!this.isBookNext&&this.value!=0}},title(){return"Page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...b(u,["setActivePage"]),onClick(){this.isVertical&&this.setActivePage(this.value,!0)}}};function ks(e,t,o,n,r,s){const a=g("PaginationNavButton");return d(),p(a,{key:e.isVertical,disabled:s.disabled,class:B(["readerNavButton",s.classes]),title:s.title,to:e.toRoute,onClick:s.onClick},{default:c(()=>[k(_(o.value),1)]),_:1},8,["disabled","class","title","to","onClick"])}const fs=f(ms,[["render",ks],["__scopeId","data-v-c9e294f6"]]),x="prev",$="next",bs={name:"ReaderNavToolbar",components:{PaginationSlider:kt,ReaderNavButton:fs,PaginationToolbar:ft,ReaderBookChangeNavButton:ps},computed:{...P(I,["isAuthDialogOpen"]),...P(u,["activeSettings","isReadInReverse","isVertical"]),...v(u,{storePage:e=>e.page,key(e){var t,o;return`${(o=(t=e.books)==null?void 0:t.current)==null?void 0:o.pk}:${this.step}:${this.isReadInReverse}`},maxPage:e=>{var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.maxPage)||0}}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},min(){return this.isReadInReverse?this.maxPage:0},max(){return this.isReadInReverse?0:this.maxPage},bookPrev(){return this.isReadInReverse?"next":"prev"},bookNext(){return this.isReadInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...b(u,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.isVertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection($):e.shiftKey&&window.scrollY===0&&this.routeToDirection(x);break;case"j":case"ArrowRight":this.routeToDirection($);break;case"k":case"ArrowLeft":this.routeToDirection(x);break;case",":this.routeToDirectionOne(x);break;case".":this.routeToDirectionOne($);break;case"n":this.routeToBook($);break;case"p":this.routeToBook(x);break}}}};function _s(e,t,o,n,r,s){const a=g("ReaderBookChangeNavButton"),h=g("ReaderNavButton"),m=g("PaginationSlider"),E=g("PaginationToolbar");return e.maxPage?(d(),p(E,{key:0,id:"readerToolbarNav"},{default:c(()=>[l(a,{direction:s.bookPrev,narrow:!1},null,8,["direction"]),l(h,{value:s.min,"two-pages":s.twoPages},null,8,["value","two-pages"]),(d(),p(m,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:s.step,"track-color":s.trackColor,reverse:e.isReadInReverse,"onUpdate:modelValue":t[0]||(t[0]=A=>s.onSliderUpdate(A))},null,8,["model-value","max","step","track-color","reverse"])),l(h,{value:s.max,"two-pages":s.twoPages},null,8,["value","two-pages"]),l(a,{direction:s.bookNext,narrow:!1},null,8,["direction"])]),_:1})):w("",!0)}const Ps=f(bs,[["render",_s],["__scopeId","data-v-dab0637e"]]),vs={name:"MainReader",components:{BooksWindow:So,ReaderEmpty:ds,ReaderNavToolbar:Ps,ReaderTopToolbar:Le,ReaderSettingsDrawer:Zo,Unauthorized:Rt},data(){return{showToolbars:!1}},computed:{...P(I,["isAuthorized"]),...v(I,{user:e=>e.user}),...v(u,{empty:e=>e.empty})},watch:{user(){this.loadReaderSettings()},isAuthorized(){this.loadReaderSettings()}},beforeMount(){u().$reset,this.loadReaderSettings()},methods:{...b(u,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},Ss={key:0},ws={id:"readerContainer"};function Rs(e,t,o,n,r,s){const a=g("ReaderTopToolbar"),h=g("BooksWindow"),m=g("ReaderNavToolbar"),E=g("ReaderEmpty"),A=g("ReaderSettingsDrawer"),xe=g("Unauthorized");return e.isAuthorized?(d(),p(Ct,{key:0,id:"readerWrapper"},{default:c(()=>[e.empty?(d(),p(E,{key:1})):(d(),S("div",Ss,[i("div",ws,[l(nt,null,{default:c(()=>[D(l(a,null,null,512),[[Q,r.showToolbars]])]),_:1}),l(h,{onClick:s.toggleToolbars},null,8,["onClick"]),l(it,null,{default:c(()=>[D(l(m,null,null,512),[[Q,r.showToolbars]])]),_:1})])])),l(A)]),_:1})):(d(),p(xe,{key:1}))}const Cs=f(vs,[["render",Rs],["__scopeId","data-v-dab9a44d"]]),Es=Object.freeze(Object.defineProperty({__proto__:null,default:Cs},Symbol.toStringTag,{value:"Module"}));export{Es as r,u};
