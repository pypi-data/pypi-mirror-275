(()=>{"use strict";let t=0;function e(t){return""===t||"0"===t||0===t||null==t||null==t}const n={};function o(t,e=null,o=null){return o||(o={}),function(t,e){return t&&t.hasAttribute("pattern")}(t)?function(t,e){let o=t.getAttribute("pattern");if(o in n)return n[o];const i=new RegExp(o,"i");return n[o]=i,i}(t).test(e||t.value)?(t.classList.remove(o.pattern||"is-invalid-pattern"),!0):(t.classList.add(o.pattern||"is-invalid-pattern"),!1):function(t){return t&&t.hasAttribute("min")}(t)?function(t,e){let n=t.getAttribute("min");return!n||parseFloat(e)>=parseFloat(n)}(t,e||t.value)?(t.classList.remove(o.min||"is-invalid-min"),!0):(t.classList.add(o.min||"is-invalid-min"),!1):!function(t){return t&&t.hasAttribute("max")}(t)||(function(t,e){let n=t.getAttribute("max");return!n||parseFloat(e)<=parseFloat(n)}(t,e||t.value)?(t.classList.remove(o.max||"is-invalid-max"),!0):(t.classList.add(o.max||"is-invalid-max"),!1))}function i(t){return"string"==typeof t?document.querySelector(t):t}var r=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))};const s={empty:"is-empty",invalid:"is-invalid",pattern:"is-invalid-pattern",min:"is-invalid-min",max:"is-invalid-max"},a=Object.values(s);function c(e,n,o){return r(this,void 0,void 0,(function*(){if(e=null==e?void 0:e.trim(),n=null==n?void 0:n.trim(),!e)throw new Error("No postcode provided");if(!n)throw new Error("No home number provided");let i=o.buildRequest||function(t,e){let n=function(t){return t.startsWith("http")||(t.startsWith("/")&&(t=t.slice(1)),t=`${window.location.origin}/${t}`),new URL(t)}(d);return n.searchParams.append("postcode",t),n.searchParams.append("home_number",e.toString()),{input:n,init:{method:"GET",headers:{"Content-Type":"application/json"}}}};const{input:r,init:s}=i(e,n),a=yield function(e,n){const o=fetch(e,n),i=Date.now();return t=i,new Promise(((e,n)=>{o.then((o=>{t===i&&(o.ok?e(o):n(o))})).catch(n)}))}(r,s);let c;try{c=yield a.json()}catch(t){throw new Error("Failed to parse response from postcode lookup service")}if(!("success"in c))throw new Error('Invalid response from postcode lookup service, missing "success" field');if(!c.success)throw c.error?new Error(c.error):new Error("Failed to fetch postcode data");if(!("data"in c))throw new Error('Invalid response from postcode lookup service, missing "data" field');const l=c.data;return o.success&&o.success(l),l}))}const d=document.currentScript.dataset.apiUrl;if(!d)throw new Error("No API URL provided, cannot initialize postcode lookup module");console.log("Postcode lookup module initialized with API URL:",d),window.lookupPostcode=function(t){return r(this,void 0,void 0,(function*(){let n=t.postcode,r=t.home_number;if(t&&t.bind&&t.bind.postcode&&t.bind.home_number){let d,l,u;const m=t.bind,p=()=>{if(!n&&!r){for(let t=0;t<a.length;t++){const e=a[t];d.classList.remove(e),l.classList.remove(e)}for(const t of u){const e=m[t];e&&(e.value="")}return!0}return!1},v=t=>{d.classList.remove(s.invalid),l.classList.remove(s.invalid);for(const o of u){const i=m[o];if(i){const c=t[o];for(const t of a)i.classList.remove(t);e(c)||!n&&!r?i.classList.add(s.empty):(i.classList.remove(s.empty),i.value=c.toString())}}},f=e=>{t&&t.error&&t.error(e),d.classList.add(s.invalid),l.classList.add(s.invalid)},h=e=>(e.classList.add("postcodes-input"),()=>{n=d.value,r=l.value,p()||o(e,null,s)&&c(n,r,t).then(v).catch(f)}),b=()=>{if(d=i(t.bind.postcode),l=i(t.bind.home_number),delete t.bind.postcode,delete t.bind.home_number,u=Object.keys(t.bind),0==u.length)throw new Error("At least postcode, home_number and one other field must be bound");for(let t=0;t<u.length;t++){const e=u[t];m[e]=i(m[e])}for(let t=0;t<u.length;t++){const e=u[t],n=m[e];n&&(n.classList.add("postcodes-input"),n.addEventListener("change",(()=>o(n,null,s))))}d.addEventListener("input",h(d)),l.addEventListener("input",h(l))};"complete"===document.readyState||"interactive"===document.readyState?b():document.addEventListener("DOMContentLoaded",b)}else{if(t&&t.bind&&(!t.bind.postcode||!t.bind.home_number))throw new Error("Both postcode and home_number must be bound to use the bind option");try{return yield c(n,r,t)}catch(e){throw t&&t.error&&t.error(e),e}}}))}})();