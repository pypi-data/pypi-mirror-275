# SPDX-FileCopyrightText: 2023 - 2024 Ledger SAS
# SPDX-License-Identifier: Apache-2.0

[tox]
min_version = 4.0
env_list =
  lint
  license
  type
  unittests
  htmlcov
  # docs
isolated_build = true

[tox:.package]
basepython = python3

[testenv]
# extras = devel

[testenv:unittests]
extras = devel
commands =
  pytest --tb=long -v {posargs}

[testenv:htmlcov]
extras = devel
commands =
  coverage run --parallel-mode -m pytest {posargs}
  coverage combine
  coverage report
  coverage html --directory=reports/testcov

[testenv:lint]
extras = lint
commands =
  black --line-length 100 --check --diff .

[testenv:type]
extras = type
commands =
  mypy -p svd2json --html-report reports/mypycov

[testenv:licenses]
extras = license
commands = reuse lint

# [testenv:docs]

[flake8]
select = C, E, F, W, B, B9

# XXX:
# Some flake8 rules conflicts with Black and/or aren't PEP8 compliant, in case of conflit we
# choose the Black way of doing.
#  - E203: is not PEP8 compliant and conflit with blake, must be disabled
#  - E704: complain about collapse impl. for ellided func/method/class which is allowed by PEP8
#          Black will ensure that this is the only case in which one should write a oneliner.
ignore = E203, E704
max-line-length = 100
exclude = .git, .github, __pycache__, build, dist, .eggs, .tox, venv, venv*, .venv, .venv*, reports, .mypy_cache
