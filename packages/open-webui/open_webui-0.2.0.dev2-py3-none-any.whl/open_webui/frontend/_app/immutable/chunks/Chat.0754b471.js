import{s as Jt,E as te,F as ee,G as le,H as ne,w as st,e as St,i as P,d as m,I as De,x as $t,y as zl,p as mt,f as I,g as M,h as E,L as Kt,Z as _e,u as K,v as se,U as Ve,C as Tt,P as ie,a as X,l as rt,R as Gt,c as Q,m as it,j as f,r as b,n as bt,K as pe,t as pt,W as Pe,z as ht,A as gt,Q as je,O as xl,X as jt,o as He,S as ge,B as $l,M as tn}from"./scheduler.bc5a4ea8.js";import{S as Yt,i as Xt,a as U,t as R,g as Ut,c as Pt,h as Fl,j as ql,k as Se,f as zt,b as at,d as ct,m as ut,e as ft}from"./index.5e522d2c.js";import{g as en}from"./globals.7f7f1b26.js";import{e as xt}from"./each.eda84b85.js";import{a as ot}from"./Toaster.svelte_svelte_type_style_lang.264cdd7d.js";import{g as Ne}from"./navigation.01f37cd6.js";import{p as ln}from"./stores.3eb2f079.js";import{p as nn,n as sn,e as Be,f as he,i as Ce,m as Wl,a as Te,S as ze,q as Fe,u as Gl,W as Zl,h as me,j as on,c as rn,o as an,g as Ie,O as qe,r as cn}from"./index.dca233de.js";import{f as Jl,r as Oe,i as We,h as Ge,v as Ze,s as un,a as Je,j as fn}from"./index.9a95918f.js";import{s as dn,q as mn,r as hn,t as gn,M as _n,v as pn,w as vn,x as bn,c as Ye}from"./menu-trigger.003d1e90.js";import{c as wn,b as Me,u as Ae,i as kn,n as yn}from"./index.3b9fd815.js";import{A as En,u as In,a as Mn,b as Dn}from"./AddFilesPlaceholder.3d2650d7.js";import{t as Xe}from"./index.68e5d06d.js";import{M as Sn}from"./Messages.fc6d27d5.js";import"./sha256.8dba905a.js";import{T as ae}from"./create.427b7dc2.js";import{D as Cn,M as Ue,T as Tn,S as Vn,U as Bn,q as Nn}from"./UserMenu.61a9fa14.js";import{c as On,e as An}from"./index.f79321e6.js";import{S as Ln}from"./Selector.43fa378c.js";import{d as Un}from"./index.85c0bfdf.js";import{g as ve}from"./spread.8a54911c.js";import{a as Yl,d as Pn}from"./updater.4d70ecd8.js";import{f as Hn}from"./FileSaver.min.898eb36f.js";import{f as Xl}from"./index.1df8947f.js";import"./paths.973fc9e2.js";import{M as Rn}from"./MenuLines.cadd813b.js";import{f as Qe}from"./dayjs.min.b0a164f5.js";const jn=n=>({subIds:n&1}),Ke=n=>({subIds:n[0]});function zn(n){let t;const e=n[6].default,l=te(e,n,n[5],Ke);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,r){l&&l.m(s,r),t=!0},p(s,[r]){l&&l.p&&(!t||r&33)&&ee(l,e,s,s[5],t?ne(e,s[5],r,jn):le(s[5]),Ke)},i(s){t||(U(l,s),t=!0)},o(s){R(l,s),t=!1},d(s){l&&l.d(s)}}}function Fn(n,t,e){let l,{$$slots:s={},$$scope:r}=t,{disabled:o=void 0}=t,{open:i=void 0}=t,{onOpenChange:a=void 0}=t;const{updateOption:u,ids:c,states:{subOpen:d}}=dn({disabled:o,onOpenChange:({next:w})=>(i!==w&&(a==null||a(w),e(2,i=w)),w)}),p=Un([c.menu,c.trigger],([w,_])=>({menu:w,trigger:_}));return st(n,p,w=>e(0,l=w)),n.$$set=w=>{"disabled"in w&&e(3,o=w.disabled),"open"in w&&e(2,i=w.open),"onOpenChange"in w&&e(4,a=w.onOpenChange),"$$scope"in w&&e(5,r=w.$$scope)},n.$$.update=()=>{n.$$.dirty&4&&i!==void 0&&d.set(i),n.$$.dirty&8&&u("disabled",o)},[l,p,i,o,a,r,s]}class qn extends Yt{constructor(t){super(),Xt(this,t,Fn,zn,Jt,{disabled:3,open:2,onOpenChange:4})}}const Wn=n=>({builder:n[0]&256}),xe=n=>({builder:n[8]}),Gn=n=>({builder:n[0]&256}),$e=n=>({builder:n[8]}),Zn=n=>({builder:n[0]&256}),tl=n=>({builder:n[8]}),Jn=n=>({builder:n[0]&256}),el=n=>({builder:n[8]}),Yn=n=>({builder:n[0]&256}),ll=n=>({builder:n[8]}),Xn=n=>({builder:n[0]&256}),nl=n=>({builder:n[8]});function Qn(n){let t,e,l,s;const r=n[28].default,o=te(r,n,n[27],xe);let i=[n[8],n[13]],a={};for(let u=0;u<i.length;u+=1)a=$t(a,i[u]);return{c(){t=I("div"),o&&o.c(),this.h()},l(u){t=M(u,"DIV",{});var c=E(t);o&&o.l(c),c.forEach(m),this.h()},h(){Kt(t,a)},m(u,c){P(u,t,c),o&&o.m(t,null),n[33](t),e=!0,l||(s=[_e(n[8].action(t)),K(t,"m-focusout",n[12]),K(t,"m-keydown",n[12]),K(t,"m-pointermove",n[12])],l=!0)},p(u,c){o&&o.p&&(!e||c[0]&134217984)&&ee(o,r,u,u[27],e?ne(r,u[27],c,Wn):le(u[27]),xe),Kt(t,a=ve(i,[c[0]&256&&u[8],c[0]&8192&&u[13]]))},i(u){e||(U(o,u),e=!0)},o(u){R(o,u),e=!1},d(u){u&&m(t),o&&o.d(u),n[33](null),l=!1,se(s)}}}function Kn(n){let t,e,l,s,r;const o=n[28].default,i=te(o,n,n[27],$e);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=$t(u,a[c]);return{c(){t=I("div"),i&&i.c(),this.h()},l(c){t=M(c,"DIV",{});var d=E(t);i&&i.l(d),d.forEach(m),this.h()},h(){Kt(t,u)},m(c,d){P(c,t,d),i&&i.m(t,null),n[32](t),l=!0,s||(r=[_e(n[8].action(t)),K(t,"m-focusout",n[12]),K(t,"m-keydown",n[12]),K(t,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&ee(i,o,n,n[27],l?ne(o,n[27],d,Gn):le(n[27]),$e),Kt(t,u=ve(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(U(i,c),e&&e.end(1),l=!0)},o(c){R(i,c),c&&(e=Fl(t,n[5],n[6])),l=!1},d(c){c&&m(t),i&&i.d(c),n[32](null),c&&e&&e.end(),s=!1,se(r)}}}function xn(n){let t,e,l,s,r;const o=n[28].default,i=te(o,n,n[27],tl);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=$t(u,a[c]);return{c(){t=I("div"),i&&i.c(),this.h()},l(c){t=M(c,"DIV",{});var d=E(t);i&&i.l(d),d.forEach(m),this.h()},h(){Kt(t,u)},m(c,d){P(c,t,d),i&&i.m(t,null),n[31](t),l=!0,s||(r=[_e(n[8].action(t)),K(t,"m-focusout",n[12]),K(t,"m-keydown",n[12]),K(t,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&ee(i,o,n,n[27],l?ne(o,n[27],d,Zn):le(n[27]),tl),Kt(t,u=ve(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(U(i,c),c&&(e||Ve(()=>{e=ql(t,n[3],n[4]),e.start()})),l=!0)},o(c){R(i,c),l=!1},d(c){c&&m(t),i&&i.d(c),n[31](null),s=!1,se(r)}}}function $n(n){let t,e,l,s,r,o;const i=n[28].default,a=te(i,n,n[27],el);let u=[n[8],n[13]],c={};for(let d=0;d<u.length;d+=1)c=$t(c,u[d]);return{c(){t=I("div"),a&&a.c(),this.h()},l(d){t=M(d,"DIV",{});var p=E(t);a&&a.l(p),p.forEach(m),this.h()},h(){Kt(t,c)},m(d,p){P(d,t,p),a&&a.m(t,null),n[30](t),s=!0,r||(o=[_e(n[8].action(t)),K(t,"m-focusout",n[12]),K(t,"m-keydown",n[12]),K(t,"m-pointermove",n[12])],r=!0)},p(d,p){n=d,a&&a.p&&(!s||p[0]&134217984)&&ee(a,i,n,n[27],s?ne(i,n[27],p,Jn):le(n[27]),el),Kt(t,c=ve(u,[p[0]&256&&n[8],p[0]&8192&&n[13]]))},i(d){s||(U(a,d),d&&Ve(()=>{s&&(l&&l.end(1),e=ql(t,n[3],n[4]),e.start())}),s=!0)},o(d){R(a,d),e&&e.invalidate(),d&&(l=Fl(t,n[5],n[6])),s=!1},d(d){d&&m(t),a&&a.d(d),n[30](null),d&&l&&l.end(),r=!1,se(o)}}}function ts(n){let t,e,l,s,r;const o=n[28].default,i=te(o,n,n[27],ll);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=$t(u,a[c]);return{c(){t=I("div"),i&&i.c(),this.h()},l(c){t=M(c,"DIV",{});var d=E(t);i&&i.l(d),d.forEach(m),this.h()},h(){Kt(t,u)},m(c,d){P(c,t,d),i&&i.m(t,null),n[29](t),l=!0,s||(r=[_e(n[8].action(t)),K(t,"m-focusout",n[12]),K(t,"m-keydown",n[12]),K(t,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&ee(i,o,n,n[27],l?ne(o,n[27],d,Yn):le(n[27]),ll),Kt(t,u=ve(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(U(i,c),c&&Ve(()=>{l&&(e||(e=Se(t,n[1],n[2],!0)),e.run(1))}),l=!0)},o(c){R(i,c),c&&(e||(e=Se(t,n[1],n[2],!1)),e.run(0)),l=!1},d(c){c&&m(t),i&&i.d(c),n[29](null),c&&e&&e.end(),s=!1,se(r)}}}function es(n){let t;const e=n[28].default,l=te(e,n,n[27],nl);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,r){l&&l.m(s,r),t=!0},p(s,r){l&&l.p&&(!t||r[0]&134217984)&&ee(l,e,s,s[27],t?ne(e,s[27],r,Xn):le(s[27]),nl)},i(s){t||(U(l,s),t=!0)},o(s){R(l,s),t=!1},d(s){l&&l.d(s)}}}function ls(n){let t,e,l,s;const r=[es,ts,$n,xn,Kn,Qn],o=[];function i(a,u){return a[7]&&a[9]?0:a[1]&&a[9]?1:a[3]&&a[5]&&a[9]?2:a[3]&&a[9]?3:a[5]&&a[9]?4:a[9]?5:-1}return~(t=i(n))&&(e=o[t]=r[t](n)),{c(){e&&e.c(),l=St()},l(a){e&&e.l(a),l=St()},m(a,u){~t&&o[t].m(a,u),P(a,l,u),s=!0},p(a,u){let c=t;t=i(a),t===c?~t&&o[t].p(a,u):(e&&(Ut(),R(o[c],1,1,()=>{o[c]=null}),Pt()),~t?(e=o[t],e?e.p(a,u):(e=o[t]=r[t](a),e.c()),U(e,1),e.m(l.parentNode,l)):e=null)},i(a){s||(U(e),s=!0)},o(a){R(e),s=!1},d(a){a&&m(l),~t&&o[t].d(a)}}}function ns(n,t,e){let l;const s=["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el"];let r=De(t,s),o,i,{$$slots:a={},$$scope:u}=t,{transition:c=void 0}=t,{transitionConfig:d=void 0}=t,{inTransition:p=void 0}=t,{inTransitionConfig:w=void 0}=t,{outTransition:_=void 0}=t,{outTransitionConfig:k=void 0}=t,{asChild:g=!1}=t,{id:y=void 0}=t,{side:v="right"}=t,{align:T="start"}=t,{sideOffset:C=0}=t,{alignOffset:H=0}=t,{collisionPadding:S=8}=t,{avoidCollisions:B=!0}=t,{collisionBoundary:L=void 0}=t,{sameWidth:Z=!1}=t,{fitViewport:N=!1}=t,{strategy:O="absolute"}=t,{overlap:tt=!1}=t,{el:W=void 0}=t;const{elements:{subMenu:nt},states:{subOpen:At},ids:yt,getAttrs:Lt}=mn();st(n,nt,A=>e(26,o=A)),st(n,At,A=>e(9,i=A));const Ct=Yl(),_t=Lt("sub-content");function Vt(A){mt[A?"unshift":"push"](()=>{W=A,e(0,W)})}function Zt(A){mt[A?"unshift":"push"](()=>{W=A,e(0,W)})}function qt(A){mt[A?"unshift":"push"](()=>{W=A,e(0,W)})}function Bt(A){mt[A?"unshift":"push"](()=>{W=A,e(0,W)})}function j(A){mt[A?"unshift":"push"](()=>{W=A,e(0,W)})}return n.$$set=A=>{t=$t($t({},t),zl(A)),e(13,r=De(t,s)),"transition"in A&&e(1,c=A.transition),"transitionConfig"in A&&e(2,d=A.transitionConfig),"inTransition"in A&&e(3,p=A.inTransition),"inTransitionConfig"in A&&e(4,w=A.inTransitionConfig),"outTransition"in A&&e(5,_=A.outTransition),"outTransitionConfig"in A&&e(6,k=A.outTransitionConfig),"asChild"in A&&e(7,g=A.asChild),"id"in A&&e(14,y=A.id),"side"in A&&e(15,v=A.side),"align"in A&&e(16,T=A.align),"sideOffset"in A&&e(17,C=A.sideOffset),"alignOffset"in A&&e(18,H=A.alignOffset),"collisionPadding"in A&&e(19,S=A.collisionPadding),"avoidCollisions"in A&&e(20,B=A.avoidCollisions),"collisionBoundary"in A&&e(21,L=A.collisionBoundary),"sameWidth"in A&&e(22,Z=A.sameWidth),"fitViewport"in A&&e(23,N=A.fitViewport),"strategy"in A&&e(24,O=A.strategy),"overlap"in A&&e(25,tt=A.overlap),"el"in A&&e(0,W=A.el),"$$scope"in A&&e(27,u=A.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&y&&yt.menu.set(y),n.$$.dirty[0]&67108864&&e(8,l=o),n.$$.dirty[0]&256&&Object.assign(l,_t),n.$$.dirty[0]&67076096&&hn({side:v,align:T,sideOffset:C,alignOffset:H,collisionPadding:S,avoidCollisions:B,collisionBoundary:L,sameWidth:Z,fitViewport:N,strategy:O,overlap:tt})},[W,c,d,p,w,_,k,g,l,i,nt,At,Ct,r,y,v,T,C,H,S,B,L,Z,N,O,tt,o,u,a,Vt,Zt,qt,Bt,j]}class ss extends Yt{constructor(t){super(),Xt(this,t,ns,ls,Jt,{transition:1,transitionConfig:2,inTransition:3,inTransitionConfig:4,outTransition:5,outTransitionConfig:6,asChild:7,id:14,side:15,align:16,sideOffset:17,alignOffset:18,collisionPadding:19,avoidCollisions:20,collisionBoundary:21,sameWidth:22,fitViewport:23,strategy:24,overlap:25,el:0},null,[-1,-1])}}const os=n=>({builder:n&4}),sl=n=>({builder:n[2]}),rs=n=>({builder:n&4}),ol=n=>({builder:n[2]});function is(n){let t,e,l,s;const r=n[13].default,o=te(r,n,n[12],sl);let i=[n[2],n[6]],a={};for(let u=0;u<i.length;u+=1)a=$t(a,i[u]);return{c(){t=I("div"),o&&o.c(),this.h()},l(u){t=M(u,"DIV",{});var c=E(t);o&&o.l(c),c.forEach(m),this.h()},h(){Kt(t,a)},m(u,c){P(u,t,c),o&&o.m(t,null),n[14](t),e=!0,l||(s=[_e(n[2].action(t)),K(t,"m-click",n[5]),K(t,"m-focusin",n[5]),K(t,"m-focusout",n[5]),K(t,"m-keydown",n[5]),K(t,"m-pointerleave",n[5]),K(t,"m-pointermove",n[5])],l=!0)},p(u,c){o&&o.p&&(!e||c&4100)&&ee(o,r,u,u[12],e?ne(r,u[12],c,os):le(u[12]),sl),Kt(t,a=ve(i,[c&4&&u[2],c&64&&u[6]]))},i(u){e||(U(o,u),e=!0)},o(u){R(o,u),e=!1},d(u){u&&m(t),o&&o.d(u),n[14](null),l=!1,se(s)}}}function as(n){let t;const e=n[13].default,l=te(e,n,n[12],ol);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,r){l&&l.m(s,r),t=!0},p(s,r){l&&l.p&&(!t||r&4100)&&ee(l,e,s,s[12],t?ne(e,s[12],r,rs):le(s[12]),ol)},i(s){t||(U(l,s),t=!0)},o(s){R(l,s),t=!1},d(s){l&&l.d(s)}}}function cs(n){let t,e,l,s;const r=[as,is],o=[];function i(a,u){return a[1]?0:1}return t=i(n),e=o[t]=r[t](n),{c(){e.c(),l=St()},l(a){e.l(a),l=St()},m(a,u){o[t].m(a,u),P(a,l,u),s=!0},p(a,[u]){let c=t;t=i(a),t===c?o[t].p(a,u):(Ut(),R(o[c],1,1,()=>{o[c]=null}),Pt(),e=o[t],e?e.p(a,u):(e=o[t]=r[t](a),e.c()),U(e,1),e.m(l.parentNode,l))},i(a){s||(U(e),s=!0)},o(a){R(e),s=!1},d(a){a&&m(l),o[t].d(a)}}}function us(n,t,e){let l,s;const r=["disabled","asChild","id","el"];let o=De(t,r),i,a,{$$slots:u={},$$scope:c}=t,{disabled:d=!1}=t,{asChild:p=!1}=t,{id:w=void 0}=t,{el:_=void 0}=t;const{elements:{subTrigger:k},ids:g,getAttrs:y,options:v}=gn();st(n,k,S=>e(11,a=S));const{disabled:T}=v;st(n,T,S=>e(10,i=S));const C=Yl();function H(S){mt[S?"unshift":"push"](()=>{_=S,e(0,_)})}return n.$$set=S=>{t=$t($t({},t),zl(S)),e(6,o=De(t,r)),"disabled"in S&&e(7,d=S.disabled),"asChild"in S&&e(1,p=S.asChild),"id"in S&&e(8,w=S.id),"el"in S&&e(0,_=S.el),"$$scope"in S&&e(12,c=S.$$scope)},n.$$.update=()=>{n.$$.dirty&256&&w&&g.trigger.set(w),n.$$.dirty&2048&&e(2,l=a),n.$$.dirty&1152&&e(9,s={...y("sub-trigger"),...Pn(d||i)}),n.$$.dirty&516&&Object.assign(l,s)},[_,p,l,k,T,C,o,d,w,s,i,a,c,u,H]}class fs extends Yt{constructor(t){super(),Xt(this,t,us,cs,Jt,{disabled:7,asChild:1,id:8,el:0})}}function rl(n,t,e){const l=n.slice();return l[11]=t[e],l[13]=e,l}function il(n){let t,e,l,s='<div class="text-lg font-semibold mt-2">/</div>',r,o,i,a,u,c,d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',p,w,_=n[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",k,g=xt(n[1]),y=[];for(let v=0;v<g.length;v+=1)y[v]=al(rl(n,g,v));return{c(){t=I("div"),e=I("div"),l=I("div"),l.innerHTML=s,r=X(),o=I("div"),i=I("div");for(let v=0;v<y.length;v+=1)y[v].c();a=X(),u=I("div"),c=I("div"),c.innerHTML=d,p=X(),w=I("div"),k=rt(_),this.h()},l(v){t=M(v,"DIV",{class:!0});var T=E(t);e=M(T,"DIV",{class:!0});var C=E(e);l=M(C,"DIV",{class:!0,"data-svelte-h":!0}),Gt(l)!=="svelte-1ynv172"&&(l.innerHTML=s),r=Q(C),o=M(C,"DIV",{class:!0});var H=E(o);i=M(H,"DIV",{class:!0});var S=E(i);for(let Z=0;Z<y.length;Z+=1)y[Z].l(S);S.forEach(m),a=Q(H),u=M(H,"DIV",{class:!0});var B=E(u);c=M(B,"DIV",{"data-svelte-h":!0}),Gt(c)!=="svelte-cdi12d"&&(c.innerHTML=d),p=Q(B),w=M(B,"DIV",{class:!0});var L=E(w);k=it(L,_),L.forEach(m),B.forEach(m),H.forEach(m),C.forEach(m),T.forEach(m),this.h()},h(){f(l,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),f(w,"class","line-clamp-1"),f(u,"class","px-2 pb-1 text-xs text-gray-600 bg-white rounded-br-xl flex items-center space-x-1"),f(o,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),f(e,"class","flex w-full px-2"),f(t,"class","md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(v,T){P(v,t,T),b(t,e),b(e,l),b(e,r),b(e,o),b(o,i);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(i,null);b(o,a),b(o,u),b(u,c),b(u,p),b(u,w),b(w,k)},p(v,T){if(T&19){g=xt(v[1]);let C;for(C=0;C<g.length;C+=1){const H=rl(v,g,C);y[C]?y[C].p(H,T):(y[C]=al(H),y[C].c(),y[C].m(i,null))}for(;C<y.length;C+=1)y[C].d(1);y.length=g.length}T&4&&_!==(_=v[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&bt(k,_)},d(v){v&&m(t),pe(y,v)}}}function al(n){let t,e,l=n[11].command+"",s,r,o,i=n[11].title+"",a,u,c,d,p;function w(){return n[9](n[11])}function _(){return n[10](n[13])}return{c(){t=I("button"),e=I("div"),s=rt(l),r=X(),o=I("div"),a=rt(i),u=X(),this.h()},l(k){t=M(k,"BUTTON",{class:!0,type:!0});var g=E(t);e=M(g,"DIV",{class:!0});var y=E(e);s=it(y,l),y.forEach(m),r=Q(g),o=M(g,"DIV",{class:!0});var v=E(o);a=it(v,i),v.forEach(m),u=Q(g),g.forEach(m),this.h()},h(){f(e,"class","font-medium text-black"),f(o,"class","text-xs text-gray-600"),f(t,"class",c="px-3 py-1.5 rounded-xl w-full text-left "+(n[13]===n[0]?" bg-gray-100 selected-command-option-button":"")),f(t,"type","button")},m(k,g){P(k,t,g),b(t,e),b(e,s),b(t,r),b(t,o),b(o,a),b(t,u),d||(p=[K(t,"click",w),K(t,"mousemove",_),K(t,"focus",ms)],d=!0)},p(k,g){n=k,g&2&&l!==(l=n[11].command+"")&&bt(s,l),g&2&&i!==(i=n[11].title+"")&&bt(a,i),g&1&&c!==(c="px-3 py-1.5 rounded-xl w-full text-left "+(n[13]===n[0]?" bg-gray-100 selected-command-option-button":""))&&f(t,"class",c)},d(k){k&&m(t),d=!1,se(p)}}}function ds(n){let t,e=n[1].length>0&&il(n);return{c(){e&&e.c(),t=St()},l(l){e&&e.l(l),t=St()},m(l,s){e&&e.m(l,s),P(l,t,s)},p(l,[s]){l[1].length>0?e?e.p(l,s):(e=il(l),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:Tt,o:Tt,d(l){l&&m(t),e&&e.d(l)}}}const ms=()=>{};function hs(n,t,e){let l,s;st(n,nn,_=>e(8,s=_));const r=ie("i18n");st(n,r,_=>e(2,l=_));let{prompt:o=""}=t,i=0,a=[];const u=()=>{e(0,i=Math.max(0,i-1))},c=()=>{e(0,i=Math.min(i+1,a.length-1))},d=async _=>{let k=_.content;if(_.content.includes("{{CLIPBOARD}}")){const v=await navigator.clipboard.readText().catch(T=>(ot.error(l.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));k=_.content.replaceAll("{{CLIPBOARD}}",v)}e(5,o=k);const g=document.getElementById("chat-textarea");await pt(),g.style.height="",g.style.height=Math.min(g.scrollHeight,200)+"px",g==null||g.focus(),await pt();const y=Jl(o);if(y.length>0){const v=y.at(0);g.setSelectionRange(v==null?void 0:v.startIndex,v.endIndex+1)}},p=_=>{d(_)},w=_=>{e(0,i=_)};return n.$$set=_=>{"prompt"in _&&e(5,o=_.prompt)},n.$$.update=()=>{n.$$.dirty&288&&e(1,a=s.filter(_=>_.command.includes(o)).sort((_,k)=>_.title.localeCompare(k.title))),n.$$.dirty&32&&o&&e(0,i=0)},[i,a,l,r,d,o,u,c,s,p,w]}class gs extends Yt{constructor(t){super(),Xt(this,t,hs,ds,Jt,{prompt:5,selectUp:6,selectDown:7})}get selectUp(){return this.$$.ctx[6]}get selectDown(){return this.$$.ctx[7]}}function cl(n,t,e){const l=n.slice();return l[19]=t[e],l[21]=e,l}function ul(n){let t,e,l,s='<div class="text-lg font-semibold mt-2">#</div>',r,o,i,a,u,c,d=xt(n[3]),p=[];for(let g=0;g<d.length;g+=1)p[g]=fl(cl(n,d,g));function w(g,y){var v,T;if(y&1&&(u=null),y&1&&(c=null),u==null&&(u=!!g[0].split(" ").some(ks)),u)return bs;if(c==null&&(c=!!((T=(v=g[0].split(" "))==null?void 0:v.at(0))!=null&&T.substring(1).startsWith("http"))),c)return vs}let _=w(n,-1),k=_&&_(n);return{c(){t=I("div"),e=I("div"),l=I("div"),l.innerHTML=s,r=X(),o=I("div"),i=I("div");for(let g=0;g<p.length;g+=1)p[g].c();a=X(),k&&k.c(),this.h()},l(g){t=M(g,"DIV",{class:!0});var y=E(t);e=M(y,"DIV",{class:!0});var v=E(e);l=M(v,"DIV",{class:!0,"data-svelte-h":!0}),Gt(l)!=="svelte-czbw16"&&(l.innerHTML=s),r=Q(v),o=M(v,"DIV",{class:!0});var T=E(o);i=M(T,"DIV",{class:!0});var C=E(i);for(let H=0;H<p.length;H+=1)p[H].l(C);a=Q(C),k&&k.l(C),C.forEach(m),T.forEach(m),v.forEach(m),y.forEach(m),this.h()},h(){f(l,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),f(o,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),f(e,"class","flex w-full px-2"),f(t,"class","md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(g,y){P(g,t,y),b(t,e),b(e,l),b(e,r),b(e,o),b(o,i);for(let v=0;v<p.length;v+=1)p[v]&&p[v].m(i,null);b(i,a),k&&k.m(i,null)},p(g,y){if(y&46){d=xt(g[3]);let v;for(v=0;v<d.length;v+=1){const T=cl(g,d,v);p[v]?p[v].p(T,y):(p[v]=fl(T),p[v].c(),p[v].m(i,a))}for(;v<p.length;v+=1)p[v].d(1);p.length=d.length}_===(_=w(g,y))&&k?k.p(g,y):(k&&k.d(1),k=_&&_(g),k&&(k.c(),k.m(i,null)))},d(g){g&&m(t),pe(p,g),k&&k.d()}}}function _s(n){let t,e,l=n[19].name+"",s,r,o=n[19].filename+"",i,a,u,c,d=n[19].title+"",p;return{c(){t=I("div"),e=rt("#"),s=rt(l),r=rt(" ("),i=rt(o),a=rt(")"),u=X(),c=I("div"),p=rt(d),this.h()},l(w){t=M(w,"DIV",{class:!0});var _=E(t);e=it(_,"#"),s=it(_,l),r=it(_," ("),i=it(_,o),a=it(_,")"),_.forEach(m),u=Q(w),c=M(w,"DIV",{class:!0});var k=E(c);p=it(k,d),k.forEach(m),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(c,"class","text-xs text-gray-600 line-clamp-1")},m(w,_){P(w,t,_),b(t,e),b(t,s),b(t,r),b(t,i),b(t,a),P(w,u,_),P(w,c,_),b(c,p)},p(w,_){_&8&&l!==(l=w[19].name+"")&&bt(s,l),_&8&&o!==(o=w[19].filename+"")&&bt(i,o),_&8&&d!==(d=w[19].title+"")&&bt(p,d)},d(w){w&&(m(t),m(u),m(c))}}}function ps(n){var a;let t,e=(((a=n[19])==null?void 0:a.title)??`#${n[19].name}`)+"",l,s,r,o=n[1].t("Collection")+"",i;return{c(){t=I("div"),l=rt(e),s=X(),r=I("div"),i=rt(o),this.h()},l(u){t=M(u,"DIV",{class:!0});var c=E(t);l=it(c,e),c.forEach(m),s=Q(u),r=M(u,"DIV",{class:!0});var d=E(r);i=it(d,o),d.forEach(m),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1")},m(u,c){P(u,t,c),b(t,l),P(u,s,c),P(u,r,c),b(r,i)},p(u,c){var d;c&8&&e!==(e=(((d=u[19])==null?void 0:d.title)??`#${u[19].name}`)+"")&&bt(l,e),c&2&&o!==(o=u[1].t("Collection")+"")&&bt(i,o)},d(u){u&&(m(t),m(s),m(r))}}}function fl(n){let t,e,l,s;function r(c,d){return c[19].type==="collection"?ps:_s}let o=r(n),i=o(n);function a(){return n[14](n[19])}function u(){return n[15](n[21])}return{c(){t=I("button"),i.c(),this.h()},l(c){t=M(c,"BUTTON",{class:!0,type:!0});var d=E(t);i.l(d),d.forEach(m),this.h()},h(){f(t,"class",e="px-3 py-1.5 rounded-xl w-full text-left "+(n[21]===n[2]?" bg-gray-100 selected-command-option-button":"")),f(t,"type","button")},m(c,d){P(c,t,d),i.m(t,null),l||(s=[K(t,"click",a),K(t,"mousemove",u),K(t,"focus",ys)],l=!0)},p(c,d){n=c,o===(o=r(n))&&i?i.p(n,d):(i.d(1),i=o(n),i&&(i.c(),i.m(t,null))),d&4&&e!==(e="px-3 py-1.5 rounded-xl w-full text-left "+(n[21]===n[2]?" bg-gray-100 selected-command-option-button":""))&&f(t,"class",e)},d(c){c&&m(t),i.d(),l=!1,se(s)}}}function vs(n){var d,p;let t,e,l=((p=(d=n[0].split(" "))==null?void 0:d.at(0))==null?void 0:p.substring(1))+"",s,r,o,i=n[1].t("Web")+"",a,u,c;return{c(){t=I("button"),e=I("div"),s=rt(l),r=X(),o=I("div"),a=rt(i),this.h()},l(w){t=M(w,"BUTTON",{class:!0,type:!0});var _=E(t);e=M(_,"DIV",{class:!0});var k=E(e);s=it(k,l),k.forEach(m),r=Q(_),o=M(_,"DIV",{class:!0});var g=E(o);a=it(g,i),g.forEach(m),_.forEach(m),this.h()},h(){f(e,"class","font-medium text-black line-clamp-1"),f(o,"class","text-xs text-gray-600 line-clamp-1"),f(t,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(t,"type","button")},m(w,_){P(w,t,_),b(t,e),b(e,s),b(t,r),b(t,o),b(o,a),u||(c=K(t,"click",n[17]),u=!0)},p(w,_){var k,g;_&1&&l!==(l=((g=(k=w[0].split(" "))==null?void 0:k.at(0))==null?void 0:g.substring(1))+"")&&bt(s,l),_&2&&i!==(i=w[1].t("Web")+"")&&bt(a,i)},d(w){w&&m(t),u=!1,c()}}}function bs(n){var d,p;let t,e,l=((p=(d=n[0].split(" "))==null?void 0:d.at(0))==null?void 0:p.substring(1))+"",s,r,o,i=n[1].t("Youtube")+"",a,u,c;return{c(){t=I("button"),e=I("div"),s=rt(l),r=X(),o=I("div"),a=rt(i),this.h()},l(w){t=M(w,"BUTTON",{class:!0,type:!0});var _=E(t);e=M(_,"DIV",{class:!0});var k=E(e);s=it(k,l),k.forEach(m),r=Q(_),o=M(_,"DIV",{class:!0});var g=E(o);a=it(g,i),g.forEach(m),_.forEach(m),this.h()},h(){f(e,"class","font-medium text-black line-clamp-1"),f(o,"class","text-xs text-gray-600 line-clamp-1"),f(t,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(t,"type","button")},m(w,_){P(w,t,_),b(t,e),b(e,s),b(t,r),b(t,o),b(o,a),u||(c=K(t,"click",n[16]),u=!0)},p(w,_){var k,g;_&1&&l!==(l=((g=(k=w[0].split(" "))==null?void 0:k.at(0))==null?void 0:g.substring(1))+"")&&bt(s,l),_&2&&i!==(i=w[1].t("Youtube")+"")&&bt(a,i)},d(w){w&&m(t),u=!1,c()}}}function ws(n){var s,r;let t=n[3].length>0||((r=(s=n[0].split(" "))==null?void 0:s.at(0))==null?void 0:r.substring(1).startsWith("http")),e,l=t&&ul(n);return{c(){l&&l.c(),e=St()},l(o){l&&l.l(o),e=St()},m(o,i){l&&l.m(o,i),P(o,e,i)},p(o,[i]){var a,u;i&9&&(t=o[3].length>0||((u=(a=o[0].split(" "))==null?void 0:a.at(0))==null?void 0:u.substring(1).startsWith("http"))),t?l?l.p(o,i):(l=ul(o),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:Tt,o:Tt,d(o){o&&m(e),l&&l.d(o)}}}const ks=n=>n.substring(1).startsWith("https://www.youtube.com")||n.substring(1).startsWith("https://youtu.be"),ys=()=>{};function Es(n,t,e){let l,s,r;st(n,sn,S=>e(13,s=S));const o=ie("i18n");st(n,o,S=>e(1,r=S));let{prompt:i=""}=t;const a=Pe();let u=0,c=[],d=[],p=[];const w=()=>{e(2,u=Math.max(0,u-1))},_=()=>{e(2,u=Math.min(u+1,c.length-1))},k=async S=>{a("select",S),e(0,i=Oe(i));const B=document.getElementById("chat-textarea");await pt(),B==null||B.focus(),await pt()},g=async S=>{a("url",S),e(0,i=Oe(i));const B=document.getElementById("chat-textarea");await pt(),B==null||B.focus(),await pt()},y=async S=>{a("youtube",S),e(0,i=Oe(i));const B=document.getElementById("chat-textarea");await pt(),B==null||B.focus(),await pt()},v=S=>{console.log(S),k(S)},T=S=>{e(2,u=S)},C=()=>{var B,L;const S=(L=(B=i.split(" "))==null?void 0:B.at(0))==null?void 0:L.substring(1);We(S)?y(S):ot.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},H=()=>{var B,L;const S=(L=(B=i.split(" "))==null?void 0:B.at(0))==null?void 0:L.substring(1);We(S)?g(S):ot.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return n.$$set=S=>{"prompt"in S&&e(0,i=S.prompt)},n.$$.update=()=>{n.$$.dirty&8194&&e(11,p=[...s.length>0?[{name:"All Documents",type:"collection",title:r.t("All Documents"),collection_names:s.map(S=>S.collection_name)}]:[],...s.reduce((S,B,L,Z)=>{var N;return[...new Set([...S,...(((N=B==null?void 0:B.content)==null?void 0:N.tags)??[]).map(O=>O.name)])]},[]).map(S=>({name:S,type:"collection",collection_names:s.filter(B=>{var L;return(((L=B==null?void 0:B.content)==null?void 0:L.tags)??[]).map(Z=>Z.name).includes(S)}).map(B=>B.collection_name)}))]),n.$$.dirty&2049&&e(12,l=p.filter(S=>{var B,L;return S.name.includes(((L=(B=i.split(" "))==null?void 0:B.at(0))==null?void 0:L.substring(1))??"")}).sort((S,B)=>S.name.localeCompare(B.name))),n.$$.dirty&8193&&e(10,d=s.filter(S=>{var B,L;return S.name.includes(((L=(B=i.split(" "))==null?void 0:B.at(0))==null?void 0:L.substring(1))??"")}).sort((S,B)=>S.title.localeCompare(B.title))),n.$$.dirty&5120&&e(3,c=[...l,...d]),n.$$.dirty&4097&&i&&(e(2,u=0),console.log(l))},[i,r,u,c,o,k,g,y,w,_,d,p,l,s,v,T,C,H]}class Is extends Yt{constructor(t){super(),Xt(this,t,Es,ws,Jt,{prompt:0,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function dl(n,t,e){const l=n.slice();return l[16]=t[e],l[18]=e,l}function ml(n){let t,e=n[2].length>0&&hl(n);return{c(){e&&e.c(),t=St()},l(l){e&&e.l(l),t=St()},m(l,s){e&&e.m(l,s),P(l,t,s)},p(l,s){l[2].length>0?e?e.p(l,s):(e=hl(l),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(l){l&&m(t),e&&e.d(l)}}}function hl(n){let t,e,l,s='<div class="text-lg font-semibold mt-2">@</div>',r,o,i,a=xt(n[2]),u=[];for(let c=0;c<a.length;c+=1)u[c]=gl(dl(n,a,c));return{c(){t=I("div"),e=I("div"),l=I("div"),l.innerHTML=s,r=X(),o=I("div"),i=I("div");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){t=M(c,"DIV",{class:!0});var d=E(t);e=M(d,"DIV",{class:!0});var p=E(e);l=M(p,"DIV",{class:!0,"data-svelte-h":!0}),Gt(l)!=="svelte-1ourwwn"&&(l.innerHTML=s),r=Q(p),o=M(p,"DIV",{class:!0});var w=E(o);i=M(w,"DIV",{class:!0});var _=E(i);for(let k=0;k<u.length;k+=1)u[k].l(_);_.forEach(m),w.forEach(m),p.forEach(m),d.forEach(m),this.h()},h(){f(l,"class","bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5"),f(o,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white"),f(e,"class","flex w-full px-2"),f(t,"class","md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(c,d){P(c,t,d),b(t,e),b(e,l),b(e,r),b(e,o),b(o,i);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(i,null)},p(c,d){if(d&22){a=xt(c[2]);let p;for(p=0;p<a.length;p+=1){const w=dl(c,a,p);u[p]?u[p].p(w,d):(u[p]=gl(w),u[p].c(),u[p].m(i,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=a.length}},d(c){c&&m(t),pe(u,c)}}}function gl(n){let t,e,l=n[16].name+"",s,r,o,i,a;function u(){return n[11](n[16])}function c(){return n[12](n[18])}return{c(){t=I("button"),e=I("div"),s=rt(l),r=X(),this.h()},l(d){t=M(d,"BUTTON",{class:!0,type:!0});var p=E(t);e=M(p,"DIV",{class:!0});var w=E(e);s=it(w,l),w.forEach(m),r=Q(p),p.forEach(m),this.h()},h(){f(e,"class","font-medium text-black line-clamp-1"),f(t,"class",o="px-3 py-1.5 rounded-xl w-full text-left "+(n[18]===n[1]?" bg-gray-100 selected-command-option-button":"")),f(t,"type","button")},m(d,p){P(d,t,p),b(t,e),b(e,s),b(t,r),i||(a=[K(t,"click",u),K(t,"mousemove",c),K(t,"focus",Ds)],i=!0)},p(d,p){n=d,p&4&&l!==(l=n[16].name+"")&&bt(s,l),p&2&&o!==(o="px-3 py-1.5 rounded-xl w-full text-left "+(n[18]===n[1]?" bg-gray-100 selected-command-option-button":""))&&f(t,"class",o)},d(d){d&&m(t),i=!1,se(a)}}}function Ms(n){let t=n[0].charAt(0)==="@",e,l=t&&ml(n);return{c(){l&&l.c(),e=St()},l(s){l&&l.l(s),e=St()},m(s,r){l&&l.m(s,r),P(s,e,r)},p(s,[r]){r&1&&(t=s[0].charAt(0)==="@"),t?l?l.p(s,r):(l=ml(s),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},i:Tt,o:Tt,d(s){s&&m(e),l&&l.d(s)}}}const Ds=()=>{};function Ss(n,t,e){let l;st(n,Be,y=>e(10,l=y));const s=ie("i18n");st(n,s,y=>e(13,y));const r=Pe();let{prompt:o=""}=t,{user:i=null}=t,{chatInputPlaceholder:a=""}=t,{messages:u=[]}=t,c=0,d=[];const p=()=>{e(1,c=Math.max(0,c-1))},w=()=>{e(1,c=Math.min(c+1,d.length-1))},_=async y=>{e(0,o=""),r("select",y)},k=y=>{_(y)},g=y=>{e(1,c=y)};return n.$$set=y=>{"prompt"in y&&e(0,o=y.prompt),"user"in y&&e(5,i=y.user),"chatInputPlaceholder"in y&&e(6,a=y.chatInputPlaceholder),"messages"in y&&e(7,u=y.messages)},n.$$.update=()=>{n.$$.dirty&1025&&e(2,d=l.filter(y=>{var v,T;return y.name.includes(((T=(v=o.split(" "))==null?void 0:v.at(0))==null?void 0:T.substring(1))??"")}).sort((y,v)=>y.name.localeCompare(v.name))),n.$$.dirty&1&&o&&e(1,c=0)},[o,c,d,s,_,i,a,u,p,w,l,k,g]}class Cs extends Yt{constructor(t){super(),Xt(this,t,Ss,Ms,Jt,{prompt:0,user:5,chatInputPlaceholder:6,messages:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Ts(n){let t,e;return{c(){t=ht("svg"),e=ht("path"),this.h()},l(l){t=gt(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=E(t);e=gt(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(e).forEach(m),s.forEach(m),this.h()},h(){f(e,"stroke-linecap","round"),f(e,"stroke-linejoin","round"),f(e,"d","M6 18 18 6M6 6l12 12"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width",n[1]),f(t,"stroke","currentColor"),f(t,"class",n[0])},m(l,s){P(l,t,s),b(t,e)},p(l,[s]){s&2&&f(t,"stroke-width",l[1]),s&1&&f(t,"class",l[0])},i:Tt,o:Tt,d(l){l&&m(t)}}}function Vs(n,t,e){let{className:l="size-3.5"}=t,{strokeWidth:s="2"}=t;return n.$$set=r=>{"className"in r&&e(0,l=r.className),"strokeWidth"in r&&e(1,s=r.strokeWidth)},[l,s]}class Bs extends Yt{constructor(t){super(),Xt(this,t,Vs,Ts,Jt,{className:0,strokeWidth:1})}}function _l(n,t,e){const l=n.slice();return l[69]=t[e],l[71]=e,l}function pl(n){let t,e,l,s,r,o,i;return r=new En({}),{c(){t=I("div"),e=I("div"),l=I("div"),s=I("div"),at(r.$$.fragment),this.h()},l(a){t=M(a,"DIV",{class:!0,id:!0,role:!0,"aria-label":!0});var u=E(t);e=M(u,"DIV",{class:!0});var c=E(e);l=M(c,"DIV",{class:!0});var d=E(l);s=M(d,"DIV",{class:!0});var p=E(s);ct(r.$$.fragment,p),p.forEach(m),d.forEach(m),c.forEach(m),u.forEach(m),this.h()},h(){f(s,"class","max-w-md"),f(l,"class","m-auto pt-64 flex flex-col justify-center"),f(e,"class","absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center"),f(t,"class",o="fixed "+(n[24]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"),f(t,"id","dropzone"),f(t,"role","region"),f(t,"aria-label","Drag and Drop Container")},m(a,u){P(a,t,u),b(t,e),b(e,l),b(l,s),ut(r,s,null),i=!0},p(a,u){(!i||u[0]&16777216&&o!==(o="fixed "+(a[24]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"))&&f(t,"class",o)},i(a){i||(U(r.$$.fragment,a),i=!0)},o(a){R(r.$$.fragment,a),i=!1},d(a){a&&m(t),ft(r)}}}function vl(n){let t,e,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',s,r;return{c(){t=I("div"),e=I("button"),e.innerHTML=l,this.h()},l(o){t=M(o,"DIV",{class:!0});var i=E(t);e=M(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Gt(e)!=="svelte-4loiwr"&&(e.innerHTML=l),i.forEach(m),this.h()},h(){f(e,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full"),f(t,"class","absolute -top-12 left-0 right-0 flex justify-center z-30")},m(o,i){P(o,t,i),b(t,e),s||(r=K(e,"click",n[32]),s=!0)},p:Tt,d(o){o&&m(t),s=!1,r()}}}function Ns(n){let t,e,l;function s(o){n[36](o)}let r={};return n[1]!==void 0&&(r.prompt=n[1]),t=new Is({props:r}),n[35](t),mt.push(()=>zt(t,"prompt",s)),t.$on("youtube",n[37]),t.$on("url",n[38]),t.$on("select",n[39]),{c(){at(t.$$.fragment)},l(o){ct(t.$$.fragment,o)},m(o,i){ut(t,o,i),l=!0},p(o,i){const a={};!e&&i[0]&2&&(e=!0,a.prompt=o[1],jt(()=>e=!1)),t.$set(a)},i(o){l||(U(t.$$.fragment,o),l=!0)},o(o){R(t.$$.fragment,o),l=!1},d(o){n[35](null),ft(t,o)}}}function Os(n){let t,e,l;function s(o){n[34](o)}let r={};return n[1]!==void 0&&(r.prompt=n[1]),t=new gs({props:r}),n[33](t),mt.push(()=>zt(t,"prompt",s)),{c(){at(t.$$.fragment)},l(o){ct(t.$$.fragment,o)},m(o,i){ut(t,o,i),l=!0},p(o,i){const a={};!e&&i[0]&2&&(e=!0,a.prompt=o[1],jt(()=>e=!1)),t.$set(a)},i(o){l||(U(t.$$.fragment,o),l=!0)},o(o){R(t.$$.fragment,o),l=!1},d(o){n[33](null),ft(t,o)}}}function bl(n){let t,e,l,s,r,o,i,a,u=n[0].name+"",c,d,p,w,_,k,g,y;return _=new Bs({}),{c(){t=I("div"),e=I("div"),l=I("img"),r=X(),o=I("div"),i=rt("Talking to "),a=I("span"),c=rt(u),d=X(),p=I("div"),w=I("button"),at(_.$$.fragment),this.h()},l(v){t=M(v,"DIV",{class:!0});var T=E(t);e=M(T,"DIV",{class:!0});var C=E(e);l=M(C,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),r=Q(C),o=M(C,"DIV",{});var H=E(o);i=it(H,"Talking to "),a=M(H,"SPAN",{class:!0});var S=E(a);c=it(S,u),S.forEach(m),H.forEach(m),C.forEach(m),d=Q(T),p=M(T,"DIV",{});var B=E(p);w=M(B,"BUTTON",{class:!0});var L=E(w);ct(_.$$.fragment,L),L.forEach(m),B.forEach(m),T.forEach(m),this.h()},h(){var v,T,C;f(l,"crossorigin","anonymous"),f(l,"alt","model profile"),f(l,"class","size-5 max-w-[28px] object-cover rounded-full"),ge(l.src,s=((C=(T=(v=n[11].find(n[45]))==null?void 0:v.info)==null?void 0:T.meta)==null?void 0:C.profile_image_url)??(n[22].language==="dg-DG"?"/doge.png":`${Te}/static/favicon.png`))||f(l,"src",s),f(a,"class","font-medium"),f(e,"class","flex items-center gap-2 text-sm dark:text-gray-500"),f(w,"class","flex items-center"),f(t,"class","px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900")},m(v,T){P(v,t,T),b(t,e),b(e,l),b(e,r),b(e,o),b(o,i),b(o,a),b(a,c),b(t,d),b(t,p),b(p,w),ut(_,w,null),k=!0,g||(y=K(w,"click",n[46]),g=!0)},p(v,T){var C,H,S;(!k||T[0]&4196353&&!ge(l.src,s=((S=(H=(C=v[11].find(v[45]))==null?void 0:C.info)==null?void 0:H.meta)==null?void 0:S.profile_image_url)??(v[22].language==="dg-DG"?"/doge.png":`${Te}/static/favicon.png`)))&&f(l,"src",s),(!k||T[0]&1)&&u!==(u=v[0].name+"")&&bt(c,u)},i(v){k||(U(_.$$.fragment,v),k=!0)},o(v){R(_.$$.fragment,v),k=!1},d(v){v&&m(t),ft(_),g=!1,y()}}}function wl(n){let t,e,l=xt(n[3]),s=[];for(let o=0;o<l.length;o+=1)s[o]=yl(_l(n,l,o));const r=o=>R(s[o],1,1,()=>{s[o]=null});return{c(){t=I("div");for(let o=0;o<s.length;o+=1)s[o].c();this.h()},l(o){t=M(o,"DIV",{class:!0});var i=E(t);for(let a=0;a<s.length;a+=1)s[a].l(i);i.forEach(m),this.h()},h(){f(t,"class","mx-2 mt-2 mb-1 flex flex-wrap gap-2")},m(o,i){P(o,t,i);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(t,null);e=!0},p(o,i){if(i[0]&5242953){l=xt(o[3]);let a;for(a=0;a<l.length;a+=1){const u=_l(o,l,a);s[a]?(s[a].p(u,i),U(s[a],1)):(s[a]=yl(u),s[a].c(),U(s[a],1),s[a].m(t,null))}for(Ut(),a=l.length;a<s.length;a+=1)r(a);Pt()}},i(o){if(!e){for(let i=0;i<l.length;i+=1)U(s[i]);e=!0}},o(o){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)R(s[i]);e=!1},d(o){o&&m(t),pe(s,o)}}}function As(n){var w;let t,e,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z"></path><path d="M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z"></path></svg>',s,r,o,i=(((w=n[69])==null?void 0:w.title)??`#${n[69].name}`)+"",a,u,c,d=n[22].t("Collection")+"",p;return{c(){t=I("div"),e=I("div"),e.innerHTML=l,s=X(),r=I("div"),o=I("div"),a=rt(i),u=X(),c=I("div"),p=rt(d),this.h()},l(_){t=M(_,"DIV",{class:!0});var k=E(t);e=M(k,"DIV",{class:!0,"data-svelte-h":!0}),Gt(e)!=="svelte-2wa7ie"&&(e.innerHTML=l),s=Q(k),r=M(k,"DIV",{class:!0});var g=E(r);o=M(g,"DIV",{class:!0});var y=E(o);a=it(y,i),y.forEach(m),u=Q(g),c=M(g,"DIV",{class:!0});var v=E(c);p=it(v,d),v.forEach(m),g.forEach(m),k.forEach(m),this.h()},h(){f(e,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(o,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(c,"class","text-gray-500 text-sm"),f(r,"class","flex flex-col justify-center -space-y-0.5"),f(t,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(_,k){P(_,t,k),b(t,e),b(t,s),b(t,r),b(r,o),b(o,a),b(r,u),b(r,c),b(c,p)},p(_,k){var g;k[0]&8&&i!==(i=(((g=_[69])==null?void 0:g.title)??`#${_[69].name}`)+"")&&bt(a,i),k[0]&4194304&&d!==(d=_[22].t("Collection")+"")&&bt(p,d)},i:Tt,o:Tt,d(_){_&&m(t)}}}function Ls(n){let t,e,l,s,r,o=n[69].name+"",i,a,u,c=n[22].t("Document")+"",d;function p(k,g){return k[69].upload_status?Hs:Ps}let w=p(n),_=w(n);return{c(){t=I("div"),e=I("div"),_.c(),l=X(),s=I("div"),r=I("div"),i=rt(o),a=X(),u=I("div"),d=rt(c),this.h()},l(k){t=M(k,"DIV",{class:!0});var g=E(t);e=M(g,"DIV",{class:!0});var y=E(e);_.l(y),y.forEach(m),l=Q(g),s=M(g,"DIV",{class:!0});var v=E(s);r=M(v,"DIV",{class:!0});var T=E(r);i=it(T,o),T.forEach(m),a=Q(v),u=M(v,"DIV",{class:!0});var C=E(u);d=it(C,c),C.forEach(m),v.forEach(m),g.forEach(m),this.h()},h(){f(e,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(r,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(u,"class","text-gray-500 text-sm"),f(s,"class","flex flex-col justify-center -space-y-0.5"),f(t,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(k,g){P(k,t,g),b(t,e),_.m(e,null),b(t,l),b(t,s),b(s,r),b(r,i),b(s,a),b(s,u),b(u,d)},p(k,g){w!==(w=p(k))&&(_.d(1),_=w(k),_&&(_.c(),_.m(e,null))),g[0]&8&&o!==(o=k[69].name+"")&&bt(i,o),g[0]&4194304&&c!==(c=k[22].t("Document")+"")&&bt(d,c)},i:Tt,o:Tt,d(k){k&&m(t),_.d()}}}function Us(n){let t,e,l,s,r,o=(n[0]?n[20].length===0:n[6].length!==n[20].length)&&kl(n);return{c(){t=I("div"),e=I("img"),s=X(),o&&o.c(),this.h()},l(i){t=M(i,"DIV",{class:!0});var a=E(t);e=M(a,"IMG",{src:!0,alt:!0,class:!0}),s=Q(a),o&&o.l(a),a.forEach(m),this.h()},h(){ge(e.src,l=n[69].url)||f(e,"src",l),f(e,"alt","input"),f(e,"class","h-16 w-16 rounded-xl object-cover"),f(t,"class","relative")},m(i,a){P(i,t,a),b(t,e),b(t,s),o&&o.m(t,null),r=!0},p(i,a){(!r||a[0]&8&&!ge(e.src,l=i[69].url))&&f(e,"src",l),(i[0]?i[20].length===0:i[6].length!==i[20].length)?o?(o.p(i,a),a[0]&1048641&&U(o,1)):(o=kl(i),o.c(),U(o,1),o.m(t,null)):o&&(Ut(),R(o,1,1,()=>{o=null}),Pt())},i(i){r||(U(o),r=!0)},o(i){R(o),r=!1},d(i){i&&m(t),o&&o.d()}}}function Ps(n){let t,e,l,s,r,o;return{c(){t=ht("svg"),e=ht("style"),l=rt(`.spinner_qM83 {
																	animation: spinner_8HQG 1.05s infinite;
																}
																.spinner_oXPr {
																	animation-delay: 0.1s;
																}
																.spinner_ZTLf {
																	animation-delay: 0.2s;
																}
																@keyframes spinner_8HQG {
																	0%,
																	57.14% {
																		animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																		transform: translate(0);
																	}
																	28.57% {
																		animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																		transform: translateY(-6px);
																	}
																	100% {
																		transform: translate(0);
																	}
																}
															`),s=ht("circle"),r=ht("circle"),o=ht("circle"),this.h()},l(i){t=gt(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=E(t);e=gt(a,"style",{});var u=E(e);l=it(u,`.spinner_qM83 {
																	animation: spinner_8HQG 1.05s infinite;
																}
																.spinner_oXPr {
																	animation-delay: 0.1s;
																}
																.spinner_ZTLf {
																	animation-delay: 0.2s;
																}
																@keyframes spinner_8HQG {
																	0%,
																	57.14% {
																		animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																		transform: translate(0);
																	}
																	28.57% {
																		animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																		transform: translateY(-6px);
																	}
																	100% {
																		transform: translate(0);
																	}
																}
															`),u.forEach(m),s=gt(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(m),r=gt(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(m),o=gt(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(m),a.forEach(m),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","2.5"),f(r,"class","spinner_qM83 spinner_oXPr"),f(r,"cx","12"),f(r,"cy","12"),f(r,"r","2.5"),f(o,"class","spinner_qM83 spinner_ZTLf"),f(o,"cx","20"),f(o,"cy","12"),f(o,"r","2.5"),f(t,"class","w-6 h-6 translate-y-[0.5px]"),f(t,"fill","currentColor"),f(t,"viewBox","0 0 24 24"),f(t,"xmlns","http://www.w3.org/2000/svg")},m(i,a){P(i,t,a),b(t,e),b(e,l),b(t,s),b(t,r),b(t,o)},d(i){i&&m(t)}}}function Hs(n){let t,e,l;return{c(){t=ht("svg"),e=ht("path"),l=ht("path"),this.h()},l(s){t=gt(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=E(t);e=gt(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(e).forEach(m),l=gt(r,"path",{d:!0}),E(l).forEach(m),r.forEach(m),this.h()},h(){f(e,"fill-rule","evenodd"),f(e,"d","M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z"),f(e,"clip-rule","evenodd"),f(l,"d","M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 24 24"),f(t,"fill","currentColor"),f(t,"class","w-6 h-6")},m(s,r){P(s,t,r),b(t,e),b(t,l)},d(s){s&&m(t)}}}function kl(n){let t,e;return t=new ae({props:{className:" absolute top-1 left-1",content:n[22].t("{{ models }}",{models:[...n[0]?[n[0]]:n[6]].filter(n[50]).join(", ")}),$$slots:{default:[Rs]},$$scope:{ctx:n}}}),{c(){at(t.$$.fragment)},l(l){ct(t.$$.fragment,l)},m(l,s){ut(t,l,s),e=!0},p(l,s){const r={};s[0]&5242945&&(r.content=l[22].t("{{ models }}",{models:[...l[0]?[l[0]]:l[6]].filter(l[50]).join(", ")})),s[2]&1024&&(r.$$scope={dirty:s,ctx:l}),t.$set(r)},i(l){e||(U(t.$$.fragment,l),e=!0)},o(l){R(t.$$.fragment,l),e=!1},d(l){ft(t,l)}}}function Rs(n){let t,e;return{c(){t=ht("svg"),e=ht("path"),this.h()},l(l){t=gt(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=E(t);e=gt(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(e).forEach(m),s.forEach(m),this.h()},h(){f(e,"fill-rule","evenodd"),f(e,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),f(e,"clip-rule","evenodd"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 24 24"),f(t,"fill","currentColor"),f(t,"class","size-4 fill-yellow-300")},m(l,s){P(l,t,s),b(t,e)},p:Tt,d(l){l&&m(t)}}}function yl(n){let t,e,l,s,r,o,i='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',a,u,c,d;const p=[Us,Ls,As],w=[];function _(g,y){return g[69].type==="image"?0:g[69].type==="doc"?1:g[69].type==="collection"?2:-1}~(e=_(n))&&(l=w[e]=p[e](n));function k(){return n[51](n[71])}return{c(){t=I("div"),l&&l.c(),s=X(),r=I("div"),o=I("button"),o.innerHTML=i,a=X(),this.h()},l(g){t=M(g,"DIV",{class:!0});var y=E(t);l&&l.l(y),s=Q(y),r=M(y,"DIV",{class:!0});var v=E(r);o=M(v,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Gt(o)!=="svelte-1i5njtt"&&(o.innerHTML=i),v.forEach(m),a=Q(y),y.forEach(m),this.h()},h(){f(o,"class","bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition"),f(o,"type","button"),f(r,"class","absolute -top-1 -right-1"),f(t,"class","relative group")},m(g,y){P(g,t,y),~e&&w[e].m(t,null),b(t,s),b(t,r),b(r,o),b(t,a),u=!0,c||(d=K(o,"click",k),c=!0)},p(g,y){n=g;let v=e;e=_(n),e===v?~e&&w[e].p(n,y):(l&&(Ut(),R(w[v],1,1,()=>{w[v]=null}),Pt()),~e?(l=w[e],l?l.p(n,y):(l=w[e]=p[e](n),l.c()),U(l,1),l.m(t,s)):l=null)},i(g){u||(U(l),u=!0)},o(g){R(l),u=!1},d(g){g&&m(t),~e&&w[e].d(),c=!1,d()}}}function El(n){let t,e,l;return e=new ae({props:{content:n[22].t("Upload files"),$$slots:{default:[js]},$$scope:{ctx:n}}}),{c(){t=I("div"),at(e.$$.fragment),this.h()},l(s){t=M(s,"DIV",{class:!0});var r=E(t);ct(e.$$.fragment,r),r.forEach(m),this.h()},h(){f(t,"class","self-end mb-2 ml-1")},m(s,r){P(s,t,r),ut(e,t,null),l=!0},p(s,r){const o={};r[0]&4194304&&(o.content=s[22].t("Upload files")),r[0]&4096|r[2]&1024&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){l||(U(e.$$.fragment,s),l=!0)},o(s){R(e.$$.fragment,s),l=!1},d(s){s&&m(t),ft(e)}}}function js(n){let t,e='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-[1.2rem] h-[1.2rem]"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg>',l,s;return{c(){t=I("button"),t.innerHTML=e,this.h()},l(r){t=M(r,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Gt(t)!=="svelte-1nsa5at"&&(t.innerHTML=e),this.h()},h(){f(t,"class","bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"),f(t,"type","button")},m(r,o){P(r,t,o),l||(s=K(t,"click",n[52]),l=!0)},p:Tt,d(r){r&&m(t),l=!1,s()}}}function zs(n){let t,e='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',l,s;return{c(){t=I("button"),t.innerHTML=e,this.h()},l(r){t=M(r,"BUTTON",{class:!0,"data-svelte-h":!0}),Gt(t)!=="svelte-1ygp9cw"&&(t.innerHTML=e),this.h()},h(){f(t,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5")},m(r,o){P(r,t,o),l||(s=K(t,"click",function(){$l(n[5])&&n[5].apply(this,arguments)}),l=!0)},p(r,o){n=r},i:Tt,o:Tt,d(r){r&&m(t),l=!1,s()}}}function Fs(n){let t,e,l,s;return t=new ae({props:{content:n[22].t("Record voice"),$$slots:{default:[Gs]},$$scope:{ctx:n}}}),l=new ae({props:{content:n[22].t("Send message"),$$slots:{default:[Zs]},$$scope:{ctx:n}}}),{c(){at(t.$$.fragment),e=X(),at(l.$$.fragment)},l(r){ct(t.$$.fragment,r),e=Q(r),ct(l.$$.fragment,r)},m(r,o){ut(t,r,o),P(r,e,o),ut(l,r,o),s=!0},p(r,o){const i={};o[0]&4194304&&(i.content=r[22].t("Record voice")),o[0]&2097408|o[2]&1024&&(i.$$scope={dirty:o,ctx:r}),t.$set(i);const a={};o[0]&4194304&&(a.content=r[22].t("Send message")),o[0]&2|o[2]&1024&&(a.$$scope={dirty:o,ctx:r}),l.$set(a)},i(r){s||(U(t.$$.fragment,r),U(l.$$.fragment,r),s=!0)},o(r){R(t.$$.fragment,r),R(l.$$.fragment,r),s=!1},d(r){r&&m(e),ft(t,r),ft(l,r)}}}function Il(n){let t,e,l;function s(i,a){return i[21]?Ws:qs}let r=s(n),o=r(n);return{c(){t=I("button"),o.c(),this.h()},l(i){t=M(i,"BUTTON",{id:!0,class:!0,type:!0});var a=E(t);o.l(a),a.forEach(m),this.h()},h(){f(t,"id","voice-input-button"),f(t,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center"),f(t,"type","button")},m(i,a){P(i,t,a),o.m(t,null),e||(l=K(t,"click",n[60]),e=!0)},p(i,a){r!==(r=s(i))&&(o.d(1),o=r(i),o&&(o.c(),o.m(t,null)))},d(i){i&&m(t),o.d(),e=!1,l()}}}function qs(n){let t,e,l;return{c(){t=ht("svg"),e=ht("path"),l=ht("path"),this.h()},l(s){t=gt(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=E(t);e=gt(r,"path",{d:!0}),E(e).forEach(m),l=gt(r,"path",{d:!0}),E(l).forEach(m),r.forEach(m),this.h()},h(){f(e,"d","M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"),f(l,"d","M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 20 20"),f(t,"fill","currentColor"),f(t,"class","w-5 h-5 translate-y-[0.5px]")},m(s,r){P(s,t,r),b(t,e),b(t,l)},d(s){s&&m(t)}}}function Ws(n){let t,e,l,s,r,o;return{c(){t=ht("svg"),e=ht("style"),l=rt(`.spinner_qM83 {
																animation: spinner_8HQG 1.05s infinite;
															}
															.spinner_oXPr {
																animation-delay: 0.1s;
															}
															.spinner_ZTLf {
																animation-delay: 0.2s;
															}
															@keyframes spinner_8HQG {
																0%,
																57.14% {
																	animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																	transform: translate(0);
																}
																28.57% {
																	animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																	transform: translateY(-6px);
																}
																100% {
																	transform: translate(0);
																}
															}
														`),s=ht("circle"),r=ht("circle"),o=ht("circle"),this.h()},l(i){t=gt(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=E(t);e=gt(a,"style",{});var u=E(e);l=it(u,`.spinner_qM83 {
																animation: spinner_8HQG 1.05s infinite;
															}
															.spinner_oXPr {
																animation-delay: 0.1s;
															}
															.spinner_ZTLf {
																animation-delay: 0.2s;
															}
															@keyframes spinner_8HQG {
																0%,
																57.14% {
																	animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																	transform: translate(0);
																}
																28.57% {
																	animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																	transform: translateY(-6px);
																}
																100% {
																	transform: translate(0);
																}
															}
														`),u.forEach(m),s=gt(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(m),r=gt(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(m),o=gt(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(m),a.forEach(m),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","2.5"),f(r,"class","spinner_qM83 spinner_oXPr"),f(r,"cx","12"),f(r,"cy","12"),f(r,"r","2.5"),f(o,"class","spinner_qM83 spinner_ZTLf"),f(o,"cx","20"),f(o,"cy","12"),f(o,"r","2.5"),f(t,"class","w-5 h-5 translate-y-[0.5px]"),f(t,"fill","currentColor"),f(t,"viewBox","0 0 24 24"),f(t,"xmlns","http://www.w3.org/2000/svg")},m(i,a){P(i,t,a),b(t,e),b(e,l),b(t,s),b(t,r),b(t,o)},d(i){i&&m(t)}}}function Gs(n){let t,e=n[8]&&Il(n);return{c(){e&&e.c(),t=St()},l(l){e&&e.l(l),t=St()},m(l,s){e&&e.m(l,s),P(l,t,s)},p(l,s){l[8]?e?e.p(l,s):(e=Il(l),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(l){l&&m(t),e&&e.d(l)}}}function Zs(n){let t,e,l,s,r;return{c(){t=I("button"),e=ht("svg"),l=ht("path"),this.h()},l(o){t=M(o,"BUTTON",{id:!0,class:!0,type:!0});var i=E(t);e=gt(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=E(e);l=gt(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(l).forEach(m),a.forEach(m),i.forEach(m),this.h()},h(){f(l,"fill-rule","evenodd"),f(l,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),f(l,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 16 16"),f(e,"fill","currentColor"),f(e,"class","w-5 h-5"),f(t,"id","send-message-button"),f(t,"class",s=(n[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 self-center"),f(t,"type","submit"),t.disabled=r=n[1]===""},m(o,i){P(o,t,i),b(t,e),b(e,l)},p(o,i){i[0]&2&&s!==(s=(o[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 self-center")&&f(t,"class",s),i[0]&2&&r!==(r=o[1]==="")&&(t.disabled=r)},d(o){o&&m(t)}}}function Js(n){let t,e,l,s,r,o,i,a,u,c,d,p,w,_,k,g,y,v,T,C,H,S,B,L,Z,N,O,tt,W,nt,At,yt,Lt,Ct,_t,Vt,Zt,qt,Bt,j=n[22].t("LLMs can make mistakes. Verify important information.")+"",A,Ht,wt,Rt,ce,Et=n[17]&&pl(n),Nt=n[2]===!1&&n[9].length>0&&vl(n);const ue=[Os,Ns],Qt=[];function fe(V,$){return $[0]&2&&(u=null),$[0]&2&&(c=null),u==null&&(u=V[1].charAt(0)==="/"),u?0:(c==null&&(c=V[1].charAt(0)==="#"),c?1:-1)}~(d=fe(n,[-1,-1,-1]))&&(p=Qt[d]=ue[d](n));function be(V){n[41](V)}function we(V){n[42](V)}function ke(V){n[43](V)}let re={messages:n[9]};n[1]!==void 0&&(re.prompt=n[1]),n[18]!==void 0&&(re.user=n[18]),n[19]!==void 0&&(re.chatInputPlaceholder=n[19]),_=new Cs({props:re}),n[40](_),mt.push(()=>zt(_,"prompt",be)),mt.push(()=>zt(_,"user",we)),mt.push(()=>zt(_,"chatInputPlaceholder",ke)),_.$on("select",n[44]);let It=n[0]!==void 0&&bl(n),D=n[3].length>0&&wl(n),F=n[7]&&El(n);const et=[Fs,zs],lt=[];function q(V,$){return $[0]&512&&(Ct=null),Ct==null&&(Ct=V[9].length==0||V[9].at(-1).done==!0),Ct?0:1}return _t=q(n,[-1,-1,-1]),Vt=lt[_t]=et[_t](n),{c(){Et&&Et.c(),t=X(),e=I("div"),l=I("div"),s=I("div"),r=I("div"),o=I("div"),Nt&&Nt.c(),i=X(),a=I("div"),p&&p.c(),w=X(),at(_.$$.fragment),v=X(),It&&It.c(),T=X(),C=I("div"),H=I("div"),S=I("div"),B=I("input"),L=X(),Z=I("form"),D&&D.c(),N=X(),O=I("div"),F&&F.c(),tt=X(),W=I("textarea"),yt=X(),Lt=I("div"),Vt.c(),qt=X(),Bt=I("div"),A=rt(j),this.h()},l(V){Et&&Et.l(V),t=Q(V),e=M(V,"DIV",{class:!0});var $=E(e);l=M($,"DIV",{class:!0});var kt=E(l);s=M(kt,"DIV",{class:!0});var Mt=E(s);r=M(Mt,"DIV",{class:!0});var Dt=E(r);o=M(Dt,"DIV",{class:!0});var Ot=E(o);Nt&&Nt.l(Ot),Ot.forEach(m),i=Q(Dt),a=M(Dt,"DIV",{class:!0});var Ft=E(a);p&&p.l(Ft),w=Q(Ft),ct(_.$$.fragment,Ft),v=Q(Ft),It&&It.l(Ft),Ft.forEach(m),Dt.forEach(m),Mt.forEach(m),T=Q(kt),C=M(kt,"DIV",{class:!0});var Wt=E(C);H=M(Wt,"DIV",{class:!0});var dt=E(H);S=M(dt,"DIV",{class:!0});var x=E(S);B=M(x,"INPUT",{type:!0}),L=Q(x),Z=M(x,"FORM",{dir:!0,class:!0});var h=E(Z);D&&D.l(h),N=Q(h),O=M(h,"DIV",{class:!0});var G=E(O);F&&F.l(G),tt=Q(G),W=M(G,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),E(W).forEach(m),yt=Q(G),Lt=M(G,"DIV",{class:!0});var Y=E(Lt);Vt.l(Y),Y.forEach(m),G.forEach(m),h.forEach(m),qt=Q(x),Bt=M(x,"DIV",{class:!0});var z=E(Bt);A=it(z,j),z.forEach(m),x.forEach(m),dt.forEach(m),Wt.forEach(m),kt.forEach(m),$.forEach(m),this.h()},h(){var V;f(o,"class","relative"),f(a,"class","w-full relative"),f(r,"class","flex flex-col max-w-6xl px-2.5 md:px-6 w-full"),f(s,"class","-mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center"),f(B,"type","file"),B.hidden=!0,B.multiple=!0,f(W,"id","chat-textarea"),f(W,"class",nt="scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-3 "+(n[7]?"":" pl-4")+" rounded-xl resize-none h-[48px] svelte-141e0sl"),f(W,"placeholder",At=n[19]!==""?n[19]:n[21]?n[22].t("Listening..."):n[22].t("Send a Message")),f(W,"rows","1"),f(Lt,"class","self-end mb-2 flex space-x-1 mr-1"),f(O,"class","flex"),f(Z,"dir",Zt=((V=n[23])==null?void 0:V.chatDirection)??"LTR"),f(Z,"class","flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100"),f(Bt,"class","mt-1.5 text-xs text-gray-500 text-center"),f(S,"class","pb-2"),f(H,"class","max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0"),f(C,"class","bg-white dark:bg-gray-900"),f(l,"class","w-full"),f(e,"class",Ht="fixed bottom-0 "+(n[24]?"left-0 md:left-[260px]":"left-0")+" right-0")},m(V,$){Et&&Et.m(V,$),P(V,t,$),P(V,e,$),b(e,l),b(l,s),b(s,r),b(r,o),Nt&&Nt.m(o,null),b(r,i),b(r,a),~d&&Qt[d].m(a,null),b(a,w),ut(_,a,null),b(a,v),It&&It.m(a,null),b(l,T),b(l,C),b(C,H),b(H,S),b(S,B),n[47](B),b(S,L),b(S,Z),D&&D.m(Z,null),b(Z,N),b(Z,O),F&&F.m(O,null),b(O,tt),b(O,W),n[53](W),je(W,n[1]),b(O,yt),b(O,Lt),lt[_t].m(Lt,null),b(S,qt),b(S,Bt),b(Bt,A),wt=!0,Rt||(ce=[K(B,"change",n[48]),K(B,"change",n[49]),K(W,"input",n[54]),K(W,"keypress",n[55]),K(W,"keydown",n[56]),K(W,"input",n[57]),K(W,"focus",n[58]),K(W,"paste",n[59]),K(Z,"submit",xl(n[61]))],Rt=!0)},p(V,$){var Ot;V[17]?Et?(Et.p(V,$),$[0]&131072&&U(Et,1)):(Et=pl(V),Et.c(),U(Et,1),Et.m(t.parentNode,t)):Et&&(Ut(),R(Et,1,1,()=>{Et=null}),Pt()),V[2]===!1&&V[9].length>0?Nt?Nt.p(V,$):(Nt=vl(V),Nt.c(),Nt.m(o,null)):Nt&&(Nt.d(1),Nt=null);let kt=d;d=fe(V,$),d===kt?~d&&Qt[d].p(V,$):(p&&(Ut(),R(Qt[kt],1,1,()=>{Qt[kt]=null}),Pt()),~d?(p=Qt[d],p?p.p(V,$):(p=Qt[d]=ue[d](V),p.c()),U(p,1),p.m(a,w)):p=null);const Mt={};$[0]&512&&(Mt.messages=V[9]),!k&&$[0]&2&&(k=!0,Mt.prompt=V[1],jt(()=>k=!1)),!g&&$[0]&262144&&(g=!0,Mt.user=V[18],jt(()=>g=!1)),!y&&$[0]&524288&&(y=!0,Mt.chatInputPlaceholder=V[19],jt(()=>y=!1)),_.$set(Mt),V[0]!==void 0?It?(It.p(V,$),$[0]&1&&U(It,1)):(It=bl(V),It.c(),U(It,1),It.m(a,null)):It&&(Ut(),R(It,1,1,()=>{It=null}),Pt()),V[3].length>0?D?(D.p(V,$),$[0]&8&&U(D,1)):(D=wl(V),D.c(),U(D,1),D.m(Z,N)):D&&(Ut(),R(D,1,1,()=>{D=null}),Pt()),V[7]?F?(F.p(V,$),$[0]&128&&U(F,1)):(F=El(V),F.c(),U(F,1),F.m(O,tt)):F&&(Ut(),R(F,1,1,()=>{F=null}),Pt()),(!wt||$[0]&128&&nt!==(nt="scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-3 "+(V[7]?"":" pl-4")+" rounded-xl resize-none h-[48px] svelte-141e0sl"))&&f(W,"class",nt),(!wt||$[0]&6815744&&At!==(At=V[19]!==""?V[19]:V[21]?V[22].t("Listening..."):V[22].t("Send a Message")))&&f(W,"placeholder",At),$[0]&2&&je(W,V[1]);let Dt=_t;_t=q(V,$),_t===Dt?lt[_t].p(V,$):(Ut(),R(lt[Dt],1,1,()=>{lt[Dt]=null}),Pt(),Vt=lt[_t],Vt?Vt.p(V,$):(Vt=lt[_t]=et[_t](V),Vt.c()),U(Vt,1),Vt.m(Lt,null)),(!wt||$[0]&8388608&&Zt!==(Zt=((Ot=V[23])==null?void 0:Ot.chatDirection)??"LTR"))&&f(Z,"dir",Zt),(!wt||$[0]&4194304)&&j!==(j=V[22].t("LLMs can make mistakes. Verify important information.")+"")&&bt(A,j),(!wt||$[0]&16777216&&Ht!==(Ht="fixed bottom-0 "+(V[24]?"left-0 md:left-[260px]":"left-0")+" right-0"))&&f(e,"class",Ht)},i(V){wt||(U(Et),U(p),U(_.$$.fragment,V),U(It),U(D),U(F),U(Vt),wt=!0)},o(V){R(Et),R(p),R(_.$$.fragment,V),R(It),R(D),R(F),R(Vt),wt=!1},d(V){V&&(m(t),m(e)),Et&&Et.d(V),Nt&&Nt.d(),~d&&Qt[d].d(),n[40](null),ft(_),It&&It.d(),n[47](null),D&&D.d(),F&&F.d(),n[53](null),lt[_t].d(),Rt=!1,se(ce)}}}function Ys(n,t,e){let l,s,r,o,i;st(n,he,h=>e(23,s=h)),st(n,Be,h=>e(11,r=h)),st(n,Ce,h=>e(24,o=h)),st(n,Wl,h=>e(25,i=h));const a=ie("i18n");st(n,a,h=>e(22,l=h));let{submitPrompt:u}=t,{stopResponse:c}=t,{autoScroll:d=!0}=t,{atSelectedModel:p}=t,{selectedModels:w}=t,_,k,g,y,v,T,C=!1,H=null,S="",{files:B=[]}=t,{fileUploadEnabled:L=!0}=t,{speechRecognitionEnabled:Z=!0}=t,{prompt:N=""}=t,{messages:O=[]}=t,tt,W=[],nt,At=[],yt=!1;const Lt=-45,Ct=()=>{const h=document.getElementById("messages-container");h.scrollTop=h.scrollHeight},_t=async()=>{const h=await navigator.mediaDevices.getUserMedia({audio:!0});nt=new MediaRecorder(h),nt.onstart=()=>{e(21,yt=!0),console.log("Recording started")},nt.ondataavailable=G=>At.push(G.data),nt.onstop=async()=>{e(21,yt=!1),console.log("Recording stopped");const G=new Blob(At,{type:"audio/wav"}),Y=Ge(G,"recording.wav"),z=await Xe(localStorage.token,Y).catch(J=>(ot.error(J),null));z&&(e(1,N=z.text),await pt(),_==null||_.focus(),N!==""&&(s==null?void 0:s.speechAutoSend)===!0&&u(N,H)),At=[]},nt.start(),Vt(h)},Vt=h=>{const G=new AudioContext,Y=G.createMediaStreamSource(h),z=G.createAnalyser();z.minDecibels=Lt,Y.connect(z);const J=z.frequencyBinCount,vt=new Uint8Array(J);let de=Date.now();const ye=()=>{if(z.getByteFrequencyData(vt),vt.some(Ee=>Ee>0)&&(de=Date.now()),yt&&Date.now()-de>3e3){nt.stop(),G.close();return}window.requestAnimationFrame(ye)};window.requestAnimationFrame(ye)},Zt=()=>{var h;if(yt)tt&&tt.stop(),nt&&nt.stop();else if(e(21,yt=!0),((h=s==null?void 0:s.audio)==null?void 0:h.STTEngine)??!1)_t();else if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){tt=new(window.SpeechRecognition||window.webkitSpeechRecognition),tt.continuous=!0;const G=3e3;let Y;tt.start(),tt.onresult=async z=>{clearTimeout(Y),console.log(z);const J=z.results[Object.keys(z.results).length-1][0].transcript;e(1,N=`${N}${J}`),await pt(),_==null||_.focus(),Y=setTimeout(()=>{console.log("Speech recognition turned off due to inactivity."),tt.stop()},G)},tt.onend=function(){console.log("recognition ended"),e(21,yt=!1),N!==""&&(s==null?void 0:s.speechAutoSend)===!0&&u(N,H)},tt.onerror=function(z){console.log(z),ot.error(l.t("Speech recognition error: {{error}}",{error:z.error})),e(21,yt=!1)}}else ot.error(l.t("SpeechRecognition API is not supported in this browser."))},qt=async h=>{console.log(h);const G={type:"doc",name:h.name,collection_name:"",upload_status:!1,error:""};try{if(e(3,B=[...B,G]),["audio/mpeg","audio/wav"].includes(h.type)){const z=await Xe(localStorage.token,h).catch(J=>(ot.error(J),null));if(z){console.log(z);const J=new Blob([z.text],{type:"text/plain"});h=Ge(J,`${h.name}.txt`)}}const Y=await In(localStorage.token,"",h);Y&&(G.upload_status=!0,G.collection_name=Y.collection_name,e(3,B))}catch(Y){e(3,B=B.filter(z=>z.name!==h.name)),ot.error(Y)}},Bt=async h=>{console.log(h);const G={type:"doc",name:h,collection_name:"",upload_status:!1,url:h,error:""};try{e(3,B=[...B,G]);const Y=await Mn(localStorage.token,"",h);Y&&(G.upload_status=!0,G.collection_name=Y.collection_name,e(3,B))}catch(Y){e(3,B=B.filter(z=>z.name!==h)),ot.error(Y)}},j=async h=>{console.log(h);const G={type:"doc",name:h,collection_name:"",upload_status:!1,url:h,error:""};try{e(3,B=[...B,G]);const Y=await Dn(localStorage.token,h);Y&&(G.upload_status=!0,G.collection_name=Y.collection_name,e(3,B))}catch(Y){e(3,B=B.filter(z=>z.name!==h)),ot.error(Y)}};He(()=>{window.setTimeout(()=>_==null?void 0:_.focus(),0);const h=document.querySelector("body"),G=vt=>{vt.key==="Escape"&&(console.log("Escape"),e(17,C=!1))},Y=vt=>{vt.preventDefault(),e(17,C=!0)},z=()=>{e(17,C=!1)},J=async vt=>{var de,ye;if(vt.preventDefault(),console.log(vt),(de=vt.dataTransfer)!=null&&de.files){const Ee=Array.from((ye=vt.dataTransfer)==null?void 0:ye.files);Ee&&Ee.length>0?Ee.forEach(oe=>{if(console.log(oe,oe.name.split(".").at(-1)),["image/gif","image/webp","image/jpeg","image/png"].includes(oe.type)){if(W.length===0){ot.error(l.t("Selected model(s) do not support image inputs"));return}let Re=new FileReader;Re.onload=Kl=>{e(3,B=[...B,{type:"image",url:`${Kl.target.result}`}])},Re.readAsDataURL(oe)}else ze.includes(oe.type)||Fe.includes(oe.name.split(".").at(-1))||ot.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:oe.type})),qt(oe)}):ot.error(l.t("File not found."))}e(17,C=!1)};return window.addEventListener("keydown",G),h==null||h.addEventListener("dragover",Y),h==null||h.addEventListener("drop",J),h==null||h.addEventListener("dragleave",z),()=>{window.removeEventListener("keydown",G),h==null||h.removeEventListener("dragover",Y),h==null||h.removeEventListener("drop",J),h==null||h.removeEventListener("dragleave",z)}});const A=()=>{e(2,d=!0),Ct()};function Ht(h){mt[h?"unshift":"push"](()=>{g=h,e(13,g)})}function wt(h){N=h,e(1,N)}function Rt(h){mt[h?"unshift":"push"](()=>{y=h,e(14,y)})}function ce(h){N=h,e(1,N)}const Et=h=>{console.log(h),j(h.detail)},Nt=h=>{console.log(h),Bt(h.detail)},ue=h=>{var G;console.log(h),e(3,B=[...B,{type:((G=h==null?void 0:h.detail)==null?void 0:G.type)??"doc",...h.detail,upload_status:!0}])};function Qt(h){mt[h?"unshift":"push"](()=>{v=h,e(15,v)})}function fe(h){N=h,e(1,N)}function be(h){H=h,e(18,H)}function we(h){S=h,e(19,S)}const ke=h=>{e(0,p=h.detail),_==null||_.focus()},re=h=>h.id===p.id,It=()=>{e(0,p=void 0)};function D(h){mt[h?"unshift":"push"](()=>{k=h,e(12,k)})}function F(){T=this.files,e(16,T)}const et=async()=>{T&&T.length>0?Array.from(T).forEach(G=>{if(["image/gif","image/webp","image/jpeg","image/png"].includes(G.type)){if(W.length===0){ot.error(l.t("Selected model(s) do not support image inputs")),e(16,T=null),e(12,k.value="",k);return}let Y=new FileReader;Y.onload=z=>{e(3,B=[...B,{type:"image",url:`${z.target.result}`}]),e(16,T=null),e(12,k.value="",k)},Y.readAsDataURL(G)}else ze.includes(G.type)||Fe.includes(G.name.split(".").at(-1))?(qt(G),e(12,k.value="",k)):(ot.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:G.type})),qt(G),e(12,k.value="",k))}):ot.error(l.t("File not found."))},lt=h=>!W.includes(h),q=h=>{B.splice(h,1),e(3,B)},V=()=>{k.click()};function $(h){mt[h?"unshift":"push"](()=>{_=h,e(10,_),e(1,N)})}function kt(){N=this.value,e(1,N)}const Mt=h=>{(!i||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(h.keyCode==13&&!h.shiftKey&&h.preventDefault(),N!==""&&h.keyCode==13&&!h.shiftKey&&u(N,H))},Dt=async h=>{var Y;const G=h.ctrlKey||h.metaKey;if(N===""&&G&&h.key.toLowerCase()==="r"){h.preventDefault(),console.log("regenerate");const z=[...document.getElementsByClassName("regenerate-response-button")].at(-1);z==null||z.click()}if(N===""&&h.key=="ArrowUp"){h.preventDefault();const z=[...document.getElementsByClassName("user-message")].at(-1),J=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(z),z.scrollIntoView({block:"center"}),J==null||J.click()}if(["/","#","@"].includes(N.charAt(0))&&h.key==="ArrowUp"&&(h.preventDefault(),(g||y||v).selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(N.charAt(0))&&h.key==="ArrowDown"&&(h.preventDefault(),(g||y||v).selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(N.charAt(0))&&h.key==="Enter"){h.preventDefault();const z=[...document.getElementsByClassName("selected-command-option-button")].at(-1);z?z==null||z.click():(Y=document.getElementById("send-message-button"))==null||Y.click()}if(["/","#","@"].includes(N.charAt(0))&&h.key==="Tab"){h.preventDefault();const z=[...document.getElementsByClassName("selected-command-option-button")].at(-1);z==null||z.click()}else if(h.key==="Tab"){const z=Jl(N);if(z.length>0){const J=z.at(0),vt=N;e(1,N=N.substring(0,(J==null?void 0:J.endIndex)+1)),await pt(),h.target.scrollTop=h.target.scrollHeight,e(1,N=vt),await pt(),h.preventDefault(),h.target.setSelectionRange(J==null?void 0:J.startIndex,J.endIndex+1)}h.target.style.height="",h.target.style.height=Math.min(h.target.scrollHeight,200)+"px"}h.key==="Escape"&&(console.log("Escape"),e(0,p=void 0))},Ot=h=>{h.target.style.height="",h.target.style.height=Math.min(h.target.scrollHeight,200)+"px",e(18,H=null)},Ft=h=>{h.target.style.height="",h.target.style.height=Math.min(h.target.scrollHeight,200)+"px"},Wt=h=>{const G=h.clipboardData||window.clipboardData;if(G&&G.items){for(const Y of G.items)if(Y.type.indexOf("image")!==-1){const z=Y.getAsFile(),J=new FileReader;J.onload=function(vt){e(3,B=[...B,{type:"image",url:`${vt.target.result}`}])},J.readAsDataURL(z)}}},dt=()=>{Zt()},x=()=>{u(N,H)};return n.$$set=h=>{"submitPrompt"in h&&e(4,u=h.submitPrompt),"stopResponse"in h&&e(5,c=h.stopResponse),"autoScroll"in h&&e(2,d=h.autoScroll),"atSelectedModel"in h&&e(0,p=h.atSelectedModel),"selectedModels"in h&&e(6,w=h.selectedModels),"files"in h&&e(3,B=h.files),"fileUploadEnabled"in h&&e(7,L=h.fileUploadEnabled),"speechRecognitionEnabled"in h&&e(8,Z=h.speechRecognitionEnabled),"prompt"in h&&e(1,N=h.prompt),"messages"in h&&e(9,O=h.messages)},n.$$.update=()=>{n.$$.dirty[0]&2113&&e(20,W=[...p?[p]:w].filter(h=>{var G,Y,z,J;return((J=(z=(Y=(G=r.find(vt=>vt.id===h))==null?void 0:G.info)==null?void 0:Y.meta)==null?void 0:z.capabilities)==null?void 0:J.vision)??!0})),n.$$.dirty[0]&1026&&N&&_&&(e(10,_.style.height="",_),e(10,_.style.height=Math.min(_.scrollHeight,200)+"px",_))},[p,N,d,B,u,c,w,L,Z,O,_,r,k,g,y,v,T,C,H,S,W,yt,l,s,o,i,a,Ct,Zt,qt,Bt,j,A,Ht,wt,Rt,ce,Et,Nt,ue,Qt,fe,be,we,ke,re,It,D,F,et,lt,q,V,$,kt,Mt,Dt,Ot,Ft,Wt,dt,x]}class Xs extends Yt{constructor(t){super(),Xt(this,t,Ys,Js,Jt,{submitPrompt:4,stopResponse:5,autoScroll:2,atSelectedModel:0,selectedModels:6,files:3,fileUploadEnabled:7,speechRecognitionEnabled:8,prompt:1,messages:9},null,[-1,-1,-1])}}function Ml(n,t,e){const l=n.slice();return l[13]=t[e],l[14]=t,l[15]=e,l}function Qs(n){let t,e,l;return e=new ae({props:{content:n[4].t("Remove Model"),$$slots:{default:[xs]},$$scope:{ctx:n}}}),{c(){t=I("div"),at(e.$$.fragment),this.h()},l(s){t=M(s,"DIV",{class:!0});var r=E(t);ct(e.$$.fragment,r),r.forEach(m),this.h()},h(){f(t,"class","self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2")},m(s,r){P(s,t,r),ut(e,t,null),l=!0},p(s,r){const o={};r&16&&(o.content=s[4].t("Remove Model")),r&65539&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){l||(U(e.$$.fragment,s),l=!0)},o(s){R(e.$$.fragment,s),l=!1},d(s){s&&m(t),ft(e)}}}function Ks(n){let t,e,l;return e=new ae({props:{content:n[4].t("Add Model"),$$slots:{default:[$s]},$$scope:{ctx:n}}}),{c(){t=I("div"),at(e.$$.fragment),this.h()},l(s){t=M(s,"DIV",{class:!0});var r=E(t);ct(e.$$.fragment,r),r.forEach(m),this.h()},h(){f(t,"class","self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600")},m(s,r){P(s,t,r),ut(e,t,null),l=!0},p(s,r){const o={};r&16&&(o.content=s[4].t("Add Model")),r&65539&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){l||(U(e.$$.fragment,s),l=!0)},o(s){R(e.$$.fragment,s),l=!1},d(s){s&&m(t),ft(e)}}}function xs(n){let t,e,l,s,r;function o(){return n[10](n[15])}return{c(){t=I("button"),e=ht("svg"),l=ht("path"),this.h()},l(i){t=M(i,"BUTTON",{});var a=E(t);e=gt(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var u=E(e);l=gt(u,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(l).forEach(m),u.forEach(m),a.forEach(m),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M19.5 12h-15"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width","2"),f(e,"stroke","currentColor"),f(e,"class","size-3.5"),t.disabled=n[1]},m(i,a){P(i,t,a),b(t,e),b(e,l),s||(r=K(t,"click",o),s=!0)},p(i,a){n=i,a&2&&(t.disabled=n[1])},d(i){i&&m(t),s=!1,r()}}}function $s(n){let t,e,l,s,r;return{c(){t=I("button"),e=ht("svg"),l=ht("path"),this.h()},l(o){t=M(o,"BUTTON",{class:!0});var i=E(t);e=gt(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=E(e);l=gt(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(l).forEach(m),a.forEach(m),i.forEach(m),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M12 6v12m6-6H6"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width","2"),f(e,"stroke","currentColor"),f(e,"class","size-3.5"),f(t,"class",""),t.disabled=n[1]},m(o,i){P(o,t,i),b(t,e),b(e,l),s||(r=K(t,"click",n[9]),s=!0)},p(o,i){i&2&&(t.disabled=o[1])},d(o){o&&m(t),s=!1,r()}}}function Dl(n){let t,e,l,s,r,o,i,a,u,c;function d(g){n[8](g,n[13],n[14],n[15])}let p={placeholder:n[4].t("Select a model"),items:n[3].map(Cl)};n[13]!==void 0&&(p.value=n[13]),s=new Ln({props:p}),mt.push(()=>zt(s,"value",d));const w=[Ks,Qs],_=[];function k(g,y){return g[15]===0?0:1}return i=k(n),a=_[i]=w[i](n),{c(){t=I("div"),e=I("div"),l=I("div"),at(s.$$.fragment),o=X(),a.c(),u=X(),this.h()},l(g){t=M(g,"DIV",{class:!0});var y=E(t);e=M(y,"DIV",{class:!0});var v=E(e);l=M(v,"DIV",{class:!0});var T=E(l);ct(s.$$.fragment,T),T.forEach(m),v.forEach(m),o=Q(y),a.l(y),u=Q(y),y.forEach(m),this.h()},h(){f(l,"class","mr-1 max-w-full"),f(e,"class","overflow-hidden w-full"),f(t,"class","flex w-full max-w-fit")},m(g,y){P(g,t,y),b(t,e),b(e,l),ut(s,l,null),b(t,o),_[i].m(t,null),b(t,u),c=!0},p(g,y){n=g;const v={};y&16&&(v.placeholder=n[4].t("Select a model")),y&8&&(v.items=n[3].map(Cl)),!r&&y&1&&(r=!0,v.value=n[13],jt(()=>r=!1)),s.$set(v),a.p(n,y)},i(g){c||(U(s.$$.fragment,g),U(a),c=!0)},o(g){R(s.$$.fragment,g),R(a),c=!1},d(g){g&&m(t),ft(s),_[i].d()}}}function Sl(n){let t,e,l=n[4].t("Set as default")+"",s,r,o;return{c(){t=I("div"),e=I("button"),s=rt(l),this.h()},l(i){t=M(i,"DIV",{class:!0});var a=E(t);e=M(a,"BUTTON",{});var u=E(e);s=it(u,l),u.forEach(m),a.forEach(m),this.h()},h(){f(t,"class","text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500")},m(i,a){P(i,t,a),b(t,e),b(e,s),r||(o=K(e,"click",n[7]),r=!0)},p(i,a){a&16&&l!==(l=i[4].t("Set as default")+"")&&bt(s,l)},d(i){i&&m(t),r=!1,o()}}}function to(n){let t,e,l,s,r=xt(n[0]),o=[];for(let u=0;u<r.length;u+=1)o[u]=Dl(Ml(n,r,u));const i=u=>R(o[u],1,1,()=>{o[u]=null});let a=n[2]&&!n[5]&&Sl(n);return{c(){t=I("div");for(let u=0;u<o.length;u+=1)o[u].c();e=X(),a&&a.c(),l=St(),this.h()},l(u){t=M(u,"DIV",{class:!0});var c=E(t);for(let d=0;d<o.length;d+=1)o[d].l(c);c.forEach(m),e=Q(u),a&&a.l(u),l=St(),this.h()},h(){f(t,"class","flex flex-col w-full items-center md:items-start")},m(u,c){P(u,t,c);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(t,null);P(u,e,c),a&&a.m(u,c),P(u,l,c),s=!0},p(u,[c]){if(c&27){r=xt(u[0]);let d;for(d=0;d<r.length;d+=1){const p=Ml(u,r,d);o[d]?(o[d].p(p,c),U(o[d],1)):(o[d]=Dl(p),o[d].c(),U(o[d],1),o[d].m(t,null))}for(Ut(),d=r.length;d<o.length;d+=1)i(d);Pt()}u[2]&&!u[5]?a?a.p(u,c):(a=Sl(u),a.c(),a.m(l.parentNode,l)):a&&(a.d(1),a=null)},i(u){if(!s){for(let c=0;c<r.length;c+=1)U(o[c]);s=!0}},o(u){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)R(o[c]);s=!1},d(u){u&&(m(t),m(e),m(l)),pe(o,u),a&&a.d(u)}}}const Cl=n=>({value:n.id,label:n.name,model:n});function eo(n,t,e){let l,s,r,o,i;st(n,Be,g=>e(3,l=g)),st(n,Gl,g=>e(11,r=g)),st(n,he,g=>e(12,o=g)),st(n,Wl,g=>e(5,i=g));const a=ie("i18n");st(n,a,g=>e(4,s=g));let{selectedModels:u=[""]}=t,{disabled:c=!1}=t,{showSetDefault:d=!0}=t;const p=async()=>{if(u.filter(y=>y==="").length){ot.error(s.t("Choose a model before saving..."));return}he.set({...o,models:u}),localStorage.setItem("settings",JSON.stringify(o)),r.role==="admin"&&(console.log("setting default models globally"),await On(localStorage.token,u.join(","))),ot.success(s.t("Default model updated"))};function w(g,y,v,T){v[T]=g,e(0,u),e(3,l)}const _=()=>{e(0,u=[...u,""])},k=g=>{u.splice(g,1),e(0,u),e(3,l)};return n.$$set=g=>{"selectedModels"in g&&e(0,u=g.selectedModels),"disabled"in g&&e(1,c=g.disabled),"showSetDefault"in g&&e(2,d=g.showSetDefault)},n.$$.update=()=>{n.$$.dirty&9&&u.length>0&&l.length>0&&e(0,u=u.map(g=>l.map(y=>y.id).includes(g)?g:""))},[u,c,d,l,s,i,a,p,w,_,k]}class lo extends Yt{constructor(t){super(),Xt(this,t,eo,to,Jt,{selectedModels:0,disabled:1,showSetDefault:2})}}function no(n){let t;const e=n[9].default,l=te(e,n,n[14],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,r){l&&l.m(s,r),t=!0},p(s,r){l&&l.p&&(!t||r&16384)&&ee(l,e,s,s[14],t?ne(e,s[14],r,null):le(s[14]),null)},i(s){t||(U(l,s),t=!0)},o(s){R(l,s),t=!1},d(s){l&&l.d(s)}}}function so(n){let t,e,l,s,r=n[3].t("Share")+"",o;return{c(){t=ht("svg"),e=ht("path"),l=X(),s=I("div"),o=rt(r),this.h()},l(i){t=gt(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=E(t);e=gt(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(e).forEach(m),a.forEach(m),l=Q(i),s=M(i,"DIV",{class:!0});var u=E(s);o=it(u,r),u.forEach(m),this.h()},h(){f(e,"fill-rule","evenodd"),f(e,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),f(e,"clip-rule","evenodd"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 24 24"),f(t,"fill","currentColor"),f(t,"class","size-4"),f(s,"class","flex items-center")},m(i,a){P(i,t,a),b(t,e),P(i,l,a),P(i,s,a),b(s,o)},p(i,a){a&8&&r!==(r=i[3].t("Share")+"")&&bt(o,r)},d(i){i&&(m(t),m(l),m(s))}}}function oo(n){let t,e,l,s,r=n[3].t("Download")+"",o;return{c(){t=ht("svg"),e=ht("path"),l=X(),s=I("div"),o=rt(r),this.h()},l(i){t=gt(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=E(t);e=gt(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(e).forEach(m),a.forEach(m),l=Q(i),s=M(i,"DIV",{class:!0});var u=E(s);o=it(u,r),u.forEach(m),this.h()},h(){f(e,"stroke-linecap","round"),f(e,"stroke-linejoin","round"),f(e,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","1.5"),f(t,"stroke","currentColor"),f(t,"class","size-4"),f(s,"class","flex items-center")},m(i,a){P(i,t,a),b(t,e),P(i,l,a),P(i,s,a),b(s,o)},p(i,a){a&8&&r!==(r=i[3].t("Download")+"")&&bt(o,r)},d(i){i&&(m(t),m(l),m(s))}}}function ro(n){let t,e=n[3].t("Plain text (.txt)")+"",l;return{c(){t=I("div"),l=rt(e),this.h()},l(s){t=M(s,"DIV",{class:!0});var r=E(t);l=it(r,e),r.forEach(m),this.h()},h(){f(t,"class","flex items-center line-clamp-1")},m(s,r){P(s,t,r),b(t,l)},p(s,r){r&8&&e!==(e=s[3].t("Plain text (.txt)")+"")&&bt(l,e)},d(s){s&&m(t)}}}function io(n){let t,e=n[3].t("PDF document (.pdf)")+"",l;return{c(){t=I("div"),l=rt(e),this.h()},l(s){t=M(s,"DIV",{class:!0});var r=E(t);l=it(r,e),r.forEach(m),this.h()},h(){f(t,"class","flex items-center line-clamp-1")},m(s,r){P(s,t,r),b(t,l)},p(s,r){r&8&&e!==(e=s[3].t("PDF document (.pdf)")+"")&&bt(l,e)},d(s){s&&m(t)}}}function ao(n){let t,e,l,s;return t=new Ue({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[ro]},$$scope:{ctx:n}}}),t.$on("click",n[11]),l=new Ue({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[io]},$$scope:{ctx:n}}}),l.$on("click",n[12]),{c(){at(t.$$.fragment),e=X(),at(l.$$.fragment)},l(r){ct(t.$$.fragment,r),e=Q(r),ct(l.$$.fragment,r)},m(r,o){ut(t,r,o),P(r,e,o),ut(l,r,o),s=!0},p(r,o){const i={};o&16392&&(i.$$scope={dirty:o,ctx:r}),t.$set(i);const a={};o&16392&&(a.$$scope={dirty:o,ctx:r}),l.$set(a)},i(r){s||(U(t.$$.fragment,r),U(l.$$.fragment,r),s=!0)},o(r){R(t.$$.fragment,r),R(l.$$.fragment,r),s=!1},d(r){r&&m(e),ft(t,r),ft(l,r)}}}function co(n){let t,e,l,s;return t=new fs({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[oo]},$$scope:{ctx:n}}}),l=new ss({props:{class:"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:Xl,sideOffset:8,$$slots:{default:[ao]},$$scope:{ctx:n}}}),{c(){at(t.$$.fragment),e=X(),at(l.$$.fragment)},l(r){ct(t.$$.fragment,r),e=Q(r),ct(l.$$.fragment,r)},m(r,o){ut(t,r,o),P(r,e,o),ut(l,r,o),s=!0},p(r,o){const i={};o&16392&&(i.$$scope={dirty:o,ctx:r}),t.$set(i);const a={};o&16392&&(a.$$scope={dirty:o,ctx:r}),l.$set(a)},i(r){s||(U(t.$$.fragment,r),U(l.$$.fragment,r),s=!0)},o(r){R(t.$$.fragment,r),R(l.$$.fragment,r),s=!1},d(r){r&&m(e),ft(t,r),ft(l,r)}}}function uo(n){let t,e,l,s,r,o,i,a,u;return t=new Ue({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[so]},$$scope:{ctx:n}}}),t.$on("click",n[10]),l=new qn({props:{$$slots:{default:[co]},$$scope:{ctx:n}}}),a=new Tn({props:{chatId:n[1].id}}),{c(){at(t.$$.fragment),e=X(),at(l.$$.fragment),s=X(),r=I("hr"),o=X(),i=I("div"),at(a.$$.fragment),this.h()},l(c){ct(t.$$.fragment,c),e=Q(c),ct(l.$$.fragment,c),s=Q(c),r=M(c,"HR",{class:!0}),o=Q(c),i=M(c,"DIV",{class:!0});var d=E(i);ct(a.$$.fragment,d),d.forEach(m),this.h()},h(){f(r,"class","border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5"),f(i,"class","flex p-1")},m(c,d){ut(t,c,d),P(c,e,d),ut(l,c,d),P(c,s,d),P(c,r,d),P(c,o,d),P(c,i,d),ut(a,i,null),u=!0},p(c,d){const p={};d&16392&&(p.$$scope={dirty:d,ctx:c}),t.$set(p);const w={};d&16392&&(w.$$scope={dirty:d,ctx:c}),l.$set(w);const _={};d&2&&(_.chatId=c[1].id),a.$set(_)},i(c){u||(U(t.$$.fragment,c),U(l.$$.fragment,c),U(a.$$.fragment,c),u=!0)},o(c){R(t.$$.fragment,c),R(l.$$.fragment,c),R(a.$$.fragment,c),u=!1},d(c){c&&(m(e),m(s),m(r),m(o),m(i)),ft(t,c),ft(l,c),ft(a)}}}function fo(n){let t,e,l;return e=new _n({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:Xl,$$slots:{default:[uo]},$$scope:{ctx:n}}}),{c(){t=I("div"),at(e.$$.fragment),this.h()},l(s){t=M(s,"DIV",{slot:!0});var r=E(t);ct(e.$$.fragment,r),r.forEach(m),this.h()},h(){f(t,"slot","content")},m(s,r){P(s,t,r),ut(e,t,null),l=!0},p(s,r){const o={};r&16395&&(o.$$scope={dirty:r,ctx:s}),e.$set(o)},i(s){l||(U(e.$$.fragment,s),l=!0)},o(s){R(e.$$.fragment,s),l=!1},d(s){s&&m(t),ft(e)}}}function mo(n){let t,e;return t=new Cn({props:{$$slots:{content:[fo],default:[no]},$$scope:{ctx:n}}}),t.$on("change",n[13]),{c(){at(t.$$.fragment)},l(l){ct(t.$$.fragment,l)},m(l,s){ut(t,l,s),e=!0},p(l,[s]){const r={};s&16395&&(r.$$scope={dirty:s,ctx:l}),t.$set(r)},i(l){e||(U(t.$$.fragment,l),e=!0)},o(l){R(t.$$.fragment,l),e=!1},d(l){ft(t,l)}}}function ho(n,t,e){let l,{$$slots:s={},$$scope:r}=t;const{saveAs:o}=Hn,i=ie("i18n");st(n,i,T=>e(3,l=T));let{shareEnabled:a=!1}=t,{shareHandler:u}=t,{downloadHandler:c}=t,{chat:d}=t,{onClose:p=()=>{}}=t;const w=async()=>{const T=d.chat;console.log("download",d);const C=T.messages.reduce((S,B,L,Z)=>`${S}### ${B.role.toUpperCase()}
${B.content}

`,"");let H=new Blob([C],{type:"text/plain"});o(H,`chat-${T.title}.txt`)},_=async()=>{const T=d.chat;console.log("download",d);const C=await An(T),H=window.URL.createObjectURL(C),S=document.createElement("a");S.href=H,S.download=`chat-${T.title}.pdf`,document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(H)},k=()=>{u()},g=()=>{w()},y=()=>{_()},v=T=>{T.detail===!1&&p()};return n.$$set=T=>{"shareEnabled"in T&&e(7,a=T.shareEnabled),"shareHandler"in T&&e(0,u=T.shareHandler),"downloadHandler"in T&&e(8,c=T.downloadHandler),"chat"in T&&e(1,d=T.chat),"onClose"in T&&e(2,p=T.onClose),"$$scope"in T&&e(14,r=T.$$scope)},[u,d,p,l,i,w,_,a,c,s,k,g,y,v,r]}class go extends Yt{constructor(t){super(),Xt(this,t,ho,mo,Jt,{shareEnabled:7,shareHandler:0,downloadHandler:8,chat:1,onClose:2})}}function Tl(n){let t,e,l;function s(o){n[15](o)}let r={showSetDefault:!n[2]};return n[0]!==void 0&&(r.selectedModels=n[0]),t=new lo({props:r}),mt.push(()=>zt(t,"selectedModels",s)),{c(){at(t.$$.fragment)},l(o){ct(t.$$.fragment,o)},m(o,i){ut(t,o,i),l=!0},p(o,i){const a={};i&4&&(a.showSetDefault=!o[2]),!e&&i&1&&(e=!0,a.selectedModels=o[0],jt(()=>e=!1)),t.$set(a)},i(o){l||(U(t.$$.fragment,o),l=!0)},o(o){R(t.$$.fragment,o),l=!1},d(o){ft(t,o)}}}function Vl(n){let t,e;return t=new go({props:{chat:n[3],shareEnabled:n[2],shareHandler:n[16],downloadHandler:n[17],$$slots:{default:[_o]},$$scope:{ctx:n}}}),{c(){at(t.$$.fragment)},l(l){ct(t.$$.fragment,l)},m(l,s){ut(t,l,s),e=!0},p(l,s){const r={};s&8&&(r.chat=l[3]),s&4&&(r.shareEnabled=l[2]),s&32&&(r.shareHandler=l[16]),s&64&&(r.downloadHandler=l[17]),s&2097152&&(r.$$scope={dirty:s,ctx:l}),t.$set(r)},i(l){e||(U(t.$$.fragment,l),e=!0)},o(l){R(t.$$.fragment,l),e=!1},d(l){ft(t,l)}}}function _o(n){let t,e='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){t=I("button"),t.innerHTML=e,this.h()},l(l){t=M(l,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),Gt(t)!=="svelte-9m6068"&&(t.innerHTML=e),this.h()},h(){f(t,"class","hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(t,"id","chat-context-menu-button")},m(l,s){P(l,t,s)},p:Tt,d(l){l&&m(t)}}}function po(n){let t,e,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"></path><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"></path></svg>',s,r,o;return{c(){t=I("button"),e=I("div"),e.innerHTML=l,this.h()},l(i){t=M(i,"BUTTON",{id:!0,class:!0});var a=E(t);e=M(a,"DIV",{class:!0,"data-svelte-h":!0}),Gt(e)!=="svelte-1fcii9y"&&(e.innerHTML=l),a.forEach(m),this.h()},h(){f(e,"class","m-auto self-center"),f(t,"id","new-chat-button"),f(t,"class",s="flex "+(n[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")},m(i,a){P(i,t,a),b(t,e),r||(o=K(t,"click",n[18]),r=!0)},p(i,a){a&256&&s!==(s="flex "+(i[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")&&f(t,"class",s)},d(i){i&&m(t),r=!1,o()}}}function Bl(n){let t,e;return t=new Bn({props:{className:"max-w-[200px]",role:n[10].role,$$slots:{default:[vo]},$$scope:{ctx:n}}}),t.$on("show",n[19]),{c(){at(t.$$.fragment)},l(l){ct(t.$$.fragment,l)},m(l,s){ut(t,l,s),e=!0},p(l,s){const r={};s&1024&&(r.role=l[10].role),s&2098176&&(r.$$scope={dirty:s,ctx:l}),t.$set(r)},i(l){e||(U(t.$$.fragment,l),e=!0)},o(l){R(t.$$.fragment,l),e=!1},d(l){ft(t,l)}}}function vo(n){let t,e,l,s;return{c(){t=I("button"),e=I("div"),l=I("img"),this.h()},l(r){t=M(r,"BUTTON",{class:!0,"aria-label":!0});var o=E(t);e=M(o,"DIV",{class:!0});var i=E(e);l=M(i,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),i.forEach(m),o.forEach(m),this.h()},h(){ge(l.src,s=n[10].profile_image_url)||f(l,"src",s),f(l,"class","size-6 object-cover rounded-full"),f(l,"alt","User profile"),f(l,"draggable","false"),f(e,"class","self-center"),f(t,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(t,"aria-label","User Menu")},m(r,o){P(r,t,o),b(t,e),b(e,l)},p(r,o){o&1024&&!ge(l.src,s=r[10].profile_image_url)&&f(l,"src",s)},d(r){r&&m(t)}}}function bo(n){let t,e,l,s,r,o,i,a,u,c,d,p,w,_,k,g,y,v,T,C,H;function S(O){n[13](O)}let B={chatId:n[7]};n[5]!==void 0&&(B.show=n[5]),t=new Vn({props:B}),mt.push(()=>zt(t,"show",S)),c=new Rn({});let L=n[4]&&Tl(n),Z=n[2]&&Vl(n);y=new ae({props:{content:n[9].t("New Chat"),$$slots:{default:[po]},$$scope:{ctx:n}}});let N=n[10]!==void 0&&Bl(n);return{c(){at(t.$$.fragment),l=X(),s=I("nav"),r=I("div"),o=I("div"),i=I("div"),a=I("button"),u=I("div"),at(c.$$.fragment),p=X(),w=I("div"),L&&L.c(),_=X(),k=I("div"),Z&&Z.c(),g=X(),at(y.$$.fragment),v=X(),N&&N.c(),this.h()},l(O){ct(t.$$.fragment,O),l=Q(O),s=M(O,"NAV",{id:!0,class:!0});var tt=E(s);r=M(tt,"DIV",{class:!0});var W=E(r);o=M(W,"DIV",{class:!0});var nt=E(o);i=M(nt,"DIV",{class:!0});var At=E(i);a=M(At,"BUTTON",{id:!0,class:!0});var yt=E(a);u=M(yt,"DIV",{class:!0});var Lt=E(u);ct(c.$$.fragment,Lt),Lt.forEach(m),yt.forEach(m),At.forEach(m),p=Q(nt),w=M(nt,"DIV",{class:!0});var Ct=E(w);L&&L.l(Ct),Ct.forEach(m),_=Q(nt),k=M(nt,"DIV",{class:!0});var _t=E(k);Z&&Z.l(_t),g=Q(_t),ct(y.$$.fragment,_t),v=Q(_t),N&&N.l(_t),_t.forEach(m),nt.forEach(m),W.forEach(m),tt.forEach(m),this.h()},h(){f(u,"class","m-auto self-center"),f(a,"id","sidebar-toggle-button"),f(a,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(i,"class",d=(n[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(w,"class","flex-1 overflow-hidden max-w-full"),f(k,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(o,"class","flex items-center w-full max-w-full"),f(r,"class","flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]"),f(s,"id","nav"),f(s,"class","sticky py-2.5 top-0 flex flex-row justify-center z-30")},m(O,tt){ut(t,O,tt),P(O,l,tt),P(O,s,tt),b(s,r),b(r,o),b(o,i),b(i,a),b(a,u),ut(c,u,null),b(o,p),b(o,w),L&&L.m(w,null),b(o,_),b(o,k),Z&&Z.m(k,null),b(k,g),ut(y,k,null),b(k,v),N&&N.m(k,null),T=!0,C||(H=K(a,"click",n[14]),C=!0)},p(O,[tt]){const W={};tt&128&&(W.chatId=O[7]),!e&&tt&32&&(e=!0,W.show=O[5],jt(()=>e=!1)),t.$set(W),(!T||tt&256&&d!==(d=(O[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&f(i,"class",d),O[4]?L?(L.p(O,tt),tt&16&&U(L,1)):(L=Tl(O),L.c(),U(L,1),L.m(w,null)):L&&(Ut(),R(L,1,1,()=>{L=null}),Pt()),O[2]?Z?(Z.p(O,tt),tt&4&&U(Z,1)):(Z=Vl(O),Z.c(),U(Z,1),Z.m(k,g)):Z&&(Ut(),R(Z,1,1,()=>{Z=null}),Pt());const nt={};tt&512&&(nt.content=O[9].t("New Chat")),tt&2097410&&(nt.$$scope={dirty:tt,ctx:O}),y.$set(nt),O[10]!==void 0?N?(N.p(O,tt),tt&1024&&U(N,1)):(N=Bl(O),N.c(),U(N,1),N.m(k,null)):N&&(Ut(),R(N,1,1,()=>{N=null}),Pt())},i(O){T||(U(t.$$.fragment,O),U(c.$$.fragment,O),U(L),U(Z),U(y.$$.fragment,O),U(N),T=!0)},o(O){R(t.$$.fragment,O),R(c.$$.fragment,O),R(L),R(Z),R(y.$$.fragment,O),R(N),T=!1},d(O){O&&(m(l),m(s)),ft(t,O),ft(c),L&&L.d(),Z&&Z.d(),ft(y),N&&N.d(),C=!1,H()}}}function wo(n,t,e){let l,s,r,o,i;st(n,Zl,L=>e(20,l=L)),st(n,me,L=>e(7,s=L)),st(n,Ce,L=>e(8,r=L)),st(n,Gl,L=>e(10,i=L));const a=ie("i18n");st(n,a,L=>e(9,o=L));let{initNewChat:u}=t,{title:c=l}=t,{shareEnabled:d=!1}=t,{chat:p}=t,{selectedModels:w}=t,{showModelSelector:_=!0}=t,k=!1,g=!1;function y(L){k=L,e(5,k)}const v=()=>{Ce.set(!r)};function T(L){w=L,e(0,w)}const C=()=>{e(5,k=!k)},H=()=>{e(6,g=!g)},S=()=>{u()},B=L=>{L.detail==="archived-chat"&&on.set(!0)};return n.$$set=L=>{"initNewChat"in L&&e(1,u=L.initNewChat),"title"in L&&e(12,c=L.title),"shareEnabled"in L&&e(2,d=L.shareEnabled),"chat"in L&&e(3,p=L.chat),"selectedModels"in L&&e(0,w=L.selectedModels),"showModelSelector"in L&&e(4,_=L.showModelSelector)},[w,u,d,p,_,k,g,s,r,o,i,a,c,y,v,T,C,H,S,B]}class ko extends Yt{constructor(t){super(),Xt(this,t,wo,bo,Jt,{initNewChat:1,title:12,shareEnabled:2,chat:3,selectedModels:0,showModelSelector:4})}}function yo(n){let t,e,l,s,r,o,i;return a(),{feed:u,reset:a};function a(){t=!0,e="",l=0,s=-1,r=void 0,o=void 0,i=""}function u(d){e=e?e+d:d,t&&Eo(e)&&(e=e.slice(Ql.length)),t=!1;const p=e.length;let w=0,_=!1;for(;w<p;){_&&(e[w]===`
`&&++w,_=!1);let k=-1,g=s,y;for(let v=l;k<0&&v<p;++v)y=e[v],y===":"&&g<0?g=v-w:y==="\r"?(_=!0,k=v-w):y===`
`&&(k=v-w);if(k<0){l=p-w,s=g;break}else l=0,s=-1;c(e,w,g,k),w+=k+1}w===p?e="":w>0&&(e=e.slice(w))}function c(d,p,w,_){if(_===0){i.length>0&&(n({type:"event",id:r,event:o||void 0,data:i.slice(0,-1)}),i="",r=void 0),o=void 0;return}const k=w<0,g=d.slice(p,p+(k?_:w));let y=0;k?y=_:d[p+w+1]===" "?y=w+2:y=w+1;const v=p+y,T=_-y,C=d.slice(v,v+T).toString();if(g==="data")i+=C?"".concat(C,`
`):`
`;else if(g==="event")o=C;else if(g==="id"&&!C.includes("\0"))r=C;else if(g==="retry"){const H=parseInt(C,10);Number.isNaN(H)||n({type:"reconnect-interval",value:H})}}}const Ql=[239,187,191];function Eo(n){return Ql.every((t,e)=>n.charCodeAt(e)===t)}class Io extends TransformStream{constructor(){let t;super({start(e){t=yo(l=>{l.type==="event"&&e.enqueue(l)})},transform(e){t.feed(e)}})}}async function Mo(n,t){const e=n.pipeThrough(new TextDecoderStream).pipeThrough(new Io).getReader();let l=Do(e);return t&&(l=So(l)),l}async function*Do(n){var t,e,l;for(;;){const{value:s,done:r}=await n.read();if(r){yield{done:!0,value:""};break}if(!s)continue;const o=s.data;if(o.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const i=JSON.parse(o);if(console.log(i),i.error){yield{done:!0,value:"",error:i.error};break}if(i.citations){yield{done:!1,value:"",citations:i.citations};continue}yield{done:!1,value:((l=(e=(t=i.choices)==null?void 0:t[0])==null?void 0:e.delta)==null?void 0:l.content)??""}}catch(i){console.error("Error extracting delta from SSE event:",i)}}}async function*So(n){for await(const t of n){if(t.done){yield t;return}if(t.citations){yield t;continue}let e=t.value;if(e.length<5){yield{done:!1,value:e};continue}for(;e!="";){const l=Math.min(Math.floor(Math.random()*3)+1,e.length);yield{done:!1,value:e.slice(0,l)},(document==null?void 0:document.visibilityState)!=="hidden"&&await Co(5),e=e.slice(l)}}}const Co=n=>new Promise(t=>setTimeout(t,n));function Nl(n){let t,e=n[2]&&Ol(n);return{c(){e&&e.c(),t=St()},l(l){e&&e.l(l),t=St()},m(l,s){e&&e.m(l,s),P(l,t,s)},p(l,s){l[2]?e?(e.p(l,s),s&4&&U(e,1)):(e=Ol(l),e.c(),U(e,1),e.m(t.parentNode,t)):e&&(Ut(),R(e,1,1,()=>{e=null}),Pt())},d(l){l&&m(t),e&&e.d(l)}}}function Ol(n){let t,e,l,s,r=n[1].type+"",o,i,a,u,c,d=n[1].content+"",p,w,_,k,g,y,v=n[1].url&&Al(),T=n[1].url&&Ll(),C=n[1].dismissible&&Ul(n);return{c(){t=I("div"),e=I("div"),l=I("div"),s=I("div"),o=rt(r),a=X(),v&&v.c(),u=X(),c=I("div"),p=rt(d),w=X(),T&&T.c(),_=X(),k=I("div"),C&&C.c(),this.h()},l(H){t=M(H,"DIV",{class:!0});var S=E(t);e=M(S,"DIV",{class:!0});var B=E(e);l=M(B,"DIV",{class:!0});var L=E(l);s=M(L,"DIV",{class:!0});var Z=E(s);o=it(Z,r),Z.forEach(m),a=Q(L),v&&v.l(L),L.forEach(m),u=Q(B),c=M(B,"DIV",{class:!0});var N=E(c);p=it(N,d),N.forEach(m),B.forEach(m),w=Q(S),T&&T.l(S),_=Q(S),k=M(S,"DIV",{class:!0});var O=E(k);C&&C.l(O),O.forEach(m),S.forEach(m),this.h()},h(){f(s,"class",i="text-xs font-black "+(n[3][n[1].type]??n[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"),f(l,"class","flex justify-between self-start"),f(c,"class","flex-1 text-xs text-gray-700 dark:text-white"),f(e,"class","flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5"),f(k,"class","flex self-start"),f(t,"class","top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-100 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-40")},m(H,S){P(H,t,S),b(t,e),b(e,l),b(l,s),b(s,o),b(l,a),v&&v.m(l,null),b(e,u),b(e,c),b(c,p),b(t,w),T&&T.m(t,null),b(t,_),b(t,k),C&&C.m(k,null),y=!0},p(H,S){(!y||S&2)&&r!==(r=H[1].type+"")&&bt(o,r),(!y||S&2&&i!==(i="text-xs font-black "+(H[3][H[1].type]??H[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"))&&f(s,"class",i),H[1].url?v||(v=Al(),v.c(),v.m(l,null)):v&&(v.d(1),v=null),(!y||S&2)&&d!==(d=H[1].content+"")&&bt(p,d),H[1].url?T||(T=Ll(),T.c(),T.m(t,_)):T&&(T.d(1),T=null),H[1].dismissible?C?C.p(H,S):(C=Ul(H),C.c(),C.m(k,null)):C&&(C.d(1),C=null)},i(H){y||(H&&Ve(()=>{y&&(g||(g=Se(t,Qe,{delay:100,duration:300},!0)),g.run(1))}),y=!0)},o(H){H&&(g||(g=Se(t,Qe,{delay:100,duration:300},!1)),g.run(0)),y=!1},d(H){H&&m(t),v&&v.d(),T&&T.d(),C&&C.d(),H&&g&&g.end()}}}function Al(n){let t,e='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/assets/files/whitepaper.pdf" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){t=I("div"),t.innerHTML=e,this.h()},l(l){t=M(l,"DIV",{class:!0,"data-svelte-h":!0}),Gt(t)!=="svelte-1ofrdjc"&&(t.innerHTML=e),this.h()},h(){f(t,"class","flex md:hidden group w-fit md:items-center")},m(l,s){P(l,t,s)},d(l){l&&m(t)}}}function Ll(n){let t,e='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){t=I("div"),t.innerHTML=e,this.h()},l(l){t=M(l,"DIV",{class:!0,"data-svelte-h":!0}),Gt(t)!=="svelte-15ujvd1"&&(t.innerHTML=e),this.h()},h(){f(t,"class","hidden md:flex group w-fit md:items-center")},m(l,s){P(l,t,s)},d(l){l&&m(t)}}}function Ul(n){let t,e="×",l,s;return{c(){t=I("button"),t.textContent=e,this.h()},l(r){t=M(r,"BUTTON",{class:!0,"data-svelte-h":!0}),Gt(t)!=="svelte-17pf3tf"&&(t.textContent=e),this.h()},h(){f(t,"class","-mt-[3px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white h-1")},m(r,o){P(r,t,o),l||(s=K(t,"click",n[5]),l=!0)},p:Tt,d(r){r&&m(t),l=!1,s()}}}function To(n){let t,e=!n[0]&&Nl(n);return{c(){e&&e.c(),t=St()},l(l){e&&e.l(l),t=St()},m(l,s){e&&e.m(l,s),P(l,t,s)},p(l,[s]){l[0]?e&&(e.d(1),e=null):e?e.p(l,s):(e=Nl(l),e.c(),e.m(t.parentNode,t))},i:Tt,o:Tt,d(l){l&&m(t),e&&e.d(l)}}}function Vo(n,t,e){const l=Pe();let{banner:s={id:"",type:"info",title:"",content:"",url:"",dismissable:!0,timestamp:Math.floor(Date.now()/1e3)}}=t,{dismissed:r=!1}=t,o=!1;const i={info:"bg-blue-500/20 text-blue-700 dark:text-blue-200 ",success:"bg-green-500/20 text-green-700 dark:text-green-200",warning:"bg-yellow-500/20 text-yellow-700 dark:text-yellow-200",error:"bg-red-500/20 text-red-700 dark:text-red-200"},a=c=>{e(0,r=!0),l("dismiss",c)};He(()=>{e(2,o=!0)});const u=()=>{a(s.id)};return n.$$set=c=>{"banner"in c&&e(1,s=c.banner),"dismissed"in c&&e(0,r=c.dismissed)},[r,s,o,i,a,u]}class Bo extends Yt{constructor(t){super(),Xt(this,t,Vo,To,Jt,{banner:1,dismissed:0})}}const{document:Le}=en;function Pl(n,t,e){const l=n.slice();return l[56]=t[e],l}function Hl(n){let t,e,l,s,r,o,i,a,u,c,d,p,w,_,k,g,y,v,T,C,H,S,B,L,Z;function N(j){n[24](j)}function O(j){n[25](j)}let tt={title:n[9],shareEnabled:n[12].length>0,chat:n[8],initNewChat:n[18]};n[6]!==void 0&&(tt.selectedModels=n[6]),n[5]!==void 0&&(tt.showModelSelector=n[5]),e=new ko({props:tt}),mt.push(()=>zt(e,"selectedModels",N)),mt.push(()=>zt(e,"showModelSelector",O));let W=n[16].length>0&&!n[13]&&Rl(n);function nt(j){n[28](j)}function At(j){n[29](j)}function yt(j){n[30](j)}function Lt(j){n[31](j)}let Ct={chatId:n[13],selectedModels:n[6],processing:Oo,bottomPadding:n[11].length>0,sendPrompt:n[20],continueGeneration:n[23],regenerateResponse:n[22]};n[1]!==void 0&&(Ct.history=n[1]),n[12]!==void 0&&(Ct.messages=n[12]),n[3]!==void 0&&(Ct.autoScroll=n[3]),n[10]!==void 0&&(Ct.prompt=n[10]),c=new Sn({props:Ct}),mt.push(()=>zt(c,"history",nt)),mt.push(()=>zt(c,"messages",At)),mt.push(()=>zt(c,"autoScroll",yt)),mt.push(()=>zt(c,"prompt",Lt));function _t(j){n[34](j)}function Vt(j){n[35](j)}function Zt(j){n[36](j)}function qt(j){n[37](j)}let Bt={selectedModels:n[6],messages:n[12],submitPrompt:n[19],stopResponse:n[21]};return n[11]!==void 0&&(Bt.files=n[11]),n[10]!==void 0&&(Bt.prompt=n[10]),n[3]!==void 0&&(Bt.autoScroll=n[3]),n[7]!==void 0&&(Bt.atSelectedModel=n[7]),v=new Xs({props:Bt}),mt.push(()=>zt(v,"files",_t)),mt.push(()=>zt(v,"prompt",Vt)),mt.push(()=>zt(v,"autoScroll",Zt)),mt.push(()=>zt(v,"atSelectedModel",qt)),{c(){t=I("div"),at(e.$$.fragment),r=X(),W&&W.c(),o=X(),i=I("div"),a=I("div"),u=I("div"),at(c.$$.fragment),y=X(),at(v.$$.fragment),this.h()},l(j){t=M(j,"DIV",{class:!0});var A=E(t);ct(e.$$.fragment,A),r=Q(A),W&&W.l(A),o=Q(A),i=M(A,"DIV",{class:!0});var Ht=E(i);a=M(Ht,"DIV",{class:!0,id:!0});var wt=E(a);u=M(wt,"DIV",{class:!0});var Rt=E(u);ct(c.$$.fragment,Rt),Rt.forEach(m),wt.forEach(m),Ht.forEach(m),A.forEach(m),y=Q(j),ct(v.$$.fragment,j),this.h()},h(){f(u,"class",k="h-full w-full flex flex-col "+(n[0]?"py-4":"pt-2 pb-4")),f(a,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full"),f(a,"id","messages-container"),f(i,"class","flex flex-col flex-auto"),f(t,"class",g="min-h-screen max-h-screen "+(n[15]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col")},m(j,A){P(j,t,A),ut(e,t,null),b(t,r),W&&W.m(t,null),b(t,o),b(t,i),b(i,a),b(a,u),ut(c,u,null),n[32](a),P(j,y,A),ut(v,j,A),B=!0,L||(Z=K(a,"scroll",n[33]),L=!0)},p(j,A){const Ht={};A[0]&512&&(Ht.title=j[9]),A[0]&4096&&(Ht.shareEnabled=j[12].length>0),A[0]&256&&(Ht.chat=j[8]),!l&&A[0]&64&&(l=!0,Ht.selectedModels=j[6],jt(()=>l=!1)),!s&&A[0]&32&&(s=!0,Ht.showModelSelector=j[5],jt(()=>s=!1)),e.$set(Ht),j[16].length>0&&!j[13]?W?(W.p(j,A),A[0]&73728&&U(W,1)):(W=Rl(j),W.c(),U(W,1),W.m(t,o)):W&&(Ut(),R(W,1,1,()=>{W=null}),Pt());const wt={};A[0]&8192&&(wt.chatId=j[13]),A[0]&64&&(wt.selectedModels=j[6]),A[0]&2048&&(wt.bottomPadding=j[11].length>0),!d&&A[0]&2&&(d=!0,wt.history=j[1],jt(()=>d=!1)),!p&&A[0]&4096&&(p=!0,wt.messages=j[12],jt(()=>p=!1)),!w&&A[0]&8&&(w=!0,wt.autoScroll=j[3],jt(()=>w=!1)),!_&&A[0]&1024&&(_=!0,wt.prompt=j[10],jt(()=>_=!1)),c.$set(wt),(!B||A[0]&1&&k!==(k="h-full w-full flex flex-col "+(j[0]?"py-4":"pt-2 pb-4")))&&f(u,"class",k),(!B||A[0]&32768&&g!==(g="min-h-screen max-h-screen "+(j[15]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col"))&&f(t,"class",g);const Rt={};A[0]&64&&(Rt.selectedModels=j[6]),A[0]&4096&&(Rt.messages=j[12]),!T&&A[0]&2048&&(T=!0,Rt.files=j[11],jt(()=>T=!1)),!C&&A[0]&1024&&(C=!0,Rt.prompt=j[10],jt(()=>C=!1)),!H&&A[0]&8&&(H=!0,Rt.autoScroll=j[3],jt(()=>H=!1)),!S&&A[0]&128&&(S=!0,Rt.atSelectedModel=j[7],jt(()=>S=!1)),v.$set(Rt)},i(j){B||(U(e.$$.fragment,j),U(W),U(c.$$.fragment,j),U(v.$$.fragment,j),B=!0)},o(j){R(e.$$.fragment,j),R(W),R(c.$$.fragment,j),R(v.$$.fragment,j),B=!1},d(j){j&&(m(t),m(y)),ft(e),W&&W.d(),ft(c),n[32](null),ft(v,j),L=!1,Z()}}}function Rl(n){let t,e,l,s,r=xt(n[16].filter(n[26])),o=[];for(let a=0;a<r.length;a+=1)o[a]=jl(Pl(n,r,a));const i=a=>R(o[a],1,1,()=>{o[a]=null});return{c(){t=I("div"),e=I("div");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){t=M(a,"DIV",{class:!0});var u=E(t);e=M(u,"DIV",{class:!0});var c=E(e);for(let d=0;d<o.length;d+=1)o[d].l(c);c.forEach(m),u.forEach(m),this.h()},h(){f(e,"class","flex flex-col gap-1 w-full"),f(t,"class",l="absolute top-[4.25rem] w-full "+(n[15]?"md:max-w-[calc(100%-260px)]":""))},m(a,u){P(a,t,u),b(t,e);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);s=!0},p(a,u){if(u[0]&65536){r=xt(a[16].filter(a[26]));let c;for(c=0;c<r.length;c+=1){const d=Pl(a,r,c);o[c]?(o[c].p(d,u),U(o[c],1)):(o[c]=jl(d),o[c].c(),U(o[c],1),o[c].m(e,null))}for(Ut(),c=r.length;c<o.length;c+=1)i(c);Pt()}(!s||u[0]&32768&&l!==(l="absolute top-[4.25rem] w-full "+(a[15]?"md:max-w-[calc(100%-260px)]":"")))&&f(t,"class",l)},i(a){if(!s){for(let u=0;u<r.length;u+=1)U(o[u]);s=!0}},o(a){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)R(o[u]);s=!1},d(a){a&&m(t),pe(o,a)}}}function jl(n){let t,e;return t=new Bo({props:{banner:n[56]}}),t.$on("dismiss",n[27]),{c(){at(t.$$.fragment)},l(l){ct(t.$$.fragment,l)},m(l,s){ut(t,l,s),e=!0},p(l,s){const r={};s[0]&65536&&(r.banner=l[56]),t.$set(r)},i(l){e||(U(t.$$.fragment,l),e=!0)},o(l){R(t.$$.fragment,l),e=!1},d(l){ft(t,l)}}}function No(n){let t,e,l,s;Le.title=t=`
		`+(n[9]?`${n[9].length>30?`${n[9].slice(0,30)}...`:n[9]} | ${n[14]}`:`${n[14]}`)+`
	`;let r=(!n[0]||n[2]&&n[0])&&Hl(n);return{c(){e=X(),r&&r.c(),l=St()},l(o){tn("svelte-1123lr8",Le.head).forEach(m),e=Q(o),r&&r.l(o),l=St()},m(o,i){P(o,e,i),r&&r.m(o,i),P(o,l,i),s=!0},p(o,i){(!s||i[0]&16896)&&t!==(t=`
		`+(o[9]?`${o[9].length>30?`${o[9].slice(0,30)}...`:o[9]} | ${o[14]}`:`${o[14]}`)+`
	`)&&(Le.title=t),!o[0]||o[2]&&o[0]?r?(r.p(o,i),i[0]&5&&U(r,1)):(r=Hl(o),r.c(),U(r,1),r.m(l.parentNode,l)):r&&(Ut(),R(r,1,1,()=>{r=null}),Pt())},i(o){s||(U(r),s=!0)},o(o){R(r),s=!1},d(o){o&&(m(e),m(l)),r&&r.d(o)}}}let Oo="";function Ao(n,t,e){let l,s,r,o,i,a,u,c,d;st(n,me,D=>e(13,l=D)),st(n,he,D=>e(41,s=D)),st(n,Be,D=>e(43,o=D)),st(n,ln,D=>e(44,i=D)),st(n,rn,D=>e(45,a=D)),st(n,Zl,D=>e(14,u=D)),st(n,Ce,D=>e(15,c=D)),st(n,an,D=>e(16,d=D));const p=ie("i18n");st(n,p,D=>e(42,r=D));let{chatIdProp:w=""}=t,_=!1,k=!1,g=!0,y,v=null,T=!0,C=[""],H,S=null,B="",L="",Z=[],N=[],O={messages:{},currentId:null};He(async()=>{l?(s.saveChatHistory??!0)||await Ne("/"):await tt()});const tt=async()=>{var et;v!==null&&(await Ye(localStorage.token,v),v=null),window.history.replaceState(O.state,"","/"),await me.set(""),e(3,g=!0),e(9,B=""),e(12,N=[]),e(1,O={messages:{},currentId:null}),i.url.searchParams.get("models")?e(6,C=(et=i.url.searchParams.get("models"))==null?void 0:et.split(",")):s!=null&&s.models?e(6,C=s==null?void 0:s.models):a!=null&&a.default_models?e(6,C=a==null?void 0:a.default_models.split(",")):e(6,C=[""]),i.url.searchParams.get("q")&&(e(10,L=i.url.searchParams.get("q")??""),L&&(await pt(),At(L))),e(6,C=C.map(lt=>o.map(q=>q.id).includes(lt)?lt:""));let D=JSON.parse(localStorage.getItem("settings")??"{}");he.set({...D});const F=document.getElementById("chat-textarea");setTimeout(()=>F==null?void 0:F.focus(),0)},W=async()=>{if(me.set(w),e(8,S=await kn(localStorage.token,l).catch(async D=>(await Ne("/"),null))),S){await A();const D=S.chat;if(D){console.log(D),e(6,C=((D==null?void 0:D.models)??void 0)!==void 0?D.models:[D.models??""]),e(1,O=((D==null?void 0:D.history)??void 0)!==void 0?D.history:fn(D.messages)),e(9,B=D.title);let F=JSON.parse(localStorage.getItem("settings")??"{}");return await he.set({...F,system:D.system??F.system,params:D.options??F.params}),e(3,g=!0),await pt(),N.length>0&&e(1,O.messages[N.at(-1).id].done=!0,O),await pt(),!0}else return null}},nt=async()=>{await pt(),y&&e(4,y.scrollTop=y.scrollHeight,y)},At=async(D,F=null)=>{if(console.log("submitPrompt",l),e(6,C=C.map(et=>o.map(lt=>lt.id).includes(et)?et:"")),C.includes(""))ot.error(r.t("Model not selected"));else if(N.length!=0&&N.at(-1).done!=!0)console.log("wait");else if(Z.length>0&&Z.filter(et=>et.upload_status===!1).length>0)ot.error(r.t("Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready."));else{document.getElementById("chat-textarea").style.height="";let et=Ze(),lt={id:et,parentId:N.length!==0?N.at(-1).id:null,childrenIds:[],role:"user",user:F??void 0,content:D,files:Z.length>0?Z:void 0,timestamp:Math.floor(Date.now()/1e3),models:C.filter((q,V)=>C.indexOf(q)===V)};e(1,O.messages[et]=lt,O),e(1,O.currentId=et,O),N.length!==0&&O.messages[N.at(-1).id].childrenIds.push(et),await pt(),N.length==1&&(s.saveChatHistory??!0?(e(8,S=await wn(localStorage.token,{id:l,title:r.t("New Chat"),models:C,system:s.system??void 0,options:{...s.params??{}},messages:N,history:O,tags:[],timestamp:Date.now()})),await Ie.set(await Me(localStorage.token)),await me.set(S.id)):await me.set("local"),await pt()),e(10,L=""),document.getElementById("chat-textarea").style.height="",e(11,Z=[]),await yt(D,et)}},yt=async(D,F,et=null)=>{const lt=JSON.parse(JSON.stringify(l));await Promise.all((et?[et]:H!==void 0?[H.id]:C).map(async q=>{var $,kt,Mt;console.log("modelId",q);const V=o.filter(Dt=>Dt.id===q).at(0);if(V){N.some(dt=>{var x;return(x=dt.files)==null?void 0:x.some(h=>h.type==="image")})&&!(((Mt=(kt=($=V.info)==null?void 0:$.meta)==null?void 0:kt.capabilities)==null?void 0:Mt.vision)??!0)&&ot.error(r.t("Model {{modelName}} is not vision capable",{modelName:V.name??V.id}));let Ot=Ze(),Ft={parentId:F,id:Ot,childrenIds:[],role:"assistant",content:"",model:V.id,modelName:V.name??V.id,userContext:null,timestamp:Math.floor(Date.now()/1e3)};e(1,O.messages[Ot]=Ft,O),e(1,O.currentId=Ot,O),F!==null&&e(1,O.messages[F].childrenIds=[...O.messages[F].childrenIds,Ot],O),await pt();let Wt=null;if(((s==null?void 0:s.memory)??!1)&&Wt===null){const dt=await Nn(localStorage.token,D).catch(x=>(ot.error(x),null));dt&&(dt.documents[0].length>0&&(Wt=dt.documents.reduce((x,h,G)=>{const Y=dt.metadatas[G][0].created_at,z=new Date(Y*1e3).toISOString().split("T")[0];return x.push(`${G+1}. [${z}]. ${h[0]}`),x},[])),console.log(Wt))}Ft.userContext=Wt,(V==null?void 0:V.owned_by)==="openai"?await Ct(V,D,Ot,lt):V&&await Lt(V,D,Ot,lt)}else ot.error(r.t("Model {{modelId}} not found",{modelId:q}))})),await Ie.set(await Me(localStorage.token))},Lt=async(D,F,et,lt)=>{var Ot,Ft,Wt,dt;D=D.id;const q=O.messages[et];await pt(),nt();const V=[s.system||((q==null?void 0:q.userContext)??null)?{role:"system",content:`${(s==null?void 0:s.system)??""}${(q==null?void 0:q.userContext)??null?`

User Context:
${((q==null?void 0:q.userContext)??[]).join(`
`)}`:""}`}:void 0,...N].filter(x=>{var h;return(h=x==null?void 0:x.content)==null?void 0:h.trim()}).map((x,h,G)=>{var J;const Y={role:x.role,content:x.content},z=(J=x.files)==null?void 0:J.filter(vt=>vt.type==="image").map(vt=>vt.url.slice(vt.url.indexOf(",")+1));return z&&z.length>0&&x.role==="user"&&(Y.images=z),Y});let $=-1;V.forEach((x,h)=>{x.images&&($=h)}),V.forEach((x,h)=>{h!==$&&delete x.images});const kt=N.filter(x=>(x==null?void 0:x.files)??null).map(x=>x.files.filter(h=>h.type==="doc"||h.type==="collection")).flat(1),[Mt,Dt]=await pn(localStorage.token,{model:D,messages:V,options:{...s.params??{},stop:((Ot=s==null?void 0:s.params)==null?void 0:Ot.stop)??void 0?s.params.stop.map(x=>decodeURIComponent(JSON.parse('"'+x.replace(/\"/g,'\\"')+'"'))):void 0,num_predict:((Ft=s==null?void 0:s.params)==null?void 0:Ft.max_tokens)??void 0,repeat_penalty:((Wt=s==null?void 0:s.params)==null?void 0:Wt.frequency_penalty)??void 0},format:s.requestFormat??void 0,keep_alive:s.keepAlive??void 0,docs:kt.length>0?kt:void 0,citations:kt.length>0});if(Mt&&Mt.ok){console.log("controller",Dt);const x=Mt.body.pipeThrough(new TextDecoderStream).pipeThrough(un(`
`)).getReader();for(;;){const{value:h,done:G}=await x.read();if(G||k||lt!==l){q.done=!0,e(12,N),e(1,O),k&&(Dt.abort("User: Stop Response"),await Ye(localStorage.token,v)),v=null;break}try{let Y=h.split(`
`);for(const z of Y)if(z!==""){console.log(z);let J=JSON.parse(z);if("citations"in J){q.citations=J.citations;continue}if("detail"in J)throw J;if("id"in J)console.log(J),v=J.id;else if(J.done==!1){if(q.content==""&&J.message.content==`
`)continue;q.content+=J.message.content,e(12,N),e(1,O)}else{if(q.done=!0,q.content==""&&(q.error=!0,q.content="Oops! No text generated from Ollama, Please try again."),q.context=J.context??null,q.info={total_duration:J.total_duration,load_duration:J.load_duration,sample_count:J.sample_count,sample_duration:J.sample_duration,prompt_eval_count:J.prompt_eval_count,prompt_eval_duration:J.prompt_eval_duration,eval_count:J.eval_count,eval_duration:J.eval_duration},e(12,N),e(1,O),s.notificationEnabled&&!document.hasFocus()){const vt=new Notification(selectedModelfile?`${selectedModelfile.title.charAt(0).toUpperCase()+selectedModelfile.title.slice(1)}`:`${D}`,{body:q.content,icon:(selectedModelfile==null?void 0:selectedModelfile.imageUrl)??`${Te}/static/favicon.png`})}s.responseAutoCopy&&Je(q.content),s.responseAutoPlayback&&(await pt(),(dt=document.getElementById(`speak-button-${q.id}`))==null||dt.click())}}}catch(Y){console.log(Y),"detail"in Y&&ot.error(Y.detail);break}g&&nt()}l==lt&&(s.saveChatHistory??!0)&&(e(8,S=await Ae(localStorage.token,lt,{messages:N,history:O,models:C})),await Ie.set(await Me(localStorage.token)))}else{if(Mt!==null){const x=await Mt.json();console.log(x),"detail"in x?(ot.error(x.detail),q.content=x.detail):(ot.error(x.error),q.content=x.error)}else ot.error(r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})),q.content=r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"});q.error=!0,q.content=r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"}),q.done=!0,e(12,N),e(1,O)}if(k=!1,await pt(),g&&nt(),N.length==2&&N.at(1).content!==""){window.history.replaceState(O.state,"",`/c/${lt}`);const x=await Bt(F);await j(lt,x)}},Ct=async(D,F,et,lt)=>{var $,kt,Mt,Dt,Ot,Ft,Wt;const q=O.messages[et],V=N.filter(dt=>(dt==null?void 0:dt.files)??null).map(dt=>dt.files.filter(x=>x.type==="doc"||x.type==="collection")).flat(1);console.log(V),nt();try{const[dt,x]=await vn(localStorage.token,{model:D.id,stream:!0,messages:[s.system||((q==null?void 0:q.userContext)??null)?{role:"system",content:`${(s==null?void 0:s.system)??""}${(q==null?void 0:q.userContext)??null?`

User Context:
${((q==null?void 0:q.userContext)??[]).join(`
`)}`:""}`}:void 0,...N].filter(h=>{var G;return(G=h==null?void 0:h.content)==null?void 0:G.trim()}).map((h,G,Y)=>{var z;return{role:h.role,...((z=h.files)==null?void 0:z.filter(J=>J.type==="image").length)>0&&h.role==="user"?{content:[{type:"text",text:Y.length-1!==G?h.content:(h==null?void 0:h.raContent)??h.content},...h.files.filter(J=>J.type==="image").map(J=>({type:"image_url",image_url:{url:J.url}}))]}:{content:Y.length-1!==G?h.content:(h==null?void 0:h.raContent)??h.content}}}),seed:(($=s==null?void 0:s.params)==null?void 0:$.seed)??void 0,stop:((kt=s==null?void 0:s.params)==null?void 0:kt.stop)??void 0?s.params.stop.map(h=>decodeURIComponent(JSON.parse('"'+h.replace(/\"/g,'\\"')+'"'))):void 0,temperature:((Mt=s==null?void 0:s.params)==null?void 0:Mt.temperature)??void 0,top_p:((Dt=s==null?void 0:s.params)==null?void 0:Dt.top_p)??void 0,frequency_penalty:((Ot=s==null?void 0:s.params)==null?void 0:Ot.frequency_penalty)??void 0,max_tokens:((Ft=s==null?void 0:s.params)==null?void 0:Ft.max_tokens)??void 0,docs:V.length>0?V:void 0,citations:V.length>0},`${qe}`);if(await pt(),nt(),dt&&dt.ok&&dt.body){const h=await Mo(dt.body,s.splitLargeChunks);for await(const G of h){const{value:Y,done:z,citations:J,error:vt}=G;if(vt){await _t(vt,null,D,q);break}if(z||k||lt!==l){q.done=!0,e(12,N),e(1,O),k&&x.abort("User: Stop Response");break}if(J){q.citations=J;continue}if(!(q.content==""&&Y==`
`)){if(q.content+=Y,e(12,N),e(1,O),s.notificationEnabled&&!document.hasFocus()){const de=new Notification(`OpenAI ${D}`,{body:q.content,icon:`${Te}/static/favicon.png`})}s.responseAutoCopy&&Je(q.content),s.responseAutoPlayback&&(await pt(),(Wt=document.getElementById(`speak-button-${q.id}`))==null||Wt.click()),g&&nt()}}l==lt&&(s.saveChatHistory??!0)&&(e(8,S=await Ae(localStorage.token,lt,{models:C,messages:N,history:O})),await Ie.set(await Me(localStorage.token)))}else await _t(null,dt,D,q)}catch(dt){await _t(dt,null,D,q)}if(e(12,N),e(1,O),k=!1,await pt(),g&&nt(),N.length==2){window.history.replaceState(O.state,"",`/c/${lt}`);const dt=await Bt(F);await j(lt,dt)}},_t=async(D,F,et,lt)=>{let q="",V;D?V=D:F!==null&&(V=await F.json()),console.error(V),"detail"in V?(ot.error(V.detail),q=V.detail):"error"in V?"message"in V.error?(ot.error(V.error.message),q=V.error.message):(ot.error(V.error),q=V.error):"message"in V&&(ot.error(V.message),q=V.message),lt.error=!0,lt.content=r.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:et.name??et.id})+`
`+q,lt.done=!0,e(12,N),e(1,O)},Vt=()=>{k=!0,console.log("stopResponse")},Zt=async D=>{if(console.log("regenerateResponse"),N.length!=0){let F=O.messages[D.parentId],et=F.content;((F==null?void 0:F.models)??[...C]).length==1?await yt(et,F.id):await yt(et,F.id,D.model)}},qt=async()=>{console.log("continueGeneration");const D=JSON.parse(JSON.stringify(l));if(N.length!=0&&N.at(-1).done==!0){const F=O.messages[O.currentId];F.done=!1,await pt();const et=o.filter(lt=>lt.id===F.model).at(0);et&&(et!=null&&et.external?await Ct(et,O.messages[F.parentId].content,F.id,D):await Lt(et,O.messages[F.parentId].content,F.id,D))}else ot.error(r.t("Model {{modelId}} not found",{modelId}))},Bt=async D=>{var F,et,lt,q;if(((F=s==null?void 0:s.title)==null?void 0:F.auto)??!0){const V=o.find(Dt=>Dt.id===C[0]),$=(V==null?void 0:V.external)??!1?((et=s==null?void 0:s.title)==null?void 0:et.modelExternal)??C[0]:((lt=s==null?void 0:s.title)==null?void 0:lt.model)??C[0],kt=o.find(Dt=>Dt.id===$);return console.log(kt),await bn(localStorage.token,((q=s==null?void 0:s.title)==null?void 0:q.prompt)??r.t("Create a concise, 3-5 word phrase as a header for the following query, strictly adhering to the 3-5 word limit and avoiding the use of the word 'title':")+" {{prompt}}",$,D,(kt==null?void 0:kt.owned_by)==="openai"?`${qe}`:`${cn}/v1`)}else return`${D}`},j=async(D,F)=>{D===l&&e(9,B=F),(s.saveChatHistory??!0)&&(e(8,S=await Ae(localStorage.token,D,{title:F})),await Ie.set(await Me(localStorage.token)))},A=async()=>await yn(localStorage.token,l).catch(async D=>[]);function Ht(D){C=D,e(6,C)}function wt(D){T=D,e(5,T)}const Rt=D=>D.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(D.id):!0,ce=D=>{const F=D.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([F,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(et=>d.find(lt=>lt.id===et))))};function Et(D){O=D,e(1,O)}function Nt(D){N=D,e(12,N),e(1,O)}function ue(D){g=D,e(3,g)}function Qt(D){L=D,e(10,L)}function fe(D){mt[D?"unshift":"push"](()=>{y=D,e(4,y)})}const be=D=>{e(3,g=y.scrollHeight-y.scrollTop<=y.clientHeight+5)};function we(D){Z=D,e(11,Z)}function ke(D){L=D,e(10,L)}function re(D){g=D,e(3,g)}function It(D){H=D,e(7,H)}return n.$$set=D=>{"chatIdProp"in D&&e(0,w=D.chatIdProp)},n.$$.update=()=>{if(n.$$.dirty[0]&2)if(O.currentId!==null){let D=[],F=O.messages[O.currentId];for(;F!==null;)D.unshift({...F}),F=F.parentId!==null?O.messages[F.parentId]:null;e(12,N=D)}else e(12,N=[]);n.$$.dirty[0]&1&&w&&(async()=>{if(await W()){await pt(),e(2,_=!0),window.setTimeout(()=>nt(),0);const D=document.getElementById("chat-textarea");D==null||D.focus()}else await Ne("/")})()},[w,O,_,g,y,T,C,H,S,B,L,Z,N,l,u,c,d,p,tt,At,yt,Vt,Zt,qt,Ht,wt,Rt,ce,Et,Nt,ue,Qt,fe,be,we,ke,re,It]}class ar extends Yt{constructor(t){super(),Xt(this,t,Ao,No,Jt,{chatIdProp:0},null,[-1,-1])}}export{ar as C};
//# sourceMappingURL=Chat.0754b471.js.map
