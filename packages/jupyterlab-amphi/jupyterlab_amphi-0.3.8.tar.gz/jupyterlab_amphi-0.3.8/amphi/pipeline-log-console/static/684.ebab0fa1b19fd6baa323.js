"use strict";(self.webpackChunk_amphi_pipeline_log_console=self.webpackChunk_amphi_pipeline_log_console||[]).push([[684],{684:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var s=n(3420),o=n(1201),i=n(5011),r=n(1760),l=n(5881),a=n(4602);class c{constructor(e){this._isDisposed=!1,this._disposed=new a.Signal(this),this._rendermime=null,this._connector=e}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get rendermime(){return this._rendermime}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),a.Signal.clearData(this))}}class d extends c{constructor(e){var t;super(e.connector),this._id=e.id,this._rendermime=null!==(t=e.rendermime)&&void 0!==t?t:null,this._ready=this._connector.ready,this._connector.kernelRestarted.connect(((e,t)=>{this._ready=this._connector.ready}))}get id(){return this._id}get ready(){return this._ready}}class h{constructor(e){this._kernelRestarted=new a.Signal(this),this._session=e.session,this._session.statusChanged.connect(((e,t)=>{switch(t){case"restarting":this._kernelRestarted.emit(this._session.ready);case"autorestarting":this._kernelRestarted.emit(this._session.ready)}}))}get kernelRestarted(){return this._kernelRestarted}get kernelLanguage(){var e;return(null===(e=this._session.session)||void 0===e?void 0:e.kernel)?this._session.session.kernel.info.then((e=>e.language_info.name)):Promise.resolve("")}get kernelName(){return this._session.kernelDisplayName}get ready(){return this._session.ready}get iopubMessage(){return this._session.iopubMessage}execute(e){var t;if(!(null===(t=this._session.session)||void 0===t?void 0:t.kernel))throw new Error("No session available.");return this._session.session.kernel.requestExecute(e)}}var p=n(5256),u=n(3345),m=n.n(u),g=n(7628),_=n.n(g),y=n(931),v=n(1047);const C=({htmlData:e})=>{const[t,n]=(0,u.useState)([]),[s,o]=(0,u.useState)([]);return(0,u.useEffect)((()=>{console.log("DATA %o",e);const{data:t,headers:s}=function(e){const t=(new DOMParser).parseFromString(e,"text/html");let n=Array.from(t.querySelectorAll("table thead th")).map((e=>{var t,n;return null!==(n=null===(t=e.textContent)||void 0===t?void 0:t.trim())&&void 0!==n?n:""}));const s=t.querySelectorAll("table tbody tr");return{data:Array.from(s,((e,t)=>{const s=e.querySelectorAll("th, td"),o={index:t.toString()};if(s.length===n.length)s.forEach(((e,t)=>{var s,i;o[n[t]]=null!==(i=null===(s=e.textContent)||void 0===s?void 0:s.trim())&&void 0!==i?i:""}));else if(s.length===n.length+1)["",...n].forEach(((e,t)=>{var n,i;o[e]=null!==(i=null===(n=s[t].textContent)||void 0===n?void 0:n.trim())&&void 0!==i?i:""}));else{const t=e.querySelectorAll("td");n.forEach(((e,n)=>{var s,i,r;o[e]=null!==(r=null===(i=null===(s=t[n])||void 0===s?void 0:s.textContent)||void 0===i?void 0:i.trim())&&void 0!==r?r:""}))}return o})),headers:n}}(e);n(t),o(s.map((e=>({title:e,dataIndex:e,key:e}))))}),[e]),m().createElement(v.A,{dataSource:t,columns:s,pagination:!1,size:"small"})};var f=n(4363),w=n(7516),x=n(3361),S=n(6198);const{Text:b}=f.A;class k extends p.Widget{constructor(){super(),this._source=null,this.addClass("amphi-Console"),this._title=E.createTitle(),this._title.className="amphi-Console-title",this._console=E.createConsole(),this._console.className="amphi-Console-table",this.node.appendChild(this._title),this.node.appendChild(this._console)}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this.onSourceDisposed,this),this._source=e,this._source&&this._source.disposed.connect(this.onSourceDisposed,this))}dispose(){this.isDisposed||(this.source=null,super.dispose())}onNewLog(e,t,n){if(!this.isAttached)return;this._console.tFoot||(this._console.createTFoot(),this._console.tFoot.className="amphi-Console-content");let s=this._console.tFoot.insertRow(0);s.className="amphi-Console-table-row";let o,i=s.insertCell(0);switch(i.innerHTML=`\n    <span>\n      ${y.renderToString(m().createElement(w.A,null,m().createElement(b,null,e)))}\n    </span>\n  `,i.style.padding="5px",i.className="amphi-Console-date",m().createElement(S.A,{style:{fontSize:24},spin:!0}),t){case"info":i=s.insertCell(1),i.style.padding="5px",o=document.createElement("div"),i.appendChild(o);let e=/SUCCESS/i.test(n)?"success":/ERROR|WARNING/i.test(n)?"warning":"info";console.log("content %o",n),_().render(m().createElement(x.A,{showIcon:!0,message:m().createElement("div",{dangerouslySetInnerHTML:{__html:n}}),type:e}),o);break;case"error":i=s.insertCell(1),i.style.padding="5px",o=document.createElement("div"),i.appendChild(o),_().render(m().createElement(x.A,{message:"Error",showIcon:!0,description:m().createElement("div",{dangerouslySetInnerHTML:{__html:n.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}}),type:"error"}),o);break;case"data":i=s.insertCell(1),i.style.padding="5",o=document.createElement("div"),i.appendChild(o);const t=(new DOMParser).parseFromString(n,"text/html").querySelector("div");t&&"documents"===t.id?o.innerHTML=n:_().render(m().createElement(C,{htmlData:n}),o)}this._console.parentElement.scrollTop=0}clearLogs(){if(this._console.tFoot)for(;this._console.tFoot.rows.length>0;)this._console.tFoot.deleteRow(0)}onSourceDisposed(e,t){this.source=null}}var E;!function(e){const t=new Map(Object.entries({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}));e.escapeHtml=function(e){return String(e).replace(/[&<>"'/]/g,(e=>t.get(e)))},e.createConsole=function(){return document.createElement("table")},e.createTitle=function(e=""){const t=document.createElement("p");return t.innerHTML=e,t}}(E||(E={}));class D{constructor(){this._source=null,this._panel=null,this._handlers={}}hasHandler(e){return!!this._handlers[e]}getHandler(e){return this._handlers[e]}addHandler(e){this._handlers[e.id]=e}get panel(){return this._panel}set panel(e){this.panel!==e&&(this._panel=e,e&&!e.source&&(e.source=this._source))}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this._onSourceDisposed,this),this._source=e,this._panel&&!this._panel.isDisposed&&(this._panel.source=this._source),this._source&&this._source.disposed.connect(this._onSourceDisposed,this))}_onSourceDisposed(){this._source=null}}var T=n(7262);const L=new T.Token("jupyterlab_extension/logconsole:IPipelineConsoleManager");var A;new T.Token("jupyterlab_extension/logconsole:IPipelineConsole"),function(e){e.open="pipeline-console:open"}(A||(A={}));const I=[{id:"@amphi/pipeline-log-console",requires:[s.ICommandPalette,o.ILayoutRestorer,o.ILabShell],provides:L,autoStart:!0,activate:(e,t,n,o)=>{const i=new D,l=A.open,a=new s.WidgetTracker({namespace:"pipeline-console"});return n.restore(a,{command:l,args:()=>({}),name:()=>"amphi-logConsole"}),e.commands.addCommand(l,{label:"Pipeline Console",execute:()=>{let t=null;for(const n of e.shell.widgets("main"))if("amphi-metadataPanel"===n.id){t=n;break}i.panel&&!i.panel.isDisposed||(i.panel=function(){const e=new k;return e.id="amphi-logConsole",e.title.label="Pipeline Console",e.title.icon=r.listIcon,e.title.closable=!0,e.disposed.connect((()=>{i.panel===e&&(i.panel=null)})),a.add(e),e}()),t&&t.isAttached?i.panel.isAttached||e.shell.add(i.panel,"main",{ref:t.id,mode:"tab-after"}):i.panel.isAttached||e.shell.add(i.panel,"main",{mode:"split-bottom"}),e.shell.activateById(i.panel.id)}}),t.addItem({command:l,category:"Pipeline Console"}),e.commands.addCommand("pipeline-console:clear",{execute:()=>{i.panel.clearLogs()},label:"Clear Console"}),e.commands.addCommand("pipeline-console:settings",{execute:()=>{},label:"Console Settings"}),e.contextMenu.addItem({command:"pipeline-console:clear",selector:".amphi-Console",rank:1}),console.log("JupyterLab extension @amphi/pipeline-log-console is activated!"),i}},{id:"@amphi/pipeline-log-console:pipelines",requires:[L,l.IPipelineTracker,o.ILabShell],autoStart:!0,activate:(e,t,n,o)=>{const r={};function l(e){const t=new Date(e);return`${t.toLocaleDateString()}\n${t.toLocaleTimeString()}`}n.widgetAdded.connect(((e,n)=>{t.hasHandler(n.context.sessionContext.path)?r[n.id]=new Promise(((e,s)=>{e(t.getHandler(n.context.sessionContext.path))})):r[n.id]=new Promise(((e,o)=>{const a=n.context.sessionContext,c=new h({session:a}),p={connector:c,id:a.path},u=new d(p);t.addHandler(u),n.disposed.connect((()=>{delete r[n.id],u.dispose()})),u.ready.then((()=>{e(u),c.ready.then((async()=>{a.session.kernel.anyMessage.connect(((e,n)=>{if(t.panel&&"recv"===n.direction)if("execute_result"===n.msg.header.msg_type||"display_data"===n.msg.header.msg_type){const e=n.msg.content;e.data["text/html"]&&t.panel.onNewLog(l(n.msg.header.date),"data",e.data["text/html"])}else if("stream"===n.msg.header.msg_type){const e=n.msg;if(e.content.text&&"\n"!==e.content.text){const o=document.createElement("div"),r={host:o,source:e.content.text,sanitizer:new s.Sanitizer};(0,i.renderText)(r).then((()=>{const e=o.outerHTML;t.panel.onNewLog(l(n.msg.header.date),"info",e)}))}}else if("error"===n.msg.header.msg_type){const e=n.msg,o=e.content.traceback.join("\n"),r=`traceback-${Date.now()}`,a=document.createElement("div"),c=`${e.content.evalue}`;a.innerHTML=`<pre><span>${c}</span><br><a href="#" style="text-decoration: underline; color: grey;" id="link-${r}" onClick="document.getElementById('${r}').style.display = document.getElementById('${r}').style.display === 'none' ? 'block' : 'none'; return false;">Show Traceback</a></pre>`;const d=document.createElement("pre");d.id=r,d.style.display="none",a.appendChild(d);const h={host:d,source:o,sanitizer:new s.Sanitizer};(0,i.renderText)(h).then((()=>{const n=a.outerHTML;t.panel.onNewLog(l(e.header.date),"error",n)}))}}))}))}))})),a(o)}));const a=(e,s)=>{var o;const i=null!==(o=null==s?void 0:s.newValue)&&void 0!==o?o:e.currentWidget;i&&n.has(i)&&r[i.id].then((e=>{e&&(t.source=e)}))};a(o),o.currentChanged.connect(a)}}]}}]);